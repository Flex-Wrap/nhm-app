(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();function _9(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function T2(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var d1={exports:{}},vf={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B_;function T9(){if(B_)return vf;B_=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,a){var o=null;if(a!==void 0&&(o=""+a),i.key!==void 0&&(o=""+i.key),"key"in i){a={};for(var u in i)u!=="key"&&(a[u]=i[u])}else a=i;return i=a.ref,{$$typeof:r,type:n,key:o,ref:i!==void 0?i:null,props:a}}return vf.Fragment=e,vf.jsx=t,vf.jsxs=t,vf}var j_;function S9(){return j_||(j_=1,d1.exports=T9()),d1.exports}var M=S9(),p1={exports:{}},ce={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U_;function A9(){if(U_)return ce;U_=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator;function m(W){return W===null||typeof W!="object"?null:(W=p&&W[p]||W["@@iterator"],typeof W=="function"?W:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,C={};function w(W,et,dt){this.props=W,this.context=et,this.refs=C,this.updater=dt||v}w.prototype.isReactComponent={},w.prototype.setState=function(W,et){if(typeof W!="object"&&typeof W!="function"&&W!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,W,et,"setState")},w.prototype.forceUpdate=function(W){this.updater.enqueueForceUpdate(this,W,"forceUpdate")};function E(){}E.prototype=w.prototype;function S(W,et,dt){this.props=W,this.context=et,this.refs=C,this.updater=dt||v}var A=S.prototype=new E;A.constructor=S,b(A,w.prototype),A.isPureReactComponent=!0;var k=Array.isArray,O={H:null,A:null,T:null,S:null,V:null},V=Object.prototype.hasOwnProperty;function T(W,et,dt,lt,St,Nt){return dt=Nt.ref,{$$typeof:r,type:W,key:et,ref:dt!==void 0?dt:null,props:Nt}}function R(W,et){return T(W.type,et,void 0,void 0,void 0,W.props)}function N(W){return typeof W=="object"&&W!==null&&W.$$typeof===r}function D(W){var et={"=":"=0",":":"=2"};return"$"+W.replace(/[=:]/g,function(dt){return et[dt]})}var L=/\/+/g;function P(W,et){return typeof W=="object"&&W!==null&&W.key!=null?D(""+W.key):et.toString(36)}function B(){}function Z(W){switch(W.status){case"fulfilled":return W.value;case"rejected":throw W.reason;default:switch(typeof W.status=="string"?W.then(B,B):(W.status="pending",W.then(function(et){W.status==="pending"&&(W.status="fulfilled",W.value=et)},function(et){W.status==="pending"&&(W.status="rejected",W.reason=et)})),W.status){case"fulfilled":return W.value;case"rejected":throw W.reason}}throw W}function rt(W,et,dt,lt,St){var Nt=typeof W;(Nt==="undefined"||Nt==="boolean")&&(W=null);var Rt=!1;if(W===null)Rt=!0;else switch(Nt){case"bigint":case"string":case"number":Rt=!0;break;case"object":switch(W.$$typeof){case r:case e:Rt=!0;break;case f:return Rt=W._init,rt(Rt(W._payload),et,dt,lt,St)}}if(Rt)return St=St(W),Rt=lt===""?"."+P(W,0):lt,k(St)?(dt="",Rt!=null&&(dt=Rt.replace(L,"$&/")+"/"),rt(St,et,dt,"",function(Xt){return Xt})):St!=null&&(N(St)&&(St=R(St,dt+(St.key==null||W&&W.key===St.key?"":(""+St.key).replace(L,"$&/")+"/")+Rt)),et.push(St)),1;Rt=0;var Ut=lt===""?".":lt+":";if(k(W))for(var Pt=0;Pt<W.length;Pt++)lt=W[Pt],Nt=Ut+P(lt,Pt),Rt+=rt(lt,et,dt,Nt,St);else if(Pt=m(W),typeof Pt=="function")for(W=Pt.call(W),Pt=0;!(lt=W.next()).done;)lt=lt.value,Nt=Ut+P(lt,Pt++),Rt+=rt(lt,et,dt,Nt,St);else if(Nt==="object"){if(typeof W.then=="function")return rt(Z(W),et,dt,lt,St);throw et=String(W),Error("Objects are not valid as a React child (found: "+(et==="[object Object]"?"object with keys {"+Object.keys(W).join(", ")+"}":et)+"). If you meant to render a collection of children, use an array instead.")}return Rt}function q(W,et,dt){if(W==null)return W;var lt=[],St=0;return rt(W,lt,"","",function(Nt){return et.call(dt,Nt,St++)}),lt}function K(W){if(W._status===-1){var et=W._result;et=et(),et.then(function(dt){(W._status===0||W._status===-1)&&(W._status=1,W._result=dt)},function(dt){(W._status===0||W._status===-1)&&(W._status=2,W._result=dt)}),W._status===-1&&(W._status=0,W._result=et)}if(W._status===1)return W._result.default;throw W._result}var Q=typeof reportError=="function"?reportError:function(W){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var et=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof W=="object"&&W!==null&&typeof W.message=="string"?String(W.message):String(W),error:W});if(!window.dispatchEvent(et))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",W);return}console.error(W)};function ut(){}return ce.Children={map:q,forEach:function(W,et,dt){q(W,function(){et.apply(this,arguments)},dt)},count:function(W){var et=0;return q(W,function(){et++}),et},toArray:function(W){return q(W,function(et){return et})||[]},only:function(W){if(!N(W))throw Error("React.Children.only expected to receive a single React element child.");return W}},ce.Component=w,ce.Fragment=t,ce.Profiler=i,ce.PureComponent=S,ce.StrictMode=n,ce.Suspense=l,ce.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,ce.__COMPILER_RUNTIME={__proto__:null,c:function(W){return O.H.useMemoCache(W)}},ce.cache=function(W){return function(){return W.apply(null,arguments)}},ce.cloneElement=function(W,et,dt){if(W==null)throw Error("The argument must be a React element, but you passed "+W+".");var lt=b({},W.props),St=W.key,Nt=void 0;if(et!=null)for(Rt in et.ref!==void 0&&(Nt=void 0),et.key!==void 0&&(St=""+et.key),et)!V.call(et,Rt)||Rt==="key"||Rt==="__self"||Rt==="__source"||Rt==="ref"&&et.ref===void 0||(lt[Rt]=et[Rt]);var Rt=arguments.length-2;if(Rt===1)lt.children=dt;else if(1<Rt){for(var Ut=Array(Rt),Pt=0;Pt<Rt;Pt++)Ut[Pt]=arguments[Pt+2];lt.children=Ut}return T(W.type,St,void 0,void 0,Nt,lt)},ce.createContext=function(W){return W={$$typeof:o,_currentValue:W,_currentValue2:W,_threadCount:0,Provider:null,Consumer:null},W.Provider=W,W.Consumer={$$typeof:a,_context:W},W},ce.createElement=function(W,et,dt){var lt,St={},Nt=null;if(et!=null)for(lt in et.key!==void 0&&(Nt=""+et.key),et)V.call(et,lt)&&lt!=="key"&&lt!=="__self"&&lt!=="__source"&&(St[lt]=et[lt]);var Rt=arguments.length-2;if(Rt===1)St.children=dt;else if(1<Rt){for(var Ut=Array(Rt),Pt=0;Pt<Rt;Pt++)Ut[Pt]=arguments[Pt+2];St.children=Ut}if(W&&W.defaultProps)for(lt in Rt=W.defaultProps,Rt)St[lt]===void 0&&(St[lt]=Rt[lt]);return T(W,Nt,void 0,void 0,null,St)},ce.createRef=function(){return{current:null}},ce.forwardRef=function(W){return{$$typeof:u,render:W}},ce.isValidElement=N,ce.lazy=function(W){return{$$typeof:f,_payload:{_status:-1,_result:W},_init:K}},ce.memo=function(W,et){return{$$typeof:h,type:W,compare:et===void 0?null:et}},ce.startTransition=function(W){var et=O.T,dt={};O.T=dt;try{var lt=W(),St=O.S;St!==null&&St(dt,lt),typeof lt=="object"&&lt!==null&&typeof lt.then=="function"&&lt.then(ut,Q)}catch(Nt){Q(Nt)}finally{O.T=et}},ce.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},ce.use=function(W){return O.H.use(W)},ce.useActionState=function(W,et,dt){return O.H.useActionState(W,et,dt)},ce.useCallback=function(W,et){return O.H.useCallback(W,et)},ce.useContext=function(W){return O.H.useContext(W)},ce.useDebugValue=function(){},ce.useDeferredValue=function(W,et){return O.H.useDeferredValue(W,et)},ce.useEffect=function(W,et,dt){var lt=O.H;if(typeof dt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return lt.useEffect(W,et)},ce.useId=function(){return O.H.useId()},ce.useImperativeHandle=function(W,et,dt){return O.H.useImperativeHandle(W,et,dt)},ce.useInsertionEffect=function(W,et){return O.H.useInsertionEffect(W,et)},ce.useLayoutEffect=function(W,et){return O.H.useLayoutEffect(W,et)},ce.useMemo=function(W,et){return O.H.useMemo(W,et)},ce.useOptimistic=function(W,et){return O.H.useOptimistic(W,et)},ce.useReducer=function(W,et,dt){return O.H.useReducer(W,et,dt)},ce.useRef=function(W){return O.H.useRef(W)},ce.useState=function(W){return O.H.useState(W)},ce.useSyncExternalStore=function(W,et,dt){return O.H.useSyncExternalStore(W,et,dt)},ce.useTransition=function(){return O.H.useTransition()},ce.version="19.1.0",ce}var W_;function S2(){return W_||(W_=1,p1.exports=A9()),p1.exports}var X=S2();const R9=_9(X);var m1={exports:{}},yf={},g1={exports:{}},v1={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H_;function N9(){return H_||(H_=1,function(r){function e(q,K){var Q=q.length;q.push(K);t:for(;0<Q;){var ut=Q-1>>>1,W=q[ut];if(0<i(W,K))q[ut]=K,q[Q]=W,Q=ut;else break t}}function t(q){return q.length===0?null:q[0]}function n(q){if(q.length===0)return null;var K=q[0],Q=q.pop();if(Q!==K){q[0]=Q;t:for(var ut=0,W=q.length,et=W>>>1;ut<et;){var dt=2*(ut+1)-1,lt=q[dt],St=dt+1,Nt=q[St];if(0>i(lt,Q))St<W&&0>i(Nt,lt)?(q[ut]=Nt,q[St]=Q,ut=St):(q[ut]=lt,q[dt]=Q,ut=dt);else if(St<W&&0>i(Nt,Q))q[ut]=Nt,q[St]=Q,ut=St;else break t}}return K}function i(q,K){var Q=q.sortIndex-K.sortIndex;return Q!==0?Q:q.id-K.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;r.unstable_now=function(){return a.now()}}else{var o=Date,u=o.now();r.unstable_now=function(){return o.now()-u}}var l=[],h=[],f=1,p=null,m=3,v=!1,b=!1,C=!1,w=!1,E=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function k(q){for(var K=t(h);K!==null;){if(K.callback===null)n(h);else if(K.startTime<=q)n(h),K.sortIndex=K.expirationTime,e(l,K);else break;K=t(h)}}function O(q){if(C=!1,k(q),!b)if(t(l)!==null)b=!0,V||(V=!0,P());else{var K=t(h);K!==null&&rt(O,K.startTime-q)}}var V=!1,T=-1,R=5,N=-1;function D(){return w?!0:!(r.unstable_now()-N<R)}function L(){if(w=!1,V){var q=r.unstable_now();N=q;var K=!0;try{t:{b=!1,C&&(C=!1,S(T),T=-1),v=!0;var Q=m;try{e:{for(k(q),p=t(l);p!==null&&!(p.expirationTime>q&&D());){var ut=p.callback;if(typeof ut=="function"){p.callback=null,m=p.priorityLevel;var W=ut(p.expirationTime<=q);if(q=r.unstable_now(),typeof W=="function"){p.callback=W,k(q),K=!0;break e}p===t(l)&&n(l),k(q)}else n(l);p=t(l)}if(p!==null)K=!0;else{var et=t(h);et!==null&&rt(O,et.startTime-q),K=!1}}break t}finally{p=null,m=Q,v=!1}K=void 0}}finally{K?P():V=!1}}}var P;if(typeof A=="function")P=function(){A(L)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,Z=B.port2;B.port1.onmessage=L,P=function(){Z.postMessage(null)}}else P=function(){E(L,0)};function rt(q,K){T=E(function(){q(r.unstable_now())},K)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(q){q.callback=null},r.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<q?Math.floor(1e3/q):5},r.unstable_getCurrentPriorityLevel=function(){return m},r.unstable_next=function(q){switch(m){case 1:case 2:case 3:var K=3;break;default:K=m}var Q=m;m=K;try{return q()}finally{m=Q}},r.unstable_requestPaint=function(){w=!0},r.unstable_runWithPriority=function(q,K){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var Q=m;m=q;try{return K()}finally{m=Q}},r.unstable_scheduleCallback=function(q,K,Q){var ut=r.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?ut+Q:ut):Q=ut,q){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=Q+W,q={id:f++,callback:K,priorityLevel:q,startTime:Q,expirationTime:W,sortIndex:-1},Q>ut?(q.sortIndex=Q,e(h,q),t(l)===null&&q===t(h)&&(C?(S(T),T=-1):C=!0,rt(O,Q-ut))):(q.sortIndex=W,e(l,q),b||v||(b=!0,V||(V=!0,P()))),q},r.unstable_shouldYield=D,r.unstable_wrapCallback=function(q){var K=m;return function(){var Q=m;m=K;try{return q.apply(this,arguments)}finally{m=Q}}}}(v1)),v1}var q_;function I9(){return q_||(q_=1,g1.exports=N9()),g1.exports}var y1={exports:{}},Tr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G_;function k9(){if(G_)return Tr;G_=1;var r=S2();function e(l){var h="https://react.dev/errors/"+l;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)h+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+l+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function a(l,h,f){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:p==null?null:""+p,children:l,containerInfo:h,implementation:f}}var o=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(l,h){if(l==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Tr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Tr.createPortal=function(l,h){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return a(l,h,null,f)},Tr.flushSync=function(l){var h=o.T,f=n.p;try{if(o.T=null,n.p=2,l)return l()}finally{o.T=h,n.p=f,n.d.f()}},Tr.preconnect=function(l,h){typeof l=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(l,h))},Tr.prefetchDNS=function(l){typeof l=="string"&&n.d.D(l)},Tr.preinit=function(l,h){if(typeof l=="string"&&h&&typeof h.as=="string"){var f=h.as,p=u(f,h.crossOrigin),m=typeof h.integrity=="string"?h.integrity:void 0,v=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;f==="style"?n.d.S(l,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:p,integrity:m,fetchPriority:v}):f==="script"&&n.d.X(l,{crossOrigin:p,integrity:m,fetchPriority:v,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Tr.preinitModule=function(l,h){if(typeof l=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var f=u(h.as,h.crossOrigin);n.d.M(l,{crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(l)},Tr.preload=function(l,h){if(typeof l=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var f=h.as,p=u(f,h.crossOrigin);n.d.L(l,f,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Tr.preloadModule=function(l,h){if(typeof l=="string")if(h){var f=u(h.as,h.crossOrigin);n.d.m(l,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:f,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(l)},Tr.requestFormReset=function(l){n.d.r(l)},Tr.unstable_batchedUpdates=function(l,h){return l(h)},Tr.useFormState=function(l,h,f){return o.H.useFormState(l,h,f)},Tr.useFormStatus=function(){return o.H.useHostTransitionStatus()},Tr.version="19.1.0",Tr}var $_;function D9(){if($_)return y1.exports;$_=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),y1.exports=k9(),y1.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K_;function O9(){if(K_)return yf;K_=1;var r=I9(),e=S2(),t=D9();function n(s){var c="https://react.dev/errors/"+s;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)c+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+s+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function a(s){var c=s,d=s;if(s.alternate)for(;c.return;)c=c.return;else{s=c;do c=s,(c.flags&4098)!==0&&(d=c.return),s=c.return;while(s)}return c.tag===3?d:null}function o(s){if(s.tag===13){var c=s.memoizedState;if(c===null&&(s=s.alternate,s!==null&&(c=s.memoizedState)),c!==null)return c.dehydrated}return null}function u(s){if(a(s)!==s)throw Error(n(188))}function l(s){var c=s.alternate;if(!c){if(c=a(s),c===null)throw Error(n(188));return c!==s?null:s}for(var d=s,g=c;;){var x=d.return;if(x===null)break;var _=x.alternate;if(_===null){if(g=x.return,g!==null){d=g;continue}break}if(x.child===_.child){for(_=x.child;_;){if(_===d)return u(x),s;if(_===g)return u(x),c;_=_.sibling}throw Error(n(188))}if(d.return!==g.return)d=x,g=_;else{for(var F=!1,j=x.child;j;){if(j===d){F=!0,d=x,g=_;break}if(j===g){F=!0,g=x,d=_;break}j=j.sibling}if(!F){for(j=_.child;j;){if(j===d){F=!0,d=_,g=x;break}if(j===g){F=!0,g=_,d=x;break}j=j.sibling}if(!F)throw Error(n(189))}}if(d.alternate!==g)throw Error(n(190))}if(d.tag!==3)throw Error(n(188));return d.stateNode.current===d?s:c}function h(s){var c=s.tag;if(c===5||c===26||c===27||c===6)return s;for(s=s.child;s!==null;){if(c=h(s),c!==null)return c;s=s.sibling}return null}var f=Object.assign,p=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),S=Symbol.for("react.consumer"),A=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),L=Symbol.iterator;function P(s){return s===null||typeof s!="object"?null:(s=L&&s[L]||s["@@iterator"],typeof s=="function"?s:null)}var B=Symbol.for("react.client.reference");function Z(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===B?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case b:return"Fragment";case w:return"Profiler";case C:return"StrictMode";case O:return"Suspense";case V:return"SuspenseList";case N:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case v:return"Portal";case A:return(s.displayName||"Context")+".Provider";case S:return(s._context.displayName||"Context")+".Consumer";case k:var c=s.render;return s=s.displayName,s||(s=c.displayName||c.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case T:return c=s.displayName||null,c!==null?c:Z(s.type)||"Memo";case R:c=s._payload,s=s._init;try{return Z(s(c))}catch{}}return null}var rt=Array.isArray,q=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q={pending:!1,data:null,method:null,action:null},ut=[],W=-1;function et(s){return{current:s}}function dt(s){0>W||(s.current=ut[W],ut[W]=null,W--)}function lt(s,c){W++,ut[W]=s.current,s.current=c}var St=et(null),Nt=et(null),Rt=et(null),Ut=et(null);function Pt(s,c){switch(lt(Rt,c),lt(Nt,s),lt(St,null),c.nodeType){case 9:case 11:s=(s=c.documentElement)&&(s=s.namespaceURI)?p_(s):0;break;default:if(s=c.tagName,c=c.namespaceURI)c=p_(c),s=m_(c,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}dt(St),lt(St,s)}function Xt(){dt(St),dt(Nt),dt(Rt)}function Le(s){s.memoizedState!==null&&lt(Ut,s);var c=St.current,d=m_(c,s.type);c!==d&&(lt(Nt,s),lt(St,d))}function Zt(s){Nt.current===s&&(dt(St),dt(Nt)),Ut.current===s&&(dt(Ut),ff._currentValue=Q)}var ye=Object.prototype.hasOwnProperty,se=r.unstable_scheduleCallback,Jt=r.unstable_cancelCallback,ze=r.unstable_shouldYield,Ae=r.unstable_requestPaint,Ke=r.unstable_now,Dr=r.unstable_getCurrentPriorityLevel,En=r.unstable_ImmediatePriority,In=r.unstable_UserBlockingPriority,un=r.unstable_NormalPriority,Er=r.unstable_LowPriority,re=r.unstable_IdlePriority,Un=r.log,ln=r.unstable_setDisableYieldValue,fe=null,le=null;function dn(s){if(typeof Un=="function"&&ln(s),le&&typeof le.setStrictMode=="function")try{le.setStrictMode(fe,s)}catch{}}var Re=Math.clz32?Math.clz32:Fi,Ei=Math.log,Hr=Math.LN2;function Fi(s){return s>>>=0,s===0?32:31-(Ei(s)/Hr|0)|0}var Bi=256,ji=4194304;function lr(s){var c=s&42;if(c!==0)return c;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function ca(s,c,d){var g=s.pendingLanes;if(g===0)return 0;var x=0,_=s.suspendedLanes,F=s.pingedLanes;s=s.warmLanes;var j=g&134217727;return j!==0?(g=j&~_,g!==0?x=lr(g):(F&=j,F!==0?x=lr(F):d||(d=j&~s,d!==0&&(x=lr(d))))):(j=g&~_,j!==0?x=lr(j):F!==0?x=lr(F):d||(d=g&~s,d!==0&&(x=lr(d)))),x===0?0:c!==0&&c!==x&&(c&_)===0&&(_=x&-x,d=c&-c,_>=d||_===32&&(d&4194048)!==0)?c:x}function Ui(s,c){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&c)===0}function hh(s,c){switch(s){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fh(){var s=Bi;return Bi<<=1,(Bi&4194048)===0&&(Bi=256),s}function dh(){var s=ji;return ji<<=1,(ji&62914560)===0&&(ji=4194304),s}function qa(s){for(var c=[],d=0;31>d;d++)c.push(s);return c}function Ga(s,c){s.pendingLanes|=c,c!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function ph(s,c,d,g,x,_){var F=s.pendingLanes;s.pendingLanes=d,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=d,s.entangledLanes&=d,s.errorRecoveryDisabledLanes&=d,s.shellSuspendCounter=0;var j=s.entanglements,Y=s.expirationTimes,ct=s.hiddenUpdates;for(d=F&~d;0<d;){var bt=31-Re(d),Ct=1<<bt;j[bt]=0,Y[bt]=-1;var ht=ct[bt];if(ht!==null)for(ct[bt]=null,bt=0;bt<ht.length;bt++){var pt=ht[bt];pt!==null&&(pt.lane&=-536870913)}d&=~Ct}g!==0&&ha(s,g,0),_!==0&&x===0&&s.tag!==0&&(s.suspendedLanes|=_&~(F&~c))}function ha(s,c,d){s.pendingLanes|=c,s.suspendedLanes&=~c;var g=31-Re(c);s.entangledLanes|=c,s.entanglements[g]=s.entanglements[g]|1073741824|d&4194090}function mh(s,c){var d=s.entangledLanes|=c;for(s=s.entanglements;d;){var g=31-Re(d),x=1<<g;x&c|s[g]&c&&(s[g]|=c),d&=~x}}function Uo(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function gl(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Wo(){var s=K.p;return s!==0?s:(s=window.event,s===void 0?32:M_(s.type))}function tp(s,c){var d=K.p;try{return K.p=s,c()}finally{K.p=d}}var cn=Math.random().toString(36).slice(2),Wn="__reactFiber$"+cn,kn="__reactProps$"+cn,_i="__reactContainer$"+cn,gh="__reactEvents$"+cn,gy="__reactListeners$"+cn,Ho="__reactHandles$"+cn,ep="__reactResources$"+cn,Qs="__reactMarker$"+cn;function qo(s){delete s[Wn],delete s[kn],delete s[gh],delete s[gy],delete s[Ho]}function $a(s){var c=s[Wn];if(c)return c;for(var d=s.parentNode;d;){if(c=d[_i]||d[Wn]){if(d=c.alternate,c.child!==null||d!==null&&d.child!==null)for(s=b_(s);s!==null;){if(d=s[Wn])return d;s=b_(s)}return c}s=d,d=s.parentNode}return null}function fa(s){if(s=s[Wn]||s[_i]){var c=s.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return s}return null}function da(s){var c=s.tag;if(c===5||c===26||c===27||c===6)return s.stateNode;throw Error(n(33))}function Or(s){var c=s[ep];return c||(c=s[ep]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function _n(s){s[Qs]=!0}var vh=new Set,vl={};function Wi(s,c){Ka(s,c),Ka(s+"Capture",c)}function Ka(s,c){for(vl[s]=c,s=0;s<c.length;s++)vh.add(c[s])}var np=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),rp={},Zs={};function ip(s){return ye.call(Zs,s)?!0:ye.call(rp,s)?!1:np.test(s)?Zs[s]=!0:(rp[s]=!0,!1)}function Go(s,c,d){if(ip(c))if(d===null)s.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":s.removeAttribute(c);return;case"boolean":var g=c.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){s.removeAttribute(c);return}}s.setAttribute(c,""+d)}}function pa(s,c,d){if(d===null)s.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttribute(c,""+d)}}function cr(s,c,d,g){if(g===null)s.removeAttribute(d);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(d);return}s.setAttributeNS(c,d,""+g)}}var Js,ap;function Xa(s){if(Js===void 0)try{throw Error()}catch(d){var c=d.stack.trim().match(/\n( *(at )?)/);Js=c&&c[1]||"",ap=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Js+s+ap}var yl=!1;function bl(s,c){if(!s||yl)return"";yl=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(c){var Ct=function(){throw Error()};if(Object.defineProperty(Ct.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ct,[])}catch(pt){var ht=pt}Reflect.construct(s,[],Ct)}else{try{Ct.call()}catch(pt){ht=pt}s.call(Ct.prototype)}}else{try{throw Error()}catch(pt){ht=pt}(Ct=s())&&typeof Ct.catch=="function"&&Ct.catch(function(){})}}catch(pt){if(pt&&ht&&typeof pt.stack=="string")return[pt.stack,ht.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _=g.DetermineComponentFrameRoot(),F=_[0],j=_[1];if(F&&j){var Y=F.split(`
`),ct=j.split(`
`);for(x=g=0;g<Y.length&&!Y[g].includes("DetermineComponentFrameRoot");)g++;for(;x<ct.length&&!ct[x].includes("DetermineComponentFrameRoot");)x++;if(g===Y.length||x===ct.length)for(g=Y.length-1,x=ct.length-1;1<=g&&0<=x&&Y[g]!==ct[x];)x--;for(;1<=g&&0<=x;g--,x--)if(Y[g]!==ct[x]){if(g!==1||x!==1)do if(g--,x--,0>x||Y[g]!==ct[x]){var bt=`
`+Y[g].replace(" at new "," at ");return s.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",s.displayName)),bt}while(1<=g&&0<=x);break}}}finally{yl=!1,Error.prepareStackTrace=d}return(d=s?s.displayName||s.name:"")?Xa(d):""}function yh(s){switch(s.tag){case 26:case 27:case 5:return Xa(s.type);case 16:return Xa("Lazy");case 13:return Xa("Suspense");case 19:return Xa("SuspenseList");case 0:case 15:return bl(s.type,!1);case 11:return bl(s.type.render,!1);case 1:return bl(s.type,!0);case 31:return Xa("Activity");default:return""}}function xl(s){try{var c="";do c+=yh(s),s=s.return;while(s);return c}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}function Mr(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function bh(s){var c=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function vy(s){var c=bh(s)?"checked":"value",d=Object.getOwnPropertyDescriptor(s.constructor.prototype,c),g=""+s[c];if(!s.hasOwnProperty(c)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var x=d.get,_=d.set;return Object.defineProperty(s,c,{configurable:!0,get:function(){return x.call(this)},set:function(F){g=""+F,_.call(this,F)}}),Object.defineProperty(s,c,{enumerable:d.enumerable}),{getValue:function(){return g},setValue:function(F){g=""+F},stopTracking:function(){s._valueTracker=null,delete s[c]}}}}function wl(s){s._valueTracker||(s._valueTracker=vy(s))}function xh(s){if(!s)return!1;var c=s._valueTracker;if(!c)return!0;var d=c.getValue(),g="";return s&&(g=bh(s)?s.checked?"true":"false":s.value),s=g,s!==d?(c.setValue(s),!0):!1}function tu(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var yy=/[\n"\\]/g;function Dn(s){return s.replace(yy,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function ni(s,c,d,g,x,_,F,j){s.name="",F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?s.type=F:s.removeAttribute("type"),c!=null?F==="number"?(c===0&&s.value===""||s.value!=c)&&(s.value=""+Mr(c)):s.value!==""+Mr(c)&&(s.value=""+Mr(c)):F!=="submit"&&F!=="reset"||s.removeAttribute("value"),c!=null?$o(s,F,Mr(c)):d!=null?$o(s,F,Mr(d)):g!=null&&s.removeAttribute("value"),x==null&&_!=null&&(s.defaultChecked=!!_),x!=null&&(s.checked=x&&typeof x!="function"&&typeof x!="symbol"),j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?s.name=""+Mr(j):s.removeAttribute("name")}function eu(s,c,d,g,x,_,F,j){if(_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(s.type=_),c!=null||d!=null){if(!(_!=="submit"&&_!=="reset"||c!=null))return;d=d!=null?""+Mr(d):"",c=c!=null?""+Mr(c):d,j||c===s.value||(s.value=c),s.defaultValue=c}g=g??x,g=typeof g!="function"&&typeof g!="symbol"&&!!g,s.checked=j?s.checked:!!g,s.defaultChecked=!!g,F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"&&(s.name=F)}function $o(s,c,d){c==="number"&&tu(s.ownerDocument)===s||s.defaultValue===""+d||(s.defaultValue=""+d)}function Ya(s,c,d,g){if(s=s.options,c){c={};for(var x=0;x<d.length;x++)c["$"+d[x]]=!0;for(d=0;d<s.length;d++)x=c.hasOwnProperty("$"+s[d].value),s[d].selected!==x&&(s[d].selected=x),x&&g&&(s[d].defaultSelected=!0)}else{for(d=""+Mr(d),c=null,x=0;x<s.length;x++){if(s[x].value===d){s[x].selected=!0,g&&(s[x].defaultSelected=!0);return}c!==null||s[x].disabled||(c=s[x])}c!==null&&(c.selected=!0)}}function Xe(s,c,d){if(c!=null&&(c=""+Mr(c),c!==s.value&&(s.value=c),d==null)){s.defaultValue!==c&&(s.defaultValue=c);return}s.defaultValue=d!=null?""+Mr(d):""}function nu(s,c,d,g){if(c==null){if(g!=null){if(d!=null)throw Error(n(92));if(rt(g)){if(1<g.length)throw Error(n(93));g=g[0]}d=g}d==null&&(d=""),c=d}d=Mr(c),s.defaultValue=d,g=s.textContent,g===d&&g!==""&&g!==null&&(s.value=g)}function Ti(s,c){if(c){var d=s.firstChild;if(d&&d===s.lastChild&&d.nodeType===3){d.nodeValue=c;return}}s.textContent=c}var ru=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function op(s,c,d){var g=c.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?g?s.setProperty(c,""):c==="float"?s.cssFloat="":s[c]="":g?s.setProperty(c,d):typeof d!="number"||d===0||ru.has(c)?c==="float"?s.cssFloat=d:s[c]=(""+d).trim():s[c]=d+"px"}function wh(s,c,d){if(c!=null&&typeof c!="object")throw Error(n(62));if(s=s.style,d!=null){for(var g in d)!d.hasOwnProperty(g)||c!=null&&c.hasOwnProperty(g)||(g.indexOf("--")===0?s.setProperty(g,""):g==="float"?s.cssFloat="":s[g]="");for(var x in c)g=c[x],c.hasOwnProperty(x)&&d[x]!==g&&op(s,x,g)}else for(var _ in c)c.hasOwnProperty(_)&&op(s,_,c[_])}function Ch(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var by=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),xy=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Cl(s){return xy.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var Qa=null;function Si(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Za=null,Ja=null;function Eh(s){var c=fa(s);if(c&&(s=c.stateNode)){var d=s[kn]||null;t:switch(s=c.stateNode,c.type){case"input":if(ni(s,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),c=d.name,d.type==="radio"&&c!=null){for(d=s;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Dn(""+c)+'"][type="radio"]'),c=0;c<d.length;c++){var g=d[c];if(g!==s&&g.form===s.form){var x=g[kn]||null;if(!x)throw Error(n(90));ni(g,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(c=0;c<d.length;c++)g=d[c],g.form===s.form&&xh(g)}break t;case"textarea":Xe(s,d.value,d.defaultValue);break t;case"select":c=d.value,c!=null&&Ya(s,!!d.multiple,c,!1)}}}var ma=!1;function sp(s,c,d){if(ma)return s(c,d);ma=!0;try{var g=s(c);return g}finally{if(ma=!1,(Za!==null||Ja!==null)&&(tm(),Za&&(c=Za,s=Ja,Ja=Za=null,Eh(c),s)))for(c=0;c<s.length;c++)Eh(s[c])}}function iu(s,c){var d=s.stateNode;if(d===null)return null;var g=d[kn]||null;if(g===null)return null;d=g[c];t:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(s=s.type,g=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!g;break t;default:s=!1}if(s)return null;if(d&&typeof d!="function")throw Error(n(231,c,typeof d));return d}var Hi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ai=!1;if(Hi)try{var au={};Object.defineProperty(au,"passive",{get:function(){Ai=!0}}),window.addEventListener("test",au,au),window.removeEventListener("test",au,au)}catch{Ai=!1}var ga=null,Ko=null,to=null;function _h(){if(to)return to;var s,c=Ko,d=c.length,g,x="value"in ga?ga.value:ga.textContent,_=x.length;for(s=0;s<d&&c[s]===x[s];s++);var F=d-s;for(g=1;g<=F&&c[d-g]===x[_-g];g++);return to=x.slice(s,1<g?1-g:void 0)}function va(s){var c=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&c===13&&(s=13)):s=c,s===10&&(s=13),32<=s||s===13?s:0}function ya(){return!0}function Th(){return!1}function Zn(s){function c(d,g,x,_,F){this._reactName=d,this._targetInst=x,this.type=g,this.nativeEvent=_,this.target=F,this.currentTarget=null;for(var j in s)s.hasOwnProperty(j)&&(d=s[j],this[j]=d?d(_):_[j]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?ya:Th,this.isPropagationStopped=Th,this}return f(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=ya)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=ya)},persist:function(){},isPersistent:ya}),c}var je={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},El=Zn(je),ou=f({},je,{view:0,detail:0}),up=Zn(ou),_l,Tl,ba,su=f({},ou,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cu,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==ba&&(ba&&s.type==="mousemove"?(_l=s.screenX-ba.screenX,Tl=s.screenY-ba.screenY):Tl=_l=0,ba=s),_l)},movementY:function(s){return"movementY"in s?s.movementY:Tl}}),Ri=Zn(su),lp=f({},su,{dataTransfer:0}),wy=Zn(lp),uu=f({},ou,{relatedTarget:0}),Sl=Zn(uu),Sh=f({},je,{animationName:0,elapsedTime:0,pseudoElement:0}),Al=Zn(Sh),cp=f({},je,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Rl=Zn(cp),Cy=f({},je,{data:0}),Ah=Zn(Cy),lu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rh(s){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(s):(s=fp[s])?!!c[s]:!1}function cu(){return Rh}var dp=f({},ou,{key:function(s){if(s.key){var c=lu[s.key]||s.key;if(c!=="Unidentified")return c}return s.type==="keypress"?(s=va(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?hp[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cu,charCode:function(s){return s.type==="keypress"?va(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?va(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Nl=Zn(dp),pp=f({},su,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Nh=Zn(pp),eo=f({},ou,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cu}),mp=Zn(eo),gp=f({},je,{propertyName:0,elapsedTime:0,pseudoElement:0}),vp=Zn(gp),yp=f({},su,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Il=Zn(yp),Lr=f({},je,{newState:0,oldState:0}),bp=Zn(Lr),xp=[9,13,27,32],xa=Hi&&"CompositionEvent"in window,y=null;Hi&&"documentMode"in document&&(y=document.documentMode);var I=Hi&&"TextEvent"in window&&!y,z=Hi&&(!xa||y&&8<y&&11>=y),H=" ",ot=!1;function yt(s,c){switch(s){case"keyup":return xp.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function It(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Ne=!1;function Hn(s,c){switch(s){case"compositionend":return It(c);case"keypress":return c.which!==32?null:(ot=!0,H);case"textInput":return s=c.data,s===H&&ot?null:s;default:return null}}function Ie(s,c){if(Ne)return s==="compositionend"||!xa&&yt(s,c)?(s=_h(),to=Ko=ga=null,Ne=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return z&&c.locale!=="ko"?null:c.data;default:return null}}var Jn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(s){var c=s&&s.nodeName&&s.nodeName.toLowerCase();return c==="input"?!!Jn[s.type]:c==="textarea"}function no(s,c,d,g){Za?Ja?Ja.push(g):Ja=[g]:Za=g,c=om(c,"onChange"),0<c.length&&(d=new El("onChange","change",null,d,g),s.push({event:d,listeners:c}))}var hr=null,wa=null;function Ih(s){l_(s,0)}function wp(s){var c=da(s);if(xh(c))return s}function IC(s,c){if(s==="change")return c}var kC=!1;if(Hi){var Ey;if(Hi){var _y="oninput"in document;if(!_y){var DC=document.createElement("div");DC.setAttribute("oninput","return;"),_y=typeof DC.oninput=="function"}Ey=_y}else Ey=!1;kC=Ey&&(!document.documentMode||9<document.documentMode)}function OC(){hr&&(hr.detachEvent("onpropertychange",MC),wa=hr=null)}function MC(s){if(s.propertyName==="value"&&wp(wa)){var c=[];no(c,wa,s,Si(s)),sp(Ih,c)}}function tO(s,c,d){s==="focusin"?(OC(),hr=c,wa=d,hr.attachEvent("onpropertychange",MC)):s==="focusout"&&OC()}function eO(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return wp(wa)}function nO(s,c){if(s==="click")return wp(c)}function rO(s,c){if(s==="input"||s==="change")return wp(c)}function iO(s,c){return s===c&&(s!==0||1/s===1/c)||s!==s&&c!==c}var ri=typeof Object.is=="function"?Object.is:iO;function kh(s,c){if(ri(s,c))return!0;if(typeof s!="object"||s===null||typeof c!="object"||c===null)return!1;var d=Object.keys(s),g=Object.keys(c);if(d.length!==g.length)return!1;for(g=0;g<d.length;g++){var x=d[g];if(!ye.call(c,x)||!ri(s[x],c[x]))return!1}return!0}function LC(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function PC(s,c){var d=LC(s);s=0;for(var g;d;){if(d.nodeType===3){if(g=s+d.textContent.length,s<=c&&g>=c)return{node:d,offset:c-s};s=g}t:{for(;d;){if(d.nextSibling){d=d.nextSibling;break t}d=d.parentNode}d=void 0}d=LC(d)}}function zC(s,c){return s&&c?s===c?!0:s&&s.nodeType===3?!1:c&&c.nodeType===3?zC(s,c.parentNode):"contains"in s?s.contains(c):s.compareDocumentPosition?!!(s.compareDocumentPosition(c)&16):!1:!1}function VC(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var c=tu(s.document);c instanceof s.HTMLIFrameElement;){try{var d=typeof c.contentWindow.location.href=="string"}catch{d=!1}if(d)s=c.contentWindow;else break;c=tu(s.document)}return c}function Ty(s){var c=s&&s.nodeName&&s.nodeName.toLowerCase();return c&&(c==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||c==="textarea"||s.contentEditable==="true")}var aO=Hi&&"documentMode"in document&&11>=document.documentMode,kl=null,Sy=null,Dh=null,Ay=!1;function FC(s,c,d){var g=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Ay||kl==null||kl!==tu(g)||(g=kl,"selectionStart"in g&&Ty(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Dh&&kh(Dh,g)||(Dh=g,g=om(Sy,"onSelect"),0<g.length&&(c=new El("onSelect","select",null,c,d),s.push({event:c,listeners:g}),c.target=kl)))}function hu(s,c){var d={};return d[s.toLowerCase()]=c.toLowerCase(),d["Webkit"+s]="webkit"+c,d["Moz"+s]="moz"+c,d}var Dl={animationend:hu("Animation","AnimationEnd"),animationiteration:hu("Animation","AnimationIteration"),animationstart:hu("Animation","AnimationStart"),transitionrun:hu("Transition","TransitionRun"),transitionstart:hu("Transition","TransitionStart"),transitioncancel:hu("Transition","TransitionCancel"),transitionend:hu("Transition","TransitionEnd")},Ry={},BC={};Hi&&(BC=document.createElement("div").style,"AnimationEvent"in window||(delete Dl.animationend.animation,delete Dl.animationiteration.animation,delete Dl.animationstart.animation),"TransitionEvent"in window||delete Dl.transitionend.transition);function fu(s){if(Ry[s])return Ry[s];if(!Dl[s])return s;var c=Dl[s],d;for(d in c)if(c.hasOwnProperty(d)&&d in BC)return Ry[s]=c[d];return s}var jC=fu("animationend"),UC=fu("animationiteration"),WC=fu("animationstart"),oO=fu("transitionrun"),sO=fu("transitionstart"),uO=fu("transitioncancel"),HC=fu("transitionend"),qC=new Map,Ny="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ny.push("scrollEnd");function qi(s,c){qC.set(s,c),Wi(c,[s])}var GC=new WeakMap;function Ni(s,c){if(typeof s=="object"&&s!==null){var d=GC.get(s);return d!==void 0?d:(c={value:s,source:c,stack:xl(c)},GC.set(s,c),c)}return{value:s,source:c,stack:xl(c)}}var Ii=[],Ol=0,Iy=0;function Cp(){for(var s=Ol,c=Iy=Ol=0;c<s;){var d=Ii[c];Ii[c++]=null;var g=Ii[c];Ii[c++]=null;var x=Ii[c];Ii[c++]=null;var _=Ii[c];if(Ii[c++]=null,g!==null&&x!==null){var F=g.pending;F===null?x.next=x:(x.next=F.next,F.next=x),g.pending=x}_!==0&&$C(d,x,_)}}function Ep(s,c,d,g){Ii[Ol++]=s,Ii[Ol++]=c,Ii[Ol++]=d,Ii[Ol++]=g,Iy|=g,s.lanes|=g,s=s.alternate,s!==null&&(s.lanes|=g)}function ky(s,c,d,g){return Ep(s,c,d,g),_p(s)}function Ml(s,c){return Ep(s,null,null,c),_p(s)}function $C(s,c,d){s.lanes|=d;var g=s.alternate;g!==null&&(g.lanes|=d);for(var x=!1,_=s.return;_!==null;)_.childLanes|=d,g=_.alternate,g!==null&&(g.childLanes|=d),_.tag===22&&(s=_.stateNode,s===null||s._visibility&1||(x=!0)),s=_,_=_.return;return s.tag===3?(_=s.stateNode,x&&c!==null&&(x=31-Re(d),s=_.hiddenUpdates,g=s[x],g===null?s[x]=[c]:g.push(c),c.lane=d|536870912),_):null}function _p(s){if(50<rf)throw rf=0,z0=null,Error(n(185));for(var c=s.return;c!==null;)s=c,c=s.return;return s.tag===3?s.stateNode:null}var Ll={};function lO(s,c,d,g){this.tag=s,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ii(s,c,d,g){return new lO(s,c,d,g)}function Dy(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ro(s,c){var d=s.alternate;return d===null?(d=ii(s.tag,c,s.key,s.mode),d.elementType=s.elementType,d.type=s.type,d.stateNode=s.stateNode,d.alternate=s,s.alternate=d):(d.pendingProps=c,d.type=s.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=s.flags&65011712,d.childLanes=s.childLanes,d.lanes=s.lanes,d.child=s.child,d.memoizedProps=s.memoizedProps,d.memoizedState=s.memoizedState,d.updateQueue=s.updateQueue,c=s.dependencies,d.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},d.sibling=s.sibling,d.index=s.index,d.ref=s.ref,d.refCleanup=s.refCleanup,d}function KC(s,c){s.flags&=65011714;var d=s.alternate;return d===null?(s.childLanes=0,s.lanes=c,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=d.childLanes,s.lanes=d.lanes,s.child=d.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=d.memoizedProps,s.memoizedState=d.memoizedState,s.updateQueue=d.updateQueue,s.type=d.type,c=d.dependencies,s.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),s}function Tp(s,c,d,g,x,_){var F=0;if(g=s,typeof s=="function")Dy(s)&&(F=1);else if(typeof s=="string")F=h9(s,d,St.current)?26:s==="html"||s==="head"||s==="body"?27:5;else t:switch(s){case N:return s=ii(31,d,c,x),s.elementType=N,s.lanes=_,s;case b:return du(d.children,x,_,c);case C:F=8,x|=24;break;case w:return s=ii(12,d,c,x|2),s.elementType=w,s.lanes=_,s;case O:return s=ii(13,d,c,x),s.elementType=O,s.lanes=_,s;case V:return s=ii(19,d,c,x),s.elementType=V,s.lanes=_,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case E:case A:F=10;break t;case S:F=9;break t;case k:F=11;break t;case T:F=14;break t;case R:F=16,g=null;break t}F=29,d=Error(n(130,s===null?"null":typeof s,"")),g=null}return c=ii(F,d,c,x),c.elementType=s,c.type=g,c.lanes=_,c}function du(s,c,d,g){return s=ii(7,s,g,c),s.lanes=d,s}function Oy(s,c,d){return s=ii(6,s,null,c),s.lanes=d,s}function My(s,c,d){return c=ii(4,s.children!==null?s.children:[],s.key,c),c.lanes=d,c.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},c}var Pl=[],zl=0,Sp=null,Ap=0,ki=[],Di=0,pu=null,io=1,ao="";function mu(s,c){Pl[zl++]=Ap,Pl[zl++]=Sp,Sp=s,Ap=c}function XC(s,c,d){ki[Di++]=io,ki[Di++]=ao,ki[Di++]=pu,pu=s;var g=io;s=ao;var x=32-Re(g)-1;g&=~(1<<x),d+=1;var _=32-Re(c)+x;if(30<_){var F=x-x%5;_=(g&(1<<F)-1).toString(32),g>>=F,x-=F,io=1<<32-Re(c)+x|d<<x|g,ao=_+s}else io=1<<_|d<<x|g,ao=s}function Ly(s){s.return!==null&&(mu(s,1),XC(s,1,0))}function Py(s){for(;s===Sp;)Sp=Pl[--zl],Pl[zl]=null,Ap=Pl[--zl],Pl[zl]=null;for(;s===pu;)pu=ki[--Di],ki[Di]=null,ao=ki[--Di],ki[Di]=null,io=ki[--Di],ki[Di]=null}var Pr=null,yn=null,Fe=!1,gu=null,Ca=!1,zy=Error(n(519));function vu(s){var c=Error(n(418,""));throw Lh(Ni(c,s)),zy}function YC(s){var c=s.stateNode,d=s.type,g=s.memoizedProps;switch(c[Wn]=s,c[kn]=g,d){case"dialog":Ce("cancel",c),Ce("close",c);break;case"iframe":case"object":case"embed":Ce("load",c);break;case"video":case"audio":for(d=0;d<of.length;d++)Ce(of[d],c);break;case"source":Ce("error",c);break;case"img":case"image":case"link":Ce("error",c),Ce("load",c);break;case"details":Ce("toggle",c);break;case"input":Ce("invalid",c),eu(c,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0),wl(c);break;case"select":Ce("invalid",c);break;case"textarea":Ce("invalid",c),nu(c,g.value,g.defaultValue,g.children),wl(c)}d=g.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||c.textContent===""+d||g.suppressHydrationWarning===!0||d_(c.textContent,d)?(g.popover!=null&&(Ce("beforetoggle",c),Ce("toggle",c)),g.onScroll!=null&&Ce("scroll",c),g.onScrollEnd!=null&&Ce("scrollend",c),g.onClick!=null&&(c.onclick=sm),c=!0):c=!1,c||vu(s)}function QC(s){for(Pr=s.return;Pr;)switch(Pr.tag){case 5:case 13:Ca=!1;return;case 27:case 3:Ca=!0;return;default:Pr=Pr.return}}function Oh(s){if(s!==Pr)return!1;if(!Fe)return QC(s),Fe=!0,!1;var c=s.tag,d;if((d=c!==3&&c!==27)&&((d=c===5)&&(d=s.type,d=!(d!=="form"&&d!=="button")||J0(s.type,s.memoizedProps)),d=!d),d&&yn&&vu(s),QC(s),c===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(317));t:{for(s=s.nextSibling,c=0;s;){if(s.nodeType===8)if(d=s.data,d==="/$"){if(c===0){yn=$i(s.nextSibling);break t}c--}else d!=="$"&&d!=="$!"&&d!=="$?"||c++;s=s.nextSibling}yn=null}}else c===27?(c=yn,cs(s.type)?(s=r1,r1=null,yn=s):yn=c):yn=Pr?$i(s.stateNode.nextSibling):null;return!0}function Mh(){yn=Pr=null,Fe=!1}function ZC(){var s=gu;return s!==null&&($r===null?$r=s:$r.push.apply($r,s),gu=null),s}function Lh(s){gu===null?gu=[s]:gu.push(s)}var Vy=et(null),yu=null,oo=null;function Xo(s,c,d){lt(Vy,c._currentValue),c._currentValue=d}function so(s){s._currentValue=Vy.current,dt(Vy)}function Fy(s,c,d){for(;s!==null;){var g=s.alternate;if((s.childLanes&c)!==c?(s.childLanes|=c,g!==null&&(g.childLanes|=c)):g!==null&&(g.childLanes&c)!==c&&(g.childLanes|=c),s===d)break;s=s.return}}function By(s,c,d,g){var x=s.child;for(x!==null&&(x.return=s);x!==null;){var _=x.dependencies;if(_!==null){var F=x.child;_=_.firstContext;t:for(;_!==null;){var j=_;_=x;for(var Y=0;Y<c.length;Y++)if(j.context===c[Y]){_.lanes|=d,j=_.alternate,j!==null&&(j.lanes|=d),Fy(_.return,d,s),g||(F=null);break t}_=j.next}}else if(x.tag===18){if(F=x.return,F===null)throw Error(n(341));F.lanes|=d,_=F.alternate,_!==null&&(_.lanes|=d),Fy(F,d,s),F=null}else F=x.child;if(F!==null)F.return=x;else for(F=x;F!==null;){if(F===s){F=null;break}if(x=F.sibling,x!==null){x.return=F.return,F=x;break}F=F.return}x=F}}function Ph(s,c,d,g){s=null;for(var x=c,_=!1;x!==null;){if(!_){if((x.flags&524288)!==0)_=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var F=x.alternate;if(F===null)throw Error(n(387));if(F=F.memoizedProps,F!==null){var j=x.type;ri(x.pendingProps.value,F.value)||(s!==null?s.push(j):s=[j])}}else if(x===Ut.current){if(F=x.alternate,F===null)throw Error(n(387));F.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(s!==null?s.push(ff):s=[ff])}x=x.return}s!==null&&By(c,s,d,g),c.flags|=262144}function Rp(s){for(s=s.firstContext;s!==null;){if(!ri(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function bu(s){yu=s,oo=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function _r(s){return JC(yu,s)}function Np(s,c){return yu===null&&bu(s),JC(s,c)}function JC(s,c){var d=c._currentValue;if(c={context:c,memoizedValue:d,next:null},oo===null){if(s===null)throw Error(n(308));oo=c,s.dependencies={lanes:0,firstContext:c},s.flags|=524288}else oo=oo.next=c;return d}var cO=typeof AbortController<"u"?AbortController:function(){var s=[],c=this.signal={aborted:!1,addEventListener:function(d,g){s.push(g)}};this.abort=function(){c.aborted=!0,s.forEach(function(d){return d()})}},hO=r.unstable_scheduleCallback,fO=r.unstable_NormalPriority,Gn={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function jy(){return{controller:new cO,data:new Map,refCount:0}}function zh(s){s.refCount--,s.refCount===0&&hO(fO,function(){s.controller.abort()})}var Vh=null,Uy=0,Vl=0,Fl=null;function dO(s,c){if(Vh===null){var d=Vh=[];Uy=0,Vl=H0(),Fl={status:"pending",value:void 0,then:function(g){d.push(g)}}}return Uy++,c.then(tE,tE),c}function tE(){if(--Uy===0&&Vh!==null){Fl!==null&&(Fl.status="fulfilled");var s=Vh;Vh=null,Vl=0,Fl=null;for(var c=0;c<s.length;c++)(0,s[c])()}}function pO(s,c){var d=[],g={status:"pending",value:null,reason:null,then:function(x){d.push(x)}};return s.then(function(){g.status="fulfilled",g.value=c;for(var x=0;x<d.length;x++)(0,d[x])(c)},function(x){for(g.status="rejected",g.reason=x,x=0;x<d.length;x++)(0,d[x])(void 0)}),g}var eE=q.S;q.S=function(s,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&dO(s,c),eE!==null&&eE(s,c)};var xu=et(null);function Wy(){var s=xu.current;return s!==null?s:en.pooledCache}function Ip(s,c){c===null?lt(xu,xu.current):lt(xu,c.pool)}function nE(){var s=Wy();return s===null?null:{parent:Gn._currentValue,pool:s}}var Fh=Error(n(460)),rE=Error(n(474)),kp=Error(n(542)),Hy={then:function(){}};function iE(s){return s=s.status,s==="fulfilled"||s==="rejected"}function Dp(){}function aE(s,c,d){switch(d=s[d],d===void 0?s.push(c):d!==c&&(c.then(Dp,Dp),c=d),c.status){case"fulfilled":return c.value;case"rejected":throw s=c.reason,sE(s),s;default:if(typeof c.status=="string")c.then(Dp,Dp);else{if(s=en,s!==null&&100<s.shellSuspendCounter)throw Error(n(482));s=c,s.status="pending",s.then(function(g){if(c.status==="pending"){var x=c;x.status="fulfilled",x.value=g}},function(g){if(c.status==="pending"){var x=c;x.status="rejected",x.reason=g}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw s=c.reason,sE(s),s}throw Bh=c,Fh}}var Bh=null;function oE(){if(Bh===null)throw Error(n(459));var s=Bh;return Bh=null,s}function sE(s){if(s===Fh||s===kp)throw Error(n(483))}var Yo=!1;function qy(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Gy(s,c){s=s.updateQueue,c.updateQueue===s&&(c.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Qo(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Zo(s,c,d){var g=s.updateQueue;if(g===null)return null;if(g=g.shared,(He&2)!==0){var x=g.pending;return x===null?c.next=c:(c.next=x.next,x.next=c),g.pending=c,c=_p(s),$C(s,null,d),c}return Ep(s,g,c,d),_p(s)}function jh(s,c,d){if(c=c.updateQueue,c!==null&&(c=c.shared,(d&4194048)!==0)){var g=c.lanes;g&=s.pendingLanes,d|=g,c.lanes=d,mh(s,d)}}function $y(s,c){var d=s.updateQueue,g=s.alternate;if(g!==null&&(g=g.updateQueue,d===g)){var x=null,_=null;if(d=d.firstBaseUpdate,d!==null){do{var F={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};_===null?x=_=F:_=_.next=F,d=d.next}while(d!==null);_===null?x=_=c:_=_.next=c}else x=_=c;d={baseState:g.baseState,firstBaseUpdate:x,lastBaseUpdate:_,shared:g.shared,callbacks:g.callbacks},s.updateQueue=d;return}s=d.lastBaseUpdate,s===null?d.firstBaseUpdate=c:s.next=c,d.lastBaseUpdate=c}var Ky=!1;function Uh(){if(Ky){var s=Fl;if(s!==null)throw s}}function Wh(s,c,d,g){Ky=!1;var x=s.updateQueue;Yo=!1;var _=x.firstBaseUpdate,F=x.lastBaseUpdate,j=x.shared.pending;if(j!==null){x.shared.pending=null;var Y=j,ct=Y.next;Y.next=null,F===null?_=ct:F.next=ct,F=Y;var bt=s.alternate;bt!==null&&(bt=bt.updateQueue,j=bt.lastBaseUpdate,j!==F&&(j===null?bt.firstBaseUpdate=ct:j.next=ct,bt.lastBaseUpdate=Y))}if(_!==null){var Ct=x.baseState;F=0,bt=ct=Y=null,j=_;do{var ht=j.lane&-536870913,pt=ht!==j.lane;if(pt?(ke&ht)===ht:(g&ht)===ht){ht!==0&&ht===Vl&&(Ky=!0),bt!==null&&(bt=bt.next={lane:0,tag:j.tag,payload:j.payload,callback:null,next:null});t:{var Qt=s,Gt=j;ht=c;var Ze=d;switch(Gt.tag){case 1:if(Qt=Gt.payload,typeof Qt=="function"){Ct=Qt.call(Ze,Ct,ht);break t}Ct=Qt;break t;case 3:Qt.flags=Qt.flags&-65537|128;case 0:if(Qt=Gt.payload,ht=typeof Qt=="function"?Qt.call(Ze,Ct,ht):Qt,ht==null)break t;Ct=f({},Ct,ht);break t;case 2:Yo=!0}}ht=j.callback,ht!==null&&(s.flags|=64,pt&&(s.flags|=8192),pt=x.callbacks,pt===null?x.callbacks=[ht]:pt.push(ht))}else pt={lane:ht,tag:j.tag,payload:j.payload,callback:j.callback,next:null},bt===null?(ct=bt=pt,Y=Ct):bt=bt.next=pt,F|=ht;if(j=j.next,j===null){if(j=x.shared.pending,j===null)break;pt=j,j=pt.next,pt.next=null,x.lastBaseUpdate=pt,x.shared.pending=null}}while(!0);bt===null&&(Y=Ct),x.baseState=Y,x.firstBaseUpdate=ct,x.lastBaseUpdate=bt,_===null&&(x.shared.lanes=0),os|=F,s.lanes=F,s.memoizedState=Ct}}function uE(s,c){if(typeof s!="function")throw Error(n(191,s));s.call(c)}function lE(s,c){var d=s.callbacks;if(d!==null)for(s.callbacks=null,s=0;s<d.length;s++)uE(d[s],c)}var Bl=et(null),Op=et(0);function cE(s,c){s=mo,lt(Op,s),lt(Bl,c),mo=s|c.baseLanes}function Xy(){lt(Op,mo),lt(Bl,Bl.current)}function Yy(){mo=Op.current,dt(Bl),dt(Op)}var Jo=0,ge=null,Ye=null,On=null,Mp=!1,jl=!1,wu=!1,Lp=0,Hh=0,Ul=null,mO=0;function Tn(){throw Error(n(321))}function Qy(s,c){if(c===null)return!1;for(var d=0;d<c.length&&d<s.length;d++)if(!ri(s[d],c[d]))return!1;return!0}function Zy(s,c,d,g,x,_){return Jo=_,ge=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,q.H=s===null||s.memoizedState===null?$E:KE,wu=!1,_=d(g,x),wu=!1,jl&&(_=fE(c,d,g,x)),hE(s),_}function hE(s){q.H=jp;var c=Ye!==null&&Ye.next!==null;if(Jo=0,On=Ye=ge=null,Mp=!1,Hh=0,Ul=null,c)throw Error(n(300));s===null||tr||(s=s.dependencies,s!==null&&Rp(s)&&(tr=!0))}function fE(s,c,d,g){ge=s;var x=0;do{if(jl&&(Ul=null),Hh=0,jl=!1,25<=x)throw Error(n(301));if(x+=1,On=Ye=null,s.updateQueue!=null){var _=s.updateQueue;_.lastEffect=null,_.events=null,_.stores=null,_.memoCache!=null&&(_.memoCache.index=0)}q.H=CO,_=c(d,g)}while(jl);return _}function gO(){var s=q.H,c=s.useState()[0];return c=typeof c.then=="function"?qh(c):c,s=s.useState()[0],(Ye!==null?Ye.memoizedState:null)!==s&&(ge.flags|=1024),c}function Jy(){var s=Lp!==0;return Lp=0,s}function t0(s,c,d){c.updateQueue=s.updateQueue,c.flags&=-2053,s.lanes&=~d}function e0(s){if(Mp){for(s=s.memoizedState;s!==null;){var c=s.queue;c!==null&&(c.pending=null),s=s.next}Mp=!1}Jo=0,On=Ye=ge=null,jl=!1,Hh=Lp=0,Ul=null}function qr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return On===null?ge.memoizedState=On=s:On=On.next=s,On}function Mn(){if(Ye===null){var s=ge.alternate;s=s!==null?s.memoizedState:null}else s=Ye.next;var c=On===null?ge.memoizedState:On.next;if(c!==null)On=c,Ye=s;else{if(s===null)throw ge.alternate===null?Error(n(467)):Error(n(310));Ye=s,s={memoizedState:Ye.memoizedState,baseState:Ye.baseState,baseQueue:Ye.baseQueue,queue:Ye.queue,next:null},On===null?ge.memoizedState=On=s:On=On.next=s}return On}function n0(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function qh(s){var c=Hh;return Hh+=1,Ul===null&&(Ul=[]),s=aE(Ul,s,c),c=ge,(On===null?c.memoizedState:On.next)===null&&(c=c.alternate,q.H=c===null||c.memoizedState===null?$E:KE),s}function Pp(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return qh(s);if(s.$$typeof===A)return _r(s)}throw Error(n(438,String(s)))}function r0(s){var c=null,d=ge.updateQueue;if(d!==null&&(c=d.memoCache),c==null){var g=ge.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(c={data:g.data.map(function(x){return x.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),d===null&&(d=n0(),ge.updateQueue=d),d.memoCache=c,d=c.data[c.index],d===void 0)for(d=c.data[c.index]=Array(s),g=0;g<s;g++)d[g]=D;return c.index++,d}function uo(s,c){return typeof c=="function"?c(s):c}function zp(s){var c=Mn();return i0(c,Ye,s)}function i0(s,c,d){var g=s.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=d;var x=s.baseQueue,_=g.pending;if(_!==null){if(x!==null){var F=x.next;x.next=_.next,_.next=F}c.baseQueue=x=_,g.pending=null}if(_=s.baseState,x===null)s.memoizedState=_;else{c=x.next;var j=F=null,Y=null,ct=c,bt=!1;do{var Ct=ct.lane&-536870913;if(Ct!==ct.lane?(ke&Ct)===Ct:(Jo&Ct)===Ct){var ht=ct.revertLane;if(ht===0)Y!==null&&(Y=Y.next={lane:0,revertLane:0,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null}),Ct===Vl&&(bt=!0);else if((Jo&ht)===ht){ct=ct.next,ht===Vl&&(bt=!0);continue}else Ct={lane:0,revertLane:ct.revertLane,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null},Y===null?(j=Y=Ct,F=_):Y=Y.next=Ct,ge.lanes|=ht,os|=ht;Ct=ct.action,wu&&d(_,Ct),_=ct.hasEagerState?ct.eagerState:d(_,Ct)}else ht={lane:Ct,revertLane:ct.revertLane,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null},Y===null?(j=Y=ht,F=_):Y=Y.next=ht,ge.lanes|=Ct,os|=Ct;ct=ct.next}while(ct!==null&&ct!==c);if(Y===null?F=_:Y.next=j,!ri(_,s.memoizedState)&&(tr=!0,bt&&(d=Fl,d!==null)))throw d;s.memoizedState=_,s.baseState=F,s.baseQueue=Y,g.lastRenderedState=_}return x===null&&(g.lanes=0),[s.memoizedState,g.dispatch]}function a0(s){var c=Mn(),d=c.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=s;var g=d.dispatch,x=d.pending,_=c.memoizedState;if(x!==null){d.pending=null;var F=x=x.next;do _=s(_,F.action),F=F.next;while(F!==x);ri(_,c.memoizedState)||(tr=!0),c.memoizedState=_,c.baseQueue===null&&(c.baseState=_),d.lastRenderedState=_}return[_,g]}function dE(s,c,d){var g=ge,x=Mn(),_=Fe;if(_){if(d===void 0)throw Error(n(407));d=d()}else d=c();var F=!ri((Ye||x).memoizedState,d);F&&(x.memoizedState=d,tr=!0),x=x.queue;var j=gE.bind(null,g,x,s);if(Gh(2048,8,j,[s]),x.getSnapshot!==c||F||On!==null&&On.memoizedState.tag&1){if(g.flags|=2048,Wl(9,Vp(),mE.bind(null,g,x,d,c),null),en===null)throw Error(n(349));_||(Jo&124)!==0||pE(g,c,d)}return d}function pE(s,c,d){s.flags|=16384,s={getSnapshot:c,value:d},c=ge.updateQueue,c===null?(c=n0(),ge.updateQueue=c,c.stores=[s]):(d=c.stores,d===null?c.stores=[s]:d.push(s))}function mE(s,c,d,g){c.value=d,c.getSnapshot=g,vE(c)&&yE(s)}function gE(s,c,d){return d(function(){vE(c)&&yE(s)})}function vE(s){var c=s.getSnapshot;s=s.value;try{var d=c();return!ri(s,d)}catch{return!0}}function yE(s){var c=Ml(s,2);c!==null&&li(c,s,2)}function o0(s){var c=qr();if(typeof s=="function"){var d=s;if(s=d(),wu){dn(!0);try{d()}finally{dn(!1)}}}return c.memoizedState=c.baseState=s,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:uo,lastRenderedState:s},c}function bE(s,c,d,g){return s.baseState=d,i0(s,Ye,typeof g=="function"?g:uo)}function vO(s,c,d,g,x){if(Bp(s))throw Error(n(485));if(s=c.action,s!==null){var _={payload:x,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(F){_.listeners.push(F)}};q.T!==null?d(!0):_.isTransition=!1,g(_),d=c.pending,d===null?(_.next=c.pending=_,xE(c,_)):(_.next=d.next,c.pending=d.next=_)}}function xE(s,c){var d=c.action,g=c.payload,x=s.state;if(c.isTransition){var _=q.T,F={};q.T=F;try{var j=d(x,g),Y=q.S;Y!==null&&Y(F,j),wE(s,c,j)}catch(ct){s0(s,c,ct)}finally{q.T=_}}else try{_=d(x,g),wE(s,c,_)}catch(ct){s0(s,c,ct)}}function wE(s,c,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(g){CE(s,c,g)},function(g){return s0(s,c,g)}):CE(s,c,d)}function CE(s,c,d){c.status="fulfilled",c.value=d,EE(c),s.state=d,c=s.pending,c!==null&&(d=c.next,d===c?s.pending=null:(d=d.next,c.next=d,xE(s,d)))}function s0(s,c,d){var g=s.pending;if(s.pending=null,g!==null){g=g.next;do c.status="rejected",c.reason=d,EE(c),c=c.next;while(c!==g)}s.action=null}function EE(s){s=s.listeners;for(var c=0;c<s.length;c++)(0,s[c])()}function _E(s,c){return c}function TE(s,c){if(Fe){var d=en.formState;if(d!==null){t:{var g=ge;if(Fe){if(yn){e:{for(var x=yn,_=Ca;x.nodeType!==8;){if(!_){x=null;break e}if(x=$i(x.nextSibling),x===null){x=null;break e}}_=x.data,x=_==="F!"||_==="F"?x:null}if(x){yn=$i(x.nextSibling),g=x.data==="F!";break t}}vu(g)}g=!1}g&&(c=d[0])}}return d=qr(),d.memoizedState=d.baseState=c,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_E,lastRenderedState:c},d.queue=g,d=HE.bind(null,ge,g),g.dispatch=d,g=o0(!1),_=f0.bind(null,ge,!1,g.queue),g=qr(),x={state:c,dispatch:null,action:s,pending:null},g.queue=x,d=vO.bind(null,ge,x,_,d),x.dispatch=d,g.memoizedState=s,[c,d,!1]}function SE(s){var c=Mn();return AE(c,Ye,s)}function AE(s,c,d){if(c=i0(s,c,_E)[0],s=zp(uo)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var g=qh(c)}catch(F){throw F===Fh?kp:F}else g=c;c=Mn();var x=c.queue,_=x.dispatch;return d!==c.memoizedState&&(ge.flags|=2048,Wl(9,Vp(),yO.bind(null,x,d),null)),[g,_,s]}function yO(s,c){s.action=c}function RE(s){var c=Mn(),d=Ye;if(d!==null)return AE(c,d,s);Mn(),c=c.memoizedState,d=Mn();var g=d.queue.dispatch;return d.memoizedState=s,[c,g,!1]}function Wl(s,c,d,g){return s={tag:s,create:d,deps:g,inst:c,next:null},c=ge.updateQueue,c===null&&(c=n0(),ge.updateQueue=c),d=c.lastEffect,d===null?c.lastEffect=s.next=s:(g=d.next,d.next=s,s.next=g,c.lastEffect=s),s}function Vp(){return{destroy:void 0,resource:void 0}}function NE(){return Mn().memoizedState}function Fp(s,c,d,g){var x=qr();g=g===void 0?null:g,ge.flags|=s,x.memoizedState=Wl(1|c,Vp(),d,g)}function Gh(s,c,d,g){var x=Mn();g=g===void 0?null:g;var _=x.memoizedState.inst;Ye!==null&&g!==null&&Qy(g,Ye.memoizedState.deps)?x.memoizedState=Wl(c,_,d,g):(ge.flags|=s,x.memoizedState=Wl(1|c,_,d,g))}function IE(s,c){Fp(8390656,8,s,c)}function kE(s,c){Gh(2048,8,s,c)}function DE(s,c){return Gh(4,2,s,c)}function OE(s,c){return Gh(4,4,s,c)}function ME(s,c){if(typeof c=="function"){s=s();var d=c(s);return function(){typeof d=="function"?d():c(null)}}if(c!=null)return s=s(),c.current=s,function(){c.current=null}}function LE(s,c,d){d=d!=null?d.concat([s]):null,Gh(4,4,ME.bind(null,c,s),d)}function u0(){}function PE(s,c){var d=Mn();c=c===void 0?null:c;var g=d.memoizedState;return c!==null&&Qy(c,g[1])?g[0]:(d.memoizedState=[s,c],s)}function zE(s,c){var d=Mn();c=c===void 0?null:c;var g=d.memoizedState;if(c!==null&&Qy(c,g[1]))return g[0];if(g=s(),wu){dn(!0);try{s()}finally{dn(!1)}}return d.memoizedState=[g,c],g}function l0(s,c,d){return d===void 0||(Jo&1073741824)!==0?s.memoizedState=c:(s.memoizedState=d,s=B3(),ge.lanes|=s,os|=s,d)}function VE(s,c,d,g){return ri(d,c)?d:Bl.current!==null?(s=l0(s,d,g),ri(s,c)||(tr=!0),s):(Jo&42)===0?(tr=!0,s.memoizedState=d):(s=B3(),ge.lanes|=s,os|=s,c)}function FE(s,c,d,g,x){var _=K.p;K.p=_!==0&&8>_?_:8;var F=q.T,j={};q.T=j,f0(s,!1,c,d);try{var Y=x(),ct=q.S;if(ct!==null&&ct(j,Y),Y!==null&&typeof Y=="object"&&typeof Y.then=="function"){var bt=pO(Y,g);$h(s,c,bt,ui(s))}else $h(s,c,g,ui(s))}catch(Ct){$h(s,c,{then:function(){},status:"rejected",reason:Ct},ui())}finally{K.p=_,q.T=F}}function bO(){}function c0(s,c,d,g){if(s.tag!==5)throw Error(n(476));var x=BE(s).queue;FE(s,x,c,Q,d===null?bO:function(){return jE(s),d(g)})}function BE(s){var c=s.memoizedState;if(c!==null)return c;c={memoizedState:Q,baseState:Q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:uo,lastRenderedState:Q},next:null};var d={};return c.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:uo,lastRenderedState:d},next:null},s.memoizedState=c,s=s.alternate,s!==null&&(s.memoizedState=c),c}function jE(s){var c=BE(s).next.queue;$h(s,c,{},ui())}function h0(){return _r(ff)}function UE(){return Mn().memoizedState}function WE(){return Mn().memoizedState}function xO(s){for(var c=s.return;c!==null;){switch(c.tag){case 24:case 3:var d=ui();s=Qo(d);var g=Zo(c,s,d);g!==null&&(li(g,c,d),jh(g,c,d)),c={cache:jy()},s.payload=c;return}c=c.return}}function wO(s,c,d){var g=ui();d={lane:g,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null},Bp(s)?qE(c,d):(d=ky(s,c,d,g),d!==null&&(li(d,s,g),GE(d,c,g)))}function HE(s,c,d){var g=ui();$h(s,c,d,g)}function $h(s,c,d,g){var x={lane:g,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null};if(Bp(s))qE(c,x);else{var _=s.alternate;if(s.lanes===0&&(_===null||_.lanes===0)&&(_=c.lastRenderedReducer,_!==null))try{var F=c.lastRenderedState,j=_(F,d);if(x.hasEagerState=!0,x.eagerState=j,ri(j,F))return Ep(s,c,x,0),en===null&&Cp(),!1}catch{}finally{}if(d=ky(s,c,x,g),d!==null)return li(d,s,g),GE(d,c,g),!0}return!1}function f0(s,c,d,g){if(g={lane:2,revertLane:H0(),action:g,hasEagerState:!1,eagerState:null,next:null},Bp(s)){if(c)throw Error(n(479))}else c=ky(s,d,g,2),c!==null&&li(c,s,2)}function Bp(s){var c=s.alternate;return s===ge||c!==null&&c===ge}function qE(s,c){jl=Mp=!0;var d=s.pending;d===null?c.next=c:(c.next=d.next,d.next=c),s.pending=c}function GE(s,c,d){if((d&4194048)!==0){var g=c.lanes;g&=s.pendingLanes,d|=g,c.lanes=d,mh(s,d)}}var jp={readContext:_r,use:Pp,useCallback:Tn,useContext:Tn,useEffect:Tn,useImperativeHandle:Tn,useLayoutEffect:Tn,useInsertionEffect:Tn,useMemo:Tn,useReducer:Tn,useRef:Tn,useState:Tn,useDebugValue:Tn,useDeferredValue:Tn,useTransition:Tn,useSyncExternalStore:Tn,useId:Tn,useHostTransitionStatus:Tn,useFormState:Tn,useActionState:Tn,useOptimistic:Tn,useMemoCache:Tn,useCacheRefresh:Tn},$E={readContext:_r,use:Pp,useCallback:function(s,c){return qr().memoizedState=[s,c===void 0?null:c],s},useContext:_r,useEffect:IE,useImperativeHandle:function(s,c,d){d=d!=null?d.concat([s]):null,Fp(4194308,4,ME.bind(null,c,s),d)},useLayoutEffect:function(s,c){return Fp(4194308,4,s,c)},useInsertionEffect:function(s,c){Fp(4,2,s,c)},useMemo:function(s,c){var d=qr();c=c===void 0?null:c;var g=s();if(wu){dn(!0);try{s()}finally{dn(!1)}}return d.memoizedState=[g,c],g},useReducer:function(s,c,d){var g=qr();if(d!==void 0){var x=d(c);if(wu){dn(!0);try{d(c)}finally{dn(!1)}}}else x=c;return g.memoizedState=g.baseState=x,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:x},g.queue=s,s=s.dispatch=wO.bind(null,ge,s),[g.memoizedState,s]},useRef:function(s){var c=qr();return s={current:s},c.memoizedState=s},useState:function(s){s=o0(s);var c=s.queue,d=HE.bind(null,ge,c);return c.dispatch=d,[s.memoizedState,d]},useDebugValue:u0,useDeferredValue:function(s,c){var d=qr();return l0(d,s,c)},useTransition:function(){var s=o0(!1);return s=FE.bind(null,ge,s.queue,!0,!1),qr().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,c,d){var g=ge,x=qr();if(Fe){if(d===void 0)throw Error(n(407));d=d()}else{if(d=c(),en===null)throw Error(n(349));(ke&124)!==0||pE(g,c,d)}x.memoizedState=d;var _={value:d,getSnapshot:c};return x.queue=_,IE(gE.bind(null,g,_,s),[s]),g.flags|=2048,Wl(9,Vp(),mE.bind(null,g,_,d,c),null),d},useId:function(){var s=qr(),c=en.identifierPrefix;if(Fe){var d=ao,g=io;d=(g&~(1<<32-Re(g)-1)).toString(32)+d,c=""+c+"R"+d,d=Lp++,0<d&&(c+="H"+d.toString(32)),c+=""}else d=mO++,c=""+c+"r"+d.toString(32)+"";return s.memoizedState=c},useHostTransitionStatus:h0,useFormState:TE,useActionState:TE,useOptimistic:function(s){var c=qr();c.memoizedState=c.baseState=s;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=d,c=f0.bind(null,ge,!0,d),d.dispatch=c,[s,c]},useMemoCache:r0,useCacheRefresh:function(){return qr().memoizedState=xO.bind(null,ge)}},KE={readContext:_r,use:Pp,useCallback:PE,useContext:_r,useEffect:kE,useImperativeHandle:LE,useInsertionEffect:DE,useLayoutEffect:OE,useMemo:zE,useReducer:zp,useRef:NE,useState:function(){return zp(uo)},useDebugValue:u0,useDeferredValue:function(s,c){var d=Mn();return VE(d,Ye.memoizedState,s,c)},useTransition:function(){var s=zp(uo)[0],c=Mn().memoizedState;return[typeof s=="boolean"?s:qh(s),c]},useSyncExternalStore:dE,useId:UE,useHostTransitionStatus:h0,useFormState:SE,useActionState:SE,useOptimistic:function(s,c){var d=Mn();return bE(d,Ye,s,c)},useMemoCache:r0,useCacheRefresh:WE},CO={readContext:_r,use:Pp,useCallback:PE,useContext:_r,useEffect:kE,useImperativeHandle:LE,useInsertionEffect:DE,useLayoutEffect:OE,useMemo:zE,useReducer:a0,useRef:NE,useState:function(){return a0(uo)},useDebugValue:u0,useDeferredValue:function(s,c){var d=Mn();return Ye===null?l0(d,s,c):VE(d,Ye.memoizedState,s,c)},useTransition:function(){var s=a0(uo)[0],c=Mn().memoizedState;return[typeof s=="boolean"?s:qh(s),c]},useSyncExternalStore:dE,useId:UE,useHostTransitionStatus:h0,useFormState:RE,useActionState:RE,useOptimistic:function(s,c){var d=Mn();return Ye!==null?bE(d,Ye,s,c):(d.baseState=s,[s,d.queue.dispatch])},useMemoCache:r0,useCacheRefresh:WE},Hl=null,Kh=0;function Up(s){var c=Kh;return Kh+=1,Hl===null&&(Hl=[]),aE(Hl,s,c)}function Xh(s,c){c=c.props.ref,s.ref=c!==void 0?c:null}function Wp(s,c){throw c.$$typeof===p?Error(n(525)):(s=Object.prototype.toString.call(c),Error(n(31,s==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":s)))}function XE(s){var c=s._init;return c(s._payload)}function YE(s){function c(at,nt){if(s){var st=at.deletions;st===null?(at.deletions=[nt],at.flags|=16):st.push(nt)}}function d(at,nt){if(!s)return null;for(;nt!==null;)c(at,nt),nt=nt.sibling;return null}function g(at){for(var nt=new Map;at!==null;)at.key!==null?nt.set(at.key,at):nt.set(at.index,at),at=at.sibling;return nt}function x(at,nt){return at=ro(at,nt),at.index=0,at.sibling=null,at}function _(at,nt,st){return at.index=st,s?(st=at.alternate,st!==null?(st=st.index,st<nt?(at.flags|=67108866,nt):st):(at.flags|=67108866,nt)):(at.flags|=1048576,nt)}function F(at){return s&&at.alternate===null&&(at.flags|=67108866),at}function j(at,nt,st,wt){return nt===null||nt.tag!==6?(nt=Oy(st,at.mode,wt),nt.return=at,nt):(nt=x(nt,st),nt.return=at,nt)}function Y(at,nt,st,wt){var Vt=st.type;return Vt===b?bt(at,nt,st.props.children,wt,st.key):nt!==null&&(nt.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===R&&XE(Vt)===nt.type)?(nt=x(nt,st.props),Xh(nt,st),nt.return=at,nt):(nt=Tp(st.type,st.key,st.props,null,at.mode,wt),Xh(nt,st),nt.return=at,nt)}function ct(at,nt,st,wt){return nt===null||nt.tag!==4||nt.stateNode.containerInfo!==st.containerInfo||nt.stateNode.implementation!==st.implementation?(nt=My(st,at.mode,wt),nt.return=at,nt):(nt=x(nt,st.children||[]),nt.return=at,nt)}function bt(at,nt,st,wt,Vt){return nt===null||nt.tag!==7?(nt=du(st,at.mode,wt,Vt),nt.return=at,nt):(nt=x(nt,st),nt.return=at,nt)}function Ct(at,nt,st){if(typeof nt=="string"&&nt!==""||typeof nt=="number"||typeof nt=="bigint")return nt=Oy(""+nt,at.mode,st),nt.return=at,nt;if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case m:return st=Tp(nt.type,nt.key,nt.props,null,at.mode,st),Xh(st,nt),st.return=at,st;case v:return nt=My(nt,at.mode,st),nt.return=at,nt;case R:var wt=nt._init;return nt=wt(nt._payload),Ct(at,nt,st)}if(rt(nt)||P(nt))return nt=du(nt,at.mode,st,null),nt.return=at,nt;if(typeof nt.then=="function")return Ct(at,Up(nt),st);if(nt.$$typeof===A)return Ct(at,Np(at,nt),st);Wp(at,nt)}return null}function ht(at,nt,st,wt){var Vt=nt!==null?nt.key:null;if(typeof st=="string"&&st!==""||typeof st=="number"||typeof st=="bigint")return Vt!==null?null:j(at,nt,""+st,wt);if(typeof st=="object"&&st!==null){switch(st.$$typeof){case m:return st.key===Vt?Y(at,nt,st,wt):null;case v:return st.key===Vt?ct(at,nt,st,wt):null;case R:return Vt=st._init,st=Vt(st._payload),ht(at,nt,st,wt)}if(rt(st)||P(st))return Vt!==null?null:bt(at,nt,st,wt,null);if(typeof st.then=="function")return ht(at,nt,Up(st),wt);if(st.$$typeof===A)return ht(at,nt,Np(at,st),wt);Wp(at,st)}return null}function pt(at,nt,st,wt,Vt){if(typeof wt=="string"&&wt!==""||typeof wt=="number"||typeof wt=="bigint")return at=at.get(st)||null,j(nt,at,""+wt,Vt);if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case m:return at=at.get(wt.key===null?st:wt.key)||null,Y(nt,at,wt,Vt);case v:return at=at.get(wt.key===null?st:wt.key)||null,ct(nt,at,wt,Vt);case R:var be=wt._init;return wt=be(wt._payload),pt(at,nt,st,wt,Vt)}if(rt(wt)||P(wt))return at=at.get(st)||null,bt(nt,at,wt,Vt,null);if(typeof wt.then=="function")return pt(at,nt,st,Up(wt),Vt);if(wt.$$typeof===A)return pt(at,nt,st,Np(nt,wt),Vt);Wp(nt,wt)}return null}function Qt(at,nt,st,wt){for(var Vt=null,be=null,Wt=nt,$t=nt=0,nr=null;Wt!==null&&$t<st.length;$t++){Wt.index>$t?(nr=Wt,Wt=null):nr=Wt.sibling;var Ve=ht(at,Wt,st[$t],wt);if(Ve===null){Wt===null&&(Wt=nr);break}s&&Wt&&Ve.alternate===null&&c(at,Wt),nt=_(Ve,nt,$t),be===null?Vt=Ve:be.sibling=Ve,be=Ve,Wt=nr}if($t===st.length)return d(at,Wt),Fe&&mu(at,$t),Vt;if(Wt===null){for(;$t<st.length;$t++)Wt=Ct(at,st[$t],wt),Wt!==null&&(nt=_(Wt,nt,$t),be===null?Vt=Wt:be.sibling=Wt,be=Wt);return Fe&&mu(at,$t),Vt}for(Wt=g(Wt);$t<st.length;$t++)nr=pt(Wt,at,$t,st[$t],wt),nr!==null&&(s&&nr.alternate!==null&&Wt.delete(nr.key===null?$t:nr.key),nt=_(nr,nt,$t),be===null?Vt=nr:be.sibling=nr,be=nr);return s&&Wt.forEach(function(ms){return c(at,ms)}),Fe&&mu(at,$t),Vt}function Gt(at,nt,st,wt){if(st==null)throw Error(n(151));for(var Vt=null,be=null,Wt=nt,$t=nt=0,nr=null,Ve=st.next();Wt!==null&&!Ve.done;$t++,Ve=st.next()){Wt.index>$t?(nr=Wt,Wt=null):nr=Wt.sibling;var ms=ht(at,Wt,Ve.value,wt);if(ms===null){Wt===null&&(Wt=nr);break}s&&Wt&&ms.alternate===null&&c(at,Wt),nt=_(ms,nt,$t),be===null?Vt=ms:be.sibling=ms,be=ms,Wt=nr}if(Ve.done)return d(at,Wt),Fe&&mu(at,$t),Vt;if(Wt===null){for(;!Ve.done;$t++,Ve=st.next())Ve=Ct(at,Ve.value,wt),Ve!==null&&(nt=_(Ve,nt,$t),be===null?Vt=Ve:be.sibling=Ve,be=Ve);return Fe&&mu(at,$t),Vt}for(Wt=g(Wt);!Ve.done;$t++,Ve=st.next())Ve=pt(Wt,at,$t,Ve.value,wt),Ve!==null&&(s&&Ve.alternate!==null&&Wt.delete(Ve.key===null?$t:Ve.key),nt=_(Ve,nt,$t),be===null?Vt=Ve:be.sibling=Ve,be=Ve);return s&&Wt.forEach(function(E9){return c(at,E9)}),Fe&&mu(at,$t),Vt}function Ze(at,nt,st,wt){if(typeof st=="object"&&st!==null&&st.type===b&&st.key===null&&(st=st.props.children),typeof st=="object"&&st!==null){switch(st.$$typeof){case m:t:{for(var Vt=st.key;nt!==null;){if(nt.key===Vt){if(Vt=st.type,Vt===b){if(nt.tag===7){d(at,nt.sibling),wt=x(nt,st.props.children),wt.return=at,at=wt;break t}}else if(nt.elementType===Vt||typeof Vt=="object"&&Vt!==null&&Vt.$$typeof===R&&XE(Vt)===nt.type){d(at,nt.sibling),wt=x(nt,st.props),Xh(wt,st),wt.return=at,at=wt;break t}d(at,nt);break}else c(at,nt);nt=nt.sibling}st.type===b?(wt=du(st.props.children,at.mode,wt,st.key),wt.return=at,at=wt):(wt=Tp(st.type,st.key,st.props,null,at.mode,wt),Xh(wt,st),wt.return=at,at=wt)}return F(at);case v:t:{for(Vt=st.key;nt!==null;){if(nt.key===Vt)if(nt.tag===4&&nt.stateNode.containerInfo===st.containerInfo&&nt.stateNode.implementation===st.implementation){d(at,nt.sibling),wt=x(nt,st.children||[]),wt.return=at,at=wt;break t}else{d(at,nt);break}else c(at,nt);nt=nt.sibling}wt=My(st,at.mode,wt),wt.return=at,at=wt}return F(at);case R:return Vt=st._init,st=Vt(st._payload),Ze(at,nt,st,wt)}if(rt(st))return Qt(at,nt,st,wt);if(P(st)){if(Vt=P(st),typeof Vt!="function")throw Error(n(150));return st=Vt.call(st),Gt(at,nt,st,wt)}if(typeof st.then=="function")return Ze(at,nt,Up(st),wt);if(st.$$typeof===A)return Ze(at,nt,Np(at,st),wt);Wp(at,st)}return typeof st=="string"&&st!==""||typeof st=="number"||typeof st=="bigint"?(st=""+st,nt!==null&&nt.tag===6?(d(at,nt.sibling),wt=x(nt,st),wt.return=at,at=wt):(d(at,nt),wt=Oy(st,at.mode,wt),wt.return=at,at=wt),F(at)):d(at,nt)}return function(at,nt,st,wt){try{Kh=0;var Vt=Ze(at,nt,st,wt);return Hl=null,Vt}catch(Wt){if(Wt===Fh||Wt===kp)throw Wt;var be=ii(29,Wt,null,at.mode);return be.lanes=wt,be.return=at,be}finally{}}}var ql=YE(!0),QE=YE(!1),Oi=et(null),Ea=null;function ts(s){var c=s.alternate;lt($n,$n.current&1),lt(Oi,s),Ea===null&&(c===null||Bl.current!==null||c.memoizedState!==null)&&(Ea=s)}function ZE(s){if(s.tag===22){if(lt($n,$n.current),lt(Oi,s),Ea===null){var c=s.alternate;c!==null&&c.memoizedState!==null&&(Ea=s)}}else es()}function es(){lt($n,$n.current),lt(Oi,Oi.current)}function lo(s){dt(Oi),Ea===s&&(Ea=null),dt($n)}var $n=et(0);function Hp(s){for(var c=s;c!==null;){if(c.tag===13){var d=c.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||n1(d)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function d0(s,c,d,g){c=s.memoizedState,d=d(g,c),d=d==null?c:f({},c,d),s.memoizedState=d,s.lanes===0&&(s.updateQueue.baseState=d)}var p0={enqueueSetState:function(s,c,d){s=s._reactInternals;var g=ui(),x=Qo(g);x.payload=c,d!=null&&(x.callback=d),c=Zo(s,x,g),c!==null&&(li(c,s,g),jh(c,s,g))},enqueueReplaceState:function(s,c,d){s=s._reactInternals;var g=ui(),x=Qo(g);x.tag=1,x.payload=c,d!=null&&(x.callback=d),c=Zo(s,x,g),c!==null&&(li(c,s,g),jh(c,s,g))},enqueueForceUpdate:function(s,c){s=s._reactInternals;var d=ui(),g=Qo(d);g.tag=2,c!=null&&(g.callback=c),c=Zo(s,g,d),c!==null&&(li(c,s,d),jh(c,s,d))}};function JE(s,c,d,g,x,_,F){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(g,_,F):c.prototype&&c.prototype.isPureReactComponent?!kh(d,g)||!kh(x,_):!0}function t3(s,c,d,g){s=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(d,g),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(d,g),c.state!==s&&p0.enqueueReplaceState(c,c.state,null)}function Cu(s,c){var d=c;if("ref"in c){d={};for(var g in c)g!=="ref"&&(d[g]=c[g])}if(s=s.defaultProps){d===c&&(d=f({},d));for(var x in s)d[x]===void 0&&(d[x]=s[x])}return d}var qp=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function e3(s){qp(s)}function n3(s){console.error(s)}function r3(s){qp(s)}function Gp(s,c){try{var d=s.onUncaughtError;d(c.value,{componentStack:c.stack})}catch(g){setTimeout(function(){throw g})}}function i3(s,c,d){try{var g=s.onCaughtError;g(d.value,{componentStack:d.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function m0(s,c,d){return d=Qo(d),d.tag=3,d.payload={element:null},d.callback=function(){Gp(s,c)},d}function a3(s){return s=Qo(s),s.tag=3,s}function o3(s,c,d,g){var x=d.type.getDerivedStateFromError;if(typeof x=="function"){var _=g.value;s.payload=function(){return x(_)},s.callback=function(){i3(c,d,g)}}var F=d.stateNode;F!==null&&typeof F.componentDidCatch=="function"&&(s.callback=function(){i3(c,d,g),typeof x!="function"&&(ss===null?ss=new Set([this]):ss.add(this));var j=g.stack;this.componentDidCatch(g.value,{componentStack:j!==null?j:""})})}function EO(s,c,d,g,x){if(d.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(c=d.alternate,c!==null&&Ph(c,d,x,!0),d=Oi.current,d!==null){switch(d.tag){case 13:return Ea===null?F0():d.alternate===null&&bn===0&&(bn=3),d.flags&=-257,d.flags|=65536,d.lanes=x,g===Hy?d.flags|=16384:(c=d.updateQueue,c===null?d.updateQueue=new Set([g]):c.add(g),j0(s,g,x)),!1;case 22:return d.flags|=65536,g===Hy?d.flags|=16384:(c=d.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([g])},d.updateQueue=c):(d=c.retryQueue,d===null?c.retryQueue=new Set([g]):d.add(g)),j0(s,g,x)),!1}throw Error(n(435,d.tag))}return j0(s,g,x),F0(),!1}if(Fe)return c=Oi.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=x,g!==zy&&(s=Error(n(422),{cause:g}),Lh(Ni(s,d)))):(g!==zy&&(c=Error(n(423),{cause:g}),Lh(Ni(c,d))),s=s.current.alternate,s.flags|=65536,x&=-x,s.lanes|=x,g=Ni(g,d),x=m0(s.stateNode,g,x),$y(s,x),bn!==4&&(bn=2)),!1;var _=Error(n(520),{cause:g});if(_=Ni(_,d),nf===null?nf=[_]:nf.push(_),bn!==4&&(bn=2),c===null)return!0;g=Ni(g,d),d=c;do{switch(d.tag){case 3:return d.flags|=65536,s=x&-x,d.lanes|=s,s=m0(d.stateNode,g,s),$y(d,s),!1;case 1:if(c=d.type,_=d.stateNode,(d.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(ss===null||!ss.has(_))))return d.flags|=65536,x&=-x,d.lanes|=x,x=a3(x),o3(x,s,d,g),$y(d,x),!1}d=d.return}while(d!==null);return!1}var s3=Error(n(461)),tr=!1;function fr(s,c,d,g){c.child=s===null?QE(c,null,d,g):ql(c,s.child,d,g)}function u3(s,c,d,g,x){d=d.render;var _=c.ref;if("ref"in g){var F={};for(var j in g)j!=="ref"&&(F[j]=g[j])}else F=g;return bu(c),g=Zy(s,c,d,F,_,x),j=Jy(),s!==null&&!tr?(t0(s,c,x),co(s,c,x)):(Fe&&j&&Ly(c),c.flags|=1,fr(s,c,g,x),c.child)}function l3(s,c,d,g,x){if(s===null){var _=d.type;return typeof _=="function"&&!Dy(_)&&_.defaultProps===void 0&&d.compare===null?(c.tag=15,c.type=_,c3(s,c,_,g,x)):(s=Tp(d.type,null,g,c,c.mode,x),s.ref=c.ref,s.return=c,c.child=s)}if(_=s.child,!E0(s,x)){var F=_.memoizedProps;if(d=d.compare,d=d!==null?d:kh,d(F,g)&&s.ref===c.ref)return co(s,c,x)}return c.flags|=1,s=ro(_,g),s.ref=c.ref,s.return=c,c.child=s}function c3(s,c,d,g,x){if(s!==null){var _=s.memoizedProps;if(kh(_,g)&&s.ref===c.ref)if(tr=!1,c.pendingProps=g=_,E0(s,x))(s.flags&131072)!==0&&(tr=!0);else return c.lanes=s.lanes,co(s,c,x)}return g0(s,c,d,g,x)}function h3(s,c,d){var g=c.pendingProps,x=g.children,_=s!==null?s.memoizedState:null;if(g.mode==="hidden"){if((c.flags&128)!==0){if(g=_!==null?_.baseLanes|d:d,s!==null){for(x=c.child=s.child,_=0;x!==null;)_=_|x.lanes|x.childLanes,x=x.sibling;c.childLanes=_&~g}else c.childLanes=0,c.child=null;return f3(s,c,g,d)}if((d&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},s!==null&&Ip(c,_!==null?_.cachePool:null),_!==null?cE(c,_):Xy(),ZE(c);else return c.lanes=c.childLanes=536870912,f3(s,c,_!==null?_.baseLanes|d:d,d)}else _!==null?(Ip(c,_.cachePool),cE(c,_),es(),c.memoizedState=null):(s!==null&&Ip(c,null),Xy(),es());return fr(s,c,x,d),c.child}function f3(s,c,d,g){var x=Wy();return x=x===null?null:{parent:Gn._currentValue,pool:x},c.memoizedState={baseLanes:d,cachePool:x},s!==null&&Ip(c,null),Xy(),ZE(c),s!==null&&Ph(s,c,g,!0),null}function $p(s,c){var d=c.ref;if(d===null)s!==null&&s.ref!==null&&(c.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(n(284));(s===null||s.ref!==d)&&(c.flags|=4194816)}}function g0(s,c,d,g,x){return bu(c),d=Zy(s,c,d,g,void 0,x),g=Jy(),s!==null&&!tr?(t0(s,c,x),co(s,c,x)):(Fe&&g&&Ly(c),c.flags|=1,fr(s,c,d,x),c.child)}function d3(s,c,d,g,x,_){return bu(c),c.updateQueue=null,d=fE(c,g,d,x),hE(s),g=Jy(),s!==null&&!tr?(t0(s,c,_),co(s,c,_)):(Fe&&g&&Ly(c),c.flags|=1,fr(s,c,d,_),c.child)}function p3(s,c,d,g,x){if(bu(c),c.stateNode===null){var _=Ll,F=d.contextType;typeof F=="object"&&F!==null&&(_=_r(F)),_=new d(g,_),c.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=p0,c.stateNode=_,_._reactInternals=c,_=c.stateNode,_.props=g,_.state=c.memoizedState,_.refs={},qy(c),F=d.contextType,_.context=typeof F=="object"&&F!==null?_r(F):Ll,_.state=c.memoizedState,F=d.getDerivedStateFromProps,typeof F=="function"&&(d0(c,d,F,g),_.state=c.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(F=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),F!==_.state&&p0.enqueueReplaceState(_,_.state,null),Wh(c,g,_,x),Uh(),_.state=c.memoizedState),typeof _.componentDidMount=="function"&&(c.flags|=4194308),g=!0}else if(s===null){_=c.stateNode;var j=c.memoizedProps,Y=Cu(d,j);_.props=Y;var ct=_.context,bt=d.contextType;F=Ll,typeof bt=="object"&&bt!==null&&(F=_r(bt));var Ct=d.getDerivedStateFromProps;bt=typeof Ct=="function"||typeof _.getSnapshotBeforeUpdate=="function",j=c.pendingProps!==j,bt||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(j||ct!==F)&&t3(c,_,g,F),Yo=!1;var ht=c.memoizedState;_.state=ht,Wh(c,g,_,x),Uh(),ct=c.memoizedState,j||ht!==ct||Yo?(typeof Ct=="function"&&(d0(c,d,Ct,g),ct=c.memoizedState),(Y=Yo||JE(c,d,Y,g,ht,ct,F))?(bt||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(c.flags|=4194308)):(typeof _.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=g,c.memoizedState=ct),_.props=g,_.state=ct,_.context=F,g=Y):(typeof _.componentDidMount=="function"&&(c.flags|=4194308),g=!1)}else{_=c.stateNode,Gy(s,c),F=c.memoizedProps,bt=Cu(d,F),_.props=bt,Ct=c.pendingProps,ht=_.context,ct=d.contextType,Y=Ll,typeof ct=="object"&&ct!==null&&(Y=_r(ct)),j=d.getDerivedStateFromProps,(ct=typeof j=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(F!==Ct||ht!==Y)&&t3(c,_,g,Y),Yo=!1,ht=c.memoizedState,_.state=ht,Wh(c,g,_,x),Uh();var pt=c.memoizedState;F!==Ct||ht!==pt||Yo||s!==null&&s.dependencies!==null&&Rp(s.dependencies)?(typeof j=="function"&&(d0(c,d,j,g),pt=c.memoizedState),(bt=Yo||JE(c,d,bt,g,ht,pt,Y)||s!==null&&s.dependencies!==null&&Rp(s.dependencies))?(ct||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(g,pt,Y),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(g,pt,Y)),typeof _.componentDidUpdate=="function"&&(c.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof _.componentDidUpdate!="function"||F===s.memoizedProps&&ht===s.memoizedState||(c.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||F===s.memoizedProps&&ht===s.memoizedState||(c.flags|=1024),c.memoizedProps=g,c.memoizedState=pt),_.props=g,_.state=pt,_.context=Y,g=bt):(typeof _.componentDidUpdate!="function"||F===s.memoizedProps&&ht===s.memoizedState||(c.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||F===s.memoizedProps&&ht===s.memoizedState||(c.flags|=1024),g=!1)}return _=g,$p(s,c),g=(c.flags&128)!==0,_||g?(_=c.stateNode,d=g&&typeof d.getDerivedStateFromError!="function"?null:_.render(),c.flags|=1,s!==null&&g?(c.child=ql(c,s.child,null,x),c.child=ql(c,null,d,x)):fr(s,c,d,x),c.memoizedState=_.state,s=c.child):s=co(s,c,x),s}function m3(s,c,d,g){return Mh(),c.flags|=256,fr(s,c,d,g),c.child}var v0={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function y0(s){return{baseLanes:s,cachePool:nE()}}function b0(s,c,d){return s=s!==null?s.childLanes&~d:0,c&&(s|=Mi),s}function g3(s,c,d){var g=c.pendingProps,x=!1,_=(c.flags&128)!==0,F;if((F=_)||(F=s!==null&&s.memoizedState===null?!1:($n.current&2)!==0),F&&(x=!0,c.flags&=-129),F=(c.flags&32)!==0,c.flags&=-33,s===null){if(Fe){if(x?ts(c):es(),Fe){var j=yn,Y;if(Y=j){t:{for(Y=j,j=Ca;Y.nodeType!==8;){if(!j){j=null;break t}if(Y=$i(Y.nextSibling),Y===null){j=null;break t}}j=Y}j!==null?(c.memoizedState={dehydrated:j,treeContext:pu!==null?{id:io,overflow:ao}:null,retryLane:536870912,hydrationErrors:null},Y=ii(18,null,null,0),Y.stateNode=j,Y.return=c,c.child=Y,Pr=c,yn=null,Y=!0):Y=!1}Y||vu(c)}if(j=c.memoizedState,j!==null&&(j=j.dehydrated,j!==null))return n1(j)?c.lanes=32:c.lanes=536870912,null;lo(c)}return j=g.children,g=g.fallback,x?(es(),x=c.mode,j=Kp({mode:"hidden",children:j},x),g=du(g,x,d,null),j.return=c,g.return=c,j.sibling=g,c.child=j,x=c.child,x.memoizedState=y0(d),x.childLanes=b0(s,F,d),c.memoizedState=v0,g):(ts(c),x0(c,j))}if(Y=s.memoizedState,Y!==null&&(j=Y.dehydrated,j!==null)){if(_)c.flags&256?(ts(c),c.flags&=-257,c=w0(s,c,d)):c.memoizedState!==null?(es(),c.child=s.child,c.flags|=128,c=null):(es(),x=g.fallback,j=c.mode,g=Kp({mode:"visible",children:g.children},j),x=du(x,j,d,null),x.flags|=2,g.return=c,x.return=c,g.sibling=x,c.child=g,ql(c,s.child,null,d),g=c.child,g.memoizedState=y0(d),g.childLanes=b0(s,F,d),c.memoizedState=v0,c=x);else if(ts(c),n1(j)){if(F=j.nextSibling&&j.nextSibling.dataset,F)var ct=F.dgst;F=ct,g=Error(n(419)),g.stack="",g.digest=F,Lh({value:g,source:null,stack:null}),c=w0(s,c,d)}else if(tr||Ph(s,c,d,!1),F=(d&s.childLanes)!==0,tr||F){if(F=en,F!==null&&(g=d&-d,g=(g&42)!==0?1:Uo(g),g=(g&(F.suspendedLanes|d))!==0?0:g,g!==0&&g!==Y.retryLane))throw Y.retryLane=g,Ml(s,g),li(F,s,g),s3;j.data==="$?"||F0(),c=w0(s,c,d)}else j.data==="$?"?(c.flags|=192,c.child=s.child,c=null):(s=Y.treeContext,yn=$i(j.nextSibling),Pr=c,Fe=!0,gu=null,Ca=!1,s!==null&&(ki[Di++]=io,ki[Di++]=ao,ki[Di++]=pu,io=s.id,ao=s.overflow,pu=c),c=x0(c,g.children),c.flags|=4096);return c}return x?(es(),x=g.fallback,j=c.mode,Y=s.child,ct=Y.sibling,g=ro(Y,{mode:"hidden",children:g.children}),g.subtreeFlags=Y.subtreeFlags&65011712,ct!==null?x=ro(ct,x):(x=du(x,j,d,null),x.flags|=2),x.return=c,g.return=c,g.sibling=x,c.child=g,g=x,x=c.child,j=s.child.memoizedState,j===null?j=y0(d):(Y=j.cachePool,Y!==null?(ct=Gn._currentValue,Y=Y.parent!==ct?{parent:ct,pool:ct}:Y):Y=nE(),j={baseLanes:j.baseLanes|d,cachePool:Y}),x.memoizedState=j,x.childLanes=b0(s,F,d),c.memoizedState=v0,g):(ts(c),d=s.child,s=d.sibling,d=ro(d,{mode:"visible",children:g.children}),d.return=c,d.sibling=null,s!==null&&(F=c.deletions,F===null?(c.deletions=[s],c.flags|=16):F.push(s)),c.child=d,c.memoizedState=null,d)}function x0(s,c){return c=Kp({mode:"visible",children:c},s.mode),c.return=s,s.child=c}function Kp(s,c){return s=ii(22,s,null,c),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function w0(s,c,d){return ql(c,s.child,null,d),s=x0(c,c.pendingProps.children),s.flags|=2,c.memoizedState=null,s}function v3(s,c,d){s.lanes|=c;var g=s.alternate;g!==null&&(g.lanes|=c),Fy(s.return,c,d)}function C0(s,c,d,g,x){var _=s.memoizedState;_===null?s.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:g,tail:d,tailMode:x}:(_.isBackwards=c,_.rendering=null,_.renderingStartTime=0,_.last=g,_.tail=d,_.tailMode=x)}function y3(s,c,d){var g=c.pendingProps,x=g.revealOrder,_=g.tail;if(fr(s,c,g.children,d),g=$n.current,(g&2)!==0)g=g&1|2,c.flags|=128;else{if(s!==null&&(s.flags&128)!==0)t:for(s=c.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&v3(s,d,c);else if(s.tag===19)v3(s,d,c);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===c)break t;for(;s.sibling===null;){if(s.return===null||s.return===c)break t;s=s.return}s.sibling.return=s.return,s=s.sibling}g&=1}switch(lt($n,g),x){case"forwards":for(d=c.child,x=null;d!==null;)s=d.alternate,s!==null&&Hp(s)===null&&(x=d),d=d.sibling;d=x,d===null?(x=c.child,c.child=null):(x=d.sibling,d.sibling=null),C0(c,!1,x,d,_);break;case"backwards":for(d=null,x=c.child,c.child=null;x!==null;){if(s=x.alternate,s!==null&&Hp(s)===null){c.child=x;break}s=x.sibling,x.sibling=d,d=x,x=s}C0(c,!0,d,null,_);break;case"together":C0(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function co(s,c,d){if(s!==null&&(c.dependencies=s.dependencies),os|=c.lanes,(d&c.childLanes)===0)if(s!==null){if(Ph(s,c,d,!1),(d&c.childLanes)===0)return null}else return null;if(s!==null&&c.child!==s.child)throw Error(n(153));if(c.child!==null){for(s=c.child,d=ro(s,s.pendingProps),c.child=d,d.return=c;s.sibling!==null;)s=s.sibling,d=d.sibling=ro(s,s.pendingProps),d.return=c;d.sibling=null}return c.child}function E0(s,c){return(s.lanes&c)!==0?!0:(s=s.dependencies,!!(s!==null&&Rp(s)))}function _O(s,c,d){switch(c.tag){case 3:Pt(c,c.stateNode.containerInfo),Xo(c,Gn,s.memoizedState.cache),Mh();break;case 27:case 5:Le(c);break;case 4:Pt(c,c.stateNode.containerInfo);break;case 10:Xo(c,c.type,c.memoizedProps.value);break;case 13:var g=c.memoizedState;if(g!==null)return g.dehydrated!==null?(ts(c),c.flags|=128,null):(d&c.child.childLanes)!==0?g3(s,c,d):(ts(c),s=co(s,c,d),s!==null?s.sibling:null);ts(c);break;case 19:var x=(s.flags&128)!==0;if(g=(d&c.childLanes)!==0,g||(Ph(s,c,d,!1),g=(d&c.childLanes)!==0),x){if(g)return y3(s,c,d);c.flags|=128}if(x=c.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),lt($n,$n.current),g)break;return null;case 22:case 23:return c.lanes=0,h3(s,c,d);case 24:Xo(c,Gn,s.memoizedState.cache)}return co(s,c,d)}function b3(s,c,d){if(s!==null)if(s.memoizedProps!==c.pendingProps)tr=!0;else{if(!E0(s,d)&&(c.flags&128)===0)return tr=!1,_O(s,c,d);tr=(s.flags&131072)!==0}else tr=!1,Fe&&(c.flags&1048576)!==0&&XC(c,Ap,c.index);switch(c.lanes=0,c.tag){case 16:t:{s=c.pendingProps;var g=c.elementType,x=g._init;if(g=x(g._payload),c.type=g,typeof g=="function")Dy(g)?(s=Cu(g,s),c.tag=1,c=p3(null,c,g,s,d)):(c.tag=0,c=g0(null,c,g,s,d));else{if(g!=null){if(x=g.$$typeof,x===k){c.tag=11,c=u3(null,c,g,s,d);break t}else if(x===T){c.tag=14,c=l3(null,c,g,s,d);break t}}throw c=Z(g)||g,Error(n(306,c,""))}}return c;case 0:return g0(s,c,c.type,c.pendingProps,d);case 1:return g=c.type,x=Cu(g,c.pendingProps),p3(s,c,g,x,d);case 3:t:{if(Pt(c,c.stateNode.containerInfo),s===null)throw Error(n(387));g=c.pendingProps;var _=c.memoizedState;x=_.element,Gy(s,c),Wh(c,g,null,d);var F=c.memoizedState;if(g=F.cache,Xo(c,Gn,g),g!==_.cache&&By(c,[Gn],d,!0),Uh(),g=F.element,_.isDehydrated)if(_={element:g,isDehydrated:!1,cache:F.cache},c.updateQueue.baseState=_,c.memoizedState=_,c.flags&256){c=m3(s,c,g,d);break t}else if(g!==x){x=Ni(Error(n(424)),c),Lh(x),c=m3(s,c,g,d);break t}else{switch(s=c.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(yn=$i(s.firstChild),Pr=c,Fe=!0,gu=null,Ca=!0,d=QE(c,null,g,d),c.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(Mh(),g===x){c=co(s,c,d);break t}fr(s,c,g,d)}c=c.child}return c;case 26:return $p(s,c),s===null?(d=E_(c.type,null,c.pendingProps,null))?c.memoizedState=d:Fe||(d=c.type,s=c.pendingProps,g=um(Rt.current).createElement(d),g[Wn]=c,g[kn]=s,pr(g,d,s),_n(g),c.stateNode=g):c.memoizedState=E_(c.type,s.memoizedProps,c.pendingProps,s.memoizedState),null;case 27:return Le(c),s===null&&Fe&&(g=c.stateNode=x_(c.type,c.pendingProps,Rt.current),Pr=c,Ca=!0,x=yn,cs(c.type)?(r1=x,yn=$i(g.firstChild)):yn=x),fr(s,c,c.pendingProps.children,d),$p(s,c),s===null&&(c.flags|=4194304),c.child;case 5:return s===null&&Fe&&((x=g=yn)&&(g=ZO(g,c.type,c.pendingProps,Ca),g!==null?(c.stateNode=g,Pr=c,yn=$i(g.firstChild),Ca=!1,x=!0):x=!1),x||vu(c)),Le(c),x=c.type,_=c.pendingProps,F=s!==null?s.memoizedProps:null,g=_.children,J0(x,_)?g=null:F!==null&&J0(x,F)&&(c.flags|=32),c.memoizedState!==null&&(x=Zy(s,c,gO,null,null,d),ff._currentValue=x),$p(s,c),fr(s,c,g,d),c.child;case 6:return s===null&&Fe&&((s=d=yn)&&(d=JO(d,c.pendingProps,Ca),d!==null?(c.stateNode=d,Pr=c,yn=null,s=!0):s=!1),s||vu(c)),null;case 13:return g3(s,c,d);case 4:return Pt(c,c.stateNode.containerInfo),g=c.pendingProps,s===null?c.child=ql(c,null,g,d):fr(s,c,g,d),c.child;case 11:return u3(s,c,c.type,c.pendingProps,d);case 7:return fr(s,c,c.pendingProps,d),c.child;case 8:return fr(s,c,c.pendingProps.children,d),c.child;case 12:return fr(s,c,c.pendingProps.children,d),c.child;case 10:return g=c.pendingProps,Xo(c,c.type,g.value),fr(s,c,g.children,d),c.child;case 9:return x=c.type._context,g=c.pendingProps.children,bu(c),x=_r(x),g=g(x),c.flags|=1,fr(s,c,g,d),c.child;case 14:return l3(s,c,c.type,c.pendingProps,d);case 15:return c3(s,c,c.type,c.pendingProps,d);case 19:return y3(s,c,d);case 31:return g=c.pendingProps,d=c.mode,g={mode:g.mode,children:g.children},s===null?(d=Kp(g,d),d.ref=c.ref,c.child=d,d.return=c,c=d):(d=ro(s.child,g),d.ref=c.ref,c.child=d,d.return=c,c=d),c;case 22:return h3(s,c,d);case 24:return bu(c),g=_r(Gn),s===null?(x=Wy(),x===null&&(x=en,_=jy(),x.pooledCache=_,_.refCount++,_!==null&&(x.pooledCacheLanes|=d),x=_),c.memoizedState={parent:g,cache:x},qy(c),Xo(c,Gn,x)):((s.lanes&d)!==0&&(Gy(s,c),Wh(c,null,null,d),Uh()),x=s.memoizedState,_=c.memoizedState,x.parent!==g?(x={parent:g,cache:g},c.memoizedState=x,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=x),Xo(c,Gn,g)):(g=_.cache,Xo(c,Gn,g),g!==x.cache&&By(c,[Gn],d,!0))),fr(s,c,c.pendingProps.children,d),c.child;case 29:throw c.pendingProps}throw Error(n(156,c.tag))}function ho(s){s.flags|=4}function x3(s,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!R_(c)){if(c=Oi.current,c!==null&&((ke&4194048)===ke?Ea!==null:(ke&62914560)!==ke&&(ke&536870912)===0||c!==Ea))throw Bh=Hy,rE;s.flags|=8192}}function Xp(s,c){c!==null&&(s.flags|=4),s.flags&16384&&(c=s.tag!==22?dh():536870912,s.lanes|=c,Xl|=c)}function Yh(s,c){if(!Fe)switch(s.tailMode){case"hidden":c=s.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?s.tail=null:d.sibling=null;break;case"collapsed":d=s.tail;for(var g=null;d!==null;)d.alternate!==null&&(g=d),d=d.sibling;g===null?c||s.tail===null?s.tail=null:s.tail.sibling=null:g.sibling=null}}function pn(s){var c=s.alternate!==null&&s.alternate.child===s.child,d=0,g=0;if(c)for(var x=s.child;x!==null;)d|=x.lanes|x.childLanes,g|=x.subtreeFlags&65011712,g|=x.flags&65011712,x.return=s,x=x.sibling;else for(x=s.child;x!==null;)d|=x.lanes|x.childLanes,g|=x.subtreeFlags,g|=x.flags,x.return=s,x=x.sibling;return s.subtreeFlags|=g,s.childLanes=d,c}function TO(s,c,d){var g=c.pendingProps;switch(Py(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pn(c),null;case 1:return pn(c),null;case 3:return d=c.stateNode,g=null,s!==null&&(g=s.memoizedState.cache),c.memoizedState.cache!==g&&(c.flags|=2048),so(Gn),Xt(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(s===null||s.child===null)&&(Oh(c)?ho(c):s===null||s.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,ZC())),pn(c),null;case 26:return d=c.memoizedState,s===null?(ho(c),d!==null?(pn(c),x3(c,d)):(pn(c),c.flags&=-16777217)):d?d!==s.memoizedState?(ho(c),pn(c),x3(c,d)):(pn(c),c.flags&=-16777217):(s.memoizedProps!==g&&ho(c),pn(c),c.flags&=-16777217),null;case 27:Zt(c),d=Rt.current;var x=c.type;if(s!==null&&c.stateNode!=null)s.memoizedProps!==g&&ho(c);else{if(!g){if(c.stateNode===null)throw Error(n(166));return pn(c),null}s=St.current,Oh(c)?YC(c):(s=x_(x,g,d),c.stateNode=s,ho(c))}return pn(c),null;case 5:if(Zt(c),d=c.type,s!==null&&c.stateNode!=null)s.memoizedProps!==g&&ho(c);else{if(!g){if(c.stateNode===null)throw Error(n(166));return pn(c),null}if(s=St.current,Oh(c))YC(c);else{switch(x=um(Rt.current),s){case 1:s=x.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:s=x.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":s=x.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":s=x.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":s=x.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof g.is=="string"?x.createElement("select",{is:g.is}):x.createElement("select"),g.multiple?s.multiple=!0:g.size&&(s.size=g.size);break;default:s=typeof g.is=="string"?x.createElement(d,{is:g.is}):x.createElement(d)}}s[Wn]=c,s[kn]=g;t:for(x=c.child;x!==null;){if(x.tag===5||x.tag===6)s.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===c)break t;for(;x.sibling===null;){if(x.return===null||x.return===c)break t;x=x.return}x.sibling.return=x.return,x=x.sibling}c.stateNode=s;t:switch(pr(s,d,g),d){case"button":case"input":case"select":case"textarea":s=!!g.autoFocus;break t;case"img":s=!0;break t;default:s=!1}s&&ho(c)}}return pn(c),c.flags&=-16777217,null;case 6:if(s&&c.stateNode!=null)s.memoizedProps!==g&&ho(c);else{if(typeof g!="string"&&c.stateNode===null)throw Error(n(166));if(s=Rt.current,Oh(c)){if(s=c.stateNode,d=c.memoizedProps,g=null,x=Pr,x!==null)switch(x.tag){case 27:case 5:g=x.memoizedProps}s[Wn]=c,s=!!(s.nodeValue===d||g!==null&&g.suppressHydrationWarning===!0||d_(s.nodeValue,d)),s||vu(c)}else s=um(s).createTextNode(g),s[Wn]=c,c.stateNode=s}return pn(c),null;case 13:if(g=c.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(x=Oh(c),g!==null&&g.dehydrated!==null){if(s===null){if(!x)throw Error(n(318));if(x=c.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(n(317));x[Wn]=c}else Mh(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;pn(c),x=!1}else x=ZC(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=x),x=!0;if(!x)return c.flags&256?(lo(c),c):(lo(c),null)}if(lo(c),(c.flags&128)!==0)return c.lanes=d,c;if(d=g!==null,s=s!==null&&s.memoizedState!==null,d){g=c.child,x=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(x=g.alternate.memoizedState.cachePool.pool);var _=null;g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(_=g.memoizedState.cachePool.pool),_!==x&&(g.flags|=2048)}return d!==s&&d&&(c.child.flags|=8192),Xp(c,c.updateQueue),pn(c),null;case 4:return Xt(),s===null&&K0(c.stateNode.containerInfo),pn(c),null;case 10:return so(c.type),pn(c),null;case 19:if(dt($n),x=c.memoizedState,x===null)return pn(c),null;if(g=(c.flags&128)!==0,_=x.rendering,_===null)if(g)Yh(x,!1);else{if(bn!==0||s!==null&&(s.flags&128)!==0)for(s=c.child;s!==null;){if(_=Hp(s),_!==null){for(c.flags|=128,Yh(x,!1),s=_.updateQueue,c.updateQueue=s,Xp(c,s),c.subtreeFlags=0,s=d,d=c.child;d!==null;)KC(d,s),d=d.sibling;return lt($n,$n.current&1|2),c.child}s=s.sibling}x.tail!==null&&Ke()>Zp&&(c.flags|=128,g=!0,Yh(x,!1),c.lanes=4194304)}else{if(!g)if(s=Hp(_),s!==null){if(c.flags|=128,g=!0,s=s.updateQueue,c.updateQueue=s,Xp(c,s),Yh(x,!0),x.tail===null&&x.tailMode==="hidden"&&!_.alternate&&!Fe)return pn(c),null}else 2*Ke()-x.renderingStartTime>Zp&&d!==536870912&&(c.flags|=128,g=!0,Yh(x,!1),c.lanes=4194304);x.isBackwards?(_.sibling=c.child,c.child=_):(s=x.last,s!==null?s.sibling=_:c.child=_,x.last=_)}return x.tail!==null?(c=x.tail,x.rendering=c,x.tail=c.sibling,x.renderingStartTime=Ke(),c.sibling=null,s=$n.current,lt($n,g?s&1|2:s&1),c):(pn(c),null);case 22:case 23:return lo(c),Yy(),g=c.memoizedState!==null,s!==null?s.memoizedState!==null!==g&&(c.flags|=8192):g&&(c.flags|=8192),g?(d&536870912)!==0&&(c.flags&128)===0&&(pn(c),c.subtreeFlags&6&&(c.flags|=8192)):pn(c),d=c.updateQueue,d!==null&&Xp(c,d.retryQueue),d=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),g=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==d&&(c.flags|=2048),s!==null&&dt(xu),null;case 24:return d=null,s!==null&&(d=s.memoizedState.cache),c.memoizedState.cache!==d&&(c.flags|=2048),so(Gn),pn(c),null;case 25:return null;case 30:return null}throw Error(n(156,c.tag))}function SO(s,c){switch(Py(c),c.tag){case 1:return s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 3:return so(Gn),Xt(),s=c.flags,(s&65536)!==0&&(s&128)===0?(c.flags=s&-65537|128,c):null;case 26:case 27:case 5:return Zt(c),null;case 13:if(lo(c),s=c.memoizedState,s!==null&&s.dehydrated!==null){if(c.alternate===null)throw Error(n(340));Mh()}return s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 19:return dt($n),null;case 4:return Xt(),null;case 10:return so(c.type),null;case 22:case 23:return lo(c),Yy(),s!==null&&dt(xu),s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 24:return so(Gn),null;case 25:return null;default:return null}}function w3(s,c){switch(Py(c),c.tag){case 3:so(Gn),Xt();break;case 26:case 27:case 5:Zt(c);break;case 4:Xt();break;case 13:lo(c);break;case 19:dt($n);break;case 10:so(c.type);break;case 22:case 23:lo(c),Yy(),s!==null&&dt(xu);break;case 24:so(Gn)}}function Qh(s,c){try{var d=c.updateQueue,g=d!==null?d.lastEffect:null;if(g!==null){var x=g.next;d=x;do{if((d.tag&s)===s){g=void 0;var _=d.create,F=d.inst;g=_(),F.destroy=g}d=d.next}while(d!==x)}}catch(j){Je(c,c.return,j)}}function ns(s,c,d){try{var g=c.updateQueue,x=g!==null?g.lastEffect:null;if(x!==null){var _=x.next;g=_;do{if((g.tag&s)===s){var F=g.inst,j=F.destroy;if(j!==void 0){F.destroy=void 0,x=c;var Y=d,ct=j;try{ct()}catch(bt){Je(x,Y,bt)}}}g=g.next}while(g!==_)}}catch(bt){Je(c,c.return,bt)}}function C3(s){var c=s.updateQueue;if(c!==null){var d=s.stateNode;try{lE(c,d)}catch(g){Je(s,s.return,g)}}}function E3(s,c,d){d.props=Cu(s.type,s.memoizedProps),d.state=s.memoizedState;try{d.componentWillUnmount()}catch(g){Je(s,c,g)}}function Zh(s,c){try{var d=s.ref;if(d!==null){switch(s.tag){case 26:case 27:case 5:var g=s.stateNode;break;case 30:g=s.stateNode;break;default:g=s.stateNode}typeof d=="function"?s.refCleanup=d(g):d.current=g}}catch(x){Je(s,c,x)}}function _a(s,c){var d=s.ref,g=s.refCleanup;if(d!==null)if(typeof g=="function")try{g()}catch(x){Je(s,c,x)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(x){Je(s,c,x)}else d.current=null}function _3(s){var c=s.type,d=s.memoizedProps,g=s.stateNode;try{t:switch(c){case"button":case"input":case"select":case"textarea":d.autoFocus&&g.focus();break t;case"img":d.src?g.src=d.src:d.srcSet&&(g.srcset=d.srcSet)}}catch(x){Je(s,s.return,x)}}function _0(s,c,d){try{var g=s.stateNode;$O(g,s.type,d,c),g[kn]=c}catch(x){Je(s,s.return,x)}}function T3(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&cs(s.type)||s.tag===4}function T0(s){t:for(;;){for(;s.sibling===null;){if(s.return===null||T3(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&cs(s.type)||s.flags&2||s.child===null||s.tag===4)continue t;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function S0(s,c,d){var g=s.tag;if(g===5||g===6)s=s.stateNode,c?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(s,c):(c=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,c.appendChild(s),d=d._reactRootContainer,d!=null||c.onclick!==null||(c.onclick=sm));else if(g!==4&&(g===27&&cs(s.type)&&(d=s.stateNode,c=null),s=s.child,s!==null))for(S0(s,c,d),s=s.sibling;s!==null;)S0(s,c,d),s=s.sibling}function Yp(s,c,d){var g=s.tag;if(g===5||g===6)s=s.stateNode,c?d.insertBefore(s,c):d.appendChild(s);else if(g!==4&&(g===27&&cs(s.type)&&(d=s.stateNode),s=s.child,s!==null))for(Yp(s,c,d),s=s.sibling;s!==null;)Yp(s,c,d),s=s.sibling}function S3(s){var c=s.stateNode,d=s.memoizedProps;try{for(var g=s.type,x=c.attributes;x.length;)c.removeAttributeNode(x[0]);pr(c,g,d),c[Wn]=s,c[kn]=d}catch(_){Je(s,s.return,_)}}var fo=!1,Sn=!1,A0=!1,A3=typeof WeakSet=="function"?WeakSet:Set,er=null;function AO(s,c){if(s=s.containerInfo,Q0=pm,s=VC(s),Ty(s)){if("selectionStart"in s)var d={start:s.selectionStart,end:s.selectionEnd};else t:{d=(d=s.ownerDocument)&&d.defaultView||window;var g=d.getSelection&&d.getSelection();if(g&&g.rangeCount!==0){d=g.anchorNode;var x=g.anchorOffset,_=g.focusNode;g=g.focusOffset;try{d.nodeType,_.nodeType}catch{d=null;break t}var F=0,j=-1,Y=-1,ct=0,bt=0,Ct=s,ht=null;e:for(;;){for(var pt;Ct!==d||x!==0&&Ct.nodeType!==3||(j=F+x),Ct!==_||g!==0&&Ct.nodeType!==3||(Y=F+g),Ct.nodeType===3&&(F+=Ct.nodeValue.length),(pt=Ct.firstChild)!==null;)ht=Ct,Ct=pt;for(;;){if(Ct===s)break e;if(ht===d&&++ct===x&&(j=F),ht===_&&++bt===g&&(Y=F),(pt=Ct.nextSibling)!==null)break;Ct=ht,ht=Ct.parentNode}Ct=pt}d=j===-1||Y===-1?null:{start:j,end:Y}}else d=null}d=d||{start:0,end:0}}else d=null;for(Z0={focusedElem:s,selectionRange:d},pm=!1,er=c;er!==null;)if(c=er,s=c.child,(c.subtreeFlags&1024)!==0&&s!==null)s.return=c,er=s;else for(;er!==null;){switch(c=er,_=c.alternate,s=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&_!==null){s=void 0,d=c,x=_.memoizedProps,_=_.memoizedState,g=d.stateNode;try{var Qt=Cu(d.type,x,d.elementType===d.type);s=g.getSnapshotBeforeUpdate(Qt,_),g.__reactInternalSnapshotBeforeUpdate=s}catch(Gt){Je(d,d.return,Gt)}}break;case 3:if((s&1024)!==0){if(s=c.stateNode.containerInfo,d=s.nodeType,d===9)e1(s);else if(d===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":e1(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(n(163))}if(s=c.sibling,s!==null){s.return=c.return,er=s;break}er=c.return}}function R3(s,c,d){var g=d.flags;switch(d.tag){case 0:case 11:case 15:rs(s,d),g&4&&Qh(5,d);break;case 1:if(rs(s,d),g&4)if(s=d.stateNode,c===null)try{s.componentDidMount()}catch(F){Je(d,d.return,F)}else{var x=Cu(d.type,c.memoizedProps);c=c.memoizedState;try{s.componentDidUpdate(x,c,s.__reactInternalSnapshotBeforeUpdate)}catch(F){Je(d,d.return,F)}}g&64&&C3(d),g&512&&Zh(d,d.return);break;case 3:if(rs(s,d),g&64&&(s=d.updateQueue,s!==null)){if(c=null,d.child!==null)switch(d.child.tag){case 27:case 5:c=d.child.stateNode;break;case 1:c=d.child.stateNode}try{lE(s,c)}catch(F){Je(d,d.return,F)}}break;case 27:c===null&&g&4&&S3(d);case 26:case 5:rs(s,d),c===null&&g&4&&_3(d),g&512&&Zh(d,d.return);break;case 12:rs(s,d);break;case 13:rs(s,d),g&4&&k3(s,d),g&64&&(s=d.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(d=PO.bind(null,d),t9(s,d))));break;case 22:if(g=d.memoizedState!==null||fo,!g){c=c!==null&&c.memoizedState!==null||Sn,x=fo;var _=Sn;fo=g,(Sn=c)&&!_?is(s,d,(d.subtreeFlags&8772)!==0):rs(s,d),fo=x,Sn=_}break;case 30:break;default:rs(s,d)}}function N3(s){var c=s.alternate;c!==null&&(s.alternate=null,N3(c)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(c=s.stateNode,c!==null&&qo(c)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var hn=null,Gr=!1;function po(s,c,d){for(d=d.child;d!==null;)I3(s,c,d),d=d.sibling}function I3(s,c,d){if(le&&typeof le.onCommitFiberUnmount=="function")try{le.onCommitFiberUnmount(fe,d)}catch{}switch(d.tag){case 26:Sn||_a(d,c),po(s,c,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:Sn||_a(d,c);var g=hn,x=Gr;cs(d.type)&&(hn=d.stateNode,Gr=!1),po(s,c,d),uf(d.stateNode),hn=g,Gr=x;break;case 5:Sn||_a(d,c);case 6:if(g=hn,x=Gr,hn=null,po(s,c,d),hn=g,Gr=x,hn!==null)if(Gr)try{(hn.nodeType===9?hn.body:hn.nodeName==="HTML"?hn.ownerDocument.body:hn).removeChild(d.stateNode)}catch(_){Je(d,c,_)}else try{hn.removeChild(d.stateNode)}catch(_){Je(d,c,_)}break;case 18:hn!==null&&(Gr?(s=hn,y_(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,d.stateNode),gf(s)):y_(hn,d.stateNode));break;case 4:g=hn,x=Gr,hn=d.stateNode.containerInfo,Gr=!0,po(s,c,d),hn=g,Gr=x;break;case 0:case 11:case 14:case 15:Sn||ns(2,d,c),Sn||ns(4,d,c),po(s,c,d);break;case 1:Sn||(_a(d,c),g=d.stateNode,typeof g.componentWillUnmount=="function"&&E3(d,c,g)),po(s,c,d);break;case 21:po(s,c,d);break;case 22:Sn=(g=Sn)||d.memoizedState!==null,po(s,c,d),Sn=g;break;default:po(s,c,d)}}function k3(s,c){if(c.memoizedState===null&&(s=c.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{gf(s)}catch(d){Je(c,c.return,d)}}function RO(s){switch(s.tag){case 13:case 19:var c=s.stateNode;return c===null&&(c=s.stateNode=new A3),c;case 22:return s=s.stateNode,c=s._retryCache,c===null&&(c=s._retryCache=new A3),c;default:throw Error(n(435,s.tag))}}function R0(s,c){var d=RO(s);c.forEach(function(g){var x=zO.bind(null,s,g);d.has(g)||(d.add(g),g.then(x,x))})}function ai(s,c){var d=c.deletions;if(d!==null)for(var g=0;g<d.length;g++){var x=d[g],_=s,F=c,j=F;t:for(;j!==null;){switch(j.tag){case 27:if(cs(j.type)){hn=j.stateNode,Gr=!1;break t}break;case 5:hn=j.stateNode,Gr=!1;break t;case 3:case 4:hn=j.stateNode.containerInfo,Gr=!0;break t}j=j.return}if(hn===null)throw Error(n(160));I3(_,F,x),hn=null,Gr=!1,_=x.alternate,_!==null&&(_.return=null),x.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)D3(c,s),c=c.sibling}var Gi=null;function D3(s,c){var d=s.alternate,g=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:ai(c,s),oi(s),g&4&&(ns(3,s,s.return),Qh(3,s),ns(5,s,s.return));break;case 1:ai(c,s),oi(s),g&512&&(Sn||d===null||_a(d,d.return)),g&64&&fo&&(s=s.updateQueue,s!==null&&(g=s.callbacks,g!==null&&(d=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=d===null?g:d.concat(g))));break;case 26:var x=Gi;if(ai(c,s),oi(s),g&512&&(Sn||d===null||_a(d,d.return)),g&4){var _=d!==null?d.memoizedState:null;if(g=s.memoizedState,d===null)if(g===null)if(s.stateNode===null){t:{g=s.type,d=s.memoizedProps,x=x.ownerDocument||x;e:switch(g){case"title":_=x.getElementsByTagName("title")[0],(!_||_[Qs]||_[Wn]||_.namespaceURI==="http://www.w3.org/2000/svg"||_.hasAttribute("itemprop"))&&(_=x.createElement(g),x.head.insertBefore(_,x.querySelector("head > title"))),pr(_,g,d),_[Wn]=s,_n(_),g=_;break t;case"link":var F=S_("link","href",x).get(g+(d.href||""));if(F){for(var j=0;j<F.length;j++)if(_=F[j],_.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&_.getAttribute("rel")===(d.rel==null?null:d.rel)&&_.getAttribute("title")===(d.title==null?null:d.title)&&_.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){F.splice(j,1);break e}}_=x.createElement(g),pr(_,g,d),x.head.appendChild(_);break;case"meta":if(F=S_("meta","content",x).get(g+(d.content||""))){for(j=0;j<F.length;j++)if(_=F[j],_.getAttribute("content")===(d.content==null?null:""+d.content)&&_.getAttribute("name")===(d.name==null?null:d.name)&&_.getAttribute("property")===(d.property==null?null:d.property)&&_.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&_.getAttribute("charset")===(d.charSet==null?null:d.charSet)){F.splice(j,1);break e}}_=x.createElement(g),pr(_,g,d),x.head.appendChild(_);break;default:throw Error(n(468,g))}_[Wn]=s,_n(_),g=_}s.stateNode=g}else A_(x,s.type,s.stateNode);else s.stateNode=T_(x,g,s.memoizedProps);else _!==g?(_===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):_.count--,g===null?A_(x,s.type,s.stateNode):T_(x,g,s.memoizedProps)):g===null&&s.stateNode!==null&&_0(s,s.memoizedProps,d.memoizedProps)}break;case 27:ai(c,s),oi(s),g&512&&(Sn||d===null||_a(d,d.return)),d!==null&&g&4&&_0(s,s.memoizedProps,d.memoizedProps);break;case 5:if(ai(c,s),oi(s),g&512&&(Sn||d===null||_a(d,d.return)),s.flags&32){x=s.stateNode;try{Ti(x,"")}catch(pt){Je(s,s.return,pt)}}g&4&&s.stateNode!=null&&(x=s.memoizedProps,_0(s,x,d!==null?d.memoizedProps:x)),g&1024&&(A0=!0);break;case 6:if(ai(c,s),oi(s),g&4){if(s.stateNode===null)throw Error(n(162));g=s.memoizedProps,d=s.stateNode;try{d.nodeValue=g}catch(pt){Je(s,s.return,pt)}}break;case 3:if(hm=null,x=Gi,Gi=lm(c.containerInfo),ai(c,s),Gi=x,oi(s),g&4&&d!==null&&d.memoizedState.isDehydrated)try{gf(c.containerInfo)}catch(pt){Je(s,s.return,pt)}A0&&(A0=!1,O3(s));break;case 4:g=Gi,Gi=lm(s.stateNode.containerInfo),ai(c,s),oi(s),Gi=g;break;case 12:ai(c,s),oi(s);break;case 13:ai(c,s),oi(s),s.child.flags&8192&&s.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(M0=Ke()),g&4&&(g=s.updateQueue,g!==null&&(s.updateQueue=null,R0(s,g)));break;case 22:x=s.memoizedState!==null;var Y=d!==null&&d.memoizedState!==null,ct=fo,bt=Sn;if(fo=ct||x,Sn=bt||Y,ai(c,s),Sn=bt,fo=ct,oi(s),g&8192)t:for(c=s.stateNode,c._visibility=x?c._visibility&-2:c._visibility|1,x&&(d===null||Y||fo||Sn||Eu(s)),d=null,c=s;;){if(c.tag===5||c.tag===26){if(d===null){Y=d=c;try{if(_=Y.stateNode,x)F=_.style,typeof F.setProperty=="function"?F.setProperty("display","none","important"):F.display="none";else{j=Y.stateNode;var Ct=Y.memoizedProps.style,ht=Ct!=null&&Ct.hasOwnProperty("display")?Ct.display:null;j.style.display=ht==null||typeof ht=="boolean"?"":(""+ht).trim()}}catch(pt){Je(Y,Y.return,pt)}}}else if(c.tag===6){if(d===null){Y=c;try{Y.stateNode.nodeValue=x?"":Y.memoizedProps}catch(pt){Je(Y,Y.return,pt)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===s)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break t;for(;c.sibling===null;){if(c.return===null||c.return===s)break t;d===c&&(d=null),c=c.return}d===c&&(d=null),c.sibling.return=c.return,c=c.sibling}g&4&&(g=s.updateQueue,g!==null&&(d=g.retryQueue,d!==null&&(g.retryQueue=null,R0(s,d))));break;case 19:ai(c,s),oi(s),g&4&&(g=s.updateQueue,g!==null&&(s.updateQueue=null,R0(s,g)));break;case 30:break;case 21:break;default:ai(c,s),oi(s)}}function oi(s){var c=s.flags;if(c&2){try{for(var d,g=s.return;g!==null;){if(T3(g)){d=g;break}g=g.return}if(d==null)throw Error(n(160));switch(d.tag){case 27:var x=d.stateNode,_=T0(s);Yp(s,_,x);break;case 5:var F=d.stateNode;d.flags&32&&(Ti(F,""),d.flags&=-33);var j=T0(s);Yp(s,j,F);break;case 3:case 4:var Y=d.stateNode.containerInfo,ct=T0(s);S0(s,ct,Y);break;default:throw Error(n(161))}}catch(bt){Je(s,s.return,bt)}s.flags&=-3}c&4096&&(s.flags&=-4097)}function O3(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var c=s;O3(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),s=s.sibling}}function rs(s,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)R3(s,c.alternate,c),c=c.sibling}function Eu(s){for(s=s.child;s!==null;){var c=s;switch(c.tag){case 0:case 11:case 14:case 15:ns(4,c,c.return),Eu(c);break;case 1:_a(c,c.return);var d=c.stateNode;typeof d.componentWillUnmount=="function"&&E3(c,c.return,d),Eu(c);break;case 27:uf(c.stateNode);case 26:case 5:_a(c,c.return),Eu(c);break;case 22:c.memoizedState===null&&Eu(c);break;case 30:Eu(c);break;default:Eu(c)}s=s.sibling}}function is(s,c,d){for(d=d&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var g=c.alternate,x=s,_=c,F=_.flags;switch(_.tag){case 0:case 11:case 15:is(x,_,d),Qh(4,_);break;case 1:if(is(x,_,d),g=_,x=g.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(ct){Je(g,g.return,ct)}if(g=_,x=g.updateQueue,x!==null){var j=g.stateNode;try{var Y=x.shared.hiddenCallbacks;if(Y!==null)for(x.shared.hiddenCallbacks=null,x=0;x<Y.length;x++)uE(Y[x],j)}catch(ct){Je(g,g.return,ct)}}d&&F&64&&C3(_),Zh(_,_.return);break;case 27:S3(_);case 26:case 5:is(x,_,d),d&&g===null&&F&4&&_3(_),Zh(_,_.return);break;case 12:is(x,_,d);break;case 13:is(x,_,d),d&&F&4&&k3(x,_);break;case 22:_.memoizedState===null&&is(x,_,d),Zh(_,_.return);break;case 30:break;default:is(x,_,d)}c=c.sibling}}function N0(s,c){var d=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),s=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(s=c.memoizedState.cachePool.pool),s!==d&&(s!=null&&s.refCount++,d!=null&&zh(d))}function I0(s,c){s=null,c.alternate!==null&&(s=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==s&&(c.refCount++,s!=null&&zh(s))}function Ta(s,c,d,g){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)M3(s,c,d,g),c=c.sibling}function M3(s,c,d,g){var x=c.flags;switch(c.tag){case 0:case 11:case 15:Ta(s,c,d,g),x&2048&&Qh(9,c);break;case 1:Ta(s,c,d,g);break;case 3:Ta(s,c,d,g),x&2048&&(s=null,c.alternate!==null&&(s=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==s&&(c.refCount++,s!=null&&zh(s)));break;case 12:if(x&2048){Ta(s,c,d,g),s=c.stateNode;try{var _=c.memoizedProps,F=_.id,j=_.onPostCommit;typeof j=="function"&&j(F,c.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(Y){Je(c,c.return,Y)}}else Ta(s,c,d,g);break;case 13:Ta(s,c,d,g);break;case 23:break;case 22:_=c.stateNode,F=c.alternate,c.memoizedState!==null?_._visibility&2?Ta(s,c,d,g):Jh(s,c):_._visibility&2?Ta(s,c,d,g):(_._visibility|=2,Gl(s,c,d,g,(c.subtreeFlags&10256)!==0)),x&2048&&N0(F,c);break;case 24:Ta(s,c,d,g),x&2048&&I0(c.alternate,c);break;default:Ta(s,c,d,g)}}function Gl(s,c,d,g,x){for(x=x&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var _=s,F=c,j=d,Y=g,ct=F.flags;switch(F.tag){case 0:case 11:case 15:Gl(_,F,j,Y,x),Qh(8,F);break;case 23:break;case 22:var bt=F.stateNode;F.memoizedState!==null?bt._visibility&2?Gl(_,F,j,Y,x):Jh(_,F):(bt._visibility|=2,Gl(_,F,j,Y,x)),x&&ct&2048&&N0(F.alternate,F);break;case 24:Gl(_,F,j,Y,x),x&&ct&2048&&I0(F.alternate,F);break;default:Gl(_,F,j,Y,x)}c=c.sibling}}function Jh(s,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var d=s,g=c,x=g.flags;switch(g.tag){case 22:Jh(d,g),x&2048&&N0(g.alternate,g);break;case 24:Jh(d,g),x&2048&&I0(g.alternate,g);break;default:Jh(d,g)}c=c.sibling}}var tf=8192;function $l(s){if(s.subtreeFlags&tf)for(s=s.child;s!==null;)L3(s),s=s.sibling}function L3(s){switch(s.tag){case 26:$l(s),s.flags&tf&&s.memoizedState!==null&&d9(Gi,s.memoizedState,s.memoizedProps);break;case 5:$l(s);break;case 3:case 4:var c=Gi;Gi=lm(s.stateNode.containerInfo),$l(s),Gi=c;break;case 22:s.memoizedState===null&&(c=s.alternate,c!==null&&c.memoizedState!==null?(c=tf,tf=16777216,$l(s),tf=c):$l(s));break;default:$l(s)}}function P3(s){var c=s.alternate;if(c!==null&&(s=c.child,s!==null)){c.child=null;do c=s.sibling,s.sibling=null,s=c;while(s!==null)}}function ef(s){var c=s.deletions;if((s.flags&16)!==0){if(c!==null)for(var d=0;d<c.length;d++){var g=c[d];er=g,V3(g,s)}P3(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)z3(s),s=s.sibling}function z3(s){switch(s.tag){case 0:case 11:case 15:ef(s),s.flags&2048&&ns(9,s,s.return);break;case 3:ef(s);break;case 12:ef(s);break;case 22:var c=s.stateNode;s.memoizedState!==null&&c._visibility&2&&(s.return===null||s.return.tag!==13)?(c._visibility&=-3,Qp(s)):ef(s);break;default:ef(s)}}function Qp(s){var c=s.deletions;if((s.flags&16)!==0){if(c!==null)for(var d=0;d<c.length;d++){var g=c[d];er=g,V3(g,s)}P3(s)}for(s=s.child;s!==null;){switch(c=s,c.tag){case 0:case 11:case 15:ns(8,c,c.return),Qp(c);break;case 22:d=c.stateNode,d._visibility&2&&(d._visibility&=-3,Qp(c));break;default:Qp(c)}s=s.sibling}}function V3(s,c){for(;er!==null;){var d=er;switch(d.tag){case 0:case 11:case 15:ns(8,d,c);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var g=d.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:zh(d.memoizedState.cache)}if(g=d.child,g!==null)g.return=d,er=g;else t:for(d=s;er!==null;){g=er;var x=g.sibling,_=g.return;if(N3(g),g===d){er=null;break t}if(x!==null){x.return=_,er=x;break t}er=_}}}var NO={getCacheForType:function(s){var c=_r(Gn),d=c.data.get(s);return d===void 0&&(d=s(),c.data.set(s,d)),d}},IO=typeof WeakMap=="function"?WeakMap:Map,He=0,en=null,we=null,ke=0,qe=0,si=null,as=!1,Kl=!1,k0=!1,mo=0,bn=0,os=0,_u=0,D0=0,Mi=0,Xl=0,nf=null,$r=null,O0=!1,M0=0,Zp=1/0,Jp=null,ss=null,dr=0,us=null,Yl=null,Ql=0,L0=0,P0=null,F3=null,rf=0,z0=null;function ui(){if((He&2)!==0&&ke!==0)return ke&-ke;if(q.T!==null){var s=Vl;return s!==0?s:H0()}return Wo()}function B3(){Mi===0&&(Mi=(ke&536870912)===0||Fe?fh():536870912);var s=Oi.current;return s!==null&&(s.flags|=32),Mi}function li(s,c,d){(s===en&&(qe===2||qe===9)||s.cancelPendingCommit!==null)&&(Zl(s,0),ls(s,ke,Mi,!1)),Ga(s,d),((He&2)===0||s!==en)&&(s===en&&((He&2)===0&&(_u|=d),bn===4&&ls(s,ke,Mi,!1)),Sa(s))}function j3(s,c,d){if((He&6)!==0)throw Error(n(327));var g=!d&&(c&124)===0&&(c&s.expiredLanes)===0||Ui(s,c),x=g?OO(s,c):B0(s,c,!0),_=g;do{if(x===0){Kl&&!g&&ls(s,c,0,!1);break}else{if(d=s.current.alternate,_&&!kO(d)){x=B0(s,c,!1),_=!1;continue}if(x===2){if(_=c,s.errorRecoveryDisabledLanes&_)var F=0;else F=s.pendingLanes&-536870913,F=F!==0?F:F&536870912?536870912:0;if(F!==0){c=F;t:{var j=s;x=nf;var Y=j.current.memoizedState.isDehydrated;if(Y&&(Zl(j,F).flags|=256),F=B0(j,F,!1),F!==2){if(k0&&!Y){j.errorRecoveryDisabledLanes|=_,_u|=_,x=4;break t}_=$r,$r=x,_!==null&&($r===null?$r=_:$r.push.apply($r,_))}x=F}if(_=!1,x!==2)continue}}if(x===1){Zl(s,0),ls(s,c,0,!0);break}t:{switch(g=s,_=x,_){case 0:case 1:throw Error(n(345));case 4:if((c&4194048)!==c)break;case 6:ls(g,c,Mi,!as);break t;case 2:$r=null;break;case 3:case 5:break;default:throw Error(n(329))}if((c&62914560)===c&&(x=M0+300-Ke(),10<x)){if(ls(g,c,Mi,!as),ca(g,0,!0)!==0)break t;g.timeoutHandle=g_(U3.bind(null,g,d,$r,Jp,O0,c,Mi,_u,Xl,as,_,2,-0,0),x);break t}U3(g,d,$r,Jp,O0,c,Mi,_u,Xl,as,_,0,-0,0)}}break}while(!0);Sa(s)}function U3(s,c,d,g,x,_,F,j,Y,ct,bt,Ct,ht,pt){if(s.timeoutHandle=-1,Ct=c.subtreeFlags,(Ct&8192||(Ct&16785408)===16785408)&&(hf={stylesheets:null,count:0,unsuspend:f9},L3(c),Ct=p9(),Ct!==null)){s.cancelPendingCommit=Ct(X3.bind(null,s,c,_,d,g,x,F,j,Y,bt,1,ht,pt)),ls(s,_,F,!ct);return}X3(s,c,_,d,g,x,F,j,Y)}function kO(s){for(var c=s;;){var d=c.tag;if((d===0||d===11||d===15)&&c.flags&16384&&(d=c.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var g=0;g<d.length;g++){var x=d[g],_=x.getSnapshot;x=x.value;try{if(!ri(_(),x))return!1}catch{return!1}}if(d=c.child,c.subtreeFlags&16384&&d!==null)d.return=c,c=d;else{if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function ls(s,c,d,g){c&=~D0,c&=~_u,s.suspendedLanes|=c,s.pingedLanes&=~c,g&&(s.warmLanes|=c),g=s.expirationTimes;for(var x=c;0<x;){var _=31-Re(x),F=1<<_;g[_]=-1,x&=~F}d!==0&&ha(s,d,c)}function tm(){return(He&6)===0?(af(0),!1):!0}function V0(){if(we!==null){if(qe===0)var s=we.return;else s=we,oo=yu=null,e0(s),Hl=null,Kh=0,s=we;for(;s!==null;)w3(s.alternate,s),s=s.return;we=null}}function Zl(s,c){var d=s.timeoutHandle;d!==-1&&(s.timeoutHandle=-1,XO(d)),d=s.cancelPendingCommit,d!==null&&(s.cancelPendingCommit=null,d()),V0(),en=s,we=d=ro(s.current,null),ke=c,qe=0,si=null,as=!1,Kl=Ui(s,c),k0=!1,Xl=Mi=D0=_u=os=bn=0,$r=nf=null,O0=!1,(c&8)!==0&&(c|=c&32);var g=s.entangledLanes;if(g!==0)for(s=s.entanglements,g&=c;0<g;){var x=31-Re(g),_=1<<x;c|=s[x],g&=~_}return mo=c,Cp(),d}function W3(s,c){ge=null,q.H=jp,c===Fh||c===kp?(c=oE(),qe=3):c===rE?(c=oE(),qe=4):qe=c===s3?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,si=c,we===null&&(bn=1,Gp(s,Ni(c,s.current)))}function H3(){var s=q.H;return q.H=jp,s===null?jp:s}function q3(){var s=q.A;return q.A=NO,s}function F0(){bn=4,as||(ke&4194048)!==ke&&Oi.current!==null||(Kl=!0),(os&134217727)===0&&(_u&134217727)===0||en===null||ls(en,ke,Mi,!1)}function B0(s,c,d){var g=He;He|=2;var x=H3(),_=q3();(en!==s||ke!==c)&&(Jp=null,Zl(s,c)),c=!1;var F=bn;t:do try{if(qe!==0&&we!==null){var j=we,Y=si;switch(qe){case 8:V0(),F=6;break t;case 3:case 2:case 9:case 6:Oi.current===null&&(c=!0);var ct=qe;if(qe=0,si=null,Jl(s,j,Y,ct),d&&Kl){F=0;break t}break;default:ct=qe,qe=0,si=null,Jl(s,j,Y,ct)}}DO(),F=bn;break}catch(bt){W3(s,bt)}while(!0);return c&&s.shellSuspendCounter++,oo=yu=null,He=g,q.H=x,q.A=_,we===null&&(en=null,ke=0,Cp()),F}function DO(){for(;we!==null;)G3(we)}function OO(s,c){var d=He;He|=2;var g=H3(),x=q3();en!==s||ke!==c?(Jp=null,Zp=Ke()+500,Zl(s,c)):Kl=Ui(s,c);t:do try{if(qe!==0&&we!==null){c=we;var _=si;e:switch(qe){case 1:qe=0,si=null,Jl(s,c,_,1);break;case 2:case 9:if(iE(_)){qe=0,si=null,$3(c);break}c=function(){qe!==2&&qe!==9||en!==s||(qe=7),Sa(s)},_.then(c,c);break t;case 3:qe=7;break t;case 4:qe=5;break t;case 7:iE(_)?(qe=0,si=null,$3(c)):(qe=0,si=null,Jl(s,c,_,7));break;case 5:var F=null;switch(we.tag){case 26:F=we.memoizedState;case 5:case 27:var j=we;if(!F||R_(F)){qe=0,si=null;var Y=j.sibling;if(Y!==null)we=Y;else{var ct=j.return;ct!==null?(we=ct,em(ct)):we=null}break e}}qe=0,si=null,Jl(s,c,_,5);break;case 6:qe=0,si=null,Jl(s,c,_,6);break;case 8:V0(),bn=6;break t;default:throw Error(n(462))}}MO();break}catch(bt){W3(s,bt)}while(!0);return oo=yu=null,q.H=g,q.A=x,He=d,we!==null?0:(en=null,ke=0,Cp(),bn)}function MO(){for(;we!==null&&!ze();)G3(we)}function G3(s){var c=b3(s.alternate,s,mo);s.memoizedProps=s.pendingProps,c===null?em(s):we=c}function $3(s){var c=s,d=c.alternate;switch(c.tag){case 15:case 0:c=d3(d,c,c.pendingProps,c.type,void 0,ke);break;case 11:c=d3(d,c,c.pendingProps,c.type.render,c.ref,ke);break;case 5:e0(c);default:w3(d,c),c=we=KC(c,mo),c=b3(d,c,mo)}s.memoizedProps=s.pendingProps,c===null?em(s):we=c}function Jl(s,c,d,g){oo=yu=null,e0(c),Hl=null,Kh=0;var x=c.return;try{if(EO(s,x,c,d,ke)){bn=1,Gp(s,Ni(d,s.current)),we=null;return}}catch(_){if(x!==null)throw we=x,_;bn=1,Gp(s,Ni(d,s.current)),we=null;return}c.flags&32768?(Fe||g===1?s=!0:Kl||(ke&536870912)!==0?s=!1:(as=s=!0,(g===2||g===9||g===3||g===6)&&(g=Oi.current,g!==null&&g.tag===13&&(g.flags|=16384))),K3(c,s)):em(c)}function em(s){var c=s;do{if((c.flags&32768)!==0){K3(c,as);return}s=c.return;var d=TO(c.alternate,c,mo);if(d!==null){we=d;return}if(c=c.sibling,c!==null){we=c;return}we=c=s}while(c!==null);bn===0&&(bn=5)}function K3(s,c){do{var d=SO(s.alternate,s);if(d!==null){d.flags&=32767,we=d;return}if(d=s.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!c&&(s=s.sibling,s!==null)){we=s;return}we=s=d}while(s!==null);bn=6,we=null}function X3(s,c,d,g,x,_,F,j,Y){s.cancelPendingCommit=null;do nm();while(dr!==0);if((He&6)!==0)throw Error(n(327));if(c!==null){if(c===s.current)throw Error(n(177));if(_=c.lanes|c.childLanes,_|=Iy,ph(s,d,_,F,j,Y),s===en&&(we=en=null,ke=0),Yl=c,us=s,Ql=d,L0=_,P0=x,F3=g,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,VO(un,function(){return t_(),null})):(s.callbackNode=null,s.callbackPriority=0),g=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||g){g=q.T,q.T=null,x=K.p,K.p=2,F=He,He|=4;try{AO(s,c,d)}finally{He=F,K.p=x,q.T=g}}dr=1,Y3(),Q3(),Z3()}}function Y3(){if(dr===1){dr=0;var s=us,c=Yl,d=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||d){d=q.T,q.T=null;var g=K.p;K.p=2;var x=He;He|=4;try{D3(c,s);var _=Z0,F=VC(s.containerInfo),j=_.focusedElem,Y=_.selectionRange;if(F!==j&&j&&j.ownerDocument&&zC(j.ownerDocument.documentElement,j)){if(Y!==null&&Ty(j)){var ct=Y.start,bt=Y.end;if(bt===void 0&&(bt=ct),"selectionStart"in j)j.selectionStart=ct,j.selectionEnd=Math.min(bt,j.value.length);else{var Ct=j.ownerDocument||document,ht=Ct&&Ct.defaultView||window;if(ht.getSelection){var pt=ht.getSelection(),Qt=j.textContent.length,Gt=Math.min(Y.start,Qt),Ze=Y.end===void 0?Gt:Math.min(Y.end,Qt);!pt.extend&&Gt>Ze&&(F=Ze,Ze=Gt,Gt=F);var at=PC(j,Gt),nt=PC(j,Ze);if(at&&nt&&(pt.rangeCount!==1||pt.anchorNode!==at.node||pt.anchorOffset!==at.offset||pt.focusNode!==nt.node||pt.focusOffset!==nt.offset)){var st=Ct.createRange();st.setStart(at.node,at.offset),pt.removeAllRanges(),Gt>Ze?(pt.addRange(st),pt.extend(nt.node,nt.offset)):(st.setEnd(nt.node,nt.offset),pt.addRange(st))}}}}for(Ct=[],pt=j;pt=pt.parentNode;)pt.nodeType===1&&Ct.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof j.focus=="function"&&j.focus(),j=0;j<Ct.length;j++){var wt=Ct[j];wt.element.scrollLeft=wt.left,wt.element.scrollTop=wt.top}}pm=!!Q0,Z0=Q0=null}finally{He=x,K.p=g,q.T=d}}s.current=c,dr=2}}function Q3(){if(dr===2){dr=0;var s=us,c=Yl,d=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||d){d=q.T,q.T=null;var g=K.p;K.p=2;var x=He;He|=4;try{R3(s,c.alternate,c)}finally{He=x,K.p=g,q.T=d}}dr=3}}function Z3(){if(dr===4||dr===3){dr=0,Ae();var s=us,c=Yl,d=Ql,g=F3;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?dr=5:(dr=0,Yl=us=null,J3(s,s.pendingLanes));var x=s.pendingLanes;if(x===0&&(ss=null),gl(d),c=c.stateNode,le&&typeof le.onCommitFiberRoot=="function")try{le.onCommitFiberRoot(fe,c,void 0,(c.current.flags&128)===128)}catch{}if(g!==null){c=q.T,x=K.p,K.p=2,q.T=null;try{for(var _=s.onRecoverableError,F=0;F<g.length;F++){var j=g[F];_(j.value,{componentStack:j.stack})}}finally{q.T=c,K.p=x}}(Ql&3)!==0&&nm(),Sa(s),x=s.pendingLanes,(d&4194090)!==0&&(x&42)!==0?s===z0?rf++:(rf=0,z0=s):rf=0,af(0)}}function J3(s,c){(s.pooledCacheLanes&=c)===0&&(c=s.pooledCache,c!=null&&(s.pooledCache=null,zh(c)))}function nm(s){return Y3(),Q3(),Z3(),t_()}function t_(){if(dr!==5)return!1;var s=us,c=L0;L0=0;var d=gl(Ql),g=q.T,x=K.p;try{K.p=32>d?32:d,q.T=null,d=P0,P0=null;var _=us,F=Ql;if(dr=0,Yl=us=null,Ql=0,(He&6)!==0)throw Error(n(331));var j=He;if(He|=4,z3(_.current),M3(_,_.current,F,d),He=j,af(0,!1),le&&typeof le.onPostCommitFiberRoot=="function")try{le.onPostCommitFiberRoot(fe,_)}catch{}return!0}finally{K.p=x,q.T=g,J3(s,c)}}function e_(s,c,d){c=Ni(d,c),c=m0(s.stateNode,c,2),s=Zo(s,c,2),s!==null&&(Ga(s,2),Sa(s))}function Je(s,c,d){if(s.tag===3)e_(s,s,d);else for(;c!==null;){if(c.tag===3){e_(c,s,d);break}else if(c.tag===1){var g=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(ss===null||!ss.has(g))){s=Ni(d,s),d=a3(2),g=Zo(c,d,2),g!==null&&(o3(d,g,c,s),Ga(g,2),Sa(g));break}}c=c.return}}function j0(s,c,d){var g=s.pingCache;if(g===null){g=s.pingCache=new IO;var x=new Set;g.set(c,x)}else x=g.get(c),x===void 0&&(x=new Set,g.set(c,x));x.has(d)||(k0=!0,x.add(d),s=LO.bind(null,s,c,d),c.then(s,s))}function LO(s,c,d){var g=s.pingCache;g!==null&&g.delete(c),s.pingedLanes|=s.suspendedLanes&d,s.warmLanes&=~d,en===s&&(ke&d)===d&&(bn===4||bn===3&&(ke&62914560)===ke&&300>Ke()-M0?(He&2)===0&&Zl(s,0):D0|=d,Xl===ke&&(Xl=0)),Sa(s)}function n_(s,c){c===0&&(c=dh()),s=Ml(s,c),s!==null&&(Ga(s,c),Sa(s))}function PO(s){var c=s.memoizedState,d=0;c!==null&&(d=c.retryLane),n_(s,d)}function zO(s,c){var d=0;switch(s.tag){case 13:var g=s.stateNode,x=s.memoizedState;x!==null&&(d=x.retryLane);break;case 19:g=s.stateNode;break;case 22:g=s.stateNode._retryCache;break;default:throw Error(n(314))}g!==null&&g.delete(c),n_(s,d)}function VO(s,c){return se(s,c)}var rm=null,tc=null,U0=!1,im=!1,W0=!1,Tu=0;function Sa(s){s!==tc&&s.next===null&&(tc===null?rm=tc=s:tc=tc.next=s),im=!0,U0||(U0=!0,BO())}function af(s,c){if(!W0&&im){W0=!0;do for(var d=!1,g=rm;g!==null;){if(s!==0){var x=g.pendingLanes;if(x===0)var _=0;else{var F=g.suspendedLanes,j=g.pingedLanes;_=(1<<31-Re(42|s)+1)-1,_&=x&~(F&~j),_=_&201326741?_&201326741|1:_?_|2:0}_!==0&&(d=!0,o_(g,_))}else _=ke,_=ca(g,g===en?_:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(_&3)===0||Ui(g,_)||(d=!0,o_(g,_));g=g.next}while(d);W0=!1}}function FO(){r_()}function r_(){im=U0=!1;var s=0;Tu!==0&&(KO()&&(s=Tu),Tu=0);for(var c=Ke(),d=null,g=rm;g!==null;){var x=g.next,_=i_(g,c);_===0?(g.next=null,d===null?rm=x:d.next=x,x===null&&(tc=d)):(d=g,(s!==0||(_&3)!==0)&&(im=!0)),g=x}af(s)}function i_(s,c){for(var d=s.suspendedLanes,g=s.pingedLanes,x=s.expirationTimes,_=s.pendingLanes&-62914561;0<_;){var F=31-Re(_),j=1<<F,Y=x[F];Y===-1?((j&d)===0||(j&g)!==0)&&(x[F]=hh(j,c)):Y<=c&&(s.expiredLanes|=j),_&=~j}if(c=en,d=ke,d=ca(s,s===c?d:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),g=s.callbackNode,d===0||s===c&&(qe===2||qe===9)||s.cancelPendingCommit!==null)return g!==null&&g!==null&&Jt(g),s.callbackNode=null,s.callbackPriority=0;if((d&3)===0||Ui(s,d)){if(c=d&-d,c===s.callbackPriority)return c;switch(g!==null&&Jt(g),gl(d)){case 2:case 8:d=In;break;case 32:d=un;break;case 268435456:d=re;break;default:d=un}return g=a_.bind(null,s),d=se(d,g),s.callbackPriority=c,s.callbackNode=d,c}return g!==null&&g!==null&&Jt(g),s.callbackPriority=2,s.callbackNode=null,2}function a_(s,c){if(dr!==0&&dr!==5)return s.callbackNode=null,s.callbackPriority=0,null;var d=s.callbackNode;if(nm()&&s.callbackNode!==d)return null;var g=ke;return g=ca(s,s===en?g:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),g===0?null:(j3(s,g,c),i_(s,Ke()),s.callbackNode!=null&&s.callbackNode===d?a_.bind(null,s):null)}function o_(s,c){if(nm())return null;j3(s,c,!0)}function BO(){YO(function(){(He&6)!==0?se(En,FO):r_()})}function H0(){return Tu===0&&(Tu=fh()),Tu}function s_(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Cl(""+s)}function u_(s,c){var d=c.ownerDocument.createElement("input");return d.name=c.name,d.value=c.value,s.id&&d.setAttribute("form",s.id),c.parentNode.insertBefore(d,c),s=new FormData(s),d.parentNode.removeChild(d),s}function jO(s,c,d,g,x){if(c==="submit"&&d&&d.stateNode===x){var _=s_((x[kn]||null).action),F=g.submitter;F&&(c=(c=F[kn]||null)?s_(c.formAction):F.getAttribute("formAction"),c!==null&&(_=c,F=null));var j=new El("action","action",null,g,x);s.push({event:j,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(Tu!==0){var Y=F?u_(x,F):new FormData(x);c0(d,{pending:!0,data:Y,method:x.method,action:_},null,Y)}}else typeof _=="function"&&(j.preventDefault(),Y=F?u_(x,F):new FormData(x),c0(d,{pending:!0,data:Y,method:x.method,action:_},_,Y))},currentTarget:x}]})}}for(var q0=0;q0<Ny.length;q0++){var G0=Ny[q0],UO=G0.toLowerCase(),WO=G0[0].toUpperCase()+G0.slice(1);qi(UO,"on"+WO)}qi(jC,"onAnimationEnd"),qi(UC,"onAnimationIteration"),qi(WC,"onAnimationStart"),qi("dblclick","onDoubleClick"),qi("focusin","onFocus"),qi("focusout","onBlur"),qi(oO,"onTransitionRun"),qi(sO,"onTransitionStart"),qi(uO,"onTransitionCancel"),qi(HC,"onTransitionEnd"),Ka("onMouseEnter",["mouseout","mouseover"]),Ka("onMouseLeave",["mouseout","mouseover"]),Ka("onPointerEnter",["pointerout","pointerover"]),Ka("onPointerLeave",["pointerout","pointerover"]),Wi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Wi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Wi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Wi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Wi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Wi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var of="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),HO=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(of));function l_(s,c){c=(c&4)!==0;for(var d=0;d<s.length;d++){var g=s[d],x=g.event;g=g.listeners;t:{var _=void 0;if(c)for(var F=g.length-1;0<=F;F--){var j=g[F],Y=j.instance,ct=j.currentTarget;if(j=j.listener,Y!==_&&x.isPropagationStopped())break t;_=j,x.currentTarget=ct;try{_(x)}catch(bt){qp(bt)}x.currentTarget=null,_=Y}else for(F=0;F<g.length;F++){if(j=g[F],Y=j.instance,ct=j.currentTarget,j=j.listener,Y!==_&&x.isPropagationStopped())break t;_=j,x.currentTarget=ct;try{_(x)}catch(bt){qp(bt)}x.currentTarget=null,_=Y}}}}function Ce(s,c){var d=c[gh];d===void 0&&(d=c[gh]=new Set);var g=s+"__bubble";d.has(g)||(c_(c,s,2,!1),d.add(g))}function $0(s,c,d){var g=0;c&&(g|=4),c_(d,s,g,c)}var am="_reactListening"+Math.random().toString(36).slice(2);function K0(s){if(!s[am]){s[am]=!0,vh.forEach(function(d){d!=="selectionchange"&&(HO.has(d)||$0(d,!1,s),$0(d,!0,s))});var c=s.nodeType===9?s:s.ownerDocument;c===null||c[am]||(c[am]=!0,$0("selectionchange",!1,c))}}function c_(s,c,d,g){switch(M_(c)){case 2:var x=v9;break;case 8:x=y9;break;default:x=u1}d=x.bind(null,c,d,s),x=void 0,!Ai||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(x=!0),g?x!==void 0?s.addEventListener(c,d,{capture:!0,passive:x}):s.addEventListener(c,d,!0):x!==void 0?s.addEventListener(c,d,{passive:x}):s.addEventListener(c,d,!1)}function X0(s,c,d,g,x){var _=g;if((c&1)===0&&(c&2)===0&&g!==null)t:for(;;){if(g===null)return;var F=g.tag;if(F===3||F===4){var j=g.stateNode.containerInfo;if(j===x)break;if(F===4)for(F=g.return;F!==null;){var Y=F.tag;if((Y===3||Y===4)&&F.stateNode.containerInfo===x)return;F=F.return}for(;j!==null;){if(F=$a(j),F===null)return;if(Y=F.tag,Y===5||Y===6||Y===26||Y===27){g=_=F;continue t}j=j.parentNode}}g=g.return}sp(function(){var ct=_,bt=Si(d),Ct=[];t:{var ht=qC.get(s);if(ht!==void 0){var pt=El,Qt=s;switch(s){case"keypress":if(va(d)===0)break t;case"keydown":case"keyup":pt=Nl;break;case"focusin":Qt="focus",pt=Sl;break;case"focusout":Qt="blur",pt=Sl;break;case"beforeblur":case"afterblur":pt=Sl;break;case"click":if(d.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pt=Ri;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pt=wy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pt=mp;break;case jC:case UC:case WC:pt=Al;break;case HC:pt=vp;break;case"scroll":case"scrollend":pt=up;break;case"wheel":pt=Il;break;case"copy":case"cut":case"paste":pt=Rl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pt=Nh;break;case"toggle":case"beforetoggle":pt=bp}var Gt=(c&4)!==0,Ze=!Gt&&(s==="scroll"||s==="scrollend"),at=Gt?ht!==null?ht+"Capture":null:ht;Gt=[];for(var nt=ct,st;nt!==null;){var wt=nt;if(st=wt.stateNode,wt=wt.tag,wt!==5&&wt!==26&&wt!==27||st===null||at===null||(wt=iu(nt,at),wt!=null&&Gt.push(sf(nt,wt,st))),Ze)break;nt=nt.return}0<Gt.length&&(ht=new pt(ht,Qt,null,d,bt),Ct.push({event:ht,listeners:Gt}))}}if((c&7)===0){t:{if(ht=s==="mouseover"||s==="pointerover",pt=s==="mouseout"||s==="pointerout",ht&&d!==Qa&&(Qt=d.relatedTarget||d.fromElement)&&($a(Qt)||Qt[_i]))break t;if((pt||ht)&&(ht=bt.window===bt?bt:(ht=bt.ownerDocument)?ht.defaultView||ht.parentWindow:window,pt?(Qt=d.relatedTarget||d.toElement,pt=ct,Qt=Qt?$a(Qt):null,Qt!==null&&(Ze=a(Qt),Gt=Qt.tag,Qt!==Ze||Gt!==5&&Gt!==27&&Gt!==6)&&(Qt=null)):(pt=null,Qt=ct),pt!==Qt)){if(Gt=Ri,wt="onMouseLeave",at="onMouseEnter",nt="mouse",(s==="pointerout"||s==="pointerover")&&(Gt=Nh,wt="onPointerLeave",at="onPointerEnter",nt="pointer"),Ze=pt==null?ht:da(pt),st=Qt==null?ht:da(Qt),ht=new Gt(wt,nt+"leave",pt,d,bt),ht.target=Ze,ht.relatedTarget=st,wt=null,$a(bt)===ct&&(Gt=new Gt(at,nt+"enter",Qt,d,bt),Gt.target=st,Gt.relatedTarget=Ze,wt=Gt),Ze=wt,pt&&Qt)e:{for(Gt=pt,at=Qt,nt=0,st=Gt;st;st=ec(st))nt++;for(st=0,wt=at;wt;wt=ec(wt))st++;for(;0<nt-st;)Gt=ec(Gt),nt--;for(;0<st-nt;)at=ec(at),st--;for(;nt--;){if(Gt===at||at!==null&&Gt===at.alternate)break e;Gt=ec(Gt),at=ec(at)}Gt=null}else Gt=null;pt!==null&&h_(Ct,ht,pt,Gt,!1),Qt!==null&&Ze!==null&&h_(Ct,Ze,Qt,Gt,!0)}}t:{if(ht=ct?da(ct):window,pt=ht.nodeName&&ht.nodeName.toLowerCase(),pt==="select"||pt==="input"&&ht.type==="file")var Vt=IC;else if(qn(ht))if(kC)Vt=rO;else{Vt=eO;var be=tO}else pt=ht.nodeName,!pt||pt.toLowerCase()!=="input"||ht.type!=="checkbox"&&ht.type!=="radio"?ct&&Ch(ct.elementType)&&(Vt=IC):Vt=nO;if(Vt&&(Vt=Vt(s,ct))){no(Ct,Vt,d,bt);break t}be&&be(s,ht,ct),s==="focusout"&&ct&&ht.type==="number"&&ct.memoizedProps.value!=null&&$o(ht,"number",ht.value)}switch(be=ct?da(ct):window,s){case"focusin":(qn(be)||be.contentEditable==="true")&&(kl=be,Sy=ct,Dh=null);break;case"focusout":Dh=Sy=kl=null;break;case"mousedown":Ay=!0;break;case"contextmenu":case"mouseup":case"dragend":Ay=!1,FC(Ct,d,bt);break;case"selectionchange":if(aO)break;case"keydown":case"keyup":FC(Ct,d,bt)}var Wt;if(xa)t:{switch(s){case"compositionstart":var $t="onCompositionStart";break t;case"compositionend":$t="onCompositionEnd";break t;case"compositionupdate":$t="onCompositionUpdate";break t}$t=void 0}else Ne?yt(s,d)&&($t="onCompositionEnd"):s==="keydown"&&d.keyCode===229&&($t="onCompositionStart");$t&&(z&&d.locale!=="ko"&&(Ne||$t!=="onCompositionStart"?$t==="onCompositionEnd"&&Ne&&(Wt=_h()):(ga=bt,Ko="value"in ga?ga.value:ga.textContent,Ne=!0)),be=om(ct,$t),0<be.length&&($t=new Ah($t,s,null,d,bt),Ct.push({event:$t,listeners:be}),Wt?$t.data=Wt:(Wt=It(d),Wt!==null&&($t.data=Wt)))),(Wt=I?Hn(s,d):Ie(s,d))&&($t=om(ct,"onBeforeInput"),0<$t.length&&(be=new Ah("onBeforeInput","beforeinput",null,d,bt),Ct.push({event:be,listeners:$t}),be.data=Wt)),jO(Ct,s,ct,d,bt)}l_(Ct,c)})}function sf(s,c,d){return{instance:s,listener:c,currentTarget:d}}function om(s,c){for(var d=c+"Capture",g=[];s!==null;){var x=s,_=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||_===null||(x=iu(s,d),x!=null&&g.unshift(sf(s,x,_)),x=iu(s,c),x!=null&&g.push(sf(s,x,_))),s.tag===3)return g;s=s.return}return[]}function ec(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function h_(s,c,d,g,x){for(var _=c._reactName,F=[];d!==null&&d!==g;){var j=d,Y=j.alternate,ct=j.stateNode;if(j=j.tag,Y!==null&&Y===g)break;j!==5&&j!==26&&j!==27||ct===null||(Y=ct,x?(ct=iu(d,_),ct!=null&&F.unshift(sf(d,ct,Y))):x||(ct=iu(d,_),ct!=null&&F.push(sf(d,ct,Y)))),d=d.return}F.length!==0&&s.push({event:c,listeners:F})}var qO=/\r\n?/g,GO=/\u0000|\uFFFD/g;function f_(s){return(typeof s=="string"?s:""+s).replace(qO,`
`).replace(GO,"")}function d_(s,c){return c=f_(c),f_(s)===c}function sm(){}function Qe(s,c,d,g,x,_){switch(d){case"children":typeof g=="string"?c==="body"||c==="textarea"&&g===""||Ti(s,g):(typeof g=="number"||typeof g=="bigint")&&c!=="body"&&Ti(s,""+g);break;case"className":pa(s,"class",g);break;case"tabIndex":pa(s,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":pa(s,d,g);break;case"style":wh(s,g,_);break;case"data":if(c!=="object"){pa(s,"data",g);break}case"src":case"href":if(g===""&&(c!=="a"||d!=="href")){s.removeAttribute(d);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){s.removeAttribute(d);break}g=Cl(""+g),s.setAttribute(d,g);break;case"action":case"formAction":if(typeof g=="function"){s.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof _=="function"&&(d==="formAction"?(c!=="input"&&Qe(s,c,"name",x.name,x,null),Qe(s,c,"formEncType",x.formEncType,x,null),Qe(s,c,"formMethod",x.formMethod,x,null),Qe(s,c,"formTarget",x.formTarget,x,null)):(Qe(s,c,"encType",x.encType,x,null),Qe(s,c,"method",x.method,x,null),Qe(s,c,"target",x.target,x,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){s.removeAttribute(d);break}g=Cl(""+g),s.setAttribute(d,g);break;case"onClick":g!=null&&(s.onclick=sm);break;case"onScroll":g!=null&&Ce("scroll",s);break;case"onScrollEnd":g!=null&&Ce("scrollend",s);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(d=g.__html,d!=null){if(x.children!=null)throw Error(n(60));s.innerHTML=d}}break;case"multiple":s.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":s.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){s.removeAttribute("xlink:href");break}d=Cl(""+g),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(d,""+g):s.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(d,""):s.removeAttribute(d);break;case"capture":case"download":g===!0?s.setAttribute(d,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?s.setAttribute(d,g):s.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?s.setAttribute(d,g):s.removeAttribute(d);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?s.removeAttribute(d):s.setAttribute(d,g);break;case"popover":Ce("beforetoggle",s),Ce("toggle",s),Go(s,"popover",g);break;case"xlinkActuate":cr(s,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":cr(s,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":cr(s,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":cr(s,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":cr(s,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":cr(s,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":cr(s,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":cr(s,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":cr(s,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":Go(s,"is",g);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=by.get(d)||d,Go(s,d,g))}}function Y0(s,c,d,g,x,_){switch(d){case"style":wh(s,g,_);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(d=g.__html,d!=null){if(x.children!=null)throw Error(n(60));s.innerHTML=d}}break;case"children":typeof g=="string"?Ti(s,g):(typeof g=="number"||typeof g=="bigint")&&Ti(s,""+g);break;case"onScroll":g!=null&&Ce("scroll",s);break;case"onScrollEnd":g!=null&&Ce("scrollend",s);break;case"onClick":g!=null&&(s.onclick=sm);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!vl.hasOwnProperty(d))t:{if(d[0]==="o"&&d[1]==="n"&&(x=d.endsWith("Capture"),c=d.slice(2,x?d.length-7:void 0),_=s[kn]||null,_=_!=null?_[d]:null,typeof _=="function"&&s.removeEventListener(c,_,x),typeof g=="function")){typeof _!="function"&&_!==null&&(d in s?s[d]=null:s.hasAttribute(d)&&s.removeAttribute(d)),s.addEventListener(c,g,x);break t}d in s?s[d]=g:g===!0?s.setAttribute(d,""):Go(s,d,g)}}}function pr(s,c,d){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ce("error",s),Ce("load",s);var g=!1,x=!1,_;for(_ in d)if(d.hasOwnProperty(_)){var F=d[_];if(F!=null)switch(_){case"src":g=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:Qe(s,c,_,F,d,null)}}x&&Qe(s,c,"srcSet",d.srcSet,d,null),g&&Qe(s,c,"src",d.src,d,null);return;case"input":Ce("invalid",s);var j=_=F=x=null,Y=null,ct=null;for(g in d)if(d.hasOwnProperty(g)){var bt=d[g];if(bt!=null)switch(g){case"name":x=bt;break;case"type":F=bt;break;case"checked":Y=bt;break;case"defaultChecked":ct=bt;break;case"value":_=bt;break;case"defaultValue":j=bt;break;case"children":case"dangerouslySetInnerHTML":if(bt!=null)throw Error(n(137,c));break;default:Qe(s,c,g,bt,d,null)}}eu(s,_,j,Y,ct,F,x,!1),wl(s);return;case"select":Ce("invalid",s),g=F=_=null;for(x in d)if(d.hasOwnProperty(x)&&(j=d[x],j!=null))switch(x){case"value":_=j;break;case"defaultValue":F=j;break;case"multiple":g=j;default:Qe(s,c,x,j,d,null)}c=_,d=F,s.multiple=!!g,c!=null?Ya(s,!!g,c,!1):d!=null&&Ya(s,!!g,d,!0);return;case"textarea":Ce("invalid",s),_=x=g=null;for(F in d)if(d.hasOwnProperty(F)&&(j=d[F],j!=null))switch(F){case"value":g=j;break;case"defaultValue":x=j;break;case"children":_=j;break;case"dangerouslySetInnerHTML":if(j!=null)throw Error(n(91));break;default:Qe(s,c,F,j,d,null)}nu(s,g,x,_),wl(s);return;case"option":for(Y in d)if(d.hasOwnProperty(Y)&&(g=d[Y],g!=null))switch(Y){case"selected":s.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:Qe(s,c,Y,g,d,null)}return;case"dialog":Ce("beforetoggle",s),Ce("toggle",s),Ce("cancel",s),Ce("close",s);break;case"iframe":case"object":Ce("load",s);break;case"video":case"audio":for(g=0;g<of.length;g++)Ce(of[g],s);break;case"image":Ce("error",s),Ce("load",s);break;case"details":Ce("toggle",s);break;case"embed":case"source":case"link":Ce("error",s),Ce("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ct in d)if(d.hasOwnProperty(ct)&&(g=d[ct],g!=null))switch(ct){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:Qe(s,c,ct,g,d,null)}return;default:if(Ch(c)){for(bt in d)d.hasOwnProperty(bt)&&(g=d[bt],g!==void 0&&Y0(s,c,bt,g,d,void 0));return}}for(j in d)d.hasOwnProperty(j)&&(g=d[j],g!=null&&Qe(s,c,j,g,d,null))}function $O(s,c,d,g){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,_=null,F=null,j=null,Y=null,ct=null,bt=null;for(pt in d){var Ct=d[pt];if(d.hasOwnProperty(pt)&&Ct!=null)switch(pt){case"checked":break;case"value":break;case"defaultValue":Y=Ct;default:g.hasOwnProperty(pt)||Qe(s,c,pt,null,g,Ct)}}for(var ht in g){var pt=g[ht];if(Ct=d[ht],g.hasOwnProperty(ht)&&(pt!=null||Ct!=null))switch(ht){case"type":_=pt;break;case"name":x=pt;break;case"checked":ct=pt;break;case"defaultChecked":bt=pt;break;case"value":F=pt;break;case"defaultValue":j=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(n(137,c));break;default:pt!==Ct&&Qe(s,c,ht,pt,g,Ct)}}ni(s,F,j,Y,ct,bt,_,x);return;case"select":pt=F=j=ht=null;for(_ in d)if(Y=d[_],d.hasOwnProperty(_)&&Y!=null)switch(_){case"value":break;case"multiple":pt=Y;default:g.hasOwnProperty(_)||Qe(s,c,_,null,g,Y)}for(x in g)if(_=g[x],Y=d[x],g.hasOwnProperty(x)&&(_!=null||Y!=null))switch(x){case"value":ht=_;break;case"defaultValue":j=_;break;case"multiple":F=_;default:_!==Y&&Qe(s,c,x,_,g,Y)}c=j,d=F,g=pt,ht!=null?Ya(s,!!d,ht,!1):!!g!=!!d&&(c!=null?Ya(s,!!d,c,!0):Ya(s,!!d,d?[]:"",!1));return;case"textarea":pt=ht=null;for(j in d)if(x=d[j],d.hasOwnProperty(j)&&x!=null&&!g.hasOwnProperty(j))switch(j){case"value":break;case"children":break;default:Qe(s,c,j,null,g,x)}for(F in g)if(x=g[F],_=d[F],g.hasOwnProperty(F)&&(x!=null||_!=null))switch(F){case"value":ht=x;break;case"defaultValue":pt=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(n(91));break;default:x!==_&&Qe(s,c,F,x,g,_)}Xe(s,ht,pt);return;case"option":for(var Qt in d)if(ht=d[Qt],d.hasOwnProperty(Qt)&&ht!=null&&!g.hasOwnProperty(Qt))switch(Qt){case"selected":s.selected=!1;break;default:Qe(s,c,Qt,null,g,ht)}for(Y in g)if(ht=g[Y],pt=d[Y],g.hasOwnProperty(Y)&&ht!==pt&&(ht!=null||pt!=null))switch(Y){case"selected":s.selected=ht&&typeof ht!="function"&&typeof ht!="symbol";break;default:Qe(s,c,Y,ht,g,pt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Gt in d)ht=d[Gt],d.hasOwnProperty(Gt)&&ht!=null&&!g.hasOwnProperty(Gt)&&Qe(s,c,Gt,null,g,ht);for(ct in g)if(ht=g[ct],pt=d[ct],g.hasOwnProperty(ct)&&ht!==pt&&(ht!=null||pt!=null))switch(ct){case"children":case"dangerouslySetInnerHTML":if(ht!=null)throw Error(n(137,c));break;default:Qe(s,c,ct,ht,g,pt)}return;default:if(Ch(c)){for(var Ze in d)ht=d[Ze],d.hasOwnProperty(Ze)&&ht!==void 0&&!g.hasOwnProperty(Ze)&&Y0(s,c,Ze,void 0,g,ht);for(bt in g)ht=g[bt],pt=d[bt],!g.hasOwnProperty(bt)||ht===pt||ht===void 0&&pt===void 0||Y0(s,c,bt,ht,g,pt);return}}for(var at in d)ht=d[at],d.hasOwnProperty(at)&&ht!=null&&!g.hasOwnProperty(at)&&Qe(s,c,at,null,g,ht);for(Ct in g)ht=g[Ct],pt=d[Ct],!g.hasOwnProperty(Ct)||ht===pt||ht==null&&pt==null||Qe(s,c,Ct,ht,g,pt)}var Q0=null,Z0=null;function um(s){return s.nodeType===9?s:s.ownerDocument}function p_(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function m_(s,c){if(s===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&c==="foreignObject"?0:s}function J0(s,c){return s==="textarea"||s==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var t1=null;function KO(){var s=window.event;return s&&s.type==="popstate"?s===t1?!1:(t1=s,!0):(t1=null,!1)}var g_=typeof setTimeout=="function"?setTimeout:void 0,XO=typeof clearTimeout=="function"?clearTimeout:void 0,v_=typeof Promise=="function"?Promise:void 0,YO=typeof queueMicrotask=="function"?queueMicrotask:typeof v_<"u"?function(s){return v_.resolve(null).then(s).catch(QO)}:g_;function QO(s){setTimeout(function(){throw s})}function cs(s){return s==="head"}function y_(s,c){var d=c,g=0,x=0;do{var _=d.nextSibling;if(s.removeChild(d),_&&_.nodeType===8)if(d=_.data,d==="/$"){if(0<g&&8>g){d=g;var F=s.ownerDocument;if(d&1&&uf(F.documentElement),d&2&&uf(F.body),d&4)for(d=F.head,uf(d),F=d.firstChild;F;){var j=F.nextSibling,Y=F.nodeName;F[Qs]||Y==="SCRIPT"||Y==="STYLE"||Y==="LINK"&&F.rel.toLowerCase()==="stylesheet"||d.removeChild(F),F=j}}if(x===0){s.removeChild(_),gf(c);return}x--}else d==="$"||d==="$?"||d==="$!"?x++:g=d.charCodeAt(0)-48;else g=0;d=_}while(d);gf(c)}function e1(s){var c=s.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var d=c;switch(c=c.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":e1(d),qo(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}s.removeChild(d)}}function ZO(s,c,d,g){for(;s.nodeType===1;){var x=d;if(s.nodeName.toLowerCase()!==c.toLowerCase()){if(!g&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(g){if(!s[Qs])switch(c){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(_=s.getAttribute("rel"),_==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(_!==x.rel||s.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||s.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||s.getAttribute("title")!==(x.title==null?null:x.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(_=s.getAttribute("src"),(_!==(x.src==null?null:x.src)||s.getAttribute("type")!==(x.type==null?null:x.type)||s.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&_&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(c==="input"&&s.type==="hidden"){var _=x.name==null?null:""+x.name;if(x.type==="hidden"&&s.getAttribute("name")===_)return s}else return s;if(s=$i(s.nextSibling),s===null)break}return null}function JO(s,c,d){if(c==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!d||(s=$i(s.nextSibling),s===null))return null;return s}function n1(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function t9(s,c){var d=s.ownerDocument;if(s.data!=="$?"||d.readyState==="complete")c();else{var g=function(){c(),d.removeEventListener("DOMContentLoaded",g)};d.addEventListener("DOMContentLoaded",g),s._reactRetry=g}}function $i(s){for(;s!=null;s=s.nextSibling){var c=s.nodeType;if(c===1||c===3)break;if(c===8){if(c=s.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return s}var r1=null;function b_(s){s=s.previousSibling;for(var c=0;s;){if(s.nodeType===8){var d=s.data;if(d==="$"||d==="$!"||d==="$?"){if(c===0)return s;c--}else d==="/$"&&c++}s=s.previousSibling}return null}function x_(s,c,d){switch(c=um(d),s){case"html":if(s=c.documentElement,!s)throw Error(n(452));return s;case"head":if(s=c.head,!s)throw Error(n(453));return s;case"body":if(s=c.body,!s)throw Error(n(454));return s;default:throw Error(n(451))}}function uf(s){for(var c=s.attributes;c.length;)s.removeAttributeNode(c[0]);qo(s)}var Li=new Map,w_=new Set;function lm(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var go=K.d;K.d={f:e9,r:n9,D:r9,C:i9,L:a9,m:o9,X:u9,S:s9,M:l9};function e9(){var s=go.f(),c=tm();return s||c}function n9(s){var c=fa(s);c!==null&&c.tag===5&&c.type==="form"?jE(c):go.r(s)}var nc=typeof document>"u"?null:document;function C_(s,c,d){var g=nc;if(g&&typeof c=="string"&&c){var x=Dn(c);x='link[rel="'+s+'"][href="'+x+'"]',typeof d=="string"&&(x+='[crossorigin="'+d+'"]'),w_.has(x)||(w_.add(x),s={rel:s,crossOrigin:d,href:c},g.querySelector(x)===null&&(c=g.createElement("link"),pr(c,"link",s),_n(c),g.head.appendChild(c)))}}function r9(s){go.D(s),C_("dns-prefetch",s,null)}function i9(s,c){go.C(s,c),C_("preconnect",s,c)}function a9(s,c,d){go.L(s,c,d);var g=nc;if(g&&s&&c){var x='link[rel="preload"][as="'+Dn(c)+'"]';c==="image"&&d&&d.imageSrcSet?(x+='[imagesrcset="'+Dn(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(x+='[imagesizes="'+Dn(d.imageSizes)+'"]')):x+='[href="'+Dn(s)+'"]';var _=x;switch(c){case"style":_=rc(s);break;case"script":_=ic(s)}Li.has(_)||(s=f({rel:"preload",href:c==="image"&&d&&d.imageSrcSet?void 0:s,as:c},d),Li.set(_,s),g.querySelector(x)!==null||c==="style"&&g.querySelector(lf(_))||c==="script"&&g.querySelector(cf(_))||(c=g.createElement("link"),pr(c,"link",s),_n(c),g.head.appendChild(c)))}}function o9(s,c){go.m(s,c);var d=nc;if(d&&s){var g=c&&typeof c.as=="string"?c.as:"script",x='link[rel="modulepreload"][as="'+Dn(g)+'"][href="'+Dn(s)+'"]',_=x;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":_=ic(s)}if(!Li.has(_)&&(s=f({rel:"modulepreload",href:s},c),Li.set(_,s),d.querySelector(x)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(cf(_)))return}g=d.createElement("link"),pr(g,"link",s),_n(g),d.head.appendChild(g)}}}function s9(s,c,d){go.S(s,c,d);var g=nc;if(g&&s){var x=Or(g).hoistableStyles,_=rc(s);c=c||"default";var F=x.get(_);if(!F){var j={loading:0,preload:null};if(F=g.querySelector(lf(_)))j.loading=5;else{s=f({rel:"stylesheet",href:s,"data-precedence":c},d),(d=Li.get(_))&&i1(s,d);var Y=F=g.createElement("link");_n(Y),pr(Y,"link",s),Y._p=new Promise(function(ct,bt){Y.onload=ct,Y.onerror=bt}),Y.addEventListener("load",function(){j.loading|=1}),Y.addEventListener("error",function(){j.loading|=2}),j.loading|=4,cm(F,c,g)}F={type:"stylesheet",instance:F,count:1,state:j},x.set(_,F)}}}function u9(s,c){go.X(s,c);var d=nc;if(d&&s){var g=Or(d).hoistableScripts,x=ic(s),_=g.get(x);_||(_=d.querySelector(cf(x)),_||(s=f({src:s,async:!0},c),(c=Li.get(x))&&a1(s,c),_=d.createElement("script"),_n(_),pr(_,"link",s),d.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},g.set(x,_))}}function l9(s,c){go.M(s,c);var d=nc;if(d&&s){var g=Or(d).hoistableScripts,x=ic(s),_=g.get(x);_||(_=d.querySelector(cf(x)),_||(s=f({src:s,async:!0,type:"module"},c),(c=Li.get(x))&&a1(s,c),_=d.createElement("script"),_n(_),pr(_,"link",s),d.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},g.set(x,_))}}function E_(s,c,d,g){var x=(x=Rt.current)?lm(x):null;if(!x)throw Error(n(446));switch(s){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(c=rc(d.href),d=Or(x).hoistableStyles,g=d.get(c),g||(g={type:"style",instance:null,count:0,state:null},d.set(c,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){s=rc(d.href);var _=Or(x).hoistableStyles,F=_.get(s);if(F||(x=x.ownerDocument||x,F={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},_.set(s,F),(_=x.querySelector(lf(s)))&&!_._p&&(F.instance=_,F.state.loading=5),Li.has(s)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Li.set(s,d),_||c9(x,s,d,F.state))),c&&g===null)throw Error(n(528,""));return F}if(c&&g!==null)throw Error(n(529,""));return null;case"script":return c=d.async,d=d.src,typeof d=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=ic(d),d=Or(x).hoistableScripts,g=d.get(c),g||(g={type:"script",instance:null,count:0,state:null},d.set(c,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,s))}}function rc(s){return'href="'+Dn(s)+'"'}function lf(s){return'link[rel="stylesheet"]['+s+"]"}function __(s){return f({},s,{"data-precedence":s.precedence,precedence:null})}function c9(s,c,d,g){s.querySelector('link[rel="preload"][as="style"]['+c+"]")?g.loading=1:(c=s.createElement("link"),g.preload=c,c.addEventListener("load",function(){return g.loading|=1}),c.addEventListener("error",function(){return g.loading|=2}),pr(c,"link",d),_n(c),s.head.appendChild(c))}function ic(s){return'[src="'+Dn(s)+'"]'}function cf(s){return"script[async]"+s}function T_(s,c,d){if(c.count++,c.instance===null)switch(c.type){case"style":var g=s.querySelector('style[data-href~="'+Dn(d.href)+'"]');if(g)return c.instance=g,_n(g),g;var x=f({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return g=(s.ownerDocument||s).createElement("style"),_n(g),pr(g,"style",x),cm(g,d.precedence,s),c.instance=g;case"stylesheet":x=rc(d.href);var _=s.querySelector(lf(x));if(_)return c.state.loading|=4,c.instance=_,_n(_),_;g=__(d),(x=Li.get(x))&&i1(g,x),_=(s.ownerDocument||s).createElement("link"),_n(_);var F=_;return F._p=new Promise(function(j,Y){F.onload=j,F.onerror=Y}),pr(_,"link",g),c.state.loading|=4,cm(_,d.precedence,s),c.instance=_;case"script":return _=ic(d.src),(x=s.querySelector(cf(_)))?(c.instance=x,_n(x),x):(g=d,(x=Li.get(_))&&(g=f({},d),a1(g,x)),s=s.ownerDocument||s,x=s.createElement("script"),_n(x),pr(x,"link",g),s.head.appendChild(x),c.instance=x);case"void":return null;default:throw Error(n(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(g=c.instance,c.state.loading|=4,cm(g,d.precedence,s));return c.instance}function cm(s,c,d){for(var g=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=g.length?g[g.length-1]:null,_=x,F=0;F<g.length;F++){var j=g[F];if(j.dataset.precedence===c)_=j;else if(_!==x)break}_?_.parentNode.insertBefore(s,_.nextSibling):(c=d.nodeType===9?d.head:d,c.insertBefore(s,c.firstChild))}function i1(s,c){s.crossOrigin==null&&(s.crossOrigin=c.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=c.referrerPolicy),s.title==null&&(s.title=c.title)}function a1(s,c){s.crossOrigin==null&&(s.crossOrigin=c.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=c.referrerPolicy),s.integrity==null&&(s.integrity=c.integrity)}var hm=null;function S_(s,c,d){if(hm===null){var g=new Map,x=hm=new Map;x.set(d,g)}else x=hm,g=x.get(d),g||(g=new Map,x.set(d,g));if(g.has(s))return g;for(g.set(s,null),d=d.getElementsByTagName(s),x=0;x<d.length;x++){var _=d[x];if(!(_[Qs]||_[Wn]||s==="link"&&_.getAttribute("rel")==="stylesheet")&&_.namespaceURI!=="http://www.w3.org/2000/svg"){var F=_.getAttribute(c)||"";F=s+F;var j=g.get(F);j?j.push(_):g.set(F,[_])}}return g}function A_(s,c,d){s=s.ownerDocument||s,s.head.insertBefore(d,c==="title"?s.querySelector("head > title"):null)}function h9(s,c,d){if(d===1||c.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return s=c.disabled,typeof c.precedence=="string"&&s==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function R_(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var hf=null;function f9(){}function d9(s,c,d){if(hf===null)throw Error(n(475));var g=hf;if(c.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var x=rc(d.href),_=s.querySelector(lf(x));if(_){s=_._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(g.count++,g=fm.bind(g),s.then(g,g)),c.state.loading|=4,c.instance=_,_n(_);return}_=s.ownerDocument||s,d=__(d),(x=Li.get(x))&&i1(d,x),_=_.createElement("link"),_n(_);var F=_;F._p=new Promise(function(j,Y){F.onload=j,F.onerror=Y}),pr(_,"link",d),c.instance=_}g.stylesheets===null&&(g.stylesheets=new Map),g.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(g.count++,c=fm.bind(g),s.addEventListener("load",c),s.addEventListener("error",c))}}function p9(){if(hf===null)throw Error(n(475));var s=hf;return s.stylesheets&&s.count===0&&o1(s,s.stylesheets),0<s.count?function(c){var d=setTimeout(function(){if(s.stylesheets&&o1(s,s.stylesheets),s.unsuspend){var g=s.unsuspend;s.unsuspend=null,g()}},6e4);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(d)}}:null}function fm(){if(this.count--,this.count===0){if(this.stylesheets)o1(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var dm=null;function o1(s,c){s.stylesheets=null,s.unsuspend!==null&&(s.count++,dm=new Map,c.forEach(m9,s),dm=null,fm.call(s))}function m9(s,c){if(!(c.state.loading&4)){var d=dm.get(s);if(d)var g=d.get(null);else{d=new Map,dm.set(s,d);for(var x=s.querySelectorAll("link[data-precedence],style[data-precedence]"),_=0;_<x.length;_++){var F=x[_];(F.nodeName==="LINK"||F.getAttribute("media")!=="not all")&&(d.set(F.dataset.precedence,F),g=F)}g&&d.set(null,g)}x=c.instance,F=x.getAttribute("data-precedence"),_=d.get(F)||g,_===g&&d.set(null,x),d.set(F,x),this.count++,g=fm.bind(this),x.addEventListener("load",g),x.addEventListener("error",g),_?_.parentNode.insertBefore(x,_.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(x,s.firstChild)),c.state.loading|=4}}var ff={$$typeof:A,Provider:null,Consumer:null,_currentValue:Q,_currentValue2:Q,_threadCount:0};function g9(s,c,d,g,x,_,F,j){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=qa(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qa(0),this.hiddenUpdates=qa(null),this.identifierPrefix=g,this.onUncaughtError=x,this.onCaughtError=_,this.onRecoverableError=F,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function N_(s,c,d,g,x,_,F,j,Y,ct,bt,Ct){return s=new g9(s,c,d,F,j,Y,ct,Ct),c=1,_===!0&&(c|=24),_=ii(3,null,null,c),s.current=_,_.stateNode=s,c=jy(),c.refCount++,s.pooledCache=c,c.refCount++,_.memoizedState={element:g,isDehydrated:d,cache:c},qy(_),s}function I_(s){return s?(s=Ll,s):Ll}function k_(s,c,d,g,x,_){x=I_(x),g.context===null?g.context=x:g.pendingContext=x,g=Qo(c),g.payload={element:d},_=_===void 0?null:_,_!==null&&(g.callback=_),d=Zo(s,g,c),d!==null&&(li(d,s,c),jh(d,s,c))}function D_(s,c){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var d=s.retryLane;s.retryLane=d!==0&&d<c?d:c}}function s1(s,c){D_(s,c),(s=s.alternate)&&D_(s,c)}function O_(s){if(s.tag===13){var c=Ml(s,67108864);c!==null&&li(c,s,67108864),s1(s,67108864)}}var pm=!0;function v9(s,c,d,g){var x=q.T;q.T=null;var _=K.p;try{K.p=2,u1(s,c,d,g)}finally{K.p=_,q.T=x}}function y9(s,c,d,g){var x=q.T;q.T=null;var _=K.p;try{K.p=8,u1(s,c,d,g)}finally{K.p=_,q.T=x}}function u1(s,c,d,g){if(pm){var x=l1(g);if(x===null)X0(s,c,g,mm,d),L_(s,g);else if(x9(x,s,c,d,g))g.stopPropagation();else if(L_(s,g),c&4&&-1<b9.indexOf(s)){for(;x!==null;){var _=fa(x);if(_!==null)switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var F=lr(_.pendingLanes);if(F!==0){var j=_;for(j.pendingLanes|=2,j.entangledLanes|=2;F;){var Y=1<<31-Re(F);j.entanglements[1]|=Y,F&=~Y}Sa(_),(He&6)===0&&(Zp=Ke()+500,af(0))}}break;case 13:j=Ml(_,2),j!==null&&li(j,_,2),tm(),s1(_,2)}if(_=l1(g),_===null&&X0(s,c,g,mm,d),_===x)break;x=_}x!==null&&g.stopPropagation()}else X0(s,c,g,null,d)}}function l1(s){return s=Si(s),c1(s)}var mm=null;function c1(s){if(mm=null,s=$a(s),s!==null){var c=a(s);if(c===null)s=null;else{var d=c.tag;if(d===13){if(s=o(c),s!==null)return s;s=null}else if(d===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;s=null}else c!==s&&(s=null)}}return mm=s,null}function M_(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Dr()){case En:return 2;case In:return 8;case un:case Er:return 32;case re:return 268435456;default:return 32}default:return 32}}var h1=!1,hs=null,fs=null,ds=null,df=new Map,pf=new Map,ps=[],b9="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function L_(s,c){switch(s){case"focusin":case"focusout":hs=null;break;case"dragenter":case"dragleave":fs=null;break;case"mouseover":case"mouseout":ds=null;break;case"pointerover":case"pointerout":df.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":pf.delete(c.pointerId)}}function mf(s,c,d,g,x,_){return s===null||s.nativeEvent!==_?(s={blockedOn:c,domEventName:d,eventSystemFlags:g,nativeEvent:_,targetContainers:[x]},c!==null&&(c=fa(c),c!==null&&O_(c)),s):(s.eventSystemFlags|=g,c=s.targetContainers,x!==null&&c.indexOf(x)===-1&&c.push(x),s)}function x9(s,c,d,g,x){switch(c){case"focusin":return hs=mf(hs,s,c,d,g,x),!0;case"dragenter":return fs=mf(fs,s,c,d,g,x),!0;case"mouseover":return ds=mf(ds,s,c,d,g,x),!0;case"pointerover":var _=x.pointerId;return df.set(_,mf(df.get(_)||null,s,c,d,g,x)),!0;case"gotpointercapture":return _=x.pointerId,pf.set(_,mf(pf.get(_)||null,s,c,d,g,x)),!0}return!1}function P_(s){var c=$a(s.target);if(c!==null){var d=a(c);if(d!==null){if(c=d.tag,c===13){if(c=o(d),c!==null){s.blockedOn=c,tp(s.priority,function(){if(d.tag===13){var g=ui();g=Uo(g);var x=Ml(d,g);x!==null&&li(x,d,g),s1(d,g)}});return}}else if(c===3&&d.stateNode.current.memoizedState.isDehydrated){s.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}s.blockedOn=null}function gm(s){if(s.blockedOn!==null)return!1;for(var c=s.targetContainers;0<c.length;){var d=l1(s.nativeEvent);if(d===null){d=s.nativeEvent;var g=new d.constructor(d.type,d);Qa=g,d.target.dispatchEvent(g),Qa=null}else return c=fa(d),c!==null&&O_(c),s.blockedOn=d,!1;c.shift()}return!0}function z_(s,c,d){gm(s)&&d.delete(c)}function w9(){h1=!1,hs!==null&&gm(hs)&&(hs=null),fs!==null&&gm(fs)&&(fs=null),ds!==null&&gm(ds)&&(ds=null),df.forEach(z_),pf.forEach(z_)}function vm(s,c){s.blockedOn===c&&(s.blockedOn=null,h1||(h1=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,w9)))}var ym=null;function V_(s){ym!==s&&(ym=s,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){ym===s&&(ym=null);for(var c=0;c<s.length;c+=3){var d=s[c],g=s[c+1],x=s[c+2];if(typeof g!="function"){if(c1(g||d)===null)continue;break}var _=fa(d);_!==null&&(s.splice(c,3),c-=3,c0(_,{pending:!0,data:x,method:d.method,action:g},g,x))}}))}function gf(s){function c(Y){return vm(Y,s)}hs!==null&&vm(hs,s),fs!==null&&vm(fs,s),ds!==null&&vm(ds,s),df.forEach(c),pf.forEach(c);for(var d=0;d<ps.length;d++){var g=ps[d];g.blockedOn===s&&(g.blockedOn=null)}for(;0<ps.length&&(d=ps[0],d.blockedOn===null);)P_(d),d.blockedOn===null&&ps.shift();if(d=(s.ownerDocument||s).$$reactFormReplay,d!=null)for(g=0;g<d.length;g+=3){var x=d[g],_=d[g+1],F=x[kn]||null;if(typeof _=="function")F||V_(d);else if(F){var j=null;if(_&&_.hasAttribute("formAction")){if(x=_,F=_[kn]||null)j=F.formAction;else if(c1(x)!==null)continue}else j=F.action;typeof j=="function"?d[g+1]=j:(d.splice(g,3),g-=3),V_(d)}}}function f1(s){this._internalRoot=s}bm.prototype.render=f1.prototype.render=function(s){var c=this._internalRoot;if(c===null)throw Error(n(409));var d=c.current,g=ui();k_(d,g,s,c,null,null)},bm.prototype.unmount=f1.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var c=s.containerInfo;k_(s.current,2,null,s,null,null),tm(),c[_i]=null}};function bm(s){this._internalRoot=s}bm.prototype.unstable_scheduleHydration=function(s){if(s){var c=Wo();s={blockedOn:null,target:s,priority:c};for(var d=0;d<ps.length&&c!==0&&c<ps[d].priority;d++);ps.splice(d,0,s),d===0&&P_(s)}};var F_=e.version;if(F_!=="19.1.0")throw Error(n(527,F_,"19.1.0"));K.findDOMNode=function(s){var c=s._reactInternals;if(c===void 0)throw typeof s.render=="function"?Error(n(188)):(s=Object.keys(s).join(","),Error(n(268,s)));return s=l(c),s=s!==null?h(s):null,s=s===null?null:s.stateNode,s};var C9={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:q,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xm.isDisabled&&xm.supportsFiber)try{fe=xm.inject(C9),le=xm}catch{}}return yf.createRoot=function(s,c){if(!i(s))throw Error(n(299));var d=!1,g="",x=e3,_=n3,F=r3,j=null;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(x=c.onUncaughtError),c.onCaughtError!==void 0&&(_=c.onCaughtError),c.onRecoverableError!==void 0&&(F=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(j=c.unstable_transitionCallbacks)),c=N_(s,1,!1,null,null,d,g,x,_,F,j,null),s[_i]=c.current,K0(s),new f1(c)},yf.hydrateRoot=function(s,c,d){if(!i(s))throw Error(n(299));var g=!1,x="",_=e3,F=n3,j=r3,Y=null,ct=null;return d!=null&&(d.unstable_strictMode===!0&&(g=!0),d.identifierPrefix!==void 0&&(x=d.identifierPrefix),d.onUncaughtError!==void 0&&(_=d.onUncaughtError),d.onCaughtError!==void 0&&(F=d.onCaughtError),d.onRecoverableError!==void 0&&(j=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(Y=d.unstable_transitionCallbacks),d.formState!==void 0&&(ct=d.formState)),c=N_(s,1,!0,c,d??null,g,x,_,F,j,Y,ct),c.context=I_(null),d=c.current,g=ui(),g=Uo(g),x=Qo(g),x.callback=null,Zo(d,x,g),d=g,c.current.lanes=d,Ga(c,d),Sa(c),s[_i]=c.current,K0(s),new bm(c)},yf.version="19.1.0",yf}var X_;function M9(){if(X_)return m1.exports;X_=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),m1.exports=O9(),m1.exports}var L9=M9(),bf={},Y_;function P9(){if(Y_)return bf;Y_=1,Object.defineProperty(bf,"__esModule",{value:!0}),bf.parse=o,bf.serialize=h;const r=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,i=Object.prototype.toString,a=(()=>{const m=function(){};return m.prototype=Object.create(null),m})();function o(m,v){const b=new a,C=m.length;if(C<2)return b;const w=(v==null?void 0:v.decode)||f;let E=0;do{const S=m.indexOf("=",E);if(S===-1)break;const A=m.indexOf(";",E),k=A===-1?C:A;if(S>k){E=m.lastIndexOf(";",S-1)+1;continue}const O=u(m,E,S),V=l(m,S,O),T=m.slice(O,V);if(b[T]===void 0){let R=u(m,S+1,k),N=l(m,k,R);const D=w(m.slice(R,N));b[T]=D}E=k+1}while(E<C);return b}function u(m,v,b){do{const C=m.charCodeAt(v);if(C!==32&&C!==9)return v}while(++v<b);return b}function l(m,v,b){for(;v>b;){const C=m.charCodeAt(--v);if(C!==32&&C!==9)return v+1}return b}function h(m,v,b){const C=(b==null?void 0:b.encode)||encodeURIComponent;if(!r.test(m))throw new TypeError(`argument name is invalid: ${m}`);const w=C(v);if(!e.test(w))throw new TypeError(`argument val is invalid: ${v}`);let E=m+"="+w;if(!b)return E;if(b.maxAge!==void 0){if(!Number.isInteger(b.maxAge))throw new TypeError(`option maxAge is invalid: ${b.maxAge}`);E+="; Max-Age="+b.maxAge}if(b.domain){if(!t.test(b.domain))throw new TypeError(`option domain is invalid: ${b.domain}`);E+="; Domain="+b.domain}if(b.path){if(!n.test(b.path))throw new TypeError(`option path is invalid: ${b.path}`);E+="; Path="+b.path}if(b.expires){if(!p(b.expires)||!Number.isFinite(b.expires.valueOf()))throw new TypeError(`option expires is invalid: ${b.expires}`);E+="; Expires="+b.expires.toUTCString()}if(b.httpOnly&&(E+="; HttpOnly"),b.secure&&(E+="; Secure"),b.partitioned&&(E+="; Partitioned"),b.priority)switch(typeof b.priority=="string"?b.priority.toLowerCase():void 0){case"low":E+="; Priority=Low";break;case"medium":E+="; Priority=Medium";break;case"high":E+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${b.priority}`)}if(b.sameSite)switch(typeof b.sameSite=="string"?b.sameSite.toLowerCase():b.sameSite){case!0:case"strict":E+="; SameSite=Strict";break;case"lax":E+="; SameSite=Lax";break;case"none":E+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${b.sameSite}`)}return E}function f(m){if(m.indexOf("%")===-1)return m;try{return decodeURIComponent(m)}catch{return m}}function p(m){return i.call(m)==="[object Date]"}return bf}P9();var Q_="popstate";function z9(r={}){function e(n,i){let{pathname:a,search:o,hash:u}=n.location;return sb("",{pathname:a,search:o,hash:u},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(n,i){return typeof i=="string"?i:Gf(i)}return F9(e,t,null,r)}function gn(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Ma(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function V9(){return Math.random().toString(36).substring(2,10)}function Z_(r,e){return{usr:r.state,key:r.key,idx:e}}function sb(r,e,t=null,n){return{pathname:typeof r=="string"?r:r.pathname,search:"",hash:"",...typeof e=="string"?Wc(e):e,state:t,key:e&&e.key||n||V9()}}function Gf({pathname:r="/",search:e="",hash:t=""}){return e&&e!=="?"&&(r+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(r+=t.charAt(0)==="#"?t:"#"+t),r}function Wc(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substring(t),r=r.substring(0,t));let n=r.indexOf("?");n>=0&&(e.search=r.substring(n),r=r.substring(0,n)),r&&(e.pathname=r)}return e}function F9(r,e,t,n={}){let{window:i=document.defaultView,v5Compat:a=!1}=n,o=i.history,u="POP",l=null,h=f();h==null&&(h=0,o.replaceState({...o.state,idx:h},""));function f(){return(o.state||{idx:null}).idx}function p(){u="POP";let w=f(),E=w==null?null:w-h;h=w,l&&l({action:u,location:C.location,delta:E})}function m(w,E){u="PUSH";let S=sb(C.location,w,E);h=f()+1;let A=Z_(S,h),k=C.createHref(S);try{o.pushState(A,"",k)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;i.location.assign(k)}a&&l&&l({action:u,location:C.location,delta:1})}function v(w,E){u="REPLACE";let S=sb(C.location,w,E);h=f();let A=Z_(S,h),k=C.createHref(S);o.replaceState(A,"",k),a&&l&&l({action:u,location:C.location,delta:0})}function b(w){return B9(w)}let C={get action(){return u},get location(){return r(i,o)},listen(w){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(Q_,p),l=w,()=>{i.removeEventListener(Q_,p),l=null}},createHref(w){return e(i,w)},createURL:b,encodeLocation(w){let E=b(w);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:m,replace:v,go(w){return o.go(w)}};return C}function B9(r,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),gn(t,"No window.location.(origin|href) available to create URL");let n=typeof r=="string"?r:Gf(r);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}function K4(r,e,t="/"){return j9(r,e,t,!1)}function j9(r,e,t,n){let i=typeof e=="string"?Wc(e):e,a=Ro(i.pathname||"/",t);if(a==null)return null;let o=X4(r);U9(o);let u=null;for(let l=0;u==null&&l<o.length;++l){let h=J9(a);u=Q9(o[l],h,n)}return u}function X4(r,e=[],t=[],n=""){let i=(a,o,u)=>{let l={relativePath:u===void 0?a.path||"":u,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};l.relativePath.startsWith("/")&&(gn(l.relativePath.startsWith(n),`Absolute route path "${l.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(n.length));let h=Co([n,l.relativePath]),f=t.concat(l);a.children&&a.children.length>0&&(gn(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),X4(a.children,e,f,h)),!(a.path==null&&!a.index)&&e.push({path:h,score:X9(h,a.index),routesMeta:f})};return r.forEach((a,o)=>{var u;if(a.path===""||!((u=a.path)!=null&&u.includes("?")))i(a,o);else for(let l of Y4(a.path))i(a,o,l)}),e}function Y4(r){let e=r.split("/");if(e.length===0)return[];let[t,...n]=e,i=t.endsWith("?"),a=t.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let o=Y4(n.join("/")),u=[];return u.push(...o.map(l=>l===""?a:[a,l].join("/"))),i&&u.push(...o),u.map(l=>r.startsWith("/")&&l===""?"/":l)}function U9(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:Y9(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var W9=/^:[\w-]+$/,H9=3,q9=2,G9=1,$9=10,K9=-2,J_=r=>r==="*";function X9(r,e){let t=r.split("/"),n=t.length;return t.some(J_)&&(n+=K9),e&&(n+=q9),t.filter(i=>!J_(i)).reduce((i,a)=>i+(W9.test(a)?H9:a===""?G9:$9),n)}function Y9(r,e){return r.length===e.length&&r.slice(0,-1).every((n,i)=>n===e[i])?r[r.length-1]-e[e.length-1]:0}function Q9(r,e,t=!1){let{routesMeta:n}=r,i={},a="/",o=[];for(let u=0;u<n.length;++u){let l=n[u],h=u===n.length-1,f=a==="/"?e:e.slice(a.length)||"/",p=dg({path:l.relativePath,caseSensitive:l.caseSensitive,end:h},f),m=l.route;if(!p&&h&&t&&!n[n.length-1].route.index&&(p=dg({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},f)),!p)return null;Object.assign(i,p.params),o.push({params:i,pathname:Co([a,p.pathname]),pathnameBase:rM(Co([a,p.pathnameBase])),route:m}),p.pathnameBase!=="/"&&(a=Co([a,p.pathnameBase]))}return o}function dg(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,n]=Z9(r.path,r.caseSensitive,r.end),i=e.match(t);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),u=i.slice(1);return{params:n.reduce((h,{paramName:f,isOptional:p},m)=>{if(f==="*"){let b=u[m]||"";o=a.slice(0,a.length-b.length).replace(/(.)\/+$/,"$1")}const v=u[m];return p&&!v?h[f]=void 0:h[f]=(v||"").replace(/%2F/g,"/"),h},{}),pathname:a,pathnameBase:o,pattern:r}}function Z9(r,e=!1,t=!0){Ma(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let n=[],i="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,u,l)=>(n.push({paramName:u,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(n.push({paramName:"*"}),i+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":r!==""&&r!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function J9(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ma(!1,`The URL path "${r}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),r}}function Ro(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=r.charAt(t);return n&&n!=="/"?null:r.slice(t)||"/"}function tM(r,e="/"){let{pathname:t,search:n="",hash:i=""}=typeof r=="string"?Wc(r):r;return{pathname:t?t.startsWith("/")?t:eM(t,e):e,search:iM(n),hash:aM(i)}}function eM(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function b1(r,e,t,n){return`Cannot include a '${r}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function nM(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Q4(r){let e=nM(r);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function Z4(r,e,t,n=!1){let i;typeof r=="string"?i=Wc(r):(i={...r},gn(!i.pathname||!i.pathname.includes("?"),b1("?","pathname","search",i)),gn(!i.pathname||!i.pathname.includes("#"),b1("#","pathname","hash",i)),gn(!i.search||!i.search.includes("#"),b1("#","search","hash",i)));let a=r===""||i.pathname==="",o=a?"/":i.pathname,u;if(o==null)u=t;else{let p=e.length-1;if(!n&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),p-=1;i.pathname=m.join("/")}u=p>=0?e[p]:"/"}let l=tM(i,u),h=o&&o!=="/"&&o.endsWith("/"),f=(a||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(h||f)&&(l.pathname+="/"),l}var Co=r=>r.join("/").replace(/\/\/+/g,"/"),rM=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),iM=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,aM=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function oM(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}var J4=["POST","PUT","PATCH","DELETE"];new Set(J4);var sM=["GET",...J4];new Set(sM);var Hc=X.createContext(null);Hc.displayName="DataRouter";var $g=X.createContext(null);$g.displayName="DataRouterState";var tA=X.createContext({isTransitioning:!1});tA.displayName="ViewTransition";var uM=X.createContext(new Map);uM.displayName="Fetchers";var lM=X.createContext(null);lM.displayName="Await";var Ba=X.createContext(null);Ba.displayName="Navigation";var xd=X.createContext(null);xd.displayName="Location";var ja=X.createContext({outlet:null,matches:[],isDataRoute:!1});ja.displayName="Route";var A2=X.createContext(null);A2.displayName="RouteError";function cM(r,{relative:e}={}){gn(wd(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=X.useContext(Ba),{hash:i,pathname:a,search:o}=Ed(r,{relative:e}),u=a;return t!=="/"&&(u=a==="/"?t:Co([t,a])),n.createHref({pathname:u,search:o,hash:i})}function wd(){return X.useContext(xd)!=null}function Lo(){return gn(wd(),"useLocation() may be used only in the context of a <Router> component."),X.useContext(xd).location}var eA="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function nA(r){X.useContext(Ba).static||X.useLayoutEffect(r)}function wi(){let{isDataRoute:r}=X.useContext(ja);return r?EM():hM()}function hM(){gn(wd(),"useNavigate() may be used only in the context of a <Router> component.");let r=X.useContext(Hc),{basename:e,navigator:t}=X.useContext(Ba),{matches:n}=X.useContext(ja),{pathname:i}=Lo(),a=JSON.stringify(Q4(n)),o=X.useRef(!1);return nA(()=>{o.current=!0}),X.useCallback((l,h={})=>{if(Ma(o.current,eA),!o.current)return;if(typeof l=="number"){t.go(l);return}let f=Z4(l,JSON.parse(a),i,h.relative==="path");r==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Co([e,f.pathname])),(h.replace?t.replace:t.push)(f,h.state,h)},[e,t,a,i,r])}X.createContext(null);function Cd(){let{matches:r}=X.useContext(ja),e=r[r.length-1];return e?e.params:{}}function Ed(r,{relative:e}={}){let{matches:t}=X.useContext(ja),{pathname:n}=Lo(),i=JSON.stringify(Q4(t));return X.useMemo(()=>Z4(r,JSON.parse(i),n,e==="path"),[r,i,n,e])}function fM(r,e){return rA(r,e)}function rA(r,e,t,n){var S;gn(wd(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i,static:a}=X.useContext(Ba),{matches:o}=X.useContext(ja),u=o[o.length-1],l=u?u.params:{},h=u?u.pathname:"/",f=u?u.pathnameBase:"/",p=u&&u.route;{let A=p&&p.path||"";iA(h,!p||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let m=Lo(),v;if(e){let A=typeof e=="string"?Wc(e):e;gn(f==="/"||((S=A.pathname)==null?void 0:S.startsWith(f)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${A.pathname}" was given in the \`location\` prop.`),v=A}else v=m;let b=v.pathname||"/",C=b;if(f!=="/"){let A=f.replace(/^\//,"").split("/");C="/"+b.replace(/^\//,"").split("/").slice(A.length).join("/")}let w=!a&&t&&t.matches&&t.matches.length>0?t.matches:K4(r,{pathname:C});Ma(p||w!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),Ma(w==null||w[w.length-1].route.element!==void 0||w[w.length-1].route.Component!==void 0||w[w.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let E=vM(w&&w.map(A=>Object.assign({},A,{params:Object.assign({},l,A.params),pathname:Co([f,i.encodeLocation?i.encodeLocation(A.pathname).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?f:Co([f,i.encodeLocation?i.encodeLocation(A.pathnameBase).pathname:A.pathnameBase])})),o,t,n);return e&&E?X.createElement(xd.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},E):E}function dM(){let r=CM(),e=oM(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,n="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:n},a={padding:"2px 4px",backgroundColor:n},o=null;return console.error("Error handled by React Router default ErrorBoundary:",r),o=X.createElement(X.Fragment,null,X.createElement("p",null," Hey developer "),X.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",X.createElement("code",{style:a},"ErrorBoundary")," or"," ",X.createElement("code",{style:a},"errorElement")," prop on your route.")),X.createElement(X.Fragment,null,X.createElement("h2",null,"Unexpected Application Error!"),X.createElement("h3",{style:{fontStyle:"italic"}},e),t?X.createElement("pre",{style:i},t):null,o)}var pM=X.createElement(dM,null),mM=class extends X.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,e){return e.location!==r.location||e.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:e.error,location:e.location,revalidation:r.revalidation||e.revalidation}}componentDidCatch(r,e){console.error("React Router caught the following error during render",r,e)}render(){return this.state.error!==void 0?X.createElement(ja.Provider,{value:this.props.routeContext},X.createElement(A2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function gM({routeContext:r,match:e,children:t}){let n=X.useContext(Hc);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),X.createElement(ja.Provider,{value:r},t)}function vM(r,e=[],t=null,n=null){if(r==null){if(!t)return null;if(t.errors)r=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let i=r,a=t==null?void 0:t.errors;if(a!=null){let l=i.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);gn(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),i=i.slice(0,Math.min(i.length,l+1))}let o=!1,u=-1;if(t)for(let l=0;l<i.length;l++){let h=i[l];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=l),h.route.id){let{loaderData:f,errors:p}=t,m=h.route.loader&&!f.hasOwnProperty(h.route.id)&&(!p||p[h.route.id]===void 0);if(h.route.lazy||m){o=!0,u>=0?i=i.slice(0,u+1):i=[i[0]];break}}}return i.reduceRight((l,h,f)=>{let p,m=!1,v=null,b=null;t&&(p=a&&h.route.id?a[h.route.id]:void 0,v=h.route.errorElement||pM,o&&(u<0&&f===0?(iA("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,b=null):u===f&&(m=!0,b=h.route.hydrateFallbackElement||null)));let C=e.concat(i.slice(0,f+1)),w=()=>{let E;return p?E=v:m?E=b:h.route.Component?E=X.createElement(h.route.Component,null):h.route.element?E=h.route.element:E=l,X.createElement(gM,{match:h,routeContext:{outlet:l,matches:C,isDataRoute:t!=null},children:E})};return t&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?X.createElement(mM,{location:t.location,revalidation:t.revalidation,component:v,error:p,children:w(),routeContext:{outlet:null,matches:C,isDataRoute:!0}}):w()},null)}function R2(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function yM(r){let e=X.useContext(Hc);return gn(e,R2(r)),e}function bM(r){let e=X.useContext($g);return gn(e,R2(r)),e}function xM(r){let e=X.useContext(ja);return gn(e,R2(r)),e}function N2(r){let e=xM(r),t=e.matches[e.matches.length-1];return gn(t.route.id,`${r} can only be used on routes that contain a unique "id"`),t.route.id}function wM(){return N2("useRouteId")}function CM(){var n;let r=X.useContext(A2),e=bM("useRouteError"),t=N2("useRouteError");return r!==void 0?r:(n=e.errors)==null?void 0:n[t]}function EM(){let{router:r}=yM("useNavigate"),e=N2("useNavigate"),t=X.useRef(!1);return nA(()=>{t.current=!0}),X.useCallback(async(i,a={})=>{Ma(t.current,eA),t.current&&(typeof i=="number"?r.navigate(i):await r.navigate(i,{fromRouteId:e,...a}))},[r,e])}var tT={};function iA(r,e,t){!e&&!tT[r]&&(tT[r]=!0,Ma(!1,t))}X.memo(_M);function _M({routes:r,future:e,state:t}){return rA(r,void 0,t,e)}function mn(r){gn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function TM({basename:r="/",children:e=null,location:t,navigationType:n="POP",navigator:i,static:a=!1}){gn(!wd(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=r.replace(/^\/*/,"/"),u=X.useMemo(()=>({basename:o,navigator:i,static:a,future:{}}),[o,i,a]);typeof t=="string"&&(t=Wc(t));let{pathname:l="/",search:h="",hash:f="",state:p=null,key:m="default"}=t,v=X.useMemo(()=>{let b=Ro(l,o);return b==null?null:{location:{pathname:b,search:h,hash:f,state:p,key:m},navigationType:n}},[o,l,h,f,p,m,n]);return Ma(v!=null,`<Router basename="${o}"> is not able to match the URL "${l}${h}${f}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:X.createElement(Ba.Provider,{value:u},X.createElement(xd.Provider,{children:e,value:v}))}function SM({children:r,location:e}){return fM(ub(r),e)}function ub(r,e=[]){let t=[];return X.Children.forEach(r,(n,i)=>{if(!X.isValidElement(n))return;let a=[...e,i];if(n.type===X.Fragment){t.push.apply(t,ub(n.props.children,a));return}gn(n.type===mn,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),gn(!n.props.index||!n.props.children,"An index route cannot have child routes.");let o={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=ub(n.props.children,a)),t.push(o)}),t}var Wm="get",Hm="application/x-www-form-urlencoded";function Kg(r){return r!=null&&typeof r.tagName=="string"}function AM(r){return Kg(r)&&r.tagName.toLowerCase()==="button"}function RM(r){return Kg(r)&&r.tagName.toLowerCase()==="form"}function NM(r){return Kg(r)&&r.tagName.toLowerCase()==="input"}function IM(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function kM(r,e){return r.button===0&&(!e||e==="_self")&&!IM(r)}var wm=null;function DM(){if(wm===null)try{new FormData(document.createElement("form"),0),wm=!1}catch{wm=!0}return wm}var OM=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function x1(r){return r!=null&&!OM.has(r)?(Ma(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Hm}"`),null):r}function MM(r,e){let t,n,i,a,o;if(RM(r)){let u=r.getAttribute("action");n=u?Ro(u,e):null,t=r.getAttribute("method")||Wm,i=x1(r.getAttribute("enctype"))||Hm,a=new FormData(r)}else if(AM(r)||NM(r)&&(r.type==="submit"||r.type==="image")){let u=r.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=r.getAttribute("formaction")||u.getAttribute("action");if(n=l?Ro(l,e):null,t=r.getAttribute("formmethod")||u.getAttribute("method")||Wm,i=x1(r.getAttribute("formenctype"))||x1(u.getAttribute("enctype"))||Hm,a=new FormData(u,r),!DM()){let{name:h,type:f,value:p}=r;if(f==="image"){let m=h?`${h}.`:"";a.append(`${m}x`,"0"),a.append(`${m}y`,"0")}else h&&a.append(h,p)}}else{if(Kg(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Wm,n=null,i=Hm,o=r}return a&&i==="text/plain"&&(o=a,a=void 0),{action:n,method:t.toLowerCase(),encType:i,formData:a,body:o}}function I2(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}async function LM(r,e){if(r.id in e)return e[r.id];try{let t=await import(r.module);return e[r.id]=t,t}catch(t){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function PM(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function zM(r,e,t){let n=await Promise.all(r.map(async i=>{let a=e.routes[i.route.id];if(a){let o=await LM(a,t);return o.links?o.links():[]}return[]}));return jM(n.flat(1).filter(PM).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function eT(r,e,t,n,i,a){let o=(l,h)=>t[h]?l.route.id!==t[h].route.id:!0,u=(l,h)=>{var f;return t[h].pathname!==l.pathname||((f=t[h].route.path)==null?void 0:f.endsWith("*"))&&t[h].params["*"]!==l.params["*"]};return a==="assets"?e.filter((l,h)=>o(l,h)||u(l,h)):a==="data"?e.filter((l,h)=>{var p;let f=n.routes[l.route.id];if(!f||!f.hasLoader)return!1;if(o(l,h)||u(l,h))return!0;if(l.route.shouldRevalidate){let m=l.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((p=t[0])==null?void 0:p.params)||{},nextUrl:new URL(r,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function VM(r,e,{includeHydrateFallback:t}={}){return FM(r.map(n=>{let i=e.routes[n.route.id];if(!i)return[];let a=[i.module];return i.clientActionModule&&(a=a.concat(i.clientActionModule)),i.clientLoaderModule&&(a=a.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(a=a.concat(i.hydrateFallbackModule)),i.imports&&(a=a.concat(i.imports)),a}).flat(1))}function FM(r){return[...new Set(r)]}function BM(r){let e={},t=Object.keys(r).sort();for(let n of t)e[n]=r[n];return e}function jM(r,e){let t=new Set;return new Set(e),r.reduce((n,i)=>{let a=JSON.stringify(BM(i));return t.has(a)||(t.add(a),n.push({key:a,link:i})),n},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var UM=new Set([100,101,204,205]);function WM(r,e){let t=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return t.pathname==="/"?t.pathname="_root.data":e&&Ro(t.pathname,e)==="/"?t.pathname=`${e.replace(/\/$/,"")}/_root.data`:t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function aA(){let r=X.useContext(Hc);return I2(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function HM(){let r=X.useContext($g);return I2(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var k2=X.createContext(void 0);k2.displayName="FrameworkContext";function oA(){let r=X.useContext(k2);return I2(r,"You must render this element inside a <HydratedRouter> element"),r}function qM(r,e){let t=X.useContext(k2),[n,i]=X.useState(!1),[a,o]=X.useState(!1),{onFocus:u,onBlur:l,onMouseEnter:h,onMouseLeave:f,onTouchStart:p}=e,m=X.useRef(null);X.useEffect(()=>{if(r==="render"&&o(!0),r==="viewport"){let C=E=>{E.forEach(S=>{o(S.isIntersecting)})},w=new IntersectionObserver(C,{threshold:.5});return m.current&&w.observe(m.current),()=>{w.disconnect()}}},[r]),X.useEffect(()=>{if(n){let C=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(C)}}},[n]);let v=()=>{i(!0)},b=()=>{i(!1),o(!1)};return t?r!=="intent"?[a,m,{}]:[a,m,{onFocus:xf(u,v),onBlur:xf(l,b),onMouseEnter:xf(h,v),onMouseLeave:xf(f,b),onTouchStart:xf(p,v)}]:[!1,m,{}]}function xf(r,e){return t=>{r&&r(t),t.defaultPrevented||e(t)}}function GM({page:r,...e}){let{router:t}=aA(),n=X.useMemo(()=>K4(t.routes,r,t.basename),[t.routes,r,t.basename]);return n?X.createElement(KM,{page:r,matches:n,...e}):null}function $M(r){let{manifest:e,routeModules:t}=oA(),[n,i]=X.useState([]);return X.useEffect(()=>{let a=!1;return zM(r,e,t).then(o=>{a||i(o)}),()=>{a=!0}},[r,e,t]),n}function KM({page:r,matches:e,...t}){let n=Lo(),{manifest:i,routeModules:a}=oA(),{basename:o}=aA(),{loaderData:u,matches:l}=HM(),h=X.useMemo(()=>eT(r,e,l,i,n,"data"),[r,e,l,i,n]),f=X.useMemo(()=>eT(r,e,l,i,n,"assets"),[r,e,l,i,n]),p=X.useMemo(()=>{if(r===n.pathname+n.search+n.hash)return[];let b=new Set,C=!1;if(e.forEach(E=>{var A;let S=i.routes[E.route.id];!S||!S.hasLoader||(!h.some(k=>k.route.id===E.route.id)&&E.route.id in u&&((A=a[E.route.id])!=null&&A.shouldRevalidate)||S.hasClientLoader?C=!0:b.add(E.route.id))}),b.size===0)return[];let w=WM(r,o);return C&&b.size>0&&w.searchParams.set("_routes",e.filter(E=>b.has(E.route.id)).map(E=>E.route.id).join(",")),[w.pathname+w.search]},[o,u,n,i,h,e,r,a]),m=X.useMemo(()=>VM(f,i),[f,i]),v=$M(f);return X.createElement(X.Fragment,null,p.map(b=>X.createElement("link",{key:b,rel:"prefetch",as:"fetch",href:b,...t})),m.map(b=>X.createElement("link",{key:b,rel:"modulepreload",href:b,...t})),v.map(({key:b,link:C})=>X.createElement("link",{key:b,...C})))}function XM(...r){return e=>{r.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var sA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{sA&&(window.__reactRouterVersion="7.6.0")}catch{}function YM({basename:r,children:e,window:t}){let n=X.useRef();n.current==null&&(n.current=z9({window:t,v5Compat:!0}));let i=n.current,[a,o]=X.useState({action:i.action,location:i.location}),u=X.useCallback(l=>{X.startTransition(()=>o(l))},[o]);return X.useLayoutEffect(()=>i.listen(u),[i,u]),X.createElement(TM,{basename:r,children:e,location:a.location,navigationType:a.action,navigator:i})}var uA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xg=X.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:i,reloadDocument:a,replace:o,state:u,target:l,to:h,preventScrollReset:f,viewTransition:p,...m},v){let{basename:b}=X.useContext(Ba),C=typeof h=="string"&&uA.test(h),w,E=!1;if(typeof h=="string"&&C&&(w=h,sA))try{let N=new URL(window.location.href),D=h.startsWith("//")?new URL(N.protocol+h):new URL(h),L=Ro(D.pathname,b);D.origin===N.origin&&L!=null?h=L+D.search+D.hash:E=!0}catch{Ma(!1,`<Link to="${h}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let S=cM(h,{relative:i}),[A,k,O]=qM(n,m),V=t7(h,{replace:o,state:u,target:l,preventScrollReset:f,relative:i,viewTransition:p});function T(N){e&&e(N),N.defaultPrevented||V(N)}let R=X.createElement("a",{...m,...O,href:w||S,onClick:E||a?e:T,ref:XM(v,k),target:l,"data-discover":!C&&t==="render"?"true":void 0});return A&&!C?X.createElement(X.Fragment,null,R,X.createElement(GM,{page:S})):R});Xg.displayName="Link";var QM=X.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:i=!1,style:a,to:o,viewTransition:u,children:l,...h},f){let p=Ed(o,{relative:h.relative}),m=Lo(),v=X.useContext($g),{navigator:b,basename:C}=X.useContext(Ba),w=v!=null&&a7(p)&&u===!0,E=b.encodeLocation?b.encodeLocation(p).pathname:p.pathname,S=m.pathname,A=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;t||(S=S.toLowerCase(),A=A?A.toLowerCase():null,E=E.toLowerCase()),A&&C&&(A=Ro(A,C)||A);const k=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let O=S===E||!i&&S.startsWith(E)&&S.charAt(k)==="/",V=A!=null&&(A===E||!i&&A.startsWith(E)&&A.charAt(E.length)==="/"),T={isActive:O,isPending:V,isTransitioning:w},R=O?e:void 0,N;typeof n=="function"?N=n(T):N=[n,O?"active":null,V?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let D=typeof a=="function"?a(T):a;return X.createElement(Xg,{...h,"aria-current":R,className:N,ref:f,style:D,to:o,viewTransition:u},typeof l=="function"?l(T):l)});QM.displayName="NavLink";var ZM=X.forwardRef(({discover:r="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:i,state:a,method:o=Wm,action:u,onSubmit:l,relative:h,preventScrollReset:f,viewTransition:p,...m},v)=>{let b=r7(),C=i7(u,{relative:h}),w=o.toLowerCase()==="get"?"get":"post",E=typeof u=="string"&&uA.test(u),S=A=>{if(l&&l(A),A.defaultPrevented)return;A.preventDefault();let k=A.nativeEvent.submitter,O=(k==null?void 0:k.getAttribute("formmethod"))||o;b(k||A.currentTarget,{fetcherKey:e,method:O,navigate:t,replace:i,state:a,relative:h,preventScrollReset:f,viewTransition:p})};return X.createElement("form",{ref:v,method:w,action:C,onSubmit:n?l:S,...m,"data-discover":!E&&r==="render"?"true":void 0})});ZM.displayName="Form";function JM(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function lA(r){let e=X.useContext(Hc);return gn(e,JM(r)),e}function t7(r,{target:e,replace:t,state:n,preventScrollReset:i,relative:a,viewTransition:o}={}){let u=wi(),l=Lo(),h=Ed(r,{relative:a});return X.useCallback(f=>{if(kM(f,e)){f.preventDefault();let p=t!==void 0?t:Gf(l)===Gf(h);u(r,{replace:p,state:n,preventScrollReset:i,relative:a,viewTransition:o})}},[l,u,h,t,n,e,r,i,a,o])}var e7=0,n7=()=>`__${String(++e7)}__`;function r7(){let{router:r}=lA("useSubmit"),{basename:e}=X.useContext(Ba),t=wM();return X.useCallback(async(n,i={})=>{let{action:a,method:o,encType:u,formData:l,body:h}=MM(n,e);if(i.navigate===!1){let f=i.fetcherKey||n7();await r.fetch(f,t,i.action||a,{preventScrollReset:i.preventScrollReset,formData:l,body:h,formMethod:i.method||o,formEncType:i.encType||u,flushSync:i.flushSync})}else await r.navigate(i.action||a,{preventScrollReset:i.preventScrollReset,formData:l,body:h,formMethod:i.method||o,formEncType:i.encType||u,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[r,e,t])}function i7(r,{relative:e}={}){let{basename:t}=X.useContext(Ba),n=X.useContext(ja);gn(n,"useFormAction must be used inside a RouteContext");let[i]=n.matches.slice(-1),a={...Ed(r||".",{relative:e})},o=Lo();if(r==null){a.search=o.search;let u=new URLSearchParams(a.search),l=u.getAll("index");if(l.some(f=>f==="")){u.delete("index"),l.filter(p=>p).forEach(p=>u.append("index",p));let f=u.toString();a.search=f?`?${f}`:""}}return(!r||r===".")&&i.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(a.pathname=a.pathname==="/"?t:Co([t,a.pathname])),Gf(a)}function a7(r,e={}){let t=X.useContext(tA);gn(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=lA("useViewTransitionState"),i=Ed(r,{relative:e.relative});if(!t.isTransitioning)return!1;let a=Ro(t.currentLocation.pathname,n)||t.currentLocation.pathname,o=Ro(t.nextLocation.pathname,n)||t.nextLocation.pathname;return dg(i.pathname,o)!=null||dg(i.pathname,a)!=null}[...UM];const o7=r=>X.createElement("svg",{width:26,height:28,viewBox:"0 0 26 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M23.5454 10.4707C24.1858 10.8112 24.7214 11.3196 25.095 11.9413C25.4685 12.563 25.6659 13.2747 25.6659 14C25.6659 14.7253 25.4685 15.437 25.095 16.0587C24.7214 16.6804 24.1858 17.1888 23.5454 17.5293L6.46271 26.8187C3.71204 28.316 0.333374 26.3693 0.333374 23.2907V4.71067C0.333374 1.63067 3.71204 -0.314664 6.46271 1.18L23.5454 10.4707Z",fill:"white"})),nT=({children:r,className:e})=>M.jsx("div",{className:`backdrop-filter-container ${e??""}`,children:r}),s7=({imageUrl:r,title:e="Exhibition Name",buttonLabel:t="start journey"})=>M.jsxs("div",{className:"card-cutout",style:{backgroundImage:`url(${r})`},children:[M.jsx("div",{className:"fake-corners"}),M.jsx(nT,{className:"title",children:M.jsx("h1",{children:e})}),M.jsx("div",{className:"text-container",children:M.jsx(nT,{children:M.jsx("h3",{children:t})})}),M.jsx("button",{className:"play-button",children:M.jsx(o7,{className:"play-icon"})})]});function rT(r,e=300,t=360,n=70){return`${r}?auto=format&fit=crop&w=${e}&h=${t}&q=${n}`}const u7=[{id:"expedition-to-africa",title:"Expedition to Africa",imageUrl:rT("https://images.unsplash.com/photo-1577971132997-c10be9372519")},{id:"the-global-backyard",title:"The Global Backyard",imageUrl:rT("https://images.unsplash.com/photo-1506744038136-46273834b3fb")}],l7=({className:r})=>M.jsx("div",{className:`${r??""}`,children:u7.map(e=>M.jsx(s7,{title:e.title,imageUrl:e.imageUrl},e.id))}),c7=()=>{};var iT={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cA=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},h7=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const i=r[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const a=r[t++];e[n++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=r[t++],o=r[t++],u=r[t++],l=((i&7)<<18|(a&63)<<12|(o&63)<<6|u&63)-65536;e[n++]=String.fromCharCode(55296+(l>>10)),e[n++]=String.fromCharCode(56320+(l&1023))}else{const a=r[t++],o=r[t++];e[n++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return e.join("")},hA={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<r.length;i+=3){const a=r[i],o=i+1<r.length,u=o?r[i+1]:0,l=i+2<r.length,h=l?r[i+2]:0,f=a>>2,p=(a&3)<<4|u>>4;let m=(u&15)<<2|h>>6,v=h&63;l||(v=64,o||(m=64)),n.push(t[f],t[p],t[m],t[v])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(cA(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):h7(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<r.length;){const a=t[r.charAt(i++)],u=i<r.length?t[r.charAt(i)]:0;++i;const h=i<r.length?t[r.charAt(i)]:64;++i;const p=i<r.length?t[r.charAt(i)]:64;if(++i,a==null||u==null||h==null||p==null)throw new f7;const m=a<<2|u>>4;if(n.push(m),h!==64){const v=u<<4&240|h>>2;if(n.push(v),p!==64){const b=h<<6&192|p;n.push(b)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class f7 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const d7=function(r){const e=cA(r);return hA.encodeByteArray(e,!0)},pg=function(r){return d7(r).replace(/\./g,"")},p7=function(r){try{return hA.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m7(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g7=()=>m7().__FIREBASE_DEFAULTS__,v7=()=>{if(typeof process>"u"||typeof iT>"u")return;const r=iT.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},y7=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&p7(r[1]);return e&&JSON.parse(e)},D2=()=>{try{return c7()||g7()||v7()||y7()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},b7=r=>{var e,t;return(t=(e=D2())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},x7=r=>{const e=b7(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},fA=()=>{var r;return(r=D2())===null||r===void 0?void 0:r.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w7{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O2(r){return r.endsWith(".cloudworkstations.dev")}async function C7(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E7(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",i=r.iat||0,a=r.sub||r.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}}},r);return[pg(JSON.stringify(t)),pg(JSON.stringify(o)),""].join(".")}const zf={};function _7(){const r={prod:[],emulator:[]};for(const e of Object.keys(zf))zf[e]?r.emulator.push(e):r.prod.push(e);return r}function T7(r){let e=document.getElementById(r),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",r),t=!0),{created:t,element:e}}let aT=!1;function S7(r,e){if(typeof window>"u"||typeof document>"u"||!O2(window.location.host)||zf[r]===e||zf[r]||aT)return;zf[r]=e;function t(m){return`__firebase__banner__${m}`}const n="__firebase__banner",a=_7().prod.length>0;function o(){const m=document.getElementById(n);m&&m.remove()}function u(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function l(m,v){m.setAttribute("width","24"),m.setAttribute("id",v),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function h(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{aT=!0,o()},m}function f(m,v){m.setAttribute("id",v),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=T7(n),v=t("text"),b=document.getElementById(v)||document.createElement("span"),C=t("learnmore"),w=document.getElementById(C)||document.createElement("a"),E=t("preprendIcon"),S=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const A=m.element;u(A),f(w,C);const k=h();l(S,E),A.append(S,b,w,k),document.body.appendChild(A)}a?(b.innerText="Preview backend disconnected.",S.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(S.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A7(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function R7(){var r;const e=(r=D2())===null||r===void 0?void 0:r.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function N7(){return!R7()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function I7(){try{return typeof indexedDB=="object"}catch{return!1}}function k7(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var a;e(((a=i.error)===null||a===void 0?void 0:a.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D7="FirebaseError";class qc extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=D7,Object.setPrototypeOf(this,qc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,dA.prototype.create)}}class dA{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],o=a?O7(a,n):"Error",u=`${this.serviceName}: ${o} (${i}).`;return new qc(i,u,n)}}function O7(r,e){return r.replace(M7,(t,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const M7=/\{\$([^}]+)}/g;function mg(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const i of t){if(!n.includes(i))return!1;const a=r[i],o=e[i];if(oT(a)&&oT(o)){if(!mg(a,o))return!1}else if(a!==o)return!1}for(const i of n)if(!t.includes(i))return!1;return!0}function oT(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function La(r){return r&&r._delegate?r._delegate:r}class $f{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iu="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L7{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new w7;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(z7(e))try{this.getOrInitializeService({instanceIdentifier:Iu})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const a=this.getOrInitializeService({instanceIdentifier:i});n.resolve(a)}catch{}}}}clearInstance(e=Iu){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Iu){return this.instances.has(e)}getOptions(e=Iu){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[a,o]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(a);n===u&&o.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),a=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;a.add(e),this.onInitCallbacks.set(i,a);const o=this.instances.get(i);return o&&e(o,i),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:P7(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Iu){return this.component?this.component.multipleInstances?e:Iu:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function P7(r){return r===Iu?void 0:r}function z7(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V7{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new L7(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Oe;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Oe||(Oe={}));const F7={debug:Oe.DEBUG,verbose:Oe.VERBOSE,info:Oe.INFO,warn:Oe.WARN,error:Oe.ERROR,silent:Oe.SILENT},B7=Oe.INFO,j7={[Oe.DEBUG]:"log",[Oe.VERBOSE]:"log",[Oe.INFO]:"info",[Oe.WARN]:"warn",[Oe.ERROR]:"error"},U7=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),i=j7[e];if(i)console[i](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class pA{constructor(e){this.name=e,this._logLevel=B7,this._logHandler=U7,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Oe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?F7[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Oe.DEBUG,...e),this._logHandler(this,Oe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Oe.VERBOSE,...e),this._logHandler(this,Oe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Oe.INFO,...e),this._logHandler(this,Oe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Oe.WARN,...e),this._logHandler(this,Oe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Oe.ERROR,...e),this._logHandler(this,Oe.ERROR,...e)}}const W7=(r,e)=>e.some(t=>r instanceof t);let sT,uT;function H7(){return sT||(sT=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function q7(){return uT||(uT=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const mA=new WeakMap,lb=new WeakMap,gA=new WeakMap,w1=new WeakMap,M2=new WeakMap;function G7(r){const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("success",a),r.removeEventListener("error",o)},a=()=>{t(Es(r.result)),i()},o=()=>{n(r.error),i()};r.addEventListener("success",a),r.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&mA.set(t,r)}).catch(()=>{}),M2.set(e,r),e}function $7(r){if(lb.has(r))return;const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("complete",a),r.removeEventListener("error",o),r.removeEventListener("abort",o)},a=()=>{t(),i()},o=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",a),r.addEventListener("error",o),r.addEventListener("abort",o)});lb.set(r,e)}let cb={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return lb.get(r);if(e==="objectStoreNames")return r.objectStoreNames||gA.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Es(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function K7(r){cb=r(cb)}function X7(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(C1(this),e,...t);return gA.set(n,e.sort?e.sort():[e]),Es(n)}:q7().includes(r)?function(...e){return r.apply(C1(this),e),Es(mA.get(this))}:function(...e){return Es(r.apply(C1(this),e))}}function Y7(r){return typeof r=="function"?X7(r):(r instanceof IDBTransaction&&$7(r),W7(r,H7())?new Proxy(r,cb):r)}function Es(r){if(r instanceof IDBRequest)return G7(r);if(w1.has(r))return w1.get(r);const e=Y7(r);return e!==r&&(w1.set(r,e),M2.set(e,r)),e}const C1=r=>M2.get(r);function Q7(r,e,{blocked:t,upgrade:n,blocking:i,terminated:a}={}){const o=indexedDB.open(r,e),u=Es(o);return n&&o.addEventListener("upgradeneeded",l=>{n(Es(o.result),l.oldVersion,l.newVersion,Es(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),u.then(l=>{a&&l.addEventListener("close",()=>a()),i&&l.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),u}const Z7=["get","getKey","getAll","getAllKeys","count"],J7=["put","add","delete","clear"],E1=new Map;function lT(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(E1.get(e))return E1.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,i=J7.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||Z7.includes(t)))return;const a=async function(o,...u){const l=this.transaction(o,i?"readwrite":"readonly");let h=l.store;return n&&(h=h.index(u.shift())),(await Promise.all([h[t](...u),i&&l.done]))[0]};return E1.set(e,a),a}K7(r=>({...r,get:(e,t,n)=>lT(e,t)||r.get(e,t,n),has:(e,t)=>!!lT(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t8{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(e8(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function e8(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const hb="@firebase/app",cT="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const No=new pA("@firebase/app"),n8="@firebase/app-compat",r8="@firebase/analytics-compat",i8="@firebase/analytics",a8="@firebase/app-check-compat",o8="@firebase/app-check",s8="@firebase/auth",u8="@firebase/auth-compat",l8="@firebase/database",c8="@firebase/data-connect",h8="@firebase/database-compat",f8="@firebase/functions",d8="@firebase/functions-compat",p8="@firebase/installations",m8="@firebase/installations-compat",g8="@firebase/messaging",v8="@firebase/messaging-compat",y8="@firebase/performance",b8="@firebase/performance-compat",x8="@firebase/remote-config",w8="@firebase/remote-config-compat",C8="@firebase/storage",E8="@firebase/storage-compat",_8="@firebase/firestore",T8="@firebase/ai",S8="@firebase/firestore-compat",A8="firebase",R8="11.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fb="[DEFAULT]",N8={[hb]:"fire-core",[n8]:"fire-core-compat",[i8]:"fire-analytics",[r8]:"fire-analytics-compat",[o8]:"fire-app-check",[a8]:"fire-app-check-compat",[s8]:"fire-auth",[u8]:"fire-auth-compat",[l8]:"fire-rtdb",[c8]:"fire-data-connect",[h8]:"fire-rtdb-compat",[f8]:"fire-fn",[d8]:"fire-fn-compat",[p8]:"fire-iid",[m8]:"fire-iid-compat",[g8]:"fire-fcm",[v8]:"fire-fcm-compat",[y8]:"fire-perf",[b8]:"fire-perf-compat",[x8]:"fire-rc",[w8]:"fire-rc-compat",[C8]:"fire-gcs",[E8]:"fire-gcs-compat",[_8]:"fire-fst",[S8]:"fire-fst-compat",[T8]:"fire-vertex","fire-js":"fire-js",[A8]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gg=new Map,I8=new Map,db=new Map;function hT(r,e){try{r.container.addComponent(e)}catch(t){No.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function vg(r){const e=r.name;if(db.has(e))return No.debug(`There were multiple attempts to register component ${e}.`),!1;db.set(e,r);for(const t of gg.values())hT(t,r);for(const t of I8.values())hT(t,r);return!0}function k8(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function D8(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O8={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},_s=new dA("app","Firebase",O8);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M8{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new $f("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _s.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L8=R8;function vA(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n=Object.assign({name:fb,automaticDataCollectionEnabled:!0},e),i=n.name;if(typeof i!="string"||!i)throw _s.create("bad-app-name",{appName:String(i)});if(t||(t=fA()),!t)throw _s.create("no-options");const a=gg.get(i);if(a){if(mg(t,a.options)&&mg(n,a.config))return a;throw _s.create("duplicate-app",{appName:i})}const o=new V7(i);for(const l of db.values())o.addComponent(l);const u=new M8(t,n,o);return gg.set(i,u),u}function P8(r=fb){const e=gg.get(r);if(!e&&r===fb&&fA())return vA();if(!e)throw _s.create("no-app",{appName:r});return e}function gc(r,e,t){var n;let i=(n=N8[r])!==null&&n!==void 0?n:r;t&&(i+=`-${t}`);const a=i.match(/\s|\//),o=e.match(/\s|\//);if(a||o){const u=[`Unable to register library "${i}" with version "${e}":`];a&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&o&&u.push("and"),o&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),No.warn(u.join(" "));return}vg(new $f(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z8="firebase-heartbeat-database",V8=1,Kf="firebase-heartbeat-store";let _1=null;function yA(){return _1||(_1=Q7(z8,V8,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(Kf)}catch(t){console.warn(t)}}}}).catch(r=>{throw _s.create("idb-open",{originalErrorMessage:r.message})})),_1}async function F8(r){try{const t=(await yA()).transaction(Kf),n=await t.objectStore(Kf).get(bA(r));return await t.done,n}catch(e){if(e instanceof qc)No.warn(e.message);else{const t=_s.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});No.warn(t.message)}}}async function fT(r,e){try{const n=(await yA()).transaction(Kf,"readwrite");await n.objectStore(Kf).put(e,bA(r)),await n.done}catch(t){if(t instanceof qc)No.warn(t.message);else{const n=_s.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});No.warn(n.message)}}}function bA(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B8=1024,j8=30;class U8{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new H8(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=dT();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(o=>o.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:i}),this._heartbeatsCache.heartbeats.length>j8){const o=q8(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){No.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=dT(),{heartbeatsToSend:n,unsentEntries:i}=W8(this._heartbeatsCache.heartbeats),a=pg(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return No.warn(t),""}}}function dT(){return new Date().toISOString().substring(0,10)}function W8(r,e=B8){const t=[];let n=r.slice();for(const i of r){const a=t.find(o=>o.agent===i.agent);if(a){if(a.dates.push(i.date),pT(t)>e){a.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),pT(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class H8{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return I7()?k7().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await F8(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return fT(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return fT(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function pT(r){return pg(JSON.stringify({version:2,heartbeats:r})).length}function q8(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let n=1;n<r.length;n++)r[n].date<t&&(t=r[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G8(r){vg(new $f("platform-logger",e=>new t8(e),"PRIVATE")),vg(new $f("heartbeat",e=>new U8(e),"PRIVATE")),gc(hb,cT,r),gc(hb,cT,"esm2017"),gc("fire-js","")}G8("");var $8="firebase",K8="11.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */gc($8,K8,"app");var mT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ts,xA;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,R){function N(){}N.prototype=R.prototype,T.D=R.prototype,T.prototype=new N,T.prototype.constructor=T,T.C=function(D,L,P){for(var B=Array(arguments.length-2),Z=2;Z<arguments.length;Z++)B[Z-2]=arguments[Z];return R.prototype[L].apply(D,B)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,R,N){N||(N=0);var D=Array(16);if(typeof R=="string")for(var L=0;16>L;++L)D[L]=R.charCodeAt(N++)|R.charCodeAt(N++)<<8|R.charCodeAt(N++)<<16|R.charCodeAt(N++)<<24;else for(L=0;16>L;++L)D[L]=R[N++]|R[N++]<<8|R[N++]<<16|R[N++]<<24;R=T.g[0],N=T.g[1],L=T.g[2];var P=T.g[3],B=R+(P^N&(L^P))+D[0]+3614090360&4294967295;R=N+(B<<7&4294967295|B>>>25),B=P+(L^R&(N^L))+D[1]+3905402710&4294967295,P=R+(B<<12&4294967295|B>>>20),B=L+(N^P&(R^N))+D[2]+606105819&4294967295,L=P+(B<<17&4294967295|B>>>15),B=N+(R^L&(P^R))+D[3]+3250441966&4294967295,N=L+(B<<22&4294967295|B>>>10),B=R+(P^N&(L^P))+D[4]+4118548399&4294967295,R=N+(B<<7&4294967295|B>>>25),B=P+(L^R&(N^L))+D[5]+1200080426&4294967295,P=R+(B<<12&4294967295|B>>>20),B=L+(N^P&(R^N))+D[6]+2821735955&4294967295,L=P+(B<<17&4294967295|B>>>15),B=N+(R^L&(P^R))+D[7]+4249261313&4294967295,N=L+(B<<22&4294967295|B>>>10),B=R+(P^N&(L^P))+D[8]+1770035416&4294967295,R=N+(B<<7&4294967295|B>>>25),B=P+(L^R&(N^L))+D[9]+2336552879&4294967295,P=R+(B<<12&4294967295|B>>>20),B=L+(N^P&(R^N))+D[10]+4294925233&4294967295,L=P+(B<<17&4294967295|B>>>15),B=N+(R^L&(P^R))+D[11]+2304563134&4294967295,N=L+(B<<22&4294967295|B>>>10),B=R+(P^N&(L^P))+D[12]+1804603682&4294967295,R=N+(B<<7&4294967295|B>>>25),B=P+(L^R&(N^L))+D[13]+4254626195&4294967295,P=R+(B<<12&4294967295|B>>>20),B=L+(N^P&(R^N))+D[14]+2792965006&4294967295,L=P+(B<<17&4294967295|B>>>15),B=N+(R^L&(P^R))+D[15]+1236535329&4294967295,N=L+(B<<22&4294967295|B>>>10),B=R+(L^P&(N^L))+D[1]+4129170786&4294967295,R=N+(B<<5&4294967295|B>>>27),B=P+(N^L&(R^N))+D[6]+3225465664&4294967295,P=R+(B<<9&4294967295|B>>>23),B=L+(R^N&(P^R))+D[11]+643717713&4294967295,L=P+(B<<14&4294967295|B>>>18),B=N+(P^R&(L^P))+D[0]+3921069994&4294967295,N=L+(B<<20&4294967295|B>>>12),B=R+(L^P&(N^L))+D[5]+3593408605&4294967295,R=N+(B<<5&4294967295|B>>>27),B=P+(N^L&(R^N))+D[10]+38016083&4294967295,P=R+(B<<9&4294967295|B>>>23),B=L+(R^N&(P^R))+D[15]+3634488961&4294967295,L=P+(B<<14&4294967295|B>>>18),B=N+(P^R&(L^P))+D[4]+3889429448&4294967295,N=L+(B<<20&4294967295|B>>>12),B=R+(L^P&(N^L))+D[9]+568446438&4294967295,R=N+(B<<5&4294967295|B>>>27),B=P+(N^L&(R^N))+D[14]+3275163606&4294967295,P=R+(B<<9&4294967295|B>>>23),B=L+(R^N&(P^R))+D[3]+4107603335&4294967295,L=P+(B<<14&4294967295|B>>>18),B=N+(P^R&(L^P))+D[8]+1163531501&4294967295,N=L+(B<<20&4294967295|B>>>12),B=R+(L^P&(N^L))+D[13]+2850285829&4294967295,R=N+(B<<5&4294967295|B>>>27),B=P+(N^L&(R^N))+D[2]+4243563512&4294967295,P=R+(B<<9&4294967295|B>>>23),B=L+(R^N&(P^R))+D[7]+1735328473&4294967295,L=P+(B<<14&4294967295|B>>>18),B=N+(P^R&(L^P))+D[12]+2368359562&4294967295,N=L+(B<<20&4294967295|B>>>12),B=R+(N^L^P)+D[5]+4294588738&4294967295,R=N+(B<<4&4294967295|B>>>28),B=P+(R^N^L)+D[8]+2272392833&4294967295,P=R+(B<<11&4294967295|B>>>21),B=L+(P^R^N)+D[11]+1839030562&4294967295,L=P+(B<<16&4294967295|B>>>16),B=N+(L^P^R)+D[14]+4259657740&4294967295,N=L+(B<<23&4294967295|B>>>9),B=R+(N^L^P)+D[1]+2763975236&4294967295,R=N+(B<<4&4294967295|B>>>28),B=P+(R^N^L)+D[4]+1272893353&4294967295,P=R+(B<<11&4294967295|B>>>21),B=L+(P^R^N)+D[7]+4139469664&4294967295,L=P+(B<<16&4294967295|B>>>16),B=N+(L^P^R)+D[10]+3200236656&4294967295,N=L+(B<<23&4294967295|B>>>9),B=R+(N^L^P)+D[13]+681279174&4294967295,R=N+(B<<4&4294967295|B>>>28),B=P+(R^N^L)+D[0]+3936430074&4294967295,P=R+(B<<11&4294967295|B>>>21),B=L+(P^R^N)+D[3]+3572445317&4294967295,L=P+(B<<16&4294967295|B>>>16),B=N+(L^P^R)+D[6]+76029189&4294967295,N=L+(B<<23&4294967295|B>>>9),B=R+(N^L^P)+D[9]+3654602809&4294967295,R=N+(B<<4&4294967295|B>>>28),B=P+(R^N^L)+D[12]+3873151461&4294967295,P=R+(B<<11&4294967295|B>>>21),B=L+(P^R^N)+D[15]+530742520&4294967295,L=P+(B<<16&4294967295|B>>>16),B=N+(L^P^R)+D[2]+3299628645&4294967295,N=L+(B<<23&4294967295|B>>>9),B=R+(L^(N|~P))+D[0]+4096336452&4294967295,R=N+(B<<6&4294967295|B>>>26),B=P+(N^(R|~L))+D[7]+1126891415&4294967295,P=R+(B<<10&4294967295|B>>>22),B=L+(R^(P|~N))+D[14]+2878612391&4294967295,L=P+(B<<15&4294967295|B>>>17),B=N+(P^(L|~R))+D[5]+4237533241&4294967295,N=L+(B<<21&4294967295|B>>>11),B=R+(L^(N|~P))+D[12]+1700485571&4294967295,R=N+(B<<6&4294967295|B>>>26),B=P+(N^(R|~L))+D[3]+2399980690&4294967295,P=R+(B<<10&4294967295|B>>>22),B=L+(R^(P|~N))+D[10]+4293915773&4294967295,L=P+(B<<15&4294967295|B>>>17),B=N+(P^(L|~R))+D[1]+2240044497&4294967295,N=L+(B<<21&4294967295|B>>>11),B=R+(L^(N|~P))+D[8]+1873313359&4294967295,R=N+(B<<6&4294967295|B>>>26),B=P+(N^(R|~L))+D[15]+4264355552&4294967295,P=R+(B<<10&4294967295|B>>>22),B=L+(R^(P|~N))+D[6]+2734768916&4294967295,L=P+(B<<15&4294967295|B>>>17),B=N+(P^(L|~R))+D[13]+1309151649&4294967295,N=L+(B<<21&4294967295|B>>>11),B=R+(L^(N|~P))+D[4]+4149444226&4294967295,R=N+(B<<6&4294967295|B>>>26),B=P+(N^(R|~L))+D[11]+3174756917&4294967295,P=R+(B<<10&4294967295|B>>>22),B=L+(R^(P|~N))+D[2]+718787259&4294967295,L=P+(B<<15&4294967295|B>>>17),B=N+(P^(L|~R))+D[9]+3951481745&4294967295,T.g[0]=T.g[0]+R&4294967295,T.g[1]=T.g[1]+(L+(B<<21&4294967295|B>>>11))&4294967295,T.g[2]=T.g[2]+L&4294967295,T.g[3]=T.g[3]+P&4294967295}n.prototype.u=function(T,R){R===void 0&&(R=T.length);for(var N=R-this.blockSize,D=this.B,L=this.h,P=0;P<R;){if(L==0)for(;P<=N;)i(this,T,P),P+=this.blockSize;if(typeof T=="string"){for(;P<R;)if(D[L++]=T.charCodeAt(P++),L==this.blockSize){i(this,D),L=0;break}}else for(;P<R;)if(D[L++]=T[P++],L==this.blockSize){i(this,D),L=0;break}}this.h=L,this.o+=R},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var R=1;R<T.length-8;++R)T[R]=0;var N=8*this.o;for(R=T.length-8;R<T.length;++R)T[R]=N&255,N/=256;for(this.u(T),T=Array(16),R=N=0;4>R;++R)for(var D=0;32>D;D+=8)T[N++]=this.g[R]>>>D&255;return T};function a(T,R){var N=u;return Object.prototype.hasOwnProperty.call(N,T)?N[T]:N[T]=R(T)}function o(T,R){this.h=R;for(var N=[],D=!0,L=T.length-1;0<=L;L--){var P=T[L]|0;D&&P==R||(N[L]=P,D=!1)}this.g=N}var u={};function l(T){return-128<=T&&128>T?a(T,function(R){return new o([R|0],0>R?-1:0)}):new o([T|0],0>T?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return p;if(0>T)return w(h(-T));for(var R=[],N=1,D=0;T>=N;D++)R[D]=T/N|0,N*=4294967296;return new o(R,0)}function f(T,R){if(T.length==0)throw Error("number format error: empty string");if(R=R||10,2>R||36<R)throw Error("radix out of range: "+R);if(T.charAt(0)=="-")return w(f(T.substring(1),R));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var N=h(Math.pow(R,8)),D=p,L=0;L<T.length;L+=8){var P=Math.min(8,T.length-L),B=parseInt(T.substring(L,L+P),R);8>P?(P=h(Math.pow(R,P)),D=D.j(P).add(h(B))):(D=D.j(N),D=D.add(h(B)))}return D}var p=l(0),m=l(1),v=l(16777216);r=o.prototype,r.m=function(){if(C(this))return-w(this).m();for(var T=0,R=1,N=0;N<this.g.length;N++){var D=this.i(N);T+=(0<=D?D:4294967296+D)*R,R*=4294967296}return T},r.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(b(this))return"0";if(C(this))return"-"+w(this).toString(T);for(var R=h(Math.pow(T,6)),N=this,D="";;){var L=k(N,R).g;N=E(N,L.j(R));var P=((0<N.g.length?N.g[0]:N.h)>>>0).toString(T);if(N=L,b(N))return P+D;for(;6>P.length;)P="0"+P;D=P+D}},r.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function b(T){if(T.h!=0)return!1;for(var R=0;R<T.g.length;R++)if(T.g[R]!=0)return!1;return!0}function C(T){return T.h==-1}r.l=function(T){return T=E(this,T),C(T)?-1:b(T)?0:1};function w(T){for(var R=T.g.length,N=[],D=0;D<R;D++)N[D]=~T.g[D];return new o(N,~T.h).add(m)}r.abs=function(){return C(this)?w(this):this},r.add=function(T){for(var R=Math.max(this.g.length,T.g.length),N=[],D=0,L=0;L<=R;L++){var P=D+(this.i(L)&65535)+(T.i(L)&65535),B=(P>>>16)+(this.i(L)>>>16)+(T.i(L)>>>16);D=B>>>16,P&=65535,B&=65535,N[L]=B<<16|P}return new o(N,N[N.length-1]&-2147483648?-1:0)};function E(T,R){return T.add(w(R))}r.j=function(T){if(b(this)||b(T))return p;if(C(this))return C(T)?w(this).j(w(T)):w(w(this).j(T));if(C(T))return w(this.j(w(T)));if(0>this.l(v)&&0>T.l(v))return h(this.m()*T.m());for(var R=this.g.length+T.g.length,N=[],D=0;D<2*R;D++)N[D]=0;for(D=0;D<this.g.length;D++)for(var L=0;L<T.g.length;L++){var P=this.i(D)>>>16,B=this.i(D)&65535,Z=T.i(L)>>>16,rt=T.i(L)&65535;N[2*D+2*L]+=B*rt,S(N,2*D+2*L),N[2*D+2*L+1]+=P*rt,S(N,2*D+2*L+1),N[2*D+2*L+1]+=B*Z,S(N,2*D+2*L+1),N[2*D+2*L+2]+=P*Z,S(N,2*D+2*L+2)}for(D=0;D<R;D++)N[D]=N[2*D+1]<<16|N[2*D];for(D=R;D<2*R;D++)N[D]=0;return new o(N,0)};function S(T,R){for(;(T[R]&65535)!=T[R];)T[R+1]+=T[R]>>>16,T[R]&=65535,R++}function A(T,R){this.g=T,this.h=R}function k(T,R){if(b(R))throw Error("division by zero");if(b(T))return new A(p,p);if(C(T))return R=k(w(T),R),new A(w(R.g),w(R.h));if(C(R))return R=k(T,w(R)),new A(w(R.g),R.h);if(30<T.g.length){if(C(T)||C(R))throw Error("slowDivide_ only works with positive integers.");for(var N=m,D=R;0>=D.l(T);)N=O(N),D=O(D);var L=V(N,1),P=V(D,1);for(D=V(D,2),N=V(N,2);!b(D);){var B=P.add(D);0>=B.l(T)&&(L=L.add(N),P=B),D=V(D,1),N=V(N,1)}return R=E(T,L.j(R)),new A(L,R)}for(L=p;0<=T.l(R);){for(N=Math.max(1,Math.floor(T.m()/R.m())),D=Math.ceil(Math.log(N)/Math.LN2),D=48>=D?1:Math.pow(2,D-48),P=h(N),B=P.j(R);C(B)||0<B.l(T);)N-=D,P=h(N),B=P.j(R);b(P)&&(P=m),L=L.add(P),T=E(T,B)}return new A(L,T)}r.A=function(T){return k(this,T).h},r.and=function(T){for(var R=Math.max(this.g.length,T.g.length),N=[],D=0;D<R;D++)N[D]=this.i(D)&T.i(D);return new o(N,this.h&T.h)},r.or=function(T){for(var R=Math.max(this.g.length,T.g.length),N=[],D=0;D<R;D++)N[D]=this.i(D)|T.i(D);return new o(N,this.h|T.h)},r.xor=function(T){for(var R=Math.max(this.g.length,T.g.length),N=[],D=0;D<R;D++)N[D]=this.i(D)^T.i(D);return new o(N,this.h^T.h)};function O(T){for(var R=T.g.length+1,N=[],D=0;D<R;D++)N[D]=T.i(D)<<1|T.i(D-1)>>>31;return new o(N,T.h)}function V(T,R){var N=R>>5;R%=32;for(var D=T.g.length-N,L=[],P=0;P<D;P++)L[P]=0<R?T.i(P+N)>>>R|T.i(P+N+1)<<32-R:T.i(P+N);return new o(L,T.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,xA=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,Ts=o}).apply(typeof mT<"u"?mT:typeof self<"u"?self:typeof window<"u"?window:{});var Cm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var wA,Rf,CA,qm,pb,EA,_A,TA;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(y,I,z){return y==Array.prototype||y==Object.prototype||(y[I]=z.value),y};function t(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Cm=="object"&&Cm];for(var I=0;I<y.length;++I){var z=y[I];if(z&&z.Math==Math)return z}throw Error("Cannot find global object")}var n=t(this);function i(y,I){if(I)t:{var z=n;y=y.split(".");for(var H=0;H<y.length-1;H++){var ot=y[H];if(!(ot in z))break t;z=z[ot]}y=y[y.length-1],H=z[y],I=I(H),I!=H&&I!=null&&e(z,y,{configurable:!0,writable:!0,value:I})}}function a(y,I){y instanceof String&&(y+="");var z=0,H=!1,ot={next:function(){if(!H&&z<y.length){var yt=z++;return{value:I(yt,y[yt]),done:!1}}return H=!0,{done:!0,value:void 0}}};return ot[Symbol.iterator]=function(){return ot},ot}i("Array.prototype.values",function(y){return y||function(){return a(this,function(I,z){return z})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},u=this||self;function l(y){var I=typeof y;return I=I!="object"?I:y?Array.isArray(y)?"array":I:"null",I=="array"||I=="object"&&typeof y.length=="number"}function h(y){var I=typeof y;return I=="object"&&y!=null||I=="function"}function f(y,I,z){return y.call.apply(y.bind,arguments)}function p(y,I,z){if(!y)throw Error();if(2<arguments.length){var H=Array.prototype.slice.call(arguments,2);return function(){var ot=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ot,H),y.apply(I,ot)}}return function(){return y.apply(I,arguments)}}function m(y,I,z){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,m.apply(null,arguments)}function v(y,I){var z=Array.prototype.slice.call(arguments,1);return function(){var H=z.slice();return H.push.apply(H,arguments),y.apply(this,H)}}function b(y,I){function z(){}z.prototype=I.prototype,y.aa=I.prototype,y.prototype=new z,y.prototype.constructor=y,y.Qb=function(H,ot,yt){for(var It=Array(arguments.length-2),Ne=2;Ne<arguments.length;Ne++)It[Ne-2]=arguments[Ne];return I.prototype[ot].apply(H,It)}}function C(y){const I=y.length;if(0<I){const z=Array(I);for(let H=0;H<I;H++)z[H]=y[H];return z}return[]}function w(y,I){for(let z=1;z<arguments.length;z++){const H=arguments[z];if(l(H)){const ot=y.length||0,yt=H.length||0;y.length=ot+yt;for(let It=0;It<yt;It++)y[ot+It]=H[It]}else y.push(H)}}class E{constructor(I,z){this.i=I,this.j=z,this.h=0,this.g=null}get(){let I;return 0<this.h?(this.h--,I=this.g,this.g=I.next,I.next=null):I=this.i(),I}}function S(y){return/^[\s\xa0]*$/.test(y)}function A(){var y=u.navigator;return y&&(y=y.userAgent)?y:""}function k(y){return k[" "](y),y}k[" "]=function(){};var O=A().indexOf("Gecko")!=-1&&!(A().toLowerCase().indexOf("webkit")!=-1&&A().indexOf("Edge")==-1)&&!(A().indexOf("Trident")!=-1||A().indexOf("MSIE")!=-1)&&A().indexOf("Edge")==-1;function V(y,I,z){for(const H in y)I.call(z,y[H],H,y)}function T(y,I){for(const z in y)I.call(void 0,y[z],z,y)}function R(y){const I={};for(const z in y)I[z]=y[z];return I}const N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function D(y,I){let z,H;for(let ot=1;ot<arguments.length;ot++){H=arguments[ot];for(z in H)y[z]=H[z];for(let yt=0;yt<N.length;yt++)z=N[yt],Object.prototype.hasOwnProperty.call(H,z)&&(y[z]=H[z])}}function L(y){var I=1;y=y.split(":");const z=[];for(;0<I&&y.length;)z.push(y.shift()),I--;return y.length&&z.push(y.join(":")),z}function P(y){u.setTimeout(()=>{throw y},0)}function B(){var y=ut;let I=null;return y.g&&(I=y.g,y.g=y.g.next,y.g||(y.h=null),I.next=null),I}class Z{constructor(){this.h=this.g=null}add(I,z){const H=rt.get();H.set(I,z),this.h?this.h.next=H:this.g=H,this.h=H}}var rt=new E(()=>new q,y=>y.reset());class q{constructor(){this.next=this.g=this.h=null}set(I,z){this.h=I,this.g=z,this.next=null}reset(){this.next=this.g=this.h=null}}let K,Q=!1,ut=new Z,W=()=>{const y=u.Promise.resolve(void 0);K=()=>{y.then(et)}};var et=()=>{for(var y;y=B();){try{y.h.call(y.g)}catch(z){P(z)}var I=rt;I.j(y),100>I.h&&(I.h++,y.next=I.g,I.g=y)}Q=!1};function dt(){this.s=this.s,this.C=this.C}dt.prototype.s=!1,dt.prototype.ma=function(){this.s||(this.s=!0,this.N())},dt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function lt(y,I){this.type=y,this.g=this.target=I,this.defaultPrevented=!1}lt.prototype.h=function(){this.defaultPrevented=!0};var St=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var y=!1,I=Object.defineProperty({},"passive",{get:function(){y=!0}});try{const z=()=>{};u.addEventListener("test",z,I),u.removeEventListener("test",z,I)}catch{}return y}();function Nt(y,I){if(lt.call(this,y?y.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,y){var z=this.type=y.type,H=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:null;if(this.target=y.target||y.srcElement,this.g=I,I=y.relatedTarget){if(O){t:{try{k(I.nodeName);var ot=!0;break t}catch{}ot=!1}ot||(I=null)}}else z=="mouseover"?I=y.fromElement:z=="mouseout"&&(I=y.toElement);this.relatedTarget=I,H?(this.clientX=H.clientX!==void 0?H.clientX:H.pageX,this.clientY=H.clientY!==void 0?H.clientY:H.pageY,this.screenX=H.screenX||0,this.screenY=H.screenY||0):(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0),this.button=y.button,this.key=y.key||"",this.ctrlKey=y.ctrlKey,this.altKey=y.altKey,this.shiftKey=y.shiftKey,this.metaKey=y.metaKey,this.pointerId=y.pointerId||0,this.pointerType=typeof y.pointerType=="string"?y.pointerType:Rt[y.pointerType]||"",this.state=y.state,this.i=y,y.defaultPrevented&&Nt.aa.h.call(this)}}b(Nt,lt);var Rt={2:"touch",3:"pen",4:"mouse"};Nt.prototype.h=function(){Nt.aa.h.call(this);var y=this.i;y.preventDefault?y.preventDefault():y.returnValue=!1};var Ut="closure_listenable_"+(1e6*Math.random()|0),Pt=0;function Xt(y,I,z,H,ot){this.listener=y,this.proxy=null,this.src=I,this.type=z,this.capture=!!H,this.ha=ot,this.key=++Pt,this.da=this.fa=!1}function Le(y){y.da=!0,y.listener=null,y.proxy=null,y.src=null,y.ha=null}function Zt(y){this.src=y,this.g={},this.h=0}Zt.prototype.add=function(y,I,z,H,ot){var yt=y.toString();y=this.g[yt],y||(y=this.g[yt]=[],this.h++);var It=se(y,I,H,ot);return-1<It?(I=y[It],z||(I.fa=!1)):(I=new Xt(I,this.src,yt,!!H,ot),I.fa=z,y.push(I)),I};function ye(y,I){var z=I.type;if(z in y.g){var H=y.g[z],ot=Array.prototype.indexOf.call(H,I,void 0),yt;(yt=0<=ot)&&Array.prototype.splice.call(H,ot,1),yt&&(Le(I),y.g[z].length==0&&(delete y.g[z],y.h--))}}function se(y,I,z,H){for(var ot=0;ot<y.length;++ot){var yt=y[ot];if(!yt.da&&yt.listener==I&&yt.capture==!!z&&yt.ha==H)return ot}return-1}var Jt="closure_lm_"+(1e6*Math.random()|0),ze={};function Ae(y,I,z,H,ot){if(Array.isArray(I)){for(var yt=0;yt<I.length;yt++)Ae(y,I[yt],z,H,ot);return null}return z=ln(z),y&&y[Ut]?y.K(I,z,h(H)?!!H.capture:!1,ot):Ke(y,I,z,!1,H,ot)}function Ke(y,I,z,H,ot,yt){if(!I)throw Error("Invalid event type");var It=h(ot)?!!ot.capture:!!ot,Ne=re(y);if(Ne||(y[Jt]=Ne=new Zt(y)),z=Ne.add(I,z,H,It,yt),z.proxy)return z;if(H=Dr(),z.proxy=H,H.src=y,H.listener=z,y.addEventListener)St||(ot=It),ot===void 0&&(ot=!1),y.addEventListener(I.toString(),H,ot);else if(y.attachEvent)y.attachEvent(un(I.toString()),H);else if(y.addListener&&y.removeListener)y.addListener(H);else throw Error("addEventListener and attachEvent are unavailable.");return z}function Dr(){function y(z){return I.call(y.src,y.listener,z)}const I=Er;return y}function En(y,I,z,H,ot){if(Array.isArray(I))for(var yt=0;yt<I.length;yt++)En(y,I[yt],z,H,ot);else H=h(H)?!!H.capture:!!H,z=ln(z),y&&y[Ut]?(y=y.i,I=String(I).toString(),I in y.g&&(yt=y.g[I],z=se(yt,z,H,ot),-1<z&&(Le(yt[z]),Array.prototype.splice.call(yt,z,1),yt.length==0&&(delete y.g[I],y.h--)))):y&&(y=re(y))&&(I=y.g[I.toString()],y=-1,I&&(y=se(I,z,H,ot)),(z=-1<y?I[y]:null)&&In(z))}function In(y){if(typeof y!="number"&&y&&!y.da){var I=y.src;if(I&&I[Ut])ye(I.i,y);else{var z=y.type,H=y.proxy;I.removeEventListener?I.removeEventListener(z,H,y.capture):I.detachEvent?I.detachEvent(un(z),H):I.addListener&&I.removeListener&&I.removeListener(H),(z=re(I))?(ye(z,y),z.h==0&&(z.src=null,I[Jt]=null)):Le(y)}}}function un(y){return y in ze?ze[y]:ze[y]="on"+y}function Er(y,I){if(y.da)y=!0;else{I=new Nt(I,this);var z=y.listener,H=y.ha||y.src;y.fa&&In(y),y=z.call(H,I)}return y}function re(y){return y=y[Jt],y instanceof Zt?y:null}var Un="__closure_events_fn_"+(1e9*Math.random()>>>0);function ln(y){return typeof y=="function"?y:(y[Un]||(y[Un]=function(I){return y.handleEvent(I)}),y[Un])}function fe(){dt.call(this),this.i=new Zt(this),this.M=this,this.F=null}b(fe,dt),fe.prototype[Ut]=!0,fe.prototype.removeEventListener=function(y,I,z,H){En(this,y,I,z,H)};function le(y,I){var z,H=y.F;if(H)for(z=[];H;H=H.F)z.push(H);if(y=y.M,H=I.type||I,typeof I=="string")I=new lt(I,y);else if(I instanceof lt)I.target=I.target||y;else{var ot=I;I=new lt(H,y),D(I,ot)}if(ot=!0,z)for(var yt=z.length-1;0<=yt;yt--){var It=I.g=z[yt];ot=dn(It,H,!0,I)&&ot}if(It=I.g=y,ot=dn(It,H,!0,I)&&ot,ot=dn(It,H,!1,I)&&ot,z)for(yt=0;yt<z.length;yt++)It=I.g=z[yt],ot=dn(It,H,!1,I)&&ot}fe.prototype.N=function(){if(fe.aa.N.call(this),this.i){var y=this.i,I;for(I in y.g){for(var z=y.g[I],H=0;H<z.length;H++)Le(z[H]);delete y.g[I],y.h--}}this.F=null},fe.prototype.K=function(y,I,z,H){return this.i.add(String(y),I,!1,z,H)},fe.prototype.L=function(y,I,z,H){return this.i.add(String(y),I,!0,z,H)};function dn(y,I,z,H){if(I=y.i.g[String(I)],!I)return!0;I=I.concat();for(var ot=!0,yt=0;yt<I.length;++yt){var It=I[yt];if(It&&!It.da&&It.capture==z){var Ne=It.listener,Hn=It.ha||It.src;It.fa&&ye(y.i,It),ot=Ne.call(Hn,H)!==!1&&ot}}return ot&&!H.defaultPrevented}function Re(y,I,z){if(typeof y=="function")z&&(y=m(y,z));else if(y&&typeof y.handleEvent=="function")y=m(y.handleEvent,y);else throw Error("Invalid listener argument");return 2147483647<Number(I)?-1:u.setTimeout(y,I||0)}function Ei(y){y.g=Re(()=>{y.g=null,y.i&&(y.i=!1,Ei(y))},y.l);const I=y.h;y.h=null,y.m.apply(null,I)}class Hr extends dt{constructor(I,z){super(),this.m=I,this.l=z,this.h=null,this.i=!1,this.g=null}j(I){this.h=arguments,this.g?this.i=!0:Ei(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Fi(y){dt.call(this),this.h=y,this.g={}}b(Fi,dt);var Bi=[];function ji(y){V(y.g,function(I,z){this.g.hasOwnProperty(z)&&In(I)},y),y.g={}}Fi.prototype.N=function(){Fi.aa.N.call(this),ji(this)},Fi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var lr=u.JSON.stringify,ca=u.JSON.parse,Ui=class{stringify(y){return u.JSON.stringify(y,void 0)}parse(y){return u.JSON.parse(y,void 0)}};function hh(){}hh.prototype.h=null;function fh(y){return y.h||(y.h=y.i())}function dh(){}var qa={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ga(){lt.call(this,"d")}b(Ga,lt);function ph(){lt.call(this,"c")}b(ph,lt);var ha={},mh=null;function Uo(){return mh=mh||new fe}ha.La="serverreachability";function gl(y){lt.call(this,ha.La,y)}b(gl,lt);function Wo(y){const I=Uo();le(I,new gl(I))}ha.STAT_EVENT="statevent";function tp(y,I){lt.call(this,ha.STAT_EVENT,y),this.stat=I}b(tp,lt);function cn(y){const I=Uo();le(I,new tp(I,y))}ha.Ma="timingevent";function Wn(y,I){lt.call(this,ha.Ma,y),this.size=I}b(Wn,lt);function kn(y,I){if(typeof y!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){y()},I)}function _i(){this.g=!0}_i.prototype.xa=function(){this.g=!1};function gh(y,I,z,H,ot,yt){y.info(function(){if(y.g)if(yt)for(var It="",Ne=yt.split("&"),Hn=0;Hn<Ne.length;Hn++){var Ie=Ne[Hn].split("=");if(1<Ie.length){var Jn=Ie[0];Ie=Ie[1];var qn=Jn.split("_");It=2<=qn.length&&qn[1]=="type"?It+(Jn+"="+Ie+"&"):It+(Jn+"=redacted&")}}else It=null;else It=yt;return"XMLHTTP REQ ("+H+") [attempt "+ot+"]: "+I+`
`+z+`
`+It})}function gy(y,I,z,H,ot,yt,It){y.info(function(){return"XMLHTTP RESP ("+H+") [ attempt "+ot+"]: "+I+`
`+z+`
`+yt+" "+It})}function Ho(y,I,z,H){y.info(function(){return"XMLHTTP TEXT ("+I+"): "+Qs(y,z)+(H?" "+H:"")})}function ep(y,I){y.info(function(){return"TIMEOUT: "+I})}_i.prototype.info=function(){};function Qs(y,I){if(!y.g)return I;if(!I)return null;try{var z=JSON.parse(I);if(z){for(y=0;y<z.length;y++)if(Array.isArray(z[y])){var H=z[y];if(!(2>H.length)){var ot=H[1];if(Array.isArray(ot)&&!(1>ot.length)){var yt=ot[0];if(yt!="noop"&&yt!="stop"&&yt!="close")for(var It=1;It<ot.length;It++)ot[It]=""}}}}return lr(z)}catch{return I}}var qo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},$a={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},fa;function da(){}b(da,hh),da.prototype.g=function(){return new XMLHttpRequest},da.prototype.i=function(){return{}},fa=new da;function Or(y,I,z,H){this.j=y,this.i=I,this.l=z,this.R=H||1,this.U=new Fi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new _n}function _n(){this.i=null,this.g="",this.h=!1}var vh={},vl={};function Wi(y,I,z){y.L=1,y.v=nu(ni(I)),y.m=z,y.P=!0,Ka(y,null)}function Ka(y,I){y.F=Date.now(),Zs(y),y.A=ni(y.v);var z=y.A,H=y.R;Array.isArray(H)||(H=[String(H)]),Eh(z.i,"t",H),y.C=0,z=y.j.J,y.h=new _n,y.g=vp(y.j,z?I:null,!y.m),0<y.O&&(y.M=new Hr(m(y.Y,y,y.g),y.O)),I=y.U,z=y.g,H=y.ca;var ot="readystatechange";Array.isArray(ot)||(ot&&(Bi[0]=ot.toString()),ot=Bi);for(var yt=0;yt<ot.length;yt++){var It=Ae(z,ot[yt],H||I.handleEvent,!1,I.h||I);if(!It)break;I.g[It.key]=It}I=y.H?R(y.H):{},y.m?(y.u||(y.u="POST"),I["Content-Type"]="application/x-www-form-urlencoded",y.g.ea(y.A,y.u,y.m,I)):(y.u="GET",y.g.ea(y.A,y.u,null,I)),Wo(),gh(y.i,y.u,y.A,y.l,y.R,y.m)}Or.prototype.ca=function(y){y=y.target;const I=this.M;I&&Ri(y)==3?I.j():this.Y(y)},Or.prototype.Y=function(y){try{if(y==this.g)t:{const qn=Ri(this.g);var I=this.g.Ba();const no=this.g.Z();if(!(3>qn)&&(qn!=3||this.g&&(this.h.h||this.g.oa()||lp(this.g)))){this.J||qn!=4||I==7||(I==8||0>=no?Wo(3):Wo(2)),Go(this);var z=this.g.Z();this.X=z;e:if(np(this)){var H=lp(this.g);y="";var ot=H.length,yt=Ri(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){cr(this),pa(this);var It="";break e}this.h.i=new u.TextDecoder}for(I=0;I<ot;I++)this.h.h=!0,y+=this.h.i.decode(H[I],{stream:!(yt&&I==ot-1)});H.length=0,this.h.g+=y,this.C=0,It=this.h.g}else It=this.g.oa();if(this.o=z==200,gy(this.i,this.u,this.A,this.l,this.R,qn,z),this.o){if(this.T&&!this.K){e:{if(this.g){var Ne,Hn=this.g;if((Ne=Hn.g?Hn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(Ne)){var Ie=Ne;break e}}Ie=null}if(z=Ie)Ho(this.i,this.l,z,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Js(this,z);else{this.o=!1,this.s=3,cn(12),cr(this),pa(this);break t}}if(this.P){z=!0;let hr;for(;!this.J&&this.C<It.length;)if(hr=rp(this,It),hr==vl){qn==4&&(this.s=4,cn(14),z=!1),Ho(this.i,this.l,null,"[Incomplete Response]");break}else if(hr==vh){this.s=4,cn(15),Ho(this.i,this.l,It,"[Invalid Chunk]"),z=!1;break}else Ho(this.i,this.l,hr,null),Js(this,hr);if(np(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),qn!=4||It.length!=0||this.h.h||(this.s=1,cn(16),z=!1),this.o=this.o&&z,!z)Ho(this.i,this.l,It,"[Invalid Chunked Response]"),cr(this),pa(this);else if(0<It.length&&!this.W){this.W=!0;var Jn=this.j;Jn.g==this&&Jn.ba&&!Jn.M&&(Jn.j.info("Great, no buffering proxy detected. Bytes received: "+It.length),cu(Jn),Jn.M=!0,cn(11))}}else Ho(this.i,this.l,It,null),Js(this,It);qn==4&&cr(this),this.o&&!this.J&&(qn==4?pp(this.j,this):(this.o=!1,Zs(this)))}else wy(this.g),z==400&&0<It.indexOf("Unknown SID")?(this.s=3,cn(12)):(this.s=0,cn(13)),cr(this),pa(this)}}}catch{}finally{}};function np(y){return y.g?y.u=="GET"&&y.L!=2&&y.j.Ca:!1}function rp(y,I){var z=y.C,H=I.indexOf(`
`,z);return H==-1?vl:(z=Number(I.substring(z,H)),isNaN(z)?vh:(H+=1,H+z>I.length?vl:(I=I.slice(H,H+z),y.C=H+z,I)))}Or.prototype.cancel=function(){this.J=!0,cr(this)};function Zs(y){y.S=Date.now()+y.I,ip(y,y.I)}function ip(y,I){if(y.B!=null)throw Error("WatchDog timer not null");y.B=kn(m(y.ba,y),I)}function Go(y){y.B&&(u.clearTimeout(y.B),y.B=null)}Or.prototype.ba=function(){this.B=null;const y=Date.now();0<=y-this.S?(ep(this.i,this.A),this.L!=2&&(Wo(),cn(17)),cr(this),this.s=2,pa(this)):ip(this,this.S-y)};function pa(y){y.j.G==0||y.J||pp(y.j,y)}function cr(y){Go(y);var I=y.M;I&&typeof I.ma=="function"&&I.ma(),y.M=null,ji(y.U),y.g&&(I=y.g,y.g=null,I.abort(),I.ma())}function Js(y,I){try{var z=y.j;if(z.G!=0&&(z.g==y||yh(z.h,y))){if(!y.K&&yh(z.h,y)&&z.G==3){try{var H=z.Da.g.parse(I)}catch{H=null}if(Array.isArray(H)&&H.length==3){var ot=H;if(ot[0]==0){t:if(!z.u){if(z.g)if(z.g.F+3e3<y.F)Nl(z),Al(z);else break t;Rh(z),cn(18)}}else z.za=ot[1],0<z.za-z.T&&37500>ot[2]&&z.F&&z.v==0&&!z.C&&(z.C=kn(m(z.Za,z),6e3));if(1>=bl(z.h)&&z.ca){try{z.ca()}catch{}z.ca=void 0}}else eo(z,11)}else if((y.K||z.g==y)&&Nl(z),!S(I))for(ot=z.Da.g.parse(I),I=0;I<ot.length;I++){let Ie=ot[I];if(z.T=Ie[0],Ie=Ie[1],z.G==2)if(Ie[0]=="c"){z.K=Ie[1],z.ia=Ie[2];const Jn=Ie[3];Jn!=null&&(z.la=Jn,z.j.info("VER="+z.la));const qn=Ie[4];qn!=null&&(z.Aa=qn,z.j.info("SVER="+z.Aa));const no=Ie[5];no!=null&&typeof no=="number"&&0<no&&(H=1.5*no,z.L=H,z.j.info("backChannelRequestTimeoutMs_="+H)),H=z;const hr=y.g;if(hr){const wa=hr.g?hr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(wa){var yt=H.h;yt.g||wa.indexOf("spdy")==-1&&wa.indexOf("quic")==-1&&wa.indexOf("h2")==-1||(yt.j=yt.l,yt.g=new Set,yt.h&&(xl(yt,yt.h),yt.h=null))}if(H.D){const Ih=hr.g?hr.g.getResponseHeader("X-HTTP-Session-Id"):null;Ih&&(H.ya=Ih,Xe(H.I,H.D,Ih))}}z.G=3,z.l&&z.l.ua(),z.ba&&(z.R=Date.now()-y.F,z.j.info("Handshake RTT: "+z.R+"ms")),H=z;var It=y;if(H.qa=gp(H,H.J?H.ia:null,H.W),It.K){Mr(H.h,It);var Ne=It,Hn=H.L;Hn&&(Ne.I=Hn),Ne.B&&(Go(Ne),Zs(Ne)),H.g=It}else fp(H);0<z.i.length&&Rl(z)}else Ie[0]!="stop"&&Ie[0]!="close"||eo(z,7);else z.G==3&&(Ie[0]=="stop"||Ie[0]=="close"?Ie[0]=="stop"?eo(z,7):Sh(z):Ie[0]!="noop"&&z.l&&z.l.ta(Ie),z.v=0)}}Wo(4)}catch{}}var ap=class{constructor(y,I){this.g=y,this.map=I}};function Xa(y){this.l=y||10,u.PerformanceNavigationTiming?(y=u.performance.getEntriesByType("navigation"),y=0<y.length&&(y[0].nextHopProtocol=="hq"||y[0].nextHopProtocol=="h2")):y=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=y?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function yl(y){return y.h?!0:y.g?y.g.size>=y.j:!1}function bl(y){return y.h?1:y.g?y.g.size:0}function yh(y,I){return y.h?y.h==I:y.g?y.g.has(I):!1}function xl(y,I){y.g?y.g.add(I):y.h=I}function Mr(y,I){y.h&&y.h==I?y.h=null:y.g&&y.g.has(I)&&y.g.delete(I)}Xa.prototype.cancel=function(){if(this.i=bh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const y of this.g.values())y.cancel();this.g.clear()}};function bh(y){if(y.h!=null)return y.i.concat(y.h.D);if(y.g!=null&&y.g.size!==0){let I=y.i;for(const z of y.g.values())I=I.concat(z.D);return I}return C(y.i)}function vy(y){if(y.V&&typeof y.V=="function")return y.V();if(typeof Map<"u"&&y instanceof Map||typeof Set<"u"&&y instanceof Set)return Array.from(y.values());if(typeof y=="string")return y.split("");if(l(y)){for(var I=[],z=y.length,H=0;H<z;H++)I.push(y[H]);return I}I=[],z=0;for(H in y)I[z++]=y[H];return I}function wl(y){if(y.na&&typeof y.na=="function")return y.na();if(!y.V||typeof y.V!="function"){if(typeof Map<"u"&&y instanceof Map)return Array.from(y.keys());if(!(typeof Set<"u"&&y instanceof Set)){if(l(y)||typeof y=="string"){var I=[];y=y.length;for(var z=0;z<y;z++)I.push(z);return I}I=[],z=0;for(const H in y)I[z++]=H;return I}}}function xh(y,I){if(y.forEach&&typeof y.forEach=="function")y.forEach(I,void 0);else if(l(y)||typeof y=="string")Array.prototype.forEach.call(y,I,void 0);else for(var z=wl(y),H=vy(y),ot=H.length,yt=0;yt<ot;yt++)I.call(void 0,H[yt],z&&z[yt],y)}var tu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function yy(y,I){if(y){y=y.split("&");for(var z=0;z<y.length;z++){var H=y[z].indexOf("="),ot=null;if(0<=H){var yt=y[z].substring(0,H);ot=y[z].substring(H+1)}else yt=y[z];I(yt,ot?decodeURIComponent(ot.replace(/\+/g," ")):"")}}}function Dn(y){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,y instanceof Dn){this.h=y.h,eu(this,y.j),this.o=y.o,this.g=y.g,$o(this,y.s),this.l=y.l;var I=y.i,z=new Qa;z.i=I.i,I.g&&(z.g=new Map(I.g),z.h=I.h),Ya(this,z),this.m=y.m}else y&&(I=String(y).match(tu))?(this.h=!1,eu(this,I[1]||"",!0),this.o=Ti(I[2]||""),this.g=Ti(I[3]||"",!0),$o(this,I[4]),this.l=Ti(I[5]||"",!0),Ya(this,I[6]||"",!0),this.m=Ti(I[7]||"")):(this.h=!1,this.i=new Qa(null,this.h))}Dn.prototype.toString=function(){var y=[],I=this.j;I&&y.push(ru(I,wh,!0),":");var z=this.g;return(z||I=="file")&&(y.push("//"),(I=this.o)&&y.push(ru(I,wh,!0),"@"),y.push(encodeURIComponent(String(z)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),z=this.s,z!=null&&y.push(":",String(z))),(z=this.l)&&(this.g&&z.charAt(0)!="/"&&y.push("/"),y.push(ru(z,z.charAt(0)=="/"?by:Ch,!0))),(z=this.i.toString())&&y.push("?",z),(z=this.m)&&y.push("#",ru(z,Cl)),y.join("")};function ni(y){return new Dn(y)}function eu(y,I,z){y.j=z?Ti(I,!0):I,y.j&&(y.j=y.j.replace(/:$/,""))}function $o(y,I){if(I){if(I=Number(I),isNaN(I)||0>I)throw Error("Bad port number "+I);y.s=I}else y.s=null}function Ya(y,I,z){I instanceof Qa?(y.i=I,sp(y.i,y.h)):(z||(I=ru(I,xy)),y.i=new Qa(I,y.h))}function Xe(y,I,z){y.i.set(I,z)}function nu(y){return Xe(y,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),y}function Ti(y,I){return y?I?decodeURI(y.replace(/%25/g,"%2525")):decodeURIComponent(y):""}function ru(y,I,z){return typeof y=="string"?(y=encodeURI(y).replace(I,op),z&&(y=y.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y):null}function op(y){return y=y.charCodeAt(0),"%"+(y>>4&15).toString(16)+(y&15).toString(16)}var wh=/[#\/\?@]/g,Ch=/[#\?:]/g,by=/[#\?]/g,xy=/[#\?@]/g,Cl=/#/g;function Qa(y,I){this.h=this.g=null,this.i=y||null,this.j=!!I}function Si(y){y.g||(y.g=new Map,y.h=0,y.i&&yy(y.i,function(I,z){y.add(decodeURIComponent(I.replace(/\+/g," ")),z)}))}r=Qa.prototype,r.add=function(y,I){Si(this),this.i=null,y=ma(this,y);var z=this.g.get(y);return z||this.g.set(y,z=[]),z.push(I),this.h+=1,this};function Za(y,I){Si(y),I=ma(y,I),y.g.has(I)&&(y.i=null,y.h-=y.g.get(I).length,y.g.delete(I))}function Ja(y,I){return Si(y),I=ma(y,I),y.g.has(I)}r.forEach=function(y,I){Si(this),this.g.forEach(function(z,H){z.forEach(function(ot){y.call(I,ot,H,this)},this)},this)},r.na=function(){Si(this);const y=Array.from(this.g.values()),I=Array.from(this.g.keys()),z=[];for(let H=0;H<I.length;H++){const ot=y[H];for(let yt=0;yt<ot.length;yt++)z.push(I[H])}return z},r.V=function(y){Si(this);let I=[];if(typeof y=="string")Ja(this,y)&&(I=I.concat(this.g.get(ma(this,y))));else{y=Array.from(this.g.values());for(let z=0;z<y.length;z++)I=I.concat(y[z])}return I},r.set=function(y,I){return Si(this),this.i=null,y=ma(this,y),Ja(this,y)&&(this.h-=this.g.get(y).length),this.g.set(y,[I]),this.h+=1,this},r.get=function(y,I){return y?(y=this.V(y),0<y.length?String(y[0]):I):I};function Eh(y,I,z){Za(y,I),0<z.length&&(y.i=null,y.g.set(ma(y,I),C(z)),y.h+=z.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const y=[],I=Array.from(this.g.keys());for(var z=0;z<I.length;z++){var H=I[z];const yt=encodeURIComponent(String(H)),It=this.V(H);for(H=0;H<It.length;H++){var ot=yt;It[H]!==""&&(ot+="="+encodeURIComponent(String(It[H]))),y.push(ot)}}return this.i=y.join("&")};function ma(y,I){return I=String(I),y.j&&(I=I.toLowerCase()),I}function sp(y,I){I&&!y.j&&(Si(y),y.i=null,y.g.forEach(function(z,H){var ot=H.toLowerCase();H!=ot&&(Za(this,H),Eh(this,ot,z))},y)),y.j=I}function iu(y,I){const z=new _i;if(u.Image){const H=new Image;H.onload=v(Ai,z,"TestLoadImage: loaded",!0,I,H),H.onerror=v(Ai,z,"TestLoadImage: error",!1,I,H),H.onabort=v(Ai,z,"TestLoadImage: abort",!1,I,H),H.ontimeout=v(Ai,z,"TestLoadImage: timeout",!1,I,H),u.setTimeout(function(){H.ontimeout&&H.ontimeout()},1e4),H.src=y}else I(!1)}function Hi(y,I){const z=new _i,H=new AbortController,ot=setTimeout(()=>{H.abort(),Ai(z,"TestPingServer: timeout",!1,I)},1e4);fetch(y,{signal:H.signal}).then(yt=>{clearTimeout(ot),yt.ok?Ai(z,"TestPingServer: ok",!0,I):Ai(z,"TestPingServer: server error",!1,I)}).catch(()=>{clearTimeout(ot),Ai(z,"TestPingServer: error",!1,I)})}function Ai(y,I,z,H,ot){try{ot&&(ot.onload=null,ot.onerror=null,ot.onabort=null,ot.ontimeout=null),H(z)}catch{}}function au(){this.g=new Ui}function ga(y,I,z){const H=z||"";try{xh(y,function(ot,yt){let It=ot;h(ot)&&(It=lr(ot)),I.push(H+yt+"="+encodeURIComponent(It))})}catch(ot){throw I.push(H+"type="+encodeURIComponent("_badmap")),ot}}function Ko(y){this.l=y.Ub||null,this.j=y.eb||!1}b(Ko,hh),Ko.prototype.g=function(){return new to(this.l,this.j)},Ko.prototype.i=function(y){return function(){return y}}({});function to(y,I){fe.call(this),this.D=y,this.o=I,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}b(to,fe),r=to.prototype,r.open=function(y,I){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=y,this.A=I,this.readyState=1,ya(this)},r.send=function(y){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const I={headers:this.u,method:this.B,credentials:this.m,cache:void 0};y&&(I.body=y),(this.D||u).fetch(new Request(this.A,I)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,va(this)),this.readyState=0},r.Sa=function(y){if(this.g&&(this.l=y,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=y.headers,this.readyState=2,ya(this)),this.g&&(this.readyState=3,ya(this),this.g)))if(this.responseType==="arraybuffer")y.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in y){if(this.j=y.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;_h(this)}else y.text().then(this.Ra.bind(this),this.ga.bind(this))};function _h(y){y.j.read().then(y.Pa.bind(y)).catch(y.ga.bind(y))}r.Pa=function(y){if(this.g){if(this.o&&y.value)this.response.push(y.value);else if(!this.o){var I=y.value?y.value:new Uint8Array(0);(I=this.v.decode(I,{stream:!y.done}))&&(this.response=this.responseText+=I)}y.done?va(this):ya(this),this.readyState==3&&_h(this)}},r.Ra=function(y){this.g&&(this.response=this.responseText=y,va(this))},r.Qa=function(y){this.g&&(this.response=y,va(this))},r.ga=function(){this.g&&va(this)};function va(y){y.readyState=4,y.l=null,y.j=null,y.v=null,ya(y)}r.setRequestHeader=function(y,I){this.u.append(y,I)},r.getResponseHeader=function(y){return this.h&&this.h.get(y.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const y=[],I=this.h.entries();for(var z=I.next();!z.done;)z=z.value,y.push(z[0]+": "+z[1]),z=I.next();return y.join(`\r
`)};function ya(y){y.onreadystatechange&&y.onreadystatechange.call(y)}Object.defineProperty(to.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(y){this.m=y?"include":"same-origin"}});function Th(y){let I="";return V(y,function(z,H){I+=H,I+=":",I+=z,I+=`\r
`}),I}function Zn(y,I,z){t:{for(H in z){var H=!1;break t}H=!0}H||(z=Th(z),typeof y=="string"?z!=null&&encodeURIComponent(String(z)):Xe(y,I,z))}function je(y){fe.call(this),this.headers=new Map,this.o=y||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}b(je,fe);var El=/^https?$/i,ou=["POST","PUT"];r=je.prototype,r.Ha=function(y){this.J=y},r.ea=function(y,I,z,H){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+y);I=I?I.toUpperCase():"GET",this.D=y,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():fa.g(),this.v=this.o?fh(this.o):fh(fa),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(I,String(y),!0),this.B=!1}catch(yt){up(this,yt);return}if(y=z||"",z=new Map(this.headers),H)if(Object.getPrototypeOf(H)===Object.prototype)for(var ot in H)z.set(ot,H[ot]);else if(typeof H.keys=="function"&&typeof H.get=="function")for(const yt of H.keys())z.set(yt,H.get(yt));else throw Error("Unknown input type for opt_headers: "+String(H));H=Array.from(z.keys()).find(yt=>yt.toLowerCase()=="content-type"),ot=u.FormData&&y instanceof u.FormData,!(0<=Array.prototype.indexOf.call(ou,I,void 0))||H||ot||z.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[yt,It]of z)this.g.setRequestHeader(yt,It);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{su(this),this.u=!0,this.g.send(y),this.u=!1}catch(yt){up(this,yt)}};function up(y,I){y.h=!1,y.g&&(y.j=!0,y.g.abort(),y.j=!1),y.l=I,y.m=5,_l(y),ba(y)}function _l(y){y.A||(y.A=!0,le(y,"complete"),le(y,"error"))}r.abort=function(y){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=y||7,le(this,"complete"),le(this,"abort"),ba(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ba(this,!0)),je.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Tl(this):this.bb())},r.bb=function(){Tl(this)};function Tl(y){if(y.h&&typeof o<"u"&&(!y.v[1]||Ri(y)!=4||y.Z()!=2)){if(y.u&&Ri(y)==4)Re(y.Ea,0,y);else if(le(y,"readystatechange"),Ri(y)==4){y.h=!1;try{const It=y.Z();t:switch(It){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var I=!0;break t;default:I=!1}var z;if(!(z=I)){var H;if(H=It===0){var ot=String(y.D).match(tu)[1]||null;!ot&&u.self&&u.self.location&&(ot=u.self.location.protocol.slice(0,-1)),H=!El.test(ot?ot.toLowerCase():"")}z=H}if(z)le(y,"complete"),le(y,"success");else{y.m=6;try{var yt=2<Ri(y)?y.g.statusText:""}catch{yt=""}y.l=yt+" ["+y.Z()+"]",_l(y)}}finally{ba(y)}}}}function ba(y,I){if(y.g){su(y);const z=y.g,H=y.v[0]?()=>{}:null;y.g=null,y.v=null,I||le(y,"ready");try{z.onreadystatechange=H}catch{}}}function su(y){y.I&&(u.clearTimeout(y.I),y.I=null)}r.isActive=function(){return!!this.g};function Ri(y){return y.g?y.g.readyState:0}r.Z=function(){try{return 2<Ri(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(y){if(this.g){var I=this.g.responseText;return y&&I.indexOf(y)==0&&(I=I.substring(y.length)),ca(I)}};function lp(y){try{if(!y.g)return null;if("response"in y.g)return y.g.response;switch(y.H){case"":case"text":return y.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in y.g)return y.g.mozResponseArrayBuffer}return null}catch{return null}}function wy(y){const I={};y=(y.g&&2<=Ri(y)&&y.g.getAllResponseHeaders()||"").split(`\r
`);for(let H=0;H<y.length;H++){if(S(y[H]))continue;var z=L(y[H]);const ot=z[0];if(z=z[1],typeof z!="string")continue;z=z.trim();const yt=I[ot]||[];I[ot]=yt,yt.push(z)}T(I,function(H){return H.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function uu(y,I,z){return z&&z.internalChannelParams&&z.internalChannelParams[y]||I}function Sl(y){this.Aa=0,this.i=[],this.j=new _i,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=uu("failFast",!1,y),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=uu("baseRetryDelayMs",5e3,y),this.cb=uu("retryDelaySeedMs",1e4,y),this.Wa=uu("forwardChannelMaxRetries",2,y),this.wa=uu("forwardChannelRequestTimeoutMs",2e4,y),this.pa=y&&y.xmlHttpFactory||void 0,this.Xa=y&&y.Tb||void 0,this.Ca=y&&y.useFetchStreams||!1,this.L=void 0,this.J=y&&y.supportsCrossDomainXhr||!1,this.K="",this.h=new Xa(y&&y.concurrentRequestLimit),this.Da=new au,this.P=y&&y.fastHandshake||!1,this.O=y&&y.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=y&&y.Rb||!1,y&&y.xa&&this.j.xa(),y&&y.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&y&&y.detectBufferingProxy||!1,this.ja=void 0,y&&y.longPollingTimeout&&0<y.longPollingTimeout&&(this.ja=y.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Sl.prototype,r.la=8,r.G=1,r.connect=function(y,I,z,H){cn(0),this.W=y,this.H=I||{},z&&H!==void 0&&(this.H.OSID=z,this.H.OAID=H),this.F=this.X,this.I=gp(this,null,this.W),Rl(this)};function Sh(y){if(cp(y),y.G==3){var I=y.U++,z=ni(y.I);if(Xe(z,"SID",y.K),Xe(z,"RID",I),Xe(z,"TYPE","terminate"),lu(y,z),I=new Or(y,y.j,I),I.L=2,I.v=nu(ni(z)),z=!1,u.navigator&&u.navigator.sendBeacon)try{z=u.navigator.sendBeacon(I.v.toString(),"")}catch{}!z&&u.Image&&(new Image().src=I.v,z=!0),z||(I.g=vp(I.j,null),I.g.ea(I.v)),I.F=Date.now(),Zs(I)}mp(y)}function Al(y){y.g&&(cu(y),y.g.cancel(),y.g=null)}function cp(y){Al(y),y.u&&(u.clearTimeout(y.u),y.u=null),Nl(y),y.h.cancel(),y.s&&(typeof y.s=="number"&&u.clearTimeout(y.s),y.s=null)}function Rl(y){if(!yl(y.h)&&!y.s){y.s=!0;var I=y.Ga;K||W(),Q||(K(),Q=!0),ut.add(I,y),y.B=0}}function Cy(y,I){return bl(y.h)>=y.h.j-(y.s?1:0)?!1:y.s?(y.i=I.D.concat(y.i),!0):y.G==1||y.G==2||y.B>=(y.Va?0:y.Wa)?!1:(y.s=kn(m(y.Ga,y,I),Nh(y,y.B)),y.B++,!0)}r.Ga=function(y){if(this.s)if(this.s=null,this.G==1){if(!y){this.U=Math.floor(1e5*Math.random()),y=this.U++;const ot=new Or(this,this.j,y);let yt=this.o;if(this.S&&(yt?(yt=R(yt),D(yt,this.S)):yt=this.S),this.m!==null||this.O||(ot.H=yt,yt=null),this.P)t:{for(var I=0,z=0;z<this.i.length;z++){e:{var H=this.i[z];if("__data__"in H.map&&(H=H.map.__data__,typeof H=="string")){H=H.length;break e}H=void 0}if(H===void 0)break;if(I+=H,4096<I){I=z;break t}if(I===4096||z===this.i.length-1){I=z+1;break t}}I=1e3}else I=1e3;I=hp(this,ot,I),z=ni(this.I),Xe(z,"RID",y),Xe(z,"CVER",22),this.D&&Xe(z,"X-HTTP-Session-Id",this.D),lu(this,z),yt&&(this.O?I="headers="+encodeURIComponent(String(Th(yt)))+"&"+I:this.m&&Zn(z,this.m,yt)),xl(this.h,ot),this.Ua&&Xe(z,"TYPE","init"),this.P?(Xe(z,"$req",I),Xe(z,"SID","null"),ot.T=!0,Wi(ot,z,null)):Wi(ot,z,I),this.G=2}}else this.G==3&&(y?Ah(this,y):this.i.length==0||yl(this.h)||Ah(this))};function Ah(y,I){var z;I?z=I.l:z=y.U++;const H=ni(y.I);Xe(H,"SID",y.K),Xe(H,"RID",z),Xe(H,"AID",y.T),lu(y,H),y.m&&y.o&&Zn(H,y.m,y.o),z=new Or(y,y.j,z,y.B+1),y.m===null&&(z.H=y.o),I&&(y.i=I.D.concat(y.i)),I=hp(y,z,1e3),z.I=Math.round(.5*y.wa)+Math.round(.5*y.wa*Math.random()),xl(y.h,z),Wi(z,H,I)}function lu(y,I){y.H&&V(y.H,function(z,H){Xe(I,H,z)}),y.l&&xh({},function(z,H){Xe(I,H,z)})}function hp(y,I,z){z=Math.min(y.i.length,z);var H=y.l?m(y.l.Na,y.l,y):null;t:{var ot=y.i;let yt=-1;for(;;){const It=["count="+z];yt==-1?0<z?(yt=ot[0].g,It.push("ofs="+yt)):yt=0:It.push("ofs="+yt);let Ne=!0;for(let Hn=0;Hn<z;Hn++){let Ie=ot[Hn].g;const Jn=ot[Hn].map;if(Ie-=yt,0>Ie)yt=Math.max(0,ot[Hn].g-100),Ne=!1;else try{ga(Jn,It,"req"+Ie+"_")}catch{H&&H(Jn)}}if(Ne){H=It.join("&");break t}}}return y=y.i.splice(0,z),I.D=y,H}function fp(y){if(!y.g&&!y.u){y.Y=1;var I=y.Fa;K||W(),Q||(K(),Q=!0),ut.add(I,y),y.v=0}}function Rh(y){return y.g||y.u||3<=y.v?!1:(y.Y++,y.u=kn(m(y.Fa,y),Nh(y,y.v)),y.v++,!0)}r.Fa=function(){if(this.u=null,dp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var y=2*this.R;this.j.info("BP detection timer enabled: "+y),this.A=kn(m(this.ab,this),y)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,cn(10),Al(this),dp(this))};function cu(y){y.A!=null&&(u.clearTimeout(y.A),y.A=null)}function dp(y){y.g=new Or(y,y.j,"rpc",y.Y),y.m===null&&(y.g.H=y.o),y.g.O=0;var I=ni(y.qa);Xe(I,"RID","rpc"),Xe(I,"SID",y.K),Xe(I,"AID",y.T),Xe(I,"CI",y.F?"0":"1"),!y.F&&y.ja&&Xe(I,"TO",y.ja),Xe(I,"TYPE","xmlhttp"),lu(y,I),y.m&&y.o&&Zn(I,y.m,y.o),y.L&&(y.g.I=y.L);var z=y.g;y=y.ia,z.L=1,z.v=nu(ni(I)),z.m=null,z.P=!0,Ka(z,y)}r.Za=function(){this.C!=null&&(this.C=null,Al(this),Rh(this),cn(19))};function Nl(y){y.C!=null&&(u.clearTimeout(y.C),y.C=null)}function pp(y,I){var z=null;if(y.g==I){Nl(y),cu(y),y.g=null;var H=2}else if(yh(y.h,I))z=I.D,Mr(y.h,I),H=1;else return;if(y.G!=0){if(I.o)if(H==1){z=I.m?I.m.length:0,I=Date.now()-I.F;var ot=y.B;H=Uo(),le(H,new Wn(H,z)),Rl(y)}else fp(y);else if(ot=I.s,ot==3||ot==0&&0<I.X||!(H==1&&Cy(y,I)||H==2&&Rh(y)))switch(z&&0<z.length&&(I=y.h,I.i=I.i.concat(z)),ot){case 1:eo(y,5);break;case 4:eo(y,10);break;case 3:eo(y,6);break;default:eo(y,2)}}}function Nh(y,I){let z=y.Ta+Math.floor(Math.random()*y.cb);return y.isActive()||(z*=2),z*I}function eo(y,I){if(y.j.info("Error code "+I),I==2){var z=m(y.fb,y),H=y.Xa;const ot=!H;H=new Dn(H||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||eu(H,"https"),nu(H),ot?iu(H.toString(),z):Hi(H.toString(),z)}else cn(2);y.G=0,y.l&&y.l.sa(I),mp(y),cp(y)}r.fb=function(y){y?(this.j.info("Successfully pinged google.com"),cn(2)):(this.j.info("Failed to ping google.com"),cn(1))};function mp(y){if(y.G=0,y.ka=[],y.l){const I=bh(y.h);(I.length!=0||y.i.length!=0)&&(w(y.ka,I),w(y.ka,y.i),y.h.i.length=0,C(y.i),y.i.length=0),y.l.ra()}}function gp(y,I,z){var H=z instanceof Dn?ni(z):new Dn(z);if(H.g!="")I&&(H.g=I+"."+H.g),$o(H,H.s);else{var ot=u.location;H=ot.protocol,I=I?I+"."+ot.hostname:ot.hostname,ot=+ot.port;var yt=new Dn(null);H&&eu(yt,H),I&&(yt.g=I),ot&&$o(yt,ot),z&&(yt.l=z),H=yt}return z=y.D,I=y.ya,z&&I&&Xe(H,z,I),Xe(H,"VER",y.la),lu(y,H),H}function vp(y,I,z){if(I&&!y.J)throw Error("Can't create secondary domain capable XhrIo object.");return I=y.Ca&&!y.pa?new je(new Ko({eb:z})):new je(y.pa),I.Ha(y.J),I}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function yp(){}r=yp.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Il(){}Il.prototype.g=function(y,I){return new Lr(y,I)};function Lr(y,I){fe.call(this),this.g=new Sl(I),this.l=y,this.h=I&&I.messageUrlParams||null,y=I&&I.messageHeaders||null,I&&I.clientProtocolHeaderRequired&&(y?y["X-Client-Protocol"]="webchannel":y={"X-Client-Protocol":"webchannel"}),this.g.o=y,y=I&&I.initMessageHeaders||null,I&&I.messageContentType&&(y?y["X-WebChannel-Content-Type"]=I.messageContentType:y={"X-WebChannel-Content-Type":I.messageContentType}),I&&I.va&&(y?y["X-WebChannel-Client-Profile"]=I.va:y={"X-WebChannel-Client-Profile":I.va}),this.g.S=y,(y=I&&I.Sb)&&!S(y)&&(this.g.m=y),this.v=I&&I.supportsCrossDomainXhr||!1,this.u=I&&I.sendRawJson||!1,(I=I&&I.httpSessionIdParam)&&!S(I)&&(this.g.D=I,y=this.h,y!==null&&I in y&&(y=this.h,I in y&&delete y[I])),this.j=new xa(this)}b(Lr,fe),Lr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Lr.prototype.close=function(){Sh(this.g)},Lr.prototype.o=function(y){var I=this.g;if(typeof y=="string"){var z={};z.__data__=y,y=z}else this.u&&(z={},z.__data__=lr(y),y=z);I.i.push(new ap(I.Ya++,y)),I.G==3&&Rl(I)},Lr.prototype.N=function(){this.g.l=null,delete this.j,Sh(this.g),delete this.g,Lr.aa.N.call(this)};function bp(y){Ga.call(this),y.__headers__&&(this.headers=y.__headers__,this.statusCode=y.__status__,delete y.__headers__,delete y.__status__);var I=y.__sm__;if(I){t:{for(const z in I){y=z;break t}y=void 0}(this.i=y)&&(y=this.i,I=I!==null&&y in I?I[y]:void 0),this.data=I}else this.data=y}b(bp,Ga);function xp(){ph.call(this),this.status=1}b(xp,ph);function xa(y){this.g=y}b(xa,yp),xa.prototype.ua=function(){le(this.g,"a")},xa.prototype.ta=function(y){le(this.g,new bp(y))},xa.prototype.sa=function(y){le(this.g,new xp)},xa.prototype.ra=function(){le(this.g,"b")},Il.prototype.createWebChannel=Il.prototype.g,Lr.prototype.send=Lr.prototype.o,Lr.prototype.open=Lr.prototype.m,Lr.prototype.close=Lr.prototype.close,TA=function(){return new Il},_A=function(){return Uo()},EA=ha,pb={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},qo.NO_ERROR=0,qo.TIMEOUT=8,qo.HTTP_ERROR=6,qm=qo,$a.COMPLETE="complete",CA=$a,dh.EventType=qa,qa.OPEN="a",qa.CLOSE="b",qa.ERROR="c",qa.MESSAGE="d",fe.prototype.listen=fe.prototype.K,Rf=dh,je.prototype.listenOnce=je.prototype.L,je.prototype.getLastError=je.prototype.Ka,je.prototype.getLastErrorCode=je.prototype.Ba,je.prototype.getStatus=je.prototype.Z,je.prototype.getResponseJson=je.prototype.Oa,je.prototype.getResponseText=je.prototype.oa,je.prototype.send=je.prototype.ea,je.prototype.setWithCredentials=je.prototype.Ha,wA=je}).apply(typeof Cm<"u"?Cm:typeof self<"u"?self:typeof window<"u"?window:{});const gT="@firebase/firestore",vT="4.7.17";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ar.UNAUTHENTICATED=new Ar(null),Ar.GOOGLE_CREDENTIALS=new Ar("google-credentials-uid"),Ar.FIRST_PARTY=new Ar("first-party-uid"),Ar.MOCK_USER=new Ar("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gc="11.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $u=new pA("@firebase/firestore");function sc(){return $u.logLevel}function Ot(r,...e){if($u.logLevel<=Oe.DEBUG){const t=e.map(L2);$u.debug(`Firestore (${Gc}): ${r}`,...t)}}function Io(r,...e){if($u.logLevel<=Oe.ERROR){const t=e.map(L2);$u.error(`Firestore (${Gc}): ${r}`,...t)}}function Cc(r,...e){if($u.logLevel<=Oe.WARN){const t=e.map(L2);$u.warn(`Firestore (${Gc}): ${r}`,...t)}}function L2(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yt(r,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,SA(r,n,t)}function SA(r,e,t){let n=`FIRESTORE (${Gc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw Io(n),new Error(n)}function We(r,e,t,n){let i="Unexpected state";typeof t=="string"?i=t:n=t,r||SA(e,i,n)}function oe(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _t={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Lt extends qc{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AA{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class X8{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ar.UNAUTHENTICATED))}shutdown(){}}class Y8{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Q8{constructor(e){this.t=e,this.currentUser=Ar.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){We(this.o===void 0,42304);let n=this.i;const i=l=>this.i!==n?(n=this.i,t(l)):Promise.resolve();let a=new Ss;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Ss,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const l=a;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},u=l=>{Ot("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?u(l):(Ot("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Ss)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(Ot("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(We(typeof n.accessToken=="string",31837,{l:n}),new AA(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return We(e===null||typeof e=="string",2055,{h:e}),new Ar(e)}}class Z8{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Ar.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class J8{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Z8(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Ar.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class yT{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tL{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,D8(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){We(this.o===void 0,3512);const n=a=>{a.error!=null&&Ot("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const o=a.token!==this.m;return this.m=a.token,Ot("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable(()=>n(a))};const i=a=>{Ot("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(a=>i(a)),setTimeout(()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?i(a):Ot("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new yT(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(We(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new yT(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eL(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RA(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NA{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const i=eL(40);for(let a=0;a<i.length;++a)n.length<20&&i[a]<t&&(n+=e.charAt(i[a]%62))}return n}}function ve(r,e){return r<e?-1:r>e?1:0}function mb(r,e){let t=0;for(;t<r.length&&t<e.length;){const n=r.codePointAt(t),i=e.codePointAt(t);if(n!==i){if(n<128&&i<128)return ve(n,i);{const a=RA(),o=nL(a.encode(bT(r,t)),a.encode(bT(e,t)));return o!==0?o:ve(n,i)}}t+=n>65535?2:1}return ve(r.length,e.length)}function bT(r,e){return r.codePointAt(e)>65535?r.substring(e,e+2):r.substring(e,e+1)}function nL(r,e){for(let t=0;t<r.length&&t<e.length;++t)if(r[t]!==e[t])return ve(r[t],e[t]);return ve(r.length,e.length)}function Ec(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT=-62135596800,wT=1e6;class Xn{static now(){return Xn.fromMillis(Date.now())}static fromDate(e){return Xn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*wT);return new Xn(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Lt(_t.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Lt(_t.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<xT)throw new Lt(_t.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Lt(_t.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/wT}_compareTo(e){return this.seconds===e.seconds?ve(this.nanoseconds,e.nanoseconds):ve(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-xT;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ae{static fromTimestamp(e){return new ae(e)}static min(){return new ae(new Xn(0,0))}static max(){return new ae(new Xn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CT="__name__";class Aa{constructor(e,t,n){t===void 0?t=0:t>e.length&&Yt(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&Yt(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return Aa.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Aa?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const a=Aa.compareSegments(e.get(i),t.get(i));if(a!==0)return a}return ve(e.length,t.length)}static compareSegments(e,t){const n=Aa.isNumericId(e),i=Aa.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?Aa.extractNumericId(e).compare(Aa.extractNumericId(t)):mb(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ts.fromString(e.substring(4,e.length-2))}}class an extends Aa{construct(e,t,n){return new an(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Lt(_t.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new an(t)}static emptyPath(){return new an([])}}const rL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class br extends Aa{construct(e,t,n){return new br(e,t,n)}static isValidIdentifier(e){return rL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),br.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===CT}static keyField(){return new br([CT])}static fromServerFormat(e){const t=[];let n="",i=0;const a=()=>{if(n.length===0)throw new Lt(_t.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;i<e.length;){const u=e[i];if(u==="\\"){if(i+1===e.length)throw new Lt(_t.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Lt(_t.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=l,i+=2}else u==="`"?(o=!o,i++):u!=="."||o?(n+=u,i++):(a(),i++)}if(a(),o)throw new Lt(_t.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new br(t)}static emptyPath(){return new br([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.path=e}static fromPath(e){return new qt(an.fromString(e))}static fromName(e){return new qt(an.fromString(e).popFirst(5))}static empty(){return new qt(an.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&an.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return an.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new qt(new an(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xf=-1;function iL(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=ae.fromTimestamp(n===1e9?new Xn(t+1,0):new Xn(t,n));return new Os(i,qt.empty(),e)}function aL(r){return new Os(r.readTime,r.key,Xf)}class Os{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Os(ae.min(),qt.empty(),Xf)}static max(){return new Os(ae.max(),qt.empty(),Xf)}}function oL(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=qt.comparator(r.documentKey,e.documentKey),t!==0?t:ve(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sL="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class uL{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $c(r){if(r.code!==_t.FAILED_PRECONDITION||r.message!==sL)throw r;Ot("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Et{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Yt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Et((n,i)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(n,i)},this.catchCallback=a=>{this.wrapFailure(t,a).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Et?t:Et.resolve(t)}catch(t){return Et.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Et.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Et.reject(t)}static resolve(e){return new Et((t,n)=>{t(e)})}static reject(e){return new Et((t,n)=>{n(e)})}static waitFor(e){return new Et((t,n)=>{let i=0,a=0,o=!1;e.forEach(u=>{++i,u.next(()=>{++a,o&&a===i&&t()},l=>n(l))}),o=!0,a===i&&t()})}static or(e){let t=Et.resolve(!1);for(const n of e)t=t.next(i=>i?Et.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,a)=>{n.push(t.call(this,i,a))}),this.waitFor(n)}static mapArray(e,t){return new Et((n,i)=>{const a=e.length,o=new Array(a);let u=0;for(let l=0;l<a;l++){const h=l;t(e[h]).next(f=>{o[h]=f,++u,u===a&&n(o)},f=>i(f))}})}static doWhile(e,t){return new Et((n,i)=>{const a=()=>{e()===!0?t().next(()=>{a()},i):n()};a()})}}function lL(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Kc(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ue(n),this.ce=n=>t.writeSequenceNumber(n))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}Yg.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P2=-1;function Qg(r){return r==null}function yg(r){return r===0&&1/r==-1/0}function cL(r){return typeof r=="number"&&Number.isInteger(r)&&!yg(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IA="";function hL(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=ET(e)),e=fL(r.get(t),e);return ET(e)}function fL(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const a=r.charAt(i);switch(a){case"\0":t+="";break;case IA:t+="";break;default:t+=a}}return t}function ET(r){return r+IA+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _T(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Hs(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function kA(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn{constructor(e,t){this.comparator=e,this.root=t||mr.EMPTY}insert(e,t){return new vn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,mr.BLACK,null,null))}remove(e){return new vn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,mr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Em(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Em(this.root,e,this.comparator,!1)}getReverseIterator(){return new Em(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Em(this.root,e,this.comparator,!0)}}class Em{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=t?n(e.key,t):1,t&&i&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class mr{constructor(e,t,n,i,a){this.key=e,this.value=t,this.color=n??mr.RED,this.left=i??mr.EMPTY,this.right=a??mr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,a){return new mr(e??this.key,t??this.value,n??this.color,i??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const a=n(e,i.key);return i=a<0?i.copy(null,null,null,i.left.insert(e,t,n),null):a===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return mr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return mr.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,mr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,mr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Yt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Yt(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Yt(27949);return e+(this.isRed()?0:1)}}mr.EMPTY=null,mr.RED=!0,mr.BLACK=!1;mr.EMPTY=new class{constructor(){this.size=0}get key(){throw Yt(57766)}get value(){throw Yt(16141)}get color(){throw Yt(16727)}get left(){throw Yt(29726)}get right(){throw Yt(36894)}copy(e,t,n,i,a){return this}insert(e,t,n){return new mr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e){this.comparator=e,this.data=new vn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new TT(this.data.getIterator())}getIteratorFrom(e){return new TT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Yn)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=n.getNext().key;if(this.comparator(i,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Yn(this.comparator);return t.data=e,t}}class TT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi{constructor(e){this.fields=e,e.sort(br.comparator)}static empty(){return new Qi([])}unionWith(e){let t=new Yn(br.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Qi(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ec(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DA extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new DA("Invalid base64 string: "+a):a}}(e);return new wr(t)}static fromUint8Array(e){const t=function(i){let a="";for(let o=0;o<i.length;++o)a+=String.fromCharCode(i[o]);return a}(e);return new wr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ve(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}wr.EMPTY_BYTE_STRING=new wr("");const dL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ms(r){if(We(!!r,39018),typeof r=="string"){let e=0;const t=dL.exec(r);if(We(!!t,46558,{timestamp:r}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:An(r.seconds),nanos:An(r.nanos)}}function An(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Ls(r){return typeof r=="string"?wr.fromBase64String(r):wr.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OA="server_timestamp",MA="__type__",LA="__previous_value__",PA="__local_write_time__";function z2(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{})[MA])===null||t===void 0?void 0:t.stringValue)===OA}function Zg(r){const e=r.mapValue.fields[LA];return z2(e)?Zg(e):e}function Yf(r){const e=Ms(r.mapValue.fields[PA].timestampValue);return new Xn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pL{constructor(e,t,n,i,a,o,u,l,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=h,this.isUsingEmulator=f}}const bg="(default)";class Qf{constructor(e,t){this.projectId=e,this.database=t||bg}static empty(){return new Qf("","")}get isDefaultDatabase(){return this.database===bg}isEqual(e){return e instanceof Qf&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zA="__type__",mL="__max__",_m={mapValue:{}},VA="__vector__",xg="value";function Ps(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?z2(r)?4:vL(r)?9007199254740991:gL(r)?10:11:Yt(28295,{value:r})}function Pa(r,e){if(r===e)return!0;const t=Ps(r);if(t!==Ps(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Yf(r).isEqual(Yf(e));case 3:return function(i,a){if(typeof i.timestampValue=="string"&&typeof a.timestampValue=="string"&&i.timestampValue.length===a.timestampValue.length)return i.timestampValue===a.timestampValue;const o=Ms(i.timestampValue),u=Ms(a.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,a){return Ls(i.bytesValue).isEqual(Ls(a.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,a){return An(i.geoPointValue.latitude)===An(a.geoPointValue.latitude)&&An(i.geoPointValue.longitude)===An(a.geoPointValue.longitude)}(r,e);case 2:return function(i,a){if("integerValue"in i&&"integerValue"in a)return An(i.integerValue)===An(a.integerValue);if("doubleValue"in i&&"doubleValue"in a){const o=An(i.doubleValue),u=An(a.doubleValue);return o===u?yg(o)===yg(u):isNaN(o)&&isNaN(u)}return!1}(r,e);case 9:return Ec(r.arrayValue.values||[],e.arrayValue.values||[],Pa);case 10:case 11:return function(i,a){const o=i.mapValue.fields||{},u=a.mapValue.fields||{};if(_T(o)!==_T(u))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(u[l]===void 0||!Pa(o[l],u[l])))return!1;return!0}(r,e);default:return Yt(52216,{left:r})}}function Zf(r,e){return(r.values||[]).find(t=>Pa(t,e))!==void 0}function _c(r,e){if(r===e)return 0;const t=Ps(r),n=Ps(e);if(t!==n)return ve(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return ve(r.booleanValue,e.booleanValue);case 2:return function(a,o){const u=An(a.integerValue||a.doubleValue),l=An(o.integerValue||o.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(r,e);case 3:return ST(r.timestampValue,e.timestampValue);case 4:return ST(Yf(r),Yf(e));case 5:return mb(r.stringValue,e.stringValue);case 6:return function(a,o){const u=Ls(a),l=Ls(o);return u.compareTo(l)}(r.bytesValue,e.bytesValue);case 7:return function(a,o){const u=a.split("/"),l=o.split("/");for(let h=0;h<u.length&&h<l.length;h++){const f=ve(u[h],l[h]);if(f!==0)return f}return ve(u.length,l.length)}(r.referenceValue,e.referenceValue);case 8:return function(a,o){const u=ve(An(a.latitude),An(o.latitude));return u!==0?u:ve(An(a.longitude),An(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return AT(r.arrayValue,e.arrayValue);case 10:return function(a,o){var u,l,h,f;const p=a.fields||{},m=o.fields||{},v=(u=p[xg])===null||u===void 0?void 0:u.arrayValue,b=(l=m[xg])===null||l===void 0?void 0:l.arrayValue,C=ve(((h=v==null?void 0:v.values)===null||h===void 0?void 0:h.length)||0,((f=b==null?void 0:b.values)===null||f===void 0?void 0:f.length)||0);return C!==0?C:AT(v,b)}(r.mapValue,e.mapValue);case 11:return function(a,o){if(a===_m.mapValue&&o===_m.mapValue)return 0;if(a===_m.mapValue)return 1;if(o===_m.mapValue)return-1;const u=a.fields||{},l=Object.keys(u),h=o.fields||{},f=Object.keys(h);l.sort(),f.sort();for(let p=0;p<l.length&&p<f.length;++p){const m=mb(l[p],f[p]);if(m!==0)return m;const v=_c(u[l[p]],h[f[p]]);if(v!==0)return v}return ve(l.length,f.length)}(r.mapValue,e.mapValue);default:throw Yt(23264,{Pe:t})}}function ST(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return ve(r,e);const t=Ms(r),n=Ms(e),i=ve(t.seconds,n.seconds);return i!==0?i:ve(t.nanos,n.nanos)}function AT(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const a=_c(t[i],n[i]);if(a)return a}return ve(t.length,n.length)}function Tc(r){return gb(r)}function gb(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Ms(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return Ls(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return qt.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const a of t.values||[])i?i=!1:n+=",",n+=gb(a);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",a=!0;for(const o of n)a?a=!1:i+=",",i+=`${o}:${gb(t.fields[o])}`;return i+"}"}(r.mapValue):Yt(61005,{value:r})}function Gm(r){switch(Ps(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Zg(r);return e?16+Gm(e):16;case 5:return 2*r.stringValue.length;case 6:return Ls(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,a)=>i+Gm(a),0)}(r.arrayValue);case 10:case 11:return function(n){let i=0;return Hs(n.fields,(a,o)=>{i+=a.length+Gm(o)}),i}(r.mapValue);default:throw Yt(13486,{value:r})}}function RT(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function vb(r){return!!r&&"integerValue"in r}function V2(r){return!!r&&"arrayValue"in r}function NT(r){return!!r&&"nullValue"in r}function IT(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function $m(r){return!!r&&"mapValue"in r}function gL(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{})[zA])===null||t===void 0?void 0:t.stringValue)===VA}function Vf(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return Hs(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Vf(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Vf(r.arrayValue.values[t]);return e}return Object.assign({},r)}function vL(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===mL}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(e){this.value=e}static empty(){return new di({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!$m(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Vf(t)}setAll(e){let t=br.emptyPath(),n={},i=[];e.forEach((o,u)=>{if(!t.isImmediateParentOf(u)){const l=this.getFieldsMap(t);this.applyChanges(l,n,i),n={},i=[],t=u.popLast()}o?n[u.lastSegment()]=Vf(o):i.push(u.lastSegment())});const a=this.getFieldsMap(t);this.applyChanges(a,n,i)}delete(e){const t=this.field(e.popLast());$m(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Pa(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];$m(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Hs(t,(i,a)=>e[i]=a);for(const i of n)delete e[i]}clone(){return new di(Vf(this.value))}}function FA(r){const e=[];return Hs(r.fields,(t,n)=>{const i=new br([t]);if($m(n)){const a=FA(n.mapValue).fields;if(a.length===0)e.push(i);else for(const o of a)e.push(i.child(o))}else e.push(i)}),new Qi(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr{constructor(e,t,n,i,a,o,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=a,this.data=o,this.documentState=u}static newInvalidDocument(e){return new Rr(e,0,ae.min(),ae.min(),ae.min(),di.empty(),0)}static newFoundDocument(e,t,n,i){return new Rr(e,1,t,ae.min(),n,i,0)}static newNoDocument(e,t){return new Rr(e,2,t,ae.min(),ae.min(),di.empty(),0)}static newUnknownDocument(e,t){return new Rr(e,3,t,ae.min(),ae.min(),di.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ae.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=di.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=di.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ae.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Rr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Rr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,t){this.position=e,this.inclusive=t}}function kT(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const a=e[i],o=r.position[i];if(a.field.isKeyField()?n=qt.comparator(qt.fromName(o.referenceValue),t.key):n=_c(o,t.data.field(a.field)),a.dir==="desc"&&(n*=-1),n!==0)break}return n}function DT(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Pa(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(e,t="asc"){this.field=e,this.dir=t}}function yL(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BA{}class zn extends BA{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new xL(e,t,n):t==="array-contains"?new EL(e,n):t==="in"?new _L(e,n):t==="not-in"?new TL(e,n):t==="array-contains-any"?new SL(e,n):new zn(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new wL(e,n):new CL(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(_c(t,this.value)):t!==null&&Ps(this.value)===Ps(t)&&this.matchesComparison(_c(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Yt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ea extends BA{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new ea(e,t)}matches(e){return jA(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function jA(r){return r.op==="and"}function UA(r){return bL(r)&&jA(r)}function bL(r){for(const e of r.filters)if(e instanceof ea)return!1;return!0}function yb(r){if(r instanceof zn)return r.field.canonicalString()+r.op.toString()+Tc(r.value);if(UA(r))return r.filters.map(e=>yb(e)).join(",");{const e=r.filters.map(t=>yb(t)).join(",");return`${r.op}(${e})`}}function WA(r,e){return r instanceof zn?function(n,i){return i instanceof zn&&n.op===i.op&&n.field.isEqual(i.field)&&Pa(n.value,i.value)}(r,e):r instanceof ea?function(n,i){return i instanceof ea&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((a,o,u)=>a&&WA(o,i.filters[u]),!0):!1}(r,e):void Yt(19439)}function HA(r){return r instanceof zn?function(t){return`${t.field.canonicalString()} ${t.op} ${Tc(t.value)}`}(r):r instanceof ea?function(t){return t.op.toString()+" {"+t.getFilters().map(HA).join(" ,")+"}"}(r):"Filter"}class xL extends zn{constructor(e,t,n){super(e,t,n),this.key=qt.fromName(n.referenceValue)}matches(e){const t=qt.comparator(e.key,this.key);return this.matchesComparison(t)}}class wL extends zn{constructor(e,t){super(e,"in",t),this.keys=qA("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class CL extends zn{constructor(e,t){super(e,"not-in",t),this.keys=qA("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function qA(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>qt.fromName(n.referenceValue))}class EL extends zn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return V2(t)&&Zf(t.arrayValue,this.value)}}class _L extends zn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Zf(this.value.arrayValue,t)}}class TL extends zn{constructor(e,t){super(e,"not-in",t)}matches(e){if(Zf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Zf(this.value.arrayValue,t)}}class SL extends zn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!V2(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Zf(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AL{constructor(e,t=null,n=[],i=[],a=null,o=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=a,this.startAt=o,this.endAt=u,this.Ie=null}}function OT(r,e=null,t=[],n=[],i=null,a=null,o=null){return new AL(r,e,t,n,i,a,o)}function F2(r){const e=oe(r);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>yb(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(a){return a.field.canonicalString()+a.dir}(n)).join(","),Qg(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Tc(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Tc(n)).join(",")),e.Ie=t}return e.Ie}function B2(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!yL(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!WA(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!DT(r.startAt,e.startAt)&&DT(r.endAt,e.endAt)}function bb(r){return qt.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(e,t=null,n=[],i=[],a=null,o="F",u=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=a,this.limitType=o,this.startAt=u,this.endAt=l,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function RL(r,e,t,n,i,a,o,u){return new Xc(r,e,t,n,i,a,o,u)}function Jg(r){return new Xc(r)}function MT(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function GA(r){return r.collectionGroup!==null}function Ff(r){const e=oe(r);if(e.Ee===null){e.Ee=[];const t=new Set;for(const a of e.explicitOrderBy)e.Ee.push(a),t.add(a.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new Yn(br.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(a=>{t.has(a.canonicalString())||a.isKeyField()||e.Ee.push(new Jf(a,n))}),t.has(br.keyField().canonicalString())||e.Ee.push(new Jf(br.keyField(),n))}return e.Ee}function ka(r){const e=oe(r);return e.de||(e.de=NL(e,Ff(r))),e.de}function NL(r,e){if(r.limitType==="F")return OT(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{const a=i.dir==="desc"?"asc":"desc";return new Jf(i.field,a)});const t=r.endAt?new wg(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new wg(r.startAt.position,r.startAt.inclusive):null;return OT(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function xb(r,e){const t=r.filters.concat([e]);return new Xc(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function wb(r,e,t){return new Xc(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function tv(r,e){return B2(ka(r),ka(e))&&r.limitType===e.limitType}function $A(r){return`${F2(ka(r))}|lt:${r.limitType}`}function uc(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>HA(i)).join(", ")}]`),Qg(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Tc(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Tc(i)).join(",")),`Target(${n})`}(ka(r))}; limitType=${r.limitType})`}function ev(r,e){return e.isFoundDocument()&&function(n,i){const a=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(a):qt.isDocumentKey(n.path)?n.path.isEqual(a):n.path.isImmediateParentOf(a)}(r,e)&&function(n,i){for(const a of Ff(n))if(!a.field.isKeyField()&&i.data.field(a.field)===null)return!1;return!0}(r,e)&&function(n,i){for(const a of n.filters)if(!a.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(o,u,l){const h=kT(o,u,l);return o.inclusive?h<=0:h<0}(n.startAt,Ff(n),i)||n.endAt&&!function(o,u,l){const h=kT(o,u,l);return o.inclusive?h>=0:h>0}(n.endAt,Ff(n),i))}(r,e)}function IL(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function KA(r){return(e,t)=>{let n=!1;for(const i of Ff(r)){const a=kL(i,e,t);if(a!==0)return a;n=n||i.field.isKeyField()}return 0}}function kL(r,e,t){const n=r.field.isKeyField()?qt.comparator(e.key,t.key):function(a,o,u){const l=o.data.field(a),h=u.data.field(a);return l!==null&&h!==null?_c(l,h):Yt(42886)}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return Yt(19790,{direction:r.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[i,a]of n)if(this.equalsFn(i,e))return a}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return void(i[a]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Hs(this.inner,(t,n)=>{for(const[i,a]of n)e(i,a)})}isEmpty(){return kA(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DL=new vn(qt.comparator);function ko(){return DL}const XA=new vn(qt.comparator);function Nf(...r){let e=XA;for(const t of r)e=e.insert(t.key,t);return e}function YA(r){let e=XA;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function zu(){return Bf()}function QA(){return Bf()}function Bf(){return new el(r=>r.toString(),(r,e)=>r.isEqual(e))}const OL=new vn(qt.comparator),ML=new Yn(qt.comparator);function _e(...r){let e=ML;for(const t of r)e=e.add(t);return e}const LL=new Yn(ve);function PL(){return LL}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j2(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:yg(e)?"-0":e}}function ZA(r){return{integerValue:""+r}}function zL(r,e){return cL(e)?ZA(e):j2(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv{constructor(){this._=void 0}}function VL(r,e,t){return r instanceof td?function(i,a){const o={fields:{[MA]:{stringValue:OA},[PA]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return a&&z2(a)&&(a=Zg(a)),a&&(o.fields[LA]=a),{mapValue:o}}(t,e):r instanceof ed?tR(r,e):r instanceof nd?eR(r,e):function(i,a){const o=JA(i,a),u=LT(o)+LT(i.Re);return vb(o)&&vb(i.Re)?ZA(u):j2(i.serializer,u)}(r,e)}function FL(r,e,t){return r instanceof ed?tR(r,e):r instanceof nd?eR(r,e):t}function JA(r,e){return r instanceof Cg?function(n){return vb(n)||function(a){return!!a&&"doubleValue"in a}(n)}(e)?e:{integerValue:0}:null}class td extends nv{}class ed extends nv{constructor(e){super(),this.elements=e}}function tR(r,e){const t=nR(e);for(const n of r.elements)t.some(i=>Pa(i,n))||t.push(n);return{arrayValue:{values:t}}}class nd extends nv{constructor(e){super(),this.elements=e}}function eR(r,e){let t=nR(e);for(const n of r.elements)t=t.filter(i=>!Pa(i,n));return{arrayValue:{values:t}}}class Cg extends nv{constructor(e,t){super(),this.serializer=e,this.Re=t}}function LT(r){return An(r.integerValue||r.doubleValue)}function nR(r){return V2(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BL{constructor(e,t){this.field=e,this.transform=t}}function jL(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof ed&&i instanceof ed||n instanceof nd&&i instanceof nd?Ec(n.elements,i.elements,Pa):n instanceof Cg&&i instanceof Cg?Pa(n.Re,i.Re):n instanceof td&&i instanceof td}(r.transform,e.transform)}class UL{constructor(e,t){this.version=e,this.transformResults=t}}class Eo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Eo}static exists(e){return new Eo(void 0,e)}static updateTime(e){return new Eo(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Km(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class rv{}function rR(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new aR(r.key,Eo.none()):new iv(r.key,r.data,Eo.none());{const t=r.data,n=di.empty();let i=new Yn(br.comparator);for(let a of e.fields)if(!i.has(a)){let o=t.field(a);o===null&&a.length>1&&(a=a.popLast(),o=t.field(a)),o===null?n.delete(a):n.set(a,o),i=i.add(a)}return new nl(r.key,n,new Qi(i.toArray()),Eo.none())}}function WL(r,e,t){r instanceof iv?function(i,a,o){const u=i.value.clone(),l=zT(i.fieldTransforms,a,o.transformResults);u.setAll(l),a.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):r instanceof nl?function(i,a,o){if(!Km(i.precondition,a))return void a.convertToUnknownDocument(o.version);const u=zT(i.fieldTransforms,a,o.transformResults),l=a.data;l.setAll(iR(i)),l.setAll(u),a.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(r,e,t):function(i,a,o){a.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function jf(r,e,t,n){return r instanceof iv?function(a,o,u,l){if(!Km(a.precondition,o))return u;const h=a.value.clone(),f=VT(a.fieldTransforms,l,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof nl?function(a,o,u,l){if(!Km(a.precondition,o))return u;const h=VT(a.fieldTransforms,l,o),f=o.data;return f.setAll(iR(a)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),u===null?null:u.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(p=>p.field))}(r,e,t,n):function(a,o,u){return Km(a.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u}(r,e,t)}function HL(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),a=JA(n.transform,i||null);a!=null&&(t===null&&(t=di.empty()),t.set(n.field,a))}return t||null}function PT(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Ec(n,i,(a,o)=>jL(a,o))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class iv extends rv{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class nl extends rv{constructor(e,t,n,i,a=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function iR(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function zT(r,e,t){const n=new Map;We(r.length===t.length,32656,{Ve:t.length,me:r.length});for(let i=0;i<t.length;i++){const a=r[i],o=a.transform,u=e.data.field(a.field);n.set(a.field,FL(o,u,t[i]))}return n}function VT(r,e,t){const n=new Map;for(const i of r){const a=i.transform,o=t.data.field(i.field);n.set(i.field,VL(a,o,e))}return n}class aR extends rv{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qL extends rv{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GL{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const a=this.mutations[i];a.key.isEqual(e.key)&&WL(a,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=jf(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=jf(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=QA();return this.mutations.forEach(i=>{const a=e.get(i.key),o=a.overlayedDocument;let u=this.applyToLocalView(o,a.mutatedFields);u=t.has(i.key)?null:u;const l=rR(o,u);l!==null&&n.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(ae.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),_e())}isEqual(e){return this.batchId===e.batchId&&Ec(this.mutations,e.mutations,(t,n)=>PT(t,n))&&Ec(this.baseMutations,e.baseMutations,(t,n)=>PT(t,n))}}class U2{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){We(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let i=function(){return OL}();const a=e.mutations;for(let o=0;o<a.length;o++)i=i.insert(a[o].key,n[o].version);return new U2(e,t,n,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $L{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KL{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ln,De;function XL(r){switch(r){case _t.OK:return Yt(64938);case _t.CANCELLED:case _t.UNKNOWN:case _t.DEADLINE_EXCEEDED:case _t.RESOURCE_EXHAUSTED:case _t.INTERNAL:case _t.UNAVAILABLE:case _t.UNAUTHENTICATED:return!1;case _t.INVALID_ARGUMENT:case _t.NOT_FOUND:case _t.ALREADY_EXISTS:case _t.PERMISSION_DENIED:case _t.FAILED_PRECONDITION:case _t.ABORTED:case _t.OUT_OF_RANGE:case _t.UNIMPLEMENTED:case _t.DATA_LOSS:return!0;default:return Yt(15467,{code:r})}}function oR(r){if(r===void 0)return Io("GRPC error has no .code"),_t.UNKNOWN;switch(r){case Ln.OK:return _t.OK;case Ln.CANCELLED:return _t.CANCELLED;case Ln.UNKNOWN:return _t.UNKNOWN;case Ln.DEADLINE_EXCEEDED:return _t.DEADLINE_EXCEEDED;case Ln.RESOURCE_EXHAUSTED:return _t.RESOURCE_EXHAUSTED;case Ln.INTERNAL:return _t.INTERNAL;case Ln.UNAVAILABLE:return _t.UNAVAILABLE;case Ln.UNAUTHENTICATED:return _t.UNAUTHENTICATED;case Ln.INVALID_ARGUMENT:return _t.INVALID_ARGUMENT;case Ln.NOT_FOUND:return _t.NOT_FOUND;case Ln.ALREADY_EXISTS:return _t.ALREADY_EXISTS;case Ln.PERMISSION_DENIED:return _t.PERMISSION_DENIED;case Ln.FAILED_PRECONDITION:return _t.FAILED_PRECONDITION;case Ln.ABORTED:return _t.ABORTED;case Ln.OUT_OF_RANGE:return _t.OUT_OF_RANGE;case Ln.UNIMPLEMENTED:return _t.UNIMPLEMENTED;case Ln.DATA_LOSS:return _t.DATA_LOSS;default:return Yt(39323,{code:r})}}(De=Ln||(Ln={}))[De.OK=0]="OK",De[De.CANCELLED=1]="CANCELLED",De[De.UNKNOWN=2]="UNKNOWN",De[De.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",De[De.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",De[De.NOT_FOUND=5]="NOT_FOUND",De[De.ALREADY_EXISTS=6]="ALREADY_EXISTS",De[De.PERMISSION_DENIED=7]="PERMISSION_DENIED",De[De.UNAUTHENTICATED=16]="UNAUTHENTICATED",De[De.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",De[De.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",De[De.ABORTED=10]="ABORTED",De[De.OUT_OF_RANGE=11]="OUT_OF_RANGE",De[De.UNIMPLEMENTED=12]="UNIMPLEMENTED",De[De.INTERNAL=13]="INTERNAL",De[De.UNAVAILABLE=14]="UNAVAILABLE",De[De.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YL=new Ts([4294967295,4294967295],0);function FT(r){const e=RA().encode(r),t=new xA;return t.update(e),new Uint8Array(t.digest())}function BT(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new Ts([t,n],0),new Ts([i,a],0)]}class W2{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new If(`Invalid padding: ${t}`);if(n<0)throw new If(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new If(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new If(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=Ts.fromNumber(this.pe)}we(e,t,n){let i=e.add(t.multiply(Ts.fromNumber(n)));return i.compare(YL)===1&&(i=new Ts([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;const t=FT(e),[n,i]=BT(t);for(let a=0;a<this.hashCount;a++){const o=this.we(n,i,a);if(!this.be(o))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),o=new W2(a,i,t);return n.forEach(u=>o.insert(u)),o}insert(e){if(this.pe===0)return;const t=FT(e),[n,i]=BT(t);for(let a=0;a<this.hashCount;a++){const o=this.we(n,i,a);this.Se(o)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class If extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class av{constructor(e,t,n,i,a){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,_d.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new av(ae.min(),i,new vn(ve),ko(),_e())}}class _d{constructor(e,t,n,i,a){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new _d(n,t,_e(),_e(),_e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(e,t,n,i){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=i}}class sR{constructor(e,t){this.targetId=e,this.Ce=t}}class uR{constructor(e,t,n=wr.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class jT{constructor(){this.Fe=0,this.Me=UT(),this.xe=wr.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=_e(),t=_e(),n=_e();return this.Me.forEach((i,a)=>{switch(a){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:Yt(38017,{changeType:a})}}),new _d(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=UT()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,We(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class QL{constructor(e){this.ze=e,this.je=new Map,this.He=ko(),this.Je=Tm(),this.Ye=Tm(),this.Ze=new vn(ve)}Xe(e){for(const t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(const t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{const n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:Yt(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((n,i)=>{this.it(i)&&t(i)})}ot(e){const t=e.targetId,n=e.Ce.count,i=this._t(t);if(i){const a=i.target;if(bb(a))if(n===0){const o=new qt(a.path);this.tt(t,o,Rr.newNoDocument(o,ae.min()))}else We(n===1,20013,{expectedCount:n});else{const o=this.ut(t);if(o!==n){const u=this.ct(e),l=u?this.lt(u,e,o):1;if(l!==0){this.st(t);const h=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,h)}}}}}ct(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:a=0}=t;let o,u;try{o=Ls(n).toUint8Array()}catch(l){if(l instanceof DA)return Cc("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new W2(o,i,a)}catch(l){return Cc(l instanceof If?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.pe===0?null:u}lt(e,t,n){return t.Ce.count===n-this.Tt(e,t.targetId)?0:2}Tt(e,t){const n=this.ze.getRemoteKeysForTarget(t);let i=0;return n.forEach(a=>{const o=this.ze.Pt(),u=`projects/${o.projectId}/databases/${o.database}/documents/${a.path.canonicalString()}`;e.mightContain(u)||(this.tt(t,a,null),i++)}),i}It(e){const t=new Map;this.je.forEach((a,o)=>{const u=this._t(o);if(u){if(a.current&&bb(u.target)){const l=new qt(u.target.path);this.Et(l).has(o)||this.dt(o,l)||this.tt(o,l,Rr.newNoDocument(l,e))}a.Le&&(t.set(o,a.qe()),a.Qe())}});let n=_e();this.Ye.forEach((a,o)=>{let u=!0;o.forEachWhile(l=>{const h=this._t(l);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(a))}),this.He.forEach((a,o)=>o.setReadTime(e));const i=new av(e,t,this.Ze,this.He,n);return this.He=ko(),this.Je=Tm(),this.Ye=Tm(),this.Ze=new vn(ve),i}et(e,t){if(!this.it(e))return;const n=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;const i=this.rt(e);this.dt(e,t)?i.$e(t,1):i.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){const t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new jT,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new Yn(ve),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new Yn(ve),this.Je=this.Je.insert(e,t)),t}it(e){const t=this._t(e)!==null;return t||Ot("WatchChangeAggregator","Detected inactive target",e),t}_t(e){const t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new jT),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function Tm(){return new vn(qt.comparator)}function UT(){return new vn(qt.comparator)}const ZL={asc:"ASCENDING",desc:"DESCENDING"},JL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},tP={and:"AND",or:"OR"};class eP{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Cb(r,e){return r.useProto3Json||Qg(e)?e:{value:e}}function Eg(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function lR(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function nP(r,e){return Eg(r,e.toTimestamp())}function Da(r){return We(!!r,49232),ae.fromTimestamp(function(t){const n=Ms(t);return new Xn(n.seconds,n.nanos)}(r))}function H2(r,e){return Eb(r,e).canonicalString()}function Eb(r,e){const t=function(i){return new an(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function cR(r){const e=an.fromString(r);return We(mR(e),10190,{key:e.toString()}),e}function _b(r,e){return H2(r.databaseId,e.path)}function T1(r,e){const t=cR(e);if(t.get(1)!==r.databaseId.projectId)throw new Lt(_t.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new Lt(_t.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new qt(fR(t))}function hR(r,e){return H2(r.databaseId,e)}function rP(r){const e=cR(r);return e.length===4?an.emptyPath():fR(e)}function Tb(r){return new an(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function fR(r){return We(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function WT(r,e,t){return{name:_b(r,e),fields:t.value.mapValue.fields}}function iP(r,e){let t;if("targetChange"in e){e.targetChange;const n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:Yt(39313,{state:h})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],a=function(h,f){return h.useProto3Json?(We(f===void 0||typeof f=="string",58123),wr.fromBase64String(f||"")):(We(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),wr.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(h){const f=h.code===void 0?_t.UNKNOWN:oR(h.code);return new Lt(f,h.message||"")}(o);t=new uR(n,i,a,u||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const i=T1(r,n.document.name),a=Da(n.document.updateTime),o=n.document.createTime?Da(n.document.createTime):ae.min(),u=new di({mapValue:{fields:n.document.fields}}),l=Rr.newFoundDocument(i,a,o,u),h=n.targetIds||[],f=n.removedTargetIds||[];t=new Xm(h,f,l.key,l)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const i=T1(r,n.document),a=n.readTime?Da(n.readTime):ae.min(),o=Rr.newNoDocument(i,a),u=n.removedTargetIds||[];t=new Xm([],u,o.key,o)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const i=T1(r,n.document),a=n.removedTargetIds||[];t=new Xm([],a,i,null)}else{if(!("filter"in e))return Yt(11601,{Vt:e});{e.filter;const n=e.filter;n.targetId;const{count:i=0,unchangedNames:a}=n,o=new KL(i,a),u=n.targetId;t=new sR(u,o)}}return t}function aP(r,e){let t;if(e instanceof iv)t={update:WT(r,e.key,e.value)};else if(e instanceof aR)t={delete:_b(r,e.key)};else if(e instanceof nl)t={update:WT(r,e.key,e.data),updateMask:pP(e.fieldMask)};else{if(!(e instanceof qL))return Yt(16599,{ft:e.type});t={verify:_b(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(a,o){const u=o.transform;if(u instanceof td)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ed)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof nd)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Cg)return{fieldPath:o.field.canonicalString(),increment:u.Re};throw Yt(20930,{transform:o.transform})}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,a){return a.updateTime!==void 0?{updateTime:nP(i,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:Yt(27497)}(r,e.precondition)),t}function oP(r,e){return r&&r.length>0?(We(e!==void 0,14353),r.map(t=>function(i,a){let o=i.updateTime?Da(i.updateTime):Da(a);return o.isEqual(ae.min())&&(o=Da(a)),new UL(o,i.transformResults||[])}(t,e))):[]}function sP(r,e){return{documents:[hR(r,e.path)]}}function uP(r,e){const t={structuredQuery:{}},n=e.path;let i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=hR(r,i);const a=function(h){if(h.length!==0)return pR(ea.create(h,"and"))}(e.filters);a&&(t.structuredQuery.where=a);const o=function(h){if(h.length!==0)return h.map(f=>function(m){return{field:lc(m.field),direction:hP(m.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const u=Cb(r,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{gt:t,parent:i}}function lP(r){let e=rP(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){We(n===1,65062);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let a=[];t.where&&(a=function(p){const m=dR(p);return m instanceof ea&&UA(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(p){return p.map(m=>function(b){return new Jf(cc(b.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(b.direction))}(m))}(t.orderBy));let u=null;t.limit&&(u=function(p){let m;return m=typeof p=="object"?p.value:p,Qg(m)?null:m}(t.limit));let l=null;t.startAt&&(l=function(p){const m=!!p.before,v=p.values||[];return new wg(v,m)}(t.startAt));let h=null;return t.endAt&&(h=function(p){const m=!p.before,v=p.values||[];return new wg(v,m)}(t.endAt)),RL(e,i,o,a,u,"F",l,h)}function cP(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Yt(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function dR(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=cc(t.unaryFilter.field);return zn.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=cc(t.unaryFilter.field);return zn.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=cc(t.unaryFilter.field);return zn.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=cc(t.unaryFilter.field);return zn.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Yt(61313);default:return Yt(60726)}}(r):r.fieldFilter!==void 0?function(t){return zn.create(cc(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Yt(58110);default:return Yt(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return ea.create(t.compositeFilter.filters.map(n=>dR(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Yt(1026)}}(t.compositeFilter.op))}(r):Yt(30097,{filter:r})}function hP(r){return ZL[r]}function fP(r){return JL[r]}function dP(r){return tP[r]}function lc(r){return{fieldPath:r.canonicalString()}}function cc(r){return br.fromServerFormat(r.fieldPath)}function pR(r){return r instanceof zn?function(t){if(t.op==="=="){if(IT(t.value))return{unaryFilter:{field:lc(t.field),op:"IS_NAN"}};if(NT(t.value))return{unaryFilter:{field:lc(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(IT(t.value))return{unaryFilter:{field:lc(t.field),op:"IS_NOT_NAN"}};if(NT(t.value))return{unaryFilter:{field:lc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:lc(t.field),op:fP(t.op),value:t.value}}}(r):r instanceof ea?function(t){const n=t.getFilters().map(i=>pR(i));return n.length===1?n[0]:{compositeFilter:{op:dP(t.op),filters:n}}}(r):Yt(54877,{filter:r})}function pP(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function mR(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e,t,n,i,a=ae.min(),o=ae.min(),u=wr.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(e){return new bs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new bs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{constructor(e){this.wt=e}}function gP(r){const e=lP({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?wb(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vP{constructor(){this.Cn=new yP}addToCollectionParentIndex(e,t){return this.Cn.add(t),Et.resolve()}getCollectionParents(e,t){return Et.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Et.resolve()}deleteFieldIndex(e,t){return Et.resolve()}deleteAllFieldIndexes(e){return Et.resolve()}createTargetIndexes(e,t){return Et.resolve()}getDocumentsMatchingTarget(e,t){return Et.resolve(null)}getIndexType(e,t){return Et.resolve(0)}getFieldIndexes(e,t){return Et.resolve([])}getNextCollectionGroupToUpdate(e){return Et.resolve(null)}getMinOffset(e,t){return Et.resolve(Os.min())}getMinOffsetFromCollectionGroup(e,t){return Et.resolve(Os.min())}updateCollectionGroup(e,t,n){return Et.resolve()}updateIndexEntries(e,t){return Et.resolve()}}class yP{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Yn(an.comparator),a=!i.has(n);return this.index[t]=i.add(n),a}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Yn(an.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},gR=41943040;class Xr{static withCacheSize(e){return new Xr(e,Xr.DEFAULT_COLLECTION_PERCENTILE,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Xr.DEFAULT_COLLECTION_PERCENTILE=10,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xr.DEFAULT=new Xr(gR,Xr.DEFAULT_COLLECTION_PERCENTILE,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xr.DISABLED=new Xr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new Sc(0)}static lr(){return new Sc(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qT="LruGarbageCollector",bP=1048576;function GT([r,e],[t,n]){const i=ve(r,t);return i===0?ve(e,n):i}class xP{constructor(e){this.Er=e,this.buffer=new Yn(GT),this.dr=0}Ar(){return++this.dr}Rr(e){const t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();GT(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class wP{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(e){Ot(qT,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Kc(t)?Ot(qT,"Ignoring IndexedDB error during garbage collection: ",t):await $c(t)}await this.mr(3e5)})}}class CP{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return Et.resolve(Yg.le);const n=new xP(t);return this.gr.forEachTarget(e,i=>n.Rr(i.sequenceNumber)).next(()=>this.gr.yr(e,i=>n.Rr(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.gr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ot("LruGarbageCollector","Garbage collection skipped; disabled"),Et.resolve(HT)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(Ot("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),HT):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let n,i,a,o,u,l,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(Ot("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(n=p,u=Date.now(),this.removeTargets(e,n,t))).next(p=>(a=p,l=Date.now(),this.removeOrphanedDocuments(e,n))).next(p=>(h=Date.now(),sc()<=Oe.DEBUG&&Ot("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(u-o)+`ms
	Removed ${a} targets in `+(l-u)+`ms
	Removed ${p} documents in `+(h-l)+`ms
Total Duration: ${h-f}ms`),Et.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:a,documentsRemoved:p})))}}function EP(r,e){return new CP(r,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _P{constructor(){this.changes=new el(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Rr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?Et.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TP{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SP{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&jf(n.mutation,i,Qi.empty(),Xn.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,_e()).next(()=>n))}getLocalViewOfDocuments(e,t,n=_e()){const i=zu();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(a=>{let o=Nf();return a.forEach((u,l)=>{o=o.insert(u,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=zu();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,_e()))}populateOverlays(e,t,n){const i=[];return n.forEach(a=>{t.has(a)||i.push(a)}),this.documentOverlayCache.getOverlays(e,i).next(a=>{a.forEach((o,u)=>{t.set(o,u)})})}computeViews(e,t,n,i){let a=ko();const o=Bf(),u=function(){return Bf()}();return t.forEach((l,h)=>{const f=n.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof nl)?a=a.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),jf(f.mutation,h,f.mutation.getFieldMask(),Xn.now())):o.set(h.key,Qi.empty())}),this.recalculateAndSaveOverlays(e,a).next(l=>(l.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>{var p;return u.set(h,new TP(f,(p=o.get(h))!==null&&p!==void 0?p:null))}),u))}recalculateAndSaveOverlays(e,t){const n=Bf();let i=new vn((o,u)=>o-u),a=_e();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const u of o)u.keys().forEach(l=>{const h=t.get(l);if(h===null)return;let f=n.get(l)||Qi.empty();f=u.applyToLocalView(h,f),n.set(l,f);const p=(i.get(u.batchId)||_e()).add(l);i=i.insert(u.batchId,p)})}).next(()=>{const o=[],u=i.getReverseIterator();for(;u.hasNext();){const l=u.getNext(),h=l.key,f=l.value,p=QA();f.forEach(m=>{if(!a.has(m)){const v=rR(t.get(m),n.get(m));v!==null&&p.set(m,v),a=a.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return Et.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(o){return qt.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):GA(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(a=>{const o=i-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-a.size):Et.resolve(zu());let u=Xf,l=a;return o.next(h=>Et.forEach(h,(f,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),a.get(f)?Et.resolve():this.remoteDocumentCache.getEntry(e,f).next(m=>{l=l.insert(f,m)}))).next(()=>this.populateOverlays(e,h,a)).next(()=>this.computeViews(e,l,h,_e())).next(f=>({batchId:u,changes:YA(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new qt(t)).next(n=>{let i=Nf();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const a=t.collectionGroup;let o=Nf();return this.indexManager.getCollectionParents(e,a).next(u=>Et.forEach(u,l=>{const h=function(p,m){return new Xc(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,l.child(a));return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,i){let a;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(a=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,a,i))).next(o=>{a.forEach((l,h)=>{const f=h.getKey();o.get(f)===null&&(o=o.insert(f,Rr.newInvalidDocument(f)))});let u=Nf();return o.forEach((l,h)=>{const f=a.get(l);f!==void 0&&jf(f.mutation,h,Qi.empty(),Xn.now()),ev(t,h)&&(u=u.insert(l,h))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AP{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return Et.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Da(i.createTime)}}(t)),Et.resolve()}getNamedQuery(e,t){return Et.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,function(i){return{name:i.name,query:gP(i.bundledQuery),readTime:Da(i.readTime)}}(t)),Et.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(){this.overlays=new vn(qt.comparator),this.Qr=new Map}getOverlay(e,t){return Et.resolve(this.overlays.get(t))}getOverlays(e,t){const n=zu();return Et.forEach(t,i=>this.getOverlay(e,i).next(a=>{a!==null&&n.set(i,a)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,a)=>{this.St(e,t,a)}),Et.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Qr.get(n);return i!==void 0&&(i.forEach(a=>this.overlays=this.overlays.remove(a)),this.Qr.delete(n)),Et.resolve()}getOverlaysForCollection(e,t,n){const i=zu(),a=t.length+1,o=new qt(t.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){const l=u.getNext().value,h=l.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===a&&l.largestBatchId>n&&i.set(l.getKey(),l)}return Et.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let a=new vn((h,f)=>h-f);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=a.get(h.largestBatchId);f===null&&(f=zu(),a=a.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=zu(),l=a.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return Et.resolve(u)}St(e,t,n){const i=this.overlays.get(n.key);if(i!==null){const o=this.Qr.get(i.largestBatchId).delete(n.key);this.Qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new $L(t,n));let a=this.Qr.get(t);a===void 0&&(a=_e(),this.Qr.set(t,a)),this.Qr.set(t,a.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP{constructor(){this.sessionToken=wr.EMPTY_BYTE_STRING}getSessionToken(e){return Et.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Et.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2{constructor(){this.$r=new Yn(rr.Ur),this.Kr=new Yn(rr.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){const n=new rr(e,t);this.$r=this.$r.add(n),this.Kr=this.Kr.add(n)}Gr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.zr(new rr(e,t))}jr(e,t){e.forEach(n=>this.removeReference(n,t))}Hr(e){const t=new qt(new an([])),n=new rr(t,e),i=new rr(t,e+1),a=[];return this.Kr.forEachInRange([n,i],o=>{this.zr(o),a.push(o.key)}),a}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){const t=new qt(new an([])),n=new rr(t,e),i=new rr(t,e+1);let a=_e();return this.Kr.forEachInRange([n,i],o=>{a=a.add(o.key)}),a}containsKey(e){const t=new rr(e,0),n=this.$r.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class rr{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return qt.comparator(e.key,t.key)||ve(e.Zr,t.Zr)}static Wr(e,t){return ve(e.Zr,t.Zr)||qt.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IP{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new Yn(rr.Ur)}checkEmpty(e){return Et.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){const a=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new GL(a,t,n,i);this.mutationQueue.push(o);for(const u of i)this.Xr=this.Xr.add(new rr(u.key,a)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return Et.resolve(o)}lookupMutationBatch(e,t){return Et.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.ti(n),a=i<0?0:i;return Et.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return Et.resolve(this.mutationQueue.length===0?P2:this.nr-1)}getAllMutationBatches(e){return Et.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new rr(t,0),i=new rr(t,Number.POSITIVE_INFINITY),a=[];return this.Xr.forEachInRange([n,i],o=>{const u=this.ei(o.Zr);a.push(u)}),Et.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Yn(ve);return t.forEach(i=>{const a=new rr(i,0),o=new rr(i,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([a,o],u=>{n=n.add(u.Zr)})}),Et.resolve(this.ni(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let a=n;qt.isDocumentKey(a)||(a=a.child(""));const o=new rr(new qt(a),0);let u=new Yn(ve);return this.Xr.forEachWhile(l=>{const h=l.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(l.Zr)),!0)},o),Et.resolve(this.ni(u))}ni(e){const t=[];return e.forEach(n=>{const i=this.ei(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){We(this.ri(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Xr;return Et.forEach(t.mutations,i=>{const a=new rr(i.key,t.batchId);return n=n.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Xr=n})}sr(e){}containsKey(e,t){const n=new rr(t,0),i=this.Xr.firstAfterOrEqual(n);return Et.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Et.resolve()}ri(e,t){return this.ti(e)}ti(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ei(e){const t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kP{constructor(e){this.ii=e,this.docs=function(){return new vn(qt.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),a=i?i.size:0,o=this.ii(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-a,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Et.resolve(n?n.document.mutableCopy():Rr.newInvalidDocument(t))}getEntries(e,t){let n=ko();return t.forEach(i=>{const a=this.docs.get(i);n=n.insert(i,a?a.document.mutableCopy():Rr.newInvalidDocument(i))}),Et.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let a=ko();const o=t.path,u=new qt(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){const{key:h,value:{document:f}}=l.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||oL(aL(f),n)<=0||(i.has(f.key)||ev(t,f))&&(a=a.insert(f.key,f.mutableCopy()))}return Et.resolve(a)}getAllFromCollectionGroup(e,t,n,i){Yt(9500)}si(e,t){return Et.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new DP(this)}getSize(e){return Et.resolve(this.size)}}class DP extends _P{constructor(e){super(),this.Br=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Br.addEntry(e,i)):this.Br.removeEntry(n)}),Et.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{constructor(e){this.persistence=e,this.oi=new el(t=>F2(t),B2),this.lastRemoteSnapshotVersion=ae.min(),this.highestTargetId=0,this._i=0,this.ai=new q2,this.targetCount=0,this.ui=Sc.cr()}forEachTarget(e,t){return this.oi.forEach((n,i)=>t(i)),Et.resolve()}getLastRemoteSnapshotVersion(e){return Et.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Et.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),Et.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this._i&&(this._i=t),Et.resolve()}Tr(e){this.oi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ui=new Sc(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,Et.resolve()}updateTargetData(e,t){return this.Tr(t),Et.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,Et.resolve()}removeTargets(e,t,n){let i=0;const a=[];return this.oi.forEach((o,u)=>{u.sequenceNumber<=t&&n.get(u.targetId)===null&&(this.oi.delete(o),a.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),Et.waitFor(a).next(()=>i)}getTargetCount(e){return Et.resolve(this.targetCount)}getTargetData(e,t){const n=this.oi.get(t)||null;return Et.resolve(n)}addMatchingKeys(e,t,n){return this.ai.Gr(t,n),Et.resolve()}removeMatchingKeys(e,t,n){this.ai.jr(t,n);const i=this.persistence.referenceDelegate,a=[];return i&&t.forEach(o=>{a.push(i.markPotentiallyOrphaned(e,o))}),Et.waitFor(a)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),Et.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ai.Yr(t);return Et.resolve(n)}containsKey(e,t){return Et.resolve(this.ai.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e,t){this.ci={},this.overlays={},this.li=new Yg(0),this.hi=!1,this.hi=!0,this.Pi=new NP,this.referenceDelegate=e(this),this.Ti=new OP(this),this.indexManager=new vP,this.remoteDocumentCache=function(i){return new kP(i)}(n=>this.referenceDelegate.Ii(n)),this.serializer=new mP(t),this.Ei=new AP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new RP,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ci[e.toKey()];return n||(n=new IP(t,this.referenceDelegate),this.ci[e.toKey()]=n),n}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,n){Ot("MemoryPersistence","Starting transaction:",e);const i=new MP(this.li.next());return this.referenceDelegate.di(),n(i).next(a=>this.referenceDelegate.Ai(i).next(()=>a)).toPromise().then(a=>(i.raiseOnCommittedEvent(),a))}Ri(e,t){return Et.or(Object.values(this.ci).map(n=>()=>n.containsKey(e,t)))}}class MP extends uL{constructor(e){super(),this.currentSequenceNumber=e}}class G2{constructor(e){this.persistence=e,this.Vi=new q2,this.mi=null}static fi(e){return new G2(e)}get gi(){if(this.mi)return this.mi;throw Yt(60996)}addReference(e,t,n){return this.Vi.addReference(n,t),this.gi.delete(n.toString()),Et.resolve()}removeReference(e,t,n){return this.Vi.removeReference(n,t),this.gi.add(n.toString()),Et.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),Et.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(i=>this.gi.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(a=>this.gi.add(a.toString()))}).next(()=>n.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Et.forEach(this.gi,n=>{const i=qt.fromPath(n);return this.pi(e,i).next(a=>{a||t.removeEntry(i,ae.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(n=>{n?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return Et.or([()=>Et.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class _g{constructor(e,t){this.persistence=e,this.yi=new el(n=>hL(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=EP(this,t)}static fi(e,t){return new _g(e,t)}di(){}Ai(e){return Et.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){const t=this.br(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}br(e){let t=0;return this.yr(e,n=>{t++}).next(()=>t)}yr(e,t){return Et.forEach(this.yi,(n,i)=>this.Dr(e,n,i).next(a=>a?Et.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),a=i.newChangeBuffer();return i.si(e,o=>this.Dr(e,o,t).next(u=>{u||(n++,a.removeEntry(o,ae.min()))})).next(()=>a.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),Et.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),Et.resolve()}removeReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),Et.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),Et.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Gm(e.data.value)),t}Dr(e,t,n){return Et.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.yi.get(t);return Et.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.ds=n,this.As=i}static Rs(e,t){let n=_e(),i=_e();for(const a of t.docChanges)switch(a.type){case 0:n=n.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}return new $2(e,t.fromCache,n,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LP{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return N7()?8:lL(A7())>0?6:4}()}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,n,i){const a={result:null};return this.ws(e,t).next(o=>{a.result=o}).next(()=>{if(!a.result)return this.bs(e,t,i,n).next(o=>{a.result=o})}).next(()=>{if(a.result)return;const o=new LP;return this.Ss(e,t,o).next(u=>{if(a.result=u,this.fs)return this.Ds(e,t,o,u.size)})}).next(()=>a.result)}Ds(e,t,n,i){return n.documentReadCount<this.gs?(sc()<=Oe.DEBUG&&Ot("QueryEngine","SDK will not create cache indexes for query:",uc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),Et.resolve()):(sc()<=Oe.DEBUG&&Ot("QueryEngine","Query:",uc(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ps*i?(sc()<=Oe.DEBUG&&Ot("QueryEngine","The SDK decides to create cache indexes for query:",uc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ka(t))):Et.resolve())}ws(e,t){if(MT(t))return Et.resolve(null);let n=ka(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=wb(t,null,"F"),n=ka(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(a=>{const o=_e(...a);return this.ys.getDocuments(e,o).next(u=>this.indexManager.getMinOffset(e,n).next(l=>{const h=this.vs(t,u);return this.Cs(t,h,o,l.readTime)?this.ws(e,wb(t,null,"F")):this.Fs(e,h,t,l)}))})))}bs(e,t,n,i){return MT(t)||i.isEqual(ae.min())?Et.resolve(null):this.ys.getDocuments(e,n).next(a=>{const o=this.vs(t,a);return this.Cs(t,o,n,i)?Et.resolve(null):(sc()<=Oe.DEBUG&&Ot("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),uc(t)),this.Fs(e,o,t,iL(i,Xf)).next(u=>u))})}vs(e,t){let n=new Yn(KA(e));return t.forEach((i,a)=>{ev(e,a)&&(n=n.add(a))}),n}Cs(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const a=e.limitType==="F"?t.last():t.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(i)>0)}Ss(e,t,n){return sc()<=Oe.DEBUG&&Ot("QueryEngine","Using full collection scan to execute query:",uc(t)),this.ys.getDocumentsMatchingQuery(e,t,Os.min(),n)}Fs(e,t,n,i){return this.ys.getDocumentsMatchingQuery(e,n,i).next(a=>(t.forEach(o=>{a=a.insert(o.key,o)}),a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K2="LocalStore",zP=3e8;class VP{constructor(e,t,n,i){this.persistence=e,this.Ms=t,this.serializer=i,this.xs=new vn(ve),this.Os=new el(a=>F2(a),B2),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(n)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new SP(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}}function FP(r,e,t,n){return new VP(r,e,t,n)}async function yR(r,e){const t=oe(r);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(a=>(i=a,t.Ls(e),t.mutationQueue.getAllMutationBatches(n))).next(a=>{const o=[],u=[];let l=_e();for(const h of i){o.push(h.batchId);for(const f of h.mutations)l=l.add(f.key)}for(const h of a){u.push(h.batchId);for(const f of h.mutations)l=l.add(f.key)}return t.localDocuments.getDocuments(n,l).next(h=>({ks:h,removedBatchIds:o,addedBatchIds:u}))})})}function BP(r,e){const t=oe(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),a=t.Bs.newChangeBuffer({trackRemovals:!0});return function(u,l,h,f){const p=h.batch,m=p.keys();let v=Et.resolve();return m.forEach(b=>{v=v.next(()=>f.getEntry(l,b)).next(C=>{const w=h.docVersions.get(b);We(w!==null,48541),C.version.compareTo(w)<0&&(p.applyToRemoteDocument(C,h),C.isValidDocument()&&(C.setReadTime(h.commitVersion),f.addEntry(C)))})}),v.next(()=>u.mutationQueue.removeMutationBatch(l,p))}(t,n,e,a).next(()=>a.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let l=_e();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(l=l.add(u.batch.mutations[h].key));return l}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function bR(r){const e=oe(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}function jP(r,e){const t=oe(r),n=e.snapshotVersion;let i=t.xs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const o=t.Bs.newChangeBuffer({trackRemovals:!0});i=t.xs;const u=[];e.targetChanges.forEach((f,p)=>{const m=i.get(p);if(!m)return;u.push(t.Ti.removeMatchingKeys(a,f.removedDocuments,p).next(()=>t.Ti.addMatchingKeys(a,f.addedDocuments,p)));let v=m.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(p)!==null?v=v.withResumeToken(wr.EMPTY_BYTE_STRING,ae.min()).withLastLimboFreeSnapshotVersion(ae.min()):f.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(f.resumeToken,n)),i=i.insert(p,v),function(C,w,E){return C.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=zP?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0}(m,v,f)&&u.push(t.Ti.updateTargetData(a,v))});let l=ko(),h=_e();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(a,f))}),u.push(UP(a,o,e.documentUpdates).next(f=>{l=f.qs,h=f.Qs})),!n.isEqual(ae.min())){const f=t.Ti.getLastRemoteSnapshotVersion(a).next(p=>t.Ti.setTargetsMetadata(a,a.currentSequenceNumber,n));u.push(f)}return Et.waitFor(u).next(()=>o.apply(a)).next(()=>t.localDocuments.getLocalViewOfDocuments(a,l,h)).next(()=>l)}).then(a=>(t.xs=i,a))}function UP(r,e,t){let n=_e(),i=_e();return t.forEach(a=>n=n.add(a)),e.getEntries(r,n).next(a=>{let o=ko();return t.forEach((u,l)=>{const h=a.get(u);l.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),l.isNoDocument()&&l.version.isEqual(ae.min())?(e.removeEntry(u,l.readTime),o=o.insert(u,l)):!h.isValidDocument()||l.version.compareTo(h.version)>0||l.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(l),o=o.insert(u,l)):Ot(K2,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",l.version)}),{qs:o,Qs:i}})}function WP(r,e){const t=oe(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=P2),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function HP(r,e){const t=oe(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Ti.getTargetData(n,e).next(a=>a?(i=a,Et.resolve(i)):t.Ti.allocateTargetId(n).next(o=>(i=new bs(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ti.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.xs.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.xs=t.xs.insert(n.targetId,n),t.Os.set(e,n.targetId)),n})}async function Sb(r,e,t){const n=oe(r),i=n.xs.get(e),a=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",a,o=>n.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!Kc(o))throw o;Ot(K2,`Failed to update sequence numbers for target ${e}: ${o}`)}n.xs=n.xs.remove(e),n.Os.delete(i.target)}function $T(r,e,t){const n=oe(r);let i=ae.min(),a=_e();return n.persistence.runTransaction("Execute query","readwrite",o=>function(l,h,f){const p=oe(l),m=p.Os.get(f);return m!==void 0?Et.resolve(p.xs.get(m)):p.Ti.getTargetData(h,f)}(n,o,ka(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Ti.getMatchingKeysForTargetId(o,u.targetId).next(l=>{a=l})}).next(()=>n.Ms.getDocumentsMatchingQuery(o,e,t?i:ae.min(),t?a:_e())).next(u=>(qP(n,IL(e),u),{documents:u,$s:a})))}function qP(r,e,t){let n=r.Ns.get(e)||ae.min();t.forEach((i,a)=>{a.readTime.compareTo(n)>0&&(n=a.readTime)}),r.Ns.set(e,n)}class KT{constructor(){this.activeTargetIds=PL()}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class GP{constructor(){this.xo=new KT,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,n){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new KT,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $P{No(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XT="ConnectivityMonitor";class YT{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){Ot(XT,"Network connectivity changed: AVAILABLE");for(const e of this.Qo)e(0)}qo(){Ot(XT,"Network connectivity changed: UNAVAILABLE");for(const e of this.Qo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sm=null;function Ab(){return Sm===null?Sm=function(){return 268435456+Math.round(2147483648*Math.random())}():Sm++,"0x"+Sm.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S1="RestConnection",KP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class XP{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${n}/databases/${i}`,this.Go=this.databaseId.database===bg?`project_id=${n}`:`project_id=${n}&database_id=${i}`}zo(e,t,n,i,a){const o=Ab(),u=this.jo(e,t.toUriEncodedString());Ot(S1,`Sending RPC '${e}' ${o}:`,u,n);const l={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(l,i,a);const{host:h}=new URL(u),f=O2(h);return this.Jo(e,u,l,n,f).then(p=>(Ot(S1,`Received RPC '${e}' ${o}: `,p),p),p=>{throw Cc(S1,`RPC '${e}' ${o} failed with error: `,p,"url: ",u,"request:",n),p})}Yo(e,t,n,i,a,o){return this.zo(e,t,n,i,a)}Ho(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Gc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,a)=>e[a]=i),n&&n.headers.forEach((i,a)=>e[a]=i)}jo(e,t){const n=KP[e];return`${this.Ko}/v1/${t}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YP{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sr="WebChannelConnection";class QP extends XP{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,a){const o=Ab();return new Promise((u,l)=>{const h=new wA;h.setWithCredentials(!0),h.listenOnce(CA.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case qm.NO_ERROR:const p=h.getResponseJson();Ot(Sr,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),u(p);break;case qm.TIMEOUT:Ot(Sr,`RPC '${e}' ${o} timed out`),l(new Lt(_t.DEADLINE_EXCEEDED,"Request time out"));break;case qm.HTTP_ERROR:const m=h.getStatus();if(Ot(Sr,`RPC '${e}' ${o} failed with status:`,m,"response text:",h.getResponseText()),m>0){let v=h.getResponseJson();Array.isArray(v)&&(v=v[0]);const b=v==null?void 0:v.error;if(b&&b.status&&b.message){const C=function(E){const S=E.toLowerCase().replace(/_/g,"-");return Object.values(_t).indexOf(S)>=0?S:_t.UNKNOWN}(b.status);l(new Lt(C,b.message))}else l(new Lt(_t.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new Lt(_t.UNAVAILABLE,"Connection failed."));break;default:Yt(9055,{h_:e,streamId:o,P_:h.getLastErrorCode(),T_:h.getLastError()})}}finally{Ot(Sr,`RPC '${e}' ${o} completed.`)}});const f=JSON.stringify(i);Ot(Sr,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",f,n,15)})}I_(e,t,n){const i=Ab(),a=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=TA(),u=_A(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(l.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Ho(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;const f=a.join("");Ot(Sr,`Creating RPC '${e}' stream ${i}: ${f}`,l);const p=o.createWebChannel(f,l);this.E_(p);let m=!1,v=!1;const b=new YP({Zo:w=>{v?Ot(Sr,`Not sending because RPC '${e}' stream ${i} is closed:`,w):(m||(Ot(Sr,`Opening RPC '${e}' stream ${i} transport.`),p.open(),m=!0),Ot(Sr,`RPC '${e}' stream ${i} sending:`,w),p.send(w))},Xo:()=>p.close()}),C=(w,E,S)=>{w.listen(E,A=>{try{S(A)}catch(k){setTimeout(()=>{throw k},0)}})};return C(p,Rf.EventType.OPEN,()=>{v||(Ot(Sr,`RPC '${e}' stream ${i} transport opened.`),b.__())}),C(p,Rf.EventType.CLOSE,()=>{v||(v=!0,Ot(Sr,`RPC '${e}' stream ${i} transport closed`),b.u_(),this.d_(p))}),C(p,Rf.EventType.ERROR,w=>{v||(v=!0,Cc(Sr,`RPC '${e}' stream ${i} transport errored. Name:`,w.name,"Message:",w.message),b.u_(new Lt(_t.UNAVAILABLE,"The operation could not be completed")))}),C(p,Rf.EventType.MESSAGE,w=>{var E;if(!v){const S=w.data[0];We(!!S,16349);const A=S,k=(A==null?void 0:A.error)||((E=A[0])===null||E===void 0?void 0:E.error);if(k){Ot(Sr,`RPC '${e}' stream ${i} received error:`,k);const O=k.status;let V=function(N){const D=Ln[N];if(D!==void 0)return oR(D)}(O),T=k.message;V===void 0&&(V=_t.INTERNAL,T="Unknown error status: "+O+" with message "+k.message),v=!0,b.u_(new Lt(V,T)),p.close()}else Ot(Sr,`RPC '${e}' stream ${i} received:`,S),b.c_(S)}}),C(u,EA.STAT_EVENT,w=>{w.stat===pb.PROXY?Ot(Sr,`RPC '${e}' stream ${i} detected buffering proxy`):w.stat===pb.NOPROXY&&Ot(Sr,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{b.a_()},0),b}terminate(){this.l_.forEach(e=>e.close()),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter(t=>t===e)}}function A1(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ov(r){return new eP(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(e,t,n=1e3,i=1.5,a=6e4){this.xi=e,this.timerId=t,this.A_=n,this.R_=i,this.V_=a,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();const t=Math.floor(this.m_+this.w_()),n=Math.max(0,Date.now()-this.g_),i=Math.max(0,t-n);i>0&&Ot("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,i,()=>(this.g_=Date.now(),e())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){this.f_!==null&&(this.f_.skipDelay(),this.f_=null)}cancel(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QT="PersistentStream";class wR{constructor(e,t,n,i,a,o,u,l){this.xi=e,this.S_=n,this.D_=i,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new xR(e,t)}O_(){return this.state===1||this.state===5||this.N_()}N_(){return this.state===2||this.state===3}start(){this.M_=0,this.state!==4?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&this.C_===null&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(e){this.U_(),this.stream.send(e)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(e,t){this.U_(),this.K_(),this.x_.cancel(),this.v_++,e!==4?this.x_.reset():t&&t.code===_t.RESOURCE_EXHAUSTED?(Io(t.toString()),Io("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):t&&t.code===_t.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}W_(){}auth(){this.state=1;const e=this.G_(this.v_),t=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.v_===t&&this.z_(n,i)},n=>{e(()=>{const i=new Lt(_t.UNKNOWN,"Fetching auth token failed: "+n.message);return this.j_(i)})})}z_(e,t){const n=this.G_(this.v_);this.stream=this.H_(e,t),this.stream.e_(()=>{n(()=>this.listener.e_())}),this.stream.n_(()=>{n(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(i=>{n(()=>this.j_(i))}),this.stream.onMessage(i=>{n(()=>++this.M_==1?this.J_(i):this.onNext(i))})}B_(){this.state=5,this.x_.y_(async()=>{this.state=0,this.start()})}j_(e){return Ot(QT,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return t=>{this.xi.enqueueAndForget(()=>this.v_===e?t():(Ot(QT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ZP extends wR{constructor(e,t,n,i,a,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,o),this.serializer=a}H_(e,t){return this.connection.I_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.x_.reset();const t=iP(this.serializer,e),n=function(a){if(!("targetChange"in a))return ae.min();const o=a.targetChange;return o.targetIds&&o.targetIds.length?ae.min():o.readTime?Da(o.readTime):ae.min()}(e);return this.listener.Y_(t,n)}Z_(e){const t={};t.database=Tb(this.serializer),t.addTarget=function(a,o){let u;const l=o.target;if(u=bb(l)?{documents:sP(a,l)}:{query:uP(a,l).gt},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=lR(a,o.resumeToken);const h=Cb(a,o.expectedCount);h!==null&&(u.expectedCount=h)}else if(o.snapshotVersion.compareTo(ae.min())>0){u.readTime=Eg(a,o.snapshotVersion.toTimestamp());const h=Cb(a,o.expectedCount);h!==null&&(u.expectedCount=h)}return u}(this.serializer,e);const n=cP(this.serializer,e);n&&(t.labels=n),this.Q_(t)}X_(e){const t={};t.database=Tb(this.serializer),t.removeTarget=e,this.Q_(t)}}class JP extends wR{constructor(e,t,n,i,a,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=a}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(e,t){return this.connection.I_("Write",e,t)}J_(e){return We(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,We(!e.writeResults||e.writeResults.length===0,55816),this.listener.na()}onNext(e){We(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.x_.reset();const t=oP(e.writeResults,e.commitTime),n=Da(e.commitTime);return this.listener.ra(n,t)}ia(){const e={};e.database=Tb(this.serializer),this.Q_(e)}ta(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>aP(this.serializer,n))};this.Q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tz{}class ez extends tz{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.sa=!1}oa(){if(this.sa)throw new Lt(_t.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,n,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.zo(e,Eb(t,n),i,a,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===_t.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Lt(_t.UNKNOWN,a.toString())})}Yo(e,t,n,i,a){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Yo(e,Eb(t,n),i,o,u,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===_t.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Lt(_t.UNKNOWN,o.toString())})}terminate(){this.sa=!0,this.connection.terminate()}}class nz{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){this._a===0&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(e){this.state==="Online"?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,e==="Online"&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(Io(t),this.ua=!1):Ot("OnlineStateTracker",t)}Ta(){this.aa!==null&&(this.aa.cancel(),this.aa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ku="RemoteStore";class rz{constructor(e,t,n,i,a){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=a,this.Ra.No(o=>{n.enqueueAndForget(async()=>{rl(this)&&(Ot(Ku,"Restarting streams for network reachability change."),await async function(l){const h=oe(l);h.da.add(4),await Td(h),h.Va.set("Unknown"),h.da.delete(4),await sv(h)}(this))})}),this.Va=new nz(n,i)}}async function sv(r){if(rl(r))for(const e of r.Aa)await e(!0)}async function Td(r){for(const e of r.Aa)await e(!1)}function CR(r,e){const t=oe(r);t.Ea.has(e.targetId)||(t.Ea.set(e.targetId,e),Z2(t)?Q2(t):Yc(t).N_()&&Y2(t,e))}function X2(r,e){const t=oe(r),n=Yc(t);t.Ea.delete(e),n.N_()&&ER(t,e),t.Ea.size===0&&(n.N_()?n.k_():rl(t)&&t.Va.set("Unknown"))}function Y2(r,e){if(r.ma.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ae.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Yc(r).Z_(e)}function ER(r,e){r.ma.Ke(e),Yc(r).X_(e)}function Q2(r){r.ma=new QL({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>r.Ea.get(e)||null,Pt:()=>r.datastore.serializer.databaseId}),Yc(r).start(),r.Va.ca()}function Z2(r){return rl(r)&&!Yc(r).O_()&&r.Ea.size>0}function rl(r){return oe(r).da.size===0}function _R(r){r.ma=void 0}async function iz(r){r.Va.set("Online")}async function az(r){r.Ea.forEach((e,t)=>{Y2(r,e)})}async function oz(r,e){_R(r),Z2(r)?(r.Va.Pa(e),Q2(r)):r.Va.set("Unknown")}async function sz(r,e,t){if(r.Va.set("Online"),e instanceof uR&&e.state===2&&e.cause)try{await async function(i,a){const o=a.cause;for(const u of a.targetIds)i.Ea.has(u)&&(await i.remoteSyncer.rejectListen(u,o),i.Ea.delete(u),i.ma.removeTarget(u))}(r,e)}catch(n){Ot(Ku,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Tg(r,n)}else if(e instanceof Xm?r.ma.Xe(e):e instanceof sR?r.ma.ot(e):r.ma.nt(e),!t.isEqual(ae.min()))try{const n=await bR(r.localStore);t.compareTo(n)>=0&&await function(a,o){const u=a.ma.It(o);return u.targetChanges.forEach((l,h)=>{if(l.resumeToken.approximateByteSize()>0){const f=a.Ea.get(h);f&&a.Ea.set(h,f.withResumeToken(l.resumeToken,o))}}),u.targetMismatches.forEach((l,h)=>{const f=a.Ea.get(l);if(!f)return;a.Ea.set(l,f.withResumeToken(wr.EMPTY_BYTE_STRING,f.snapshotVersion)),ER(a,l);const p=new bs(f.target,l,h,f.sequenceNumber);Y2(a,p)}),a.remoteSyncer.applyRemoteEvent(u)}(r,t)}catch(n){Ot(Ku,"Failed to raise snapshot:",n),await Tg(r,n)}}async function Tg(r,e,t){if(!Kc(e))throw e;r.da.add(1),await Td(r),r.Va.set("Offline"),t||(t=()=>bR(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{Ot(Ku,"Retrying IndexedDB access"),await t(),r.da.delete(1),await sv(r)})}function TR(r,e){return e().catch(t=>Tg(r,t,e))}async function uv(r){const e=oe(r),t=zs(e);let n=e.Ia.length>0?e.Ia[e.Ia.length-1].batchId:P2;for(;uz(e);)try{const i=await WP(e.localStore,n);if(i===null){e.Ia.length===0&&t.k_();break}n=i.batchId,lz(e,i)}catch(i){await Tg(e,i)}SR(e)&&AR(e)}function uz(r){return rl(r)&&r.Ia.length<10}function lz(r,e){r.Ia.push(e);const t=zs(r);t.N_()&&t.ea&&t.ta(e.mutations)}function SR(r){return rl(r)&&!zs(r).O_()&&r.Ia.length>0}function AR(r){zs(r).start()}async function cz(r){zs(r).ia()}async function hz(r){const e=zs(r);for(const t of r.Ia)e.ta(t.mutations)}async function fz(r,e,t){const n=r.Ia.shift(),i=U2.from(n,e,t);await TR(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),await uv(r)}async function dz(r,e){e&&zs(r).ea&&await async function(n,i){if(function(o){return XL(o)&&o!==_t.ABORTED}(i.code)){const a=n.Ia.shift();zs(n).L_(),await TR(n,()=>n.remoteSyncer.rejectFailedWrite(a.batchId,i)),await uv(n)}}(r,e),SR(r)&&AR(r)}async function ZT(r,e){const t=oe(r);t.asyncQueue.verifyOperationInProgress(),Ot(Ku,"RemoteStore received new credentials");const n=rl(t);t.da.add(3),await Td(t),n&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.da.delete(3),await sv(t)}async function pz(r,e){const t=oe(r);e?(t.da.delete(2),await sv(t)):e||(t.da.add(2),await Td(t),t.Va.set("Unknown"))}function Yc(r){return r.fa||(r.fa=function(t,n,i){const a=oe(t);return a.oa(),new ZP(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(r.datastore,r.asyncQueue,{e_:iz.bind(null,r),n_:az.bind(null,r),i_:oz.bind(null,r),Y_:sz.bind(null,r)}),r.Aa.push(async e=>{e?(r.fa.L_(),Z2(r)?Q2(r):r.Va.set("Unknown")):(await r.fa.stop(),_R(r))})),r.fa}function zs(r){return r.ga||(r.ga=function(t,n,i){const a=oe(t);return a.oa(),new JP(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(r.datastore,r.asyncQueue,{e_:()=>Promise.resolve(),n_:cz.bind(null,r),i_:dz.bind(null,r),na:hz.bind(null,r),ra:fz.bind(null,r)}),r.Aa.push(async e=>{e?(r.ga.L_(),await uv(r)):(await r.ga.stop(),r.Ia.length>0&&(Ot(Ku,`Stopping write stream with ${r.Ia.length} pending writes`),r.Ia=[]))})),r.ga}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J2{constructor(e,t,n,i,a){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=a,this.deferred=new Ss,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,a){const o=Date.now()+n,u=new J2(e,t,o,i,a);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Lt(_t.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function tx(r,e){if(Io("AsyncQueue",`${e}: ${r}`),Kc(r))return new Lt(_t.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{static emptySet(e){return new vc(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||qt.comparator(t.key,n.key):(t,n)=>qt.comparator(t.key,n.key),this.keyedMap=Nf(),this.sortedSet=new vn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof vc)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=n.getNext().key;if(!i.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new vc;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JT{constructor(){this.pa=new vn(qt.comparator)}track(e){const t=e.doc.key,n=this.pa.get(t);n?e.type!==0&&n.type===3?this.pa=this.pa.insert(t,e):e.type===3&&n.type!==1?this.pa=this.pa.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.pa=this.pa.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.pa=this.pa.remove(t):e.type===1&&n.type===2?this.pa=this.pa.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):Yt(63341,{Vt:e,ya:n}):this.pa=this.pa.insert(t,e)}wa(){const e=[];return this.pa.inorderTraversal((t,n)=>{e.push(n)}),e}}class Ac{constructor(e,t,n,i,a,o,u,l,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,a){const o=[];return t.forEach(u=>{o.push({type:0,doc:u})}),new Ac(e,t,vc.emptySet(t),o,n,i,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&tv(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mz{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(e=>e.va())}}class gz{constructor(){this.queries=tS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const i=oe(t),a=i.queries;i.queries=tS(),a.forEach((o,u)=>{for(const l of u.Sa)l.onError(n)})})(this,new Lt(_t.ABORTED,"Firestore shutting down"))}}function tS(){return new el(r=>$A(r),tv)}async function RR(r,e){const t=oe(r);let n=3;const i=e.query;let a=t.queries.get(i);a?!a.Da()&&e.va()&&(n=2):(a=new mz,n=e.va()?0:1);try{switch(n){case 0:a.ba=await t.onListen(i,!0);break;case 1:a.ba=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){const u=tx(o,`Initialization of query '${uc(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,a),a.Sa.push(e),e.Fa(t.onlineState),a.ba&&e.Ma(a.ba)&&ex(t)}async function NR(r,e){const t=oe(r),n=e.query;let i=3;const a=t.queries.get(n);if(a){const o=a.Sa.indexOf(e);o>=0&&(a.Sa.splice(o,1),a.Sa.length===0?i=e.va()?0:1:!a.Da()&&e.va()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function vz(r,e){const t=oe(r);let n=!1;for(const i of e){const a=i.query,o=t.queries.get(a);if(o){for(const u of o.Sa)u.Ma(i)&&(n=!0);o.ba=i}}n&&ex(t)}function yz(r,e,t){const n=oe(r),i=n.queries.get(e);if(i)for(const a of i.Sa)a.onError(t);n.queries.delete(e)}function ex(r){r.Ca.forEach(e=>{e.next()})}var Rb,eS;(eS=Rb||(Rb={})).xa="default",eS.Cache="cache";class IR{constructor(e,t,n){this.query=e,this.Oa=t,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=n||{}}Ma(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)i.type!==3&&n.push(i);e=new Ac(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Na?this.La(e)&&(this.Oa.next(e),t=!0):this.ka(e,this.onlineState)&&(this.qa(e),t=!0),this.Ba=e,t}onError(e){this.Oa.error(e)}Fa(e){this.onlineState=e;let t=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,e)&&(this.qa(this.Ba),t=!0),t}ka(e,t){if(!e.fromCache||!this.va())return!0;const n=t!=="Offline";return(!this.options.Qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}La(e){if(e.docChanges.length>0)return!0;const t=this.Ba&&this.Ba.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}qa(e){e=Ac.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Na=!0,this.Oa.next(e)}va(){return this.options.source!==Rb.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kR{constructor(e){this.key=e}}class DR{constructor(e){this.key=e}}class bz{constructor(e,t){this.query=e,this.Ha=t,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=_e(),this.mutatedKeys=_e(),this.Za=KA(e),this.Xa=new vc(this.Za)}get eu(){return this.Ha}tu(e,t){const n=t?t.nu:new JT,i=t?t.Xa:this.Xa;let a=t?t.mutatedKeys:this.mutatedKeys,o=i,u=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,p)=>{const m=i.get(f),v=ev(this.query,p)?p:null,b=!!m&&this.mutatedKeys.has(m.key),C=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let w=!1;m&&v?m.data.isEqual(v.data)?b!==C&&(n.track({type:3,doc:v}),w=!0):this.ru(m,v)||(n.track({type:2,doc:v}),w=!0,(l&&this.Za(v,l)>0||h&&this.Za(v,h)<0)&&(u=!0)):!m&&v?(n.track({type:0,doc:v}),w=!0):m&&!v&&(n.track({type:1,doc:m}),w=!0,(l||h)&&(u=!0)),w&&(v?(o=o.add(v),a=C?a.add(f):a.delete(f)):(o=o.delete(f),a=a.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),a=a.delete(f.key),n.track({type:1,doc:f})}return{Xa:o,nu:n,Cs:u,mutatedKeys:a}}ru(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const a=this.Xa;this.Xa=e.Xa,this.mutatedKeys=e.mutatedKeys;const o=e.nu.wa();o.sort((f,p)=>function(v,b){const C=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Yt(20277,{Vt:w})}};return C(v)-C(b)}(f.type,p.type)||this.Za(f.doc,p.doc)),this.iu(n),i=i!=null&&i;const u=t&&!i?this.su():[],l=this.Ya.size===0&&this.current&&!i?1:0,h=l!==this.Ja;return this.Ja=l,o.length!==0||h?{snapshot:new Ac(this.query,e.Xa,a,o,e.mutatedKeys,l===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),ou:u}:{ou:u}}Fa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new JT,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(e){return!this.Ha.has(e)&&!!this.Xa.has(e)&&!this.Xa.get(e).hasLocalMutations}iu(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}su(){if(!this.current)return[];const e=this.Ya;this.Ya=_e(),this.Xa.forEach(n=>{this._u(n.key)&&(this.Ya=this.Ya.add(n.key))});const t=[];return e.forEach(n=>{this.Ya.has(n)||t.push(new DR(n))}),this.Ya.forEach(n=>{e.has(n)||t.push(new kR(n))}),t}au(e){this.Ha=e.$s,this.Ya=_e();const t=this.tu(e.documents);return this.applyChanges(t,!0)}uu(){return Ac.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,this.Ja===0,this.hasCachedResults)}}const nx="SyncEngine";class xz{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class wz{constructor(e){this.key=e,this.cu=!1}}class Cz{constructor(e,t,n,i,a,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.lu={},this.hu=new el(u=>$A(u),tv),this.Pu=new Map,this.Tu=new Set,this.Iu=new vn(qt.comparator),this.Eu=new Map,this.du=new q2,this.Au={},this.Ru=new Map,this.Vu=Sc.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return this.mu===!0}}async function Ez(r,e,t=!0){const n=VR(r);let i;const a=n.hu.get(e);return a?(n.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.uu()):i=await OR(n,e,t,!0),i}async function _z(r,e){const t=VR(r);await OR(t,e,!0,!1)}async function OR(r,e,t,n){const i=await HP(r.localStore,ka(e)),a=i.targetId,o=r.sharedClientState.addLocalQueryTarget(a,t);let u;return n&&(u=await Tz(r,e,a,o==="current",i.resumeToken)),r.isPrimaryClient&&t&&CR(r.remoteStore,i),u}async function Tz(r,e,t,n,i){r.fu=(p,m,v)=>async function(C,w,E,S){let A=w.view.tu(E);A.Cs&&(A=await $T(C.localStore,w.query,!1).then(({documents:T})=>w.view.tu(T,A)));const k=S&&S.targetChanges.get(w.targetId),O=S&&S.targetMismatches.get(w.targetId)!=null,V=w.view.applyChanges(A,C.isPrimaryClient,k,O);return rS(C,w.targetId,V.ou),V.snapshot}(r,p,m,v);const a=await $T(r.localStore,e,!0),o=new bz(e,a.$s),u=o.tu(a.documents),l=_d.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),h=o.applyChanges(u,r.isPrimaryClient,l);rS(r,t,h.ou);const f=new xz(e,t,o);return r.hu.set(e,f),r.Pu.has(t)?r.Pu.get(t).push(e):r.Pu.set(t,[e]),h.snapshot}async function Sz(r,e,t){const n=oe(r),i=n.hu.get(e),a=n.Pu.get(i.targetId);if(a.length>1)return n.Pu.set(i.targetId,a.filter(o=>!tv(o,e))),void n.hu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Sb(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&X2(n.remoteStore,i.targetId),Nb(n,i.targetId)}).catch($c)):(Nb(n,i.targetId),await Sb(n.localStore,i.targetId,!0))}async function Az(r,e){const t=oe(r),n=t.hu.get(e),i=t.Pu.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),X2(t.remoteStore,n.targetId))}async function Rz(r,e,t){const n=Lz(r);try{const i=await function(o,u){const l=oe(o),h=Xn.now(),f=u.reduce((v,b)=>v.add(b.key),_e());let p,m;return l.persistence.runTransaction("Locally write mutations","readwrite",v=>{let b=ko(),C=_e();return l.Bs.getEntries(v,f).next(w=>{b=w,b.forEach((E,S)=>{S.isValidDocument()||(C=C.add(E))})}).next(()=>l.localDocuments.getOverlayedDocuments(v,b)).next(w=>{p=w;const E=[];for(const S of u){const A=HL(S,p.get(S.key).overlayedDocument);A!=null&&E.push(new nl(S.key,A,FA(A.value.mapValue),Eo.exists(!0)))}return l.mutationQueue.addMutationBatch(v,h,E,u)}).next(w=>{m=w;const E=w.applyToLocalDocumentSet(p,C);return l.documentOverlayCache.saveOverlays(v,w.batchId,E)})}).then(()=>({batchId:m.batchId,changes:YA(p)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(o,u,l){let h=o.Au[o.currentUser.toKey()];h||(h=new vn(ve)),h=h.insert(u,l),o.Au[o.currentUser.toKey()]=h}(n,i.batchId,t),await Sd(n,i.changes),await uv(n.remoteStore)}catch(i){const a=tx(i,"Failed to persist write");t.reject(a)}}async function MR(r,e){const t=oe(r);try{const n=await jP(t.localStore,e);e.targetChanges.forEach((i,a)=>{const o=t.Eu.get(a);o&&(We(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.cu=!0:i.modifiedDocuments.size>0?We(o.cu,14607):i.removedDocuments.size>0&&(We(o.cu,42227),o.cu=!1))}),await Sd(t,n,e)}catch(n){await $c(n)}}function nS(r,e,t){const n=oe(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const i=[];n.hu.forEach((a,o)=>{const u=o.view.Fa(e);u.snapshot&&i.push(u.snapshot)}),function(o,u){const l=oe(o);l.onlineState=u;let h=!1;l.queries.forEach((f,p)=>{for(const m of p.Sa)m.Fa(u)&&(h=!0)}),h&&ex(l)}(n.eventManager,e),i.length&&n.lu.Y_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function Nz(r,e,t){const n=oe(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Eu.get(e),a=i&&i.key;if(a){let o=new vn(qt.comparator);o=o.insert(a,Rr.newNoDocument(a,ae.min()));const u=_e().add(a),l=new av(ae.min(),new Map,new vn(ve),o,u);await MR(n,l),n.Iu=n.Iu.remove(a),n.Eu.delete(e),rx(n)}else await Sb(n.localStore,e,!1).then(()=>Nb(n,e,t)).catch($c)}async function Iz(r,e){const t=oe(r),n=e.batch.batchId;try{const i=await BP(t.localStore,e);PR(t,n,null),LR(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Sd(t,i)}catch(i){await $c(i)}}async function kz(r,e,t){const n=oe(r);try{const i=await function(o,u){const l=oe(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return l.mutationQueue.lookupMutationBatch(h,u).next(p=>(We(p!==null,37113),f=p.keys(),l.mutationQueue.removeMutationBatch(h,p))).next(()=>l.mutationQueue.performConsistencyCheck(h)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>l.localDocuments.getDocuments(h,f))})}(n.localStore,e);PR(n,e,t),LR(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Sd(n,i)}catch(i){await $c(i)}}function LR(r,e){(r.Ru.get(e)||[]).forEach(t=>{t.resolve()}),r.Ru.delete(e)}function PR(r,e,t){const n=oe(r);let i=n.Au[n.currentUser.toKey()];if(i){const a=i.get(e);a&&(t?a.reject(t):a.resolve(),i=i.remove(e)),n.Au[n.currentUser.toKey()]=i}}function Nb(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Pu.get(e))r.hu.delete(n),t&&r.lu.gu(n,t);r.Pu.delete(e),r.isPrimaryClient&&r.du.Hr(e).forEach(n=>{r.du.containsKey(n)||zR(r,n)})}function zR(r,e){r.Tu.delete(e.path.canonicalString());const t=r.Iu.get(e);t!==null&&(X2(r.remoteStore,t),r.Iu=r.Iu.remove(e),r.Eu.delete(t),rx(r))}function rS(r,e,t){for(const n of t)n instanceof kR?(r.du.addReference(n.key,e),Dz(r,n)):n instanceof DR?(Ot(nx,"Document no longer in limbo: "+n.key),r.du.removeReference(n.key,e),r.du.containsKey(n.key)||zR(r,n.key)):Yt(19791,{pu:n})}function Dz(r,e){const t=e.key,n=t.path.canonicalString();r.Iu.get(t)||r.Tu.has(n)||(Ot(nx,"New document in limbo: "+t),r.Tu.add(n),rx(r))}function rx(r){for(;r.Tu.size>0&&r.Iu.size<r.maxConcurrentLimboResolutions;){const e=r.Tu.values().next().value;r.Tu.delete(e);const t=new qt(an.fromString(e)),n=r.Vu.next();r.Eu.set(n,new wz(t)),r.Iu=r.Iu.insert(t,n),CR(r.remoteStore,new bs(ka(Jg(t.path)),n,"TargetPurposeLimboResolution",Yg.le))}}async function Sd(r,e,t){const n=oe(r),i=[],a=[],o=[];n.hu.isEmpty()||(n.hu.forEach((u,l)=>{o.push(n.fu(l,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){const p=h?!h.fromCache:(f=t==null?void 0:t.targetChanges.get(l.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(l.targetId,p?"current":"not-current")}if(h){i.push(h);const p=$2.Rs(l.targetId,h);a.push(p)}}))}),await Promise.all(o),n.lu.Y_(i),await async function(l,h){const f=oe(l);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>Et.forEach(h,m=>Et.forEach(m.ds,v=>f.persistence.referenceDelegate.addReference(p,m.targetId,v)).next(()=>Et.forEach(m.As,v=>f.persistence.referenceDelegate.removeReference(p,m.targetId,v)))))}catch(p){if(!Kc(p))throw p;Ot(K2,"Failed to update sequence numbers: "+p)}for(const p of h){const m=p.targetId;if(!p.fromCache){const v=f.xs.get(m),b=v.snapshotVersion,C=v.withLastLimboFreeSnapshotVersion(b);f.xs=f.xs.insert(m,C)}}}(n.localStore,a))}async function Oz(r,e){const t=oe(r);if(!t.currentUser.isEqual(e)){Ot(nx,"User change. New user:",e.toKey());const n=await yR(t.localStore,e);t.currentUser=e,function(a,o){a.Ru.forEach(u=>{u.forEach(l=>{l.reject(new Lt(_t.CANCELLED,o))})}),a.Ru.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Sd(t,n.ks)}}function Mz(r,e){const t=oe(r),n=t.Eu.get(e);if(n&&n.cu)return _e().add(n.key);{let i=_e();const a=t.Pu.get(e);if(!a)return i;for(const o of a){const u=t.hu.get(o);i=i.unionWith(u.view.eu)}return i}}function VR(r){const e=oe(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=MR.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Mz.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Nz.bind(null,e),e.lu.Y_=vz.bind(null,e.eventManager),e.lu.gu=yz.bind(null,e.eventManager),e}function Lz(r){const e=oe(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Iz.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=kz.bind(null,e),e}class Sg{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ov(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,t){return null}Cu(e,t){return null}Du(e){return FP(this.persistence,new PP,e.initialUser,this.serializer)}Su(e){return new vR(G2.fi,this.serializer)}bu(e){return new GP}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Sg.provider={build:()=>new Sg};class Pz extends Sg{constructor(e){super(),this.cacheSizeBytes=e}vu(e,t){We(this.persistence.referenceDelegate instanceof _g,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new wP(n,e.asyncQueue,t)}Su(e){const t=this.cacheSizeBytes!==void 0?Xr.withCacheSize(this.cacheSizeBytes):Xr.DEFAULT;return new vR(n=>_g.fi(n,t),this.serializer)}}class Ib{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>nS(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=Oz.bind(null,this.syncEngine),await pz(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new gz}()}createDatastore(e){const t=ov(e.databaseInfo.databaseId),n=function(a){return new QP(a)}(e.databaseInfo);return function(a,o,u,l){return new ez(a,o,u,l)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,i,a,o,u){return new rz(n,i,a,o,u)}(this.localStore,this.datastore,e.asyncQueue,t=>nS(this.syncEngine,t,0),function(){return YT.C()?new YT:new $P}())}createSyncEngine(e,t){return function(i,a,o,u,l,h,f){const p=new Cz(i,a,o,u,l,h);return f&&(p.mu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const a=oe(i);Ot(Ku,"RemoteStore shutting down."),a.da.add(5),await Td(a),a.Ra.shutdown(),a.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Ib.provider={build:()=>new Ib};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FR{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Mu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Mu(this.observer.error,e):Io("Uncaught Error in snapshot listener:",e.toString()))}xu(){this.muted=!0}Mu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vs="FirestoreClient";class zz{constructor(e,t,n,i,a){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ar.UNAUTHENTICATED,this.clientId=NA.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(n,async o=>{Ot(Vs,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(n,o=>(Ot(Vs,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ss;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=tx(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function R1(r,e){r.asyncQueue.verifyOperationInProgress(),Ot(Vs,"Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(async i=>{n.isEqual(i)||(await yR(e.localStore,i),n=i)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function iS(r,e){r.asyncQueue.verifyOperationInProgress();const t=await Vz(r);Ot(Vs,"Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>ZT(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>ZT(e.remoteStore,i)),r._onlineComponents=e}async function Vz(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Ot(Vs,"Using user provided OfflineComponentProvider");try{await R1(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===_t.FAILED_PRECONDITION||i.code===_t.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Cc("Error using user provided cache. Falling back to memory cache: "+t),await R1(r,new Sg)}}else Ot(Vs,"Using default OfflineComponentProvider"),await R1(r,new Pz(void 0));return r._offlineComponents}async function BR(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Ot(Vs,"Using user provided OnlineComponentProvider"),await iS(r,r._uninitializedComponentsProvider._online)):(Ot(Vs,"Using default OnlineComponentProvider"),await iS(r,new Ib))),r._onlineComponents}function Fz(r){return BR(r).then(e=>e.syncEngine)}async function kb(r){const e=await BR(r),t=e.eventManager;return t.onListen=Ez.bind(null,e.syncEngine),t.onUnlisten=Sz.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=_z.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Az.bind(null,e.syncEngine),t}function Bz(r,e,t={}){const n=new Ss;return r.asyncQueue.enqueueAndForget(async()=>function(a,o,u,l,h){const f=new FR({next:m=>{f.xu(),o.enqueueAndForget(()=>NR(a,p));const v=m.docs.has(u);!v&&m.fromCache?h.reject(new Lt(_t.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&m.fromCache&&l&&l.source==="server"?h.reject(new Lt(_t.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(m)},error:m=>h.reject(m)}),p=new IR(Jg(u.path),f,{includeMetadataChanges:!0,Qa:!0});return RR(a,p)}(await kb(r),r.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jR(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aS=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UR(r,e,t){if(!t)throw new Lt(_t.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function jz(r,e,t,n){if(e===!0&&n===!0)throw new Lt(_t.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function oS(r){if(!qt.isDocumentKey(r))throw new Lt(_t.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function sS(r){if(qt.isDocumentKey(r))throw new Lt(_t.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function lv(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":Yt(12329,{type:typeof r})}function As(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new Lt(_t.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=lv(r);throw new Lt(_t.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WR="firestore.googleapis.com",uS=!0;class lS{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new Lt(_t.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=WR,this.ssl=uS}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:uS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=gR;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<bP)throw new Lt(_t.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}jz("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jR((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new Lt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new Lt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new Lt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class cv{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Lt(_t.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Lt(_t.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new X8;switch(n.type){case"firstParty":return new J8(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Lt(_t.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=aS.get(t);n&&(Ot("ComponentProvider","Removing Datastore"),aS.delete(t),n.terminate())}(this),Promise.resolve()}}function Uz(r,e,t,n={}){var i;r=As(r,cv);const a=O2(e),o=r._getSettings(),u=Object.assign(Object.assign({},o),{emulatorOptions:r._getEmulatorOptions()}),l=`${e}:${t}`;a&&(C7(`https://${l}`),S7("Firestore",!0)),o.host!==WR&&o.host!==l&&Cc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h=Object.assign(Object.assign({},o),{host:l,ssl:a,emulatorOptions:n});if(!mg(h,u)&&(r._setSettings(h),n.mockUserToken)){let f,p;if(typeof n.mockUserToken=="string")f=n.mockUserToken,p=Ar.MOCK_USER;else{f=E7(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);const m=n.mockUserToken.sub||n.mockUserToken.user_id;if(!m)throw new Lt(_t.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Ar(m)}r._authCredentials=new Y8(new AA(f,p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new il(this.firestore,e,this._query)}}class Br{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Br(this.firestore,e,this._key)}}class Rs extends il{constructor(e,t,n){super(e,t,Jg(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Br(this.firestore,null,new qt(e))}withConverter(e){return new Rs(this.firestore,e,this._path)}}function Wz(r,e,...t){if(r=La(r),UR("collection","path",e),r instanceof cv){const n=an.fromString(e,...t);return sS(n),new Rs(r,null,n)}{if(!(r instanceof Br||r instanceof Rs))throw new Lt(_t.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(an.fromString(e,...t));return sS(n),new Rs(r.firestore,null,n)}}function HR(r,e,...t){if(r=La(r),arguments.length===1&&(e=NA.newId()),UR("doc","path",e),r instanceof cv){const n=an.fromString(e,...t);return oS(n),new Br(r,null,new qt(n))}{if(!(r instanceof Br||r instanceof Rs))throw new Lt(_t.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(an.fromString(e,...t));return oS(n),new Br(r.firestore,r instanceof Rs?r.converter:null,new qt(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cS="AsyncQueue";class hS{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new xR(this,"async_queue_retry"),this.rc=()=>{const n=A1();n&&Ot(cS,"Visibility state changed to "+n.visibilityState),this.x_.b_()},this.sc=e;const t=A1();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;const t=A1();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise(()=>{});const t=new Ss;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ju.push(e),this.ac()))}async ac(){if(this.Ju.length!==0){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!Kc(e))throw e;Ot(cS,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(e){const t=this.sc.then(()=>(this.ec=!0,e().catch(n=>{throw this.Xu=n,this.ec=!1,Io("INTERNAL UNHANDLED ERROR: ",fS(n)),n}).then(n=>(this.ec=!1,n))));return this.sc=t,t}enqueueAfterDelay(e,t,n){this.oc(),this.nc.indexOf(e)>-1&&(t=0);const i=J2.createAndSchedule(this,e,t,n,a=>this.uc(a));return this.Zu.push(i),i}oc(){this.Xu&&Yt(47125,{cc:fS(this.Xu)})}verifyOperationInProgress(){}async lc(){let e;do e=this.sc,await e;while(e!==this.sc)}hc(e){for(const t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then(()=>{this.Zu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.Zu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.lc()})}Tc(e){this.nc.push(e)}uc(e){const t=this.Zu.indexOf(e);this.Zu.splice(t,1)}}function fS(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dS(r){return function(t,n){if(typeof t!="object"||t===null)return!1;const i=t;for(const a of n)if(a in i&&typeof i[a]=="function")return!0;return!1}(r,["next","error","complete"])}class rd extends cv{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new hS,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new hS(e),this._firestoreClient=void 0,await e}}}function Hz(r,e){const t=typeof r=="object"?r:P8(),n=typeof r=="string"?r:bg,i=k8(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const a=x7("firestore");a&&Uz(i,...a)}return i}function ix(r){if(r._terminated)throw new Lt(_t.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||qz(r),r._firestoreClient}function qz(r){var e,t,n;const i=r._freezeSettings(),a=function(u,l,h,f){return new pL(u,l,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,jR(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new zz(r._authCredentials,r._appCheckCredentials,r._queue,a,r._componentsProvider&&function(u){const l=u==null?void 0:u._online.build();return{_offline:u==null?void 0:u._offline.build(l),_online:l}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Rc(wr.fromBase64String(e))}catch(t){throw new Lt(_t.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Rc(wr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hv{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Lt(_t.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new br(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fv{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ax{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Lt(_t.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Lt(_t.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ve(this._lat,e._lat)||ve(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ox{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let a=0;a<n.length;++a)if(n[a]!==i[a])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gz=/^__.*__$/;class qR{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new nl(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function GR(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Yt(40011,{Ic:r})}}class sx{constructor(e,t,n,i,a,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,a===void 0&&this.Ec(),this.fieldTransforms=a||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(e){return new sx(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.dc({path:n,Rc:!1});return i.Vc(e),i}mc(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.dc({path:n,Rc:!1});return i.Ec(),i}fc(e){return this.dc({path:void 0,Rc:!0})}gc(e){return Ag(e,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ec(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vc(this.path.get(e))}Vc(e){if(e.length===0)throw this.gc("Document fields must not be empty");if(GR(this.Ic)&&Gz.test(e))throw this.gc('Document fields cannot begin and end with "__"')}}class $z{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ov(e)}bc(e,t,n,i=!1){return new sx({Ic:e,methodName:t,wc:n,path:br.emptyPath(),Rc:!1,yc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function $R(r){const e=r._freezeSettings(),t=ov(r._databaseId);return new $z(r._databaseId,!!e.ignoreUndefinedProperties,t)}class dv extends fv{_toFieldTransform(e){if(e.Ic!==2)throw e.Ic===1?e.gc(`${this._methodName}() can only appear at the top level of your update data`):e.gc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof dv}}class ux extends fv{_toFieldTransform(e){return new BL(e.path,new td)}isEqual(e){return e instanceof ux}}function Kz(r,e,t,n){const i=r.bc(1,e,t);XR("Data must be an object, but it was:",i,n);const a=[],o=di.empty();Hs(n,(l,h)=>{const f=lx(e,l,t);h=La(h);const p=i.mc(f);if(h instanceof dv)a.push(f);else{const m=Ad(h,p);m!=null&&(a.push(f),o.set(f,m))}});const u=new Qi(a);return new qR(o,u,i.fieldTransforms)}function Xz(r,e,t,n,i,a){const o=r.bc(1,e,t),u=[pS(e,n,t)],l=[i];if(a.length%2!=0)throw new Lt(_t.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<a.length;m+=2)u.push(pS(e,a[m])),l.push(a[m+1]);const h=[],f=di.empty();for(let m=u.length-1;m>=0;--m)if(!Jz(h,u[m])){const v=u[m];let b=l[m];b=La(b);const C=o.mc(v);if(b instanceof dv)h.push(v);else{const w=Ad(b,C);w!=null&&(h.push(v),f.set(v,w))}}const p=new Qi(h);return new qR(f,p,o.fieldTransforms)}function Yz(r,e,t,n=!1){return Ad(t,r.bc(n?4:3,e))}function Ad(r,e){if(KR(r=La(r)))return XR("Unsupported field value:",e,r),Qz(r,e);if(r instanceof fv)return function(n,i){if(!GR(i.Ic))throw i.gc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.gc(`${n._methodName}() is not currently supported inside arrays`);const a=n._toFieldTransform(i);a&&i.fieldTransforms.push(a)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Rc&&e.Ic!==4)throw e.gc("Nested arrays are not supported");return function(n,i){const a=[];let o=0;for(const u of n){let l=Ad(u,i.fc(o));l==null&&(l={nullValue:"NULL_VALUE"}),a.push(l),o++}return{arrayValue:{values:a}}}(r,e)}return function(n,i){if((n=La(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return zL(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const a=Xn.fromDate(n);return{timestampValue:Eg(i.serializer,a)}}if(n instanceof Xn){const a=new Xn(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Eg(i.serializer,a)}}if(n instanceof ax)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Rc)return{bytesValue:lR(i.serializer,n._byteString)};if(n instanceof Br){const a=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(a))throw i.gc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:H2(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof ox)return function(o,u){return{mapValue:{fields:{[zA]:{stringValue:VA},[xg]:{arrayValue:{values:o.toArray().map(h=>{if(typeof h!="number")throw u.gc("VectorValues must only contain numeric values.");return j2(u.serializer,h)})}}}}}}(n,i);throw i.gc(`Unsupported field value: ${lv(n)}`)}(r,e)}function Qz(r,e){const t={};return kA(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Hs(r,(n,i)=>{const a=Ad(i,e.Ac(n));a!=null&&(t[n]=a)}),{mapValue:{fields:t}}}function KR(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof Xn||r instanceof ax||r instanceof Rc||r instanceof Br||r instanceof fv||r instanceof ox)}function XR(r,e,t){if(!KR(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const n=lv(t);throw n==="an object"?e.gc(r+" a custom object"):e.gc(r+" "+n)}}function pS(r,e,t){if((e=La(e))instanceof hv)return e._internalPath;if(typeof e=="string")return lx(r,e);throw Ag("Field path arguments must be of type string or ",r,!1,void 0,t)}const Zz=new RegExp("[~\\*/\\[\\]]");function lx(r,e,t){if(e.search(Zz)>=0)throw Ag(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new hv(...e.split("."))._internalPath}catch{throw Ag(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Ag(r,e,t,n,i){const a=n&&!n.isEmpty(),o=i!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(a||o)&&(l+=" (found",a&&(l+=` in field ${n}`),o&&(l+=` in document ${i}`),l+=")"),new Lt(_t.INVALID_ARGUMENT,u+r+l)}function Jz(r,e){return r.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YR{constructor(e,t,n,i,a){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new Br(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new tV(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(pv("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class tV extends YR{data(){return super.data()}}function pv(r,e){return typeof e=="string"?lx(r,e):e instanceof hv?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eV(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new Lt(_t.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cx{}class QR extends cx{}function nV(r,e,...t){let n=[];e instanceof cx&&n.push(e),n=n.concat(t),function(a){const o=a.filter(l=>l instanceof hx).length,u=a.filter(l=>l instanceof mv).length;if(o>1||o>0&&u>0)throw new Lt(_t.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class mv extends QR{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new mv(e,t,n)}_apply(e){const t=this._parse(e);return ZR(e._query,t),new il(e.firestore,e.converter,xb(e._query,t))}_parse(e){const t=$R(e.firestore);return function(a,o,u,l,h,f,p){let m;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new Lt(_t.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){gS(p,f);const b=[];for(const C of p)b.push(mS(l,a,C));m={arrayValue:{values:b}}}else m=mS(l,a,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||gS(p,f),m=Yz(u,o,p,f==="in"||f==="not-in");return zn.create(h,f,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function rV(r,e,t){const n=e,i=pv("where",r);return mv._create(i,n,t)}class hx extends cx{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new hx(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:ea.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(i,a){let o=i;const u=a.getFlattenedFilters();for(const l of u)ZR(o,l),o=xb(o,l)}(e._query,t),new il(e.firestore,e.converter,xb(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class fx extends QR{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new fx(e,t)}_apply(e){const t=function(i,a,o){if(i.startAt!==null)throw new Lt(_t.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new Lt(_t.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Jf(a,o)}(e._query,this._field,this._direction);return new il(e.firestore,e.converter,function(i,a){const o=i.explicitOrderBy.concat([a]);return new Xc(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function iV(r,e="asc"){const t=e,n=pv("orderBy",r);return fx._create(n,t)}function mS(r,e,t){if(typeof(t=La(t))=="string"){if(t==="")throw new Lt(_t.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!GA(e)&&t.indexOf("/")!==-1)throw new Lt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(an.fromString(t));if(!qt.isDocumentKey(n))throw new Lt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return RT(r,new qt(n))}if(t instanceof Br)return RT(r,t._key);throw new Lt(_t.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${lv(t)}.`)}function gS(r,e){if(!Array.isArray(r)||r.length===0)throw new Lt(_t.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ZR(r,e){const t=function(i,a){for(const o of i)for(const u of o.getFlattenedFilters())if(a.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Lt(_t.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Lt(_t.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class aV{convertValue(e,t="none"){switch(Ps(e)){case 0:return null;case 1:return e.booleanValue;case 2:return An(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ls(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Yt(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Hs(e,(i,a)=>{n[i]=this.convertValue(a,t)}),n}convertVectorValue(e){var t,n,i;const a=(i=(n=(t=e.fields)===null||t===void 0?void 0:t[xg].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(o=>An(o.doubleValue));return new ox(a)}convertGeoPoint(e){return new ax(An(e.latitude),An(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Zg(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Yf(e));default:return null}}convertTimestamp(e){const t=Ms(e);return new Xn(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=an.fromString(e);We(mR(n),9688,{name:e});const i=new Qf(n.get(1),n.get(3)),a=new qt(n.popFirst(5));return i.isEqual(t)||Io(`Document ${a} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class JR extends YR{constructor(e,t,n,i,a,o){super(e,t,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ym(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(pv("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Ym extends JR{data(e={}){return super.data(e)}}class oV{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new kf(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Ym(this._firestore,this._userDataWriter,n.key,n,new kf(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Lt(_t.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,a){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(u=>{const l=new Ym(i._firestore,i._userDataWriter,u.doc.key,u.doc,new kf(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>a||u.type!==3).map(u=>{const l=new Ym(i._firestore,i._userDataWriter,u.doc.key,u.doc,new kf(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return u.type!==0&&(h=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),u.type!==1&&(o=o.add(u.doc),f=o.indexOf(u.doc.key)),{type:sV(u.type),doc:l,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function sV(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Yt(61501,{type:r})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tN(r){r=As(r,Br);const e=As(r.firestore,rd);return Bz(ix(e),r._key).then(t=>nN(e,r,t))}class eN extends aV{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Br(this.firestore,null,t)}}function uV(r,e,t,...n){r=As(r,Br);const i=As(r.firestore,rd),a=$R(i);let o;return o=typeof(e=La(e))=="string"||e instanceof hv?Xz(a,"updateDoc",r._key,e,t,n):Kz(a,"updateDoc",r._key,e),cV(i,[o.toMutation(r._key,Eo.exists(!0))])}function lV(r,...e){var t,n,i;r=La(r);let a={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||dS(e[o])||(a=e[o],o++);const u={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(dS(e[o])){const p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(n=p.error)===null||n===void 0?void 0:n.bind(p),e[o+2]=(i=p.complete)===null||i===void 0?void 0:i.bind(p)}let l,h,f;if(r instanceof Br)h=As(r.firestore,rd),f=Jg(r._key.path),l={next:p=>{e[o]&&e[o](nN(h,r,p))},error:e[o+1],complete:e[o+2]};else{const p=As(r,il);h=As(p.firestore,rd),f=p._query;const m=new eN(h);l={next:v=>{e[o]&&e[o](new oV(h,m,p,v))},error:e[o+1],complete:e[o+2]},eV(r._query)}return function(m,v,b,C){const w=new FR(C),E=new IR(v,w,b);return m.asyncQueue.enqueueAndForget(async()=>RR(await kb(m),E)),()=>{w.xu(),m.asyncQueue.enqueueAndForget(async()=>NR(await kb(m),E))}}(ix(h),f,u,l)}function cV(r,e){return function(n,i){const a=new Ss;return n.asyncQueue.enqueueAndForget(async()=>Rz(await Fz(n),i,a)),a.promise}(ix(r),e)}function nN(r,e,t){const n=t.docs.get(e._key),i=new eN(r);return new JR(r,i,e._key,n,new kf(t.hasPendingWrites,t.fromCache),e.converter)}function hV(){return new ux("serverTimestamp")}(function(e,t=!0){(function(i){Gc=i})(L8),vg(new $f("firestore",(n,{instanceIdentifier:i,options:a})=>{const o=n.getProvider("app").getImmediate(),u=new rd(new Q8(n.getProvider("auth-internal")),new tL(o,n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Lt(_t.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qf(h.options.projectId,f)}(o,i),o);return a=Object.assign({useFetchStreams:t},a),u._setSettings(a),u},"PUBLIC").setMultipleInstances(!0)),gc(gT,vT,e),gc(gT,vT,"esm2017")})();const fV={apiKey:"AIzaSyDBbELkSRwTb4fS0ti8d0LErBxTVG6PkRA",authDomain:"nhm-exam.firebaseapp.com",projectId:"nhm-exam",storageBucket:"nhm-exam.firebasestorage.app",messagingSenderId:"909982371658",appId:"1:909982371658:web:5f6dfb00a905b516f53bb3",measurementId:"G-H3YCH6LQTW"},dV=vA(fV),dx=Hz(dV);function pV(r,e=300,t=360,n=70){return`${r}?auto=format&fit=crop&w=${e}&h=${t}&q=${n}`}function mV(r){const e=new Date().toISOString(),t=nV(Wz(dx,"Events"),rV("date",">=",e),iV("date"));return lV(t,n=>{const i=n.docs.map(a=>{const o=a.data();return{id:a.id,eventName:o.eventName,date:o.date,imgUrl:pV(o.imgUrl),description:o.description}});r(i)})}async function gV(r){const e=HR(dx,"PollResults","results"),t=await tN(e);if(!t.exists())throw new Error("Poll results document does not exist.");const i=t.data().votes||{yes:0,no:0},a={...i,[r]:(i[r]||0)+1};await uV(e,{votes:a,lastVoteDate:hV()})}async function vV(){const r=HR(dx,"PollResults","results"),e=await tN(r);return e.exists()?e.data().votes||{yes:0,no:0}:{yes:0,no:0}}const rN=({title:r,date:e,imgUrl:t})=>M.jsxs("div",{className:"event-card-mini",children:[M.jsx("img",{src:t,alt:r}),M.jsxs("div",{className:"info",children:[M.jsx("div",{className:"small-text",children:e}),M.jsx("h3",{children:r})]})]}),Rd=r=>X.createElement("svg",{width:18,height:16,viewBox:"0 0 18 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M9.5625 14.75L16.3125 8L9.5625 1.25M15.375 8L1.6875 8",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"}));function yV(r){if(r>3&&r<21)return"th";switch(r%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}function bV(r){const e=new Date(r),t=e.getDate();return`${e.toLocaleString("default",{month:"long"})} ${t}${yV(t)}`}const xV=({className:r})=>{const[e,t]=X.useState([]);return X.useEffect(()=>{const n=mV(i=>{t(i.slice(0,2))});return()=>n()},[]),M.jsxs("div",{className:`${r??""}`,children:[M.jsxs("div",{className:"upcoming-events-header",children:[M.jsx("h2",{children:"Upcoming Events"}),M.jsx(Rd,{className:"arrow"})]}),e.map(n=>M.jsx(rN,{title:n.eventName,date:bV(n.date),imgUrl:n.imgUrl},n.id))]})},wV=[{id:"ticket-prices",label:"Ticket prices"},{id:"opening-hours",label:"Opening hours"},{id:"route-parking",label:"Route & Parking"},{id:"social-media",label:"Social Media"},{id:"contact-info",label:"Contact info"}],CV=({className:r})=>M.jsxs("div",{className:`${r??""}`,children:[M.jsx("h2",{children:"Useful links"}),M.jsx("ul",{className:"useful-links-list",children:wV.map(e=>M.jsx("li",{className:"useful-links-item",children:M.jsxs(Xg,{to:`/infoPages/${e.id}`,children:[M.jsx("span",{children:e.label}),M.jsx(Rd,{className:"arrow-icon"})]})},e.id))})]}),EV=()=>M.jsxs("div",{className:"scrollable-container",children:[M.jsx(l7,{className:"story-scroll-container content"}),M.jsx(xV,{className:"upcoming-events-container content"}),M.jsx(CV,{className:"useful-links-container content"})]}),_V=({className:r="",left:e,right:t,bottom:n,onLeftClick:i,onRightClick:a,onBottomClick:o})=>M.jsxs("div",{className:`card-container ${r}`,children:[M.jsxs("div",{className:"card card-left",style:{"--card-image":`url(${e.picture})`},onClick:i,children:[M.jsx("h2",{className:"card-title",children:e.title}),M.jsx("div",{className:"card-new",children:M.jsx("p",{children:"new"})})]}),M.jsxs("div",{className:"card card-right",style:{"--card-image":`url(${t.picture})`},onClick:a,children:[M.jsx("h2",{className:"card-title",children:t.title}),M.jsx("div",{className:"card-new",children:M.jsx("p",{children:"new"})})]}),M.jsx("div",{className:"card card-bottom",style:{"--card-image":`url(${n.picture})`},onClick:o,children:M.jsx("h2",{className:"card-title",children:n.title})})]}),px="/nhm-app/assets/oops-BX26dlfH.jpg",iN="/nhm-app/assets/beetles-rFeEkjbv.Jpg",TV="/nhm-app/assets/backyard1-2LouvGb9.jpg",SV="/nhm-app/assets/safari1-DL8WKjUb.jpg",aN="/nhm-app/assets/ournature-CDP2irj3.Jpg",AV=()=>{const r=wi();function e(t){r(`/exhibitions/${t}`)}return M.jsxs("div",{className:"scrollable-container content",children:[M.jsx(_V,{left:{title:"OOPS!",picture:px},right:{title:"Beetles",picture:iN},bottom:{title:"The Global Backyard",picture:TV},onLeftClick:()=>e(3),onRightClick:()=>e(1),onBottomClick:()=>e(5)}),M.jsx("div",{className:"exhibition-card",style:{"--card-image":`url(${SV})`},onClick:()=>e(4),children:M.jsx("h2",{children:"Expedition to Africa"})}),M.jsx("div",{className:"exhibition-card",style:{"--card-image":`url(${aN})`},onClick:()=>e(2),children:M.jsx("h2",{children:"Our Nature"})})]})},N1=({icon:r,label:e})=>M.jsxs("div",{className:"tag",children:[r&&M.jsx("span",{className:"tag-icon",children:r}),M.jsx("span",{children:e})]}),RV=r=>X.createElement("svg",{width:18,height:18,viewBox:"0 0 18 18",fill:"none",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M4.80012 3.56989C5.91786 2.47451 7.42272 1.86449 8.98769 1.87239C10.5527 1.88029 12.0513 2.50548 13.1579 3.6121C14.2645 4.71872 14.8897 6.21734 14.8976 7.78231C14.9055 9.34729 14.2955 10.8521 13.2001 11.9699L10.0606 15.1094C9.77933 15.3906 9.39786 15.5486 9.00012 15.5486C8.60237 15.5486 8.22091 15.3906 7.93962 15.1094L4.80012 11.9699C3.68628 10.8559 3.06055 9.34517 3.06055 7.76989C3.06055 6.19461 3.68628 4.68384 4.80012 3.56989Z",stroke:"#130902",strokeWidth:1.5,strokeLinejoin:"round"}),X.createElement("path",{d:"M9 10.0198C10.2426 10.0198 11.25 9.01242 11.25 7.76977C11.25 6.52713 10.2426 5.51978 9 5.51978C7.75736 5.51978 6.75 6.52713 6.75 7.76977C6.75 9.01242 7.75736 10.0198 9 10.0198Z",stroke:"#130902",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),NV=r=>X.createElement("svg",{width:18,height:18,viewBox:"0 0 18 18",fill:"none",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M9 15.75C12.7279 15.75 15.75 12.7279 15.75 9C15.75 5.27208 12.7279 2.25 9 2.25C5.27208 2.25 2.25 5.27208 2.25 9C2.25 12.7279 5.27208 15.75 9 15.75Z",stroke:"#130902",strokeWidth:1.7}),X.createElement("path",{d:"M12.375 9H9.1875C9.13777 9 9.09008 8.98025 9.05492 8.94508C9.01975 8.90992 9 8.86223 9 8.8125V6.375",stroke:"#130902",strokeWidth:1.7,strokeLinecap:"round"})),IV="/nhm-app/assets/backyard-Djb9nUb3.jpg",oN="/nhm-app/assets/safari-CCS1uwwQ.jpg",kV=r=>X.createElement("svg",{width:56,height:56,viewBox:"0 0 56 56",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M21 15.491V47.8333M35 7V39.6667M7 20.3233C7 16.884 7 15.1667 7.917 14.1633C8.24154 13.8064 8.63635 13.5204 9.07667 13.3233C10.318 12.7727 11.949 13.3163 15.211 14.4037C17.7007 15.2343 18.9443 15.6497 20.2043 15.6053C20.6666 15.5901 21.1261 15.5292 21.5763 15.4233C22.8013 15.1317 23.8933 14.4037 26.0773 12.95L29.302 10.7987C32.102 8.932 33.4997 7.99867 35.105 7.78633C36.7103 7.56933 38.3063 8.10133 41.496 9.16533L44.2143 10.0707C46.5243 10.8407 47.6793 11.2257 48.3397 12.1427C49 13.0597 49 14.28 49 16.7113V35.679C49 39.116 49 40.8357 48.083 41.839C47.758 42.1942 47.3632 42.4786 46.9233 42.6743C45.682 43.2273 44.051 42.6837 40.789 41.5963C38.2993 40.7657 37.0557 40.3503 35.7957 40.3947C35.3334 40.4099 34.8739 40.4708 34.4237 40.5767C33.1987 40.8683 32.1067 41.5963 29.9227 43.05L26.698 45.2013C23.898 47.068 22.5003 48.0013 20.895 48.2137C19.2897 48.4307 17.6937 47.8987 14.504 46.8347L11.7857 45.9293C9.47567 45.1593 8.32067 44.7743 7.66033 43.8573C7 42.9403 7 41.72 7 39.2887V20.3233Z",stroke:"#3E1E08",strokeWidth:1.5})),DV=r=>X.createElement("svg",{width:56,height:56,viewBox:"0 0 56 56",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M21 15.491V47.8333M35 7V39.6667M7 20.3233C7 16.884 7 15.1667 7.917 14.1633C8.24154 13.8064 8.63635 13.5204 9.07667 13.3233C10.318 12.7727 11.949 13.3163 15.211 14.4037C17.7007 15.2343 18.9443 15.6497 20.2043 15.6053C20.6666 15.5901 21.1261 15.5292 21.5763 15.4233C22.8013 15.1317 23.8933 14.4037 26.0773 12.95L29.302 10.7987C32.102 8.932 33.4997 7.99867 35.105 7.78633C36.7103 7.56933 38.3063 8.10133 41.496 9.16533L44.2143 10.0707C46.5243 10.8407 47.6793 11.2257 48.3397 12.1427C49 13.0597 49 14.28 49 16.7113V35.679C49 39.116 49 40.8357 48.083 41.839C47.758 42.1942 47.3632 42.4786 46.9233 42.6743C45.682 43.2273 44.051 42.6837 40.789 41.5963C38.2993 40.7657 37.0557 40.3503 35.7957 40.3947C35.3334 40.4099 34.8739 40.4708 34.4237 40.5767C33.1987 40.8683 32.1067 41.5963 29.9227 43.05L26.698 45.2013C23.898 47.068 22.5003 48.0013 20.895 48.2137C19.2897 48.4307 17.6937 47.8987 14.504 46.8347L11.7857 45.9293C9.47567 45.1593 8.32067 44.7743 7.66033 43.8573C7 42.9403 7 41.72 7 39.2887V20.3233Z",stroke:"#3E4B15",strokeWidth:1.5})),OV=r=>X.createElement("svg",{width:56,height:56,viewBox:"0 0 56 56",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M21 15.491V47.8333M35 7V39.6667M7 20.3233C7 16.884 7 15.1667 7.917 14.1633C8.24154 13.8064 8.63635 13.5204 9.07667 13.3233C10.318 12.7727 11.949 13.3163 15.211 14.4037C17.7007 15.2343 18.9443 15.6497 20.2043 15.6053C20.6666 15.5901 21.1261 15.5292 21.5763 15.4233C22.8013 15.1317 23.8933 14.4037 26.0773 12.95L29.302 10.7987C32.102 8.932 33.4997 7.99867 35.105 7.78633C36.7103 7.56933 38.3063 8.10133 41.496 9.16533L44.2143 10.0707C46.5243 10.8407 47.6793 11.2257 48.3397 12.1427C49 13.0597 49 14.28 49 16.7113V35.679C49 39.116 49 40.8357 48.083 41.839C47.758 42.1942 47.3632 42.4786 46.9233 42.6743C45.682 43.2273 44.051 42.6837 40.789 41.5963C38.2993 40.7657 37.0557 40.3503 35.7957 40.3947C35.3334 40.4099 34.8739 40.4708 34.4237 40.5767C33.1987 40.8683 32.1067 41.5963 29.9227 43.05L26.698 45.2013C23.898 47.068 22.5003 48.0013 20.895 48.2137C19.2897 48.4307 17.6937 47.8987 14.504 46.8347L11.7857 45.9293C9.47567 45.1593 8.32067 44.7743 7.66033 43.8573C7 42.9403 7 41.72 7 39.2887V20.3233Z",stroke:"#FA9B0E",strokeWidth:1.5})),MV=r=>X.createElement("svg",{width:56,height:56,viewBox:"0 0 56 56",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("rect",{width:56,height:56,rx:28,fill:"#E9C770"}),X.createElement("path",{d:"M37.409 25.3531C37.8893 25.6085 38.291 25.9898 38.5712 26.456C38.8514 26.9223 38.9994 27.4561 38.9994 28.0001C38.9994 28.544 38.8514 29.0778 38.5712 29.5441C38.291 30.0104 37.8893 30.3917 37.409 30.6471L24.597 37.6141C22.534 38.7371 20 37.2771 20 34.9681V21.0331C20 18.7231 22.534 17.2641 24.597 18.3851L37.409 25.3531Z",fill:"white"})),LV=r=>X.createElement("svg",{width:56,height:56,viewBox:"0 0 56 56",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("rect",{width:56,height:56,rx:28,fill:"#96C3E3"}),X.createElement("path",{d:"M37.409 25.3531C37.8893 25.6085 38.291 25.9898 38.5712 26.456C38.8514 26.9223 38.9994 27.4561 38.9994 28.0001C38.9994 28.544 38.8514 29.0778 38.5712 29.5441C38.291 30.0104 37.8893 30.3917 37.409 30.6471L24.597 37.6141C22.534 38.7371 20 37.2771 20 34.9681V21.0331C20 18.7231 22.534 17.2641 24.597 18.3851L37.409 25.3531Z",fill:"white"})),sN=[{id:1,name:"BEETLES",description:"This exhibition presents a fascinating collection centered on beetles, highlighting their incredible diversity, intricate forms, and ecological significance. Through scientific illustrations, macro photography, and mixed media works, it showcases both artistic and biological perspectives on these remarkable insects.",image:iN,floor:"3rd Floor",time:"Aprox. 1 hour",type:"Temporary",icon:kV,buttonText:"See on map",link:"#"},{id:2,name:"Our Nature",description:"This exhibition offers an in-depth look at the rich and diverse landscapes of Danish nature, from coastal habitats and ancient forests to heathlands and wetlands. Through specimens, interactive displays, and scientific insights, visitors can explore the ecosystems, flora, and fauna that define Denmarks natural heritage.",image:aN,floor:"Ground Floor",time:"Aprox. 1 hour",type:"Permanent",icon:DV,buttonText:"See on map",link:"#"},{id:3,name:"Oops!",description:"This exhibition explores chance and coincidence in the universefrom cosmic randomness like the Big Bang to unexpected patterns in nature and science. Through immersive displays and interactive installations, visitors reflect on how accidental events have shaped the cosmos, life, and our understanding of existence.",image:px,floor:"1st Floor",time:"Aprox. 40 mins",type:"Temporary",icon:OV,buttonText:"See on map",link:"#"},{id:4,name:"Expedition to Africa",description:"This exhibition follows a 1947 Danish expedition to Africa, showcasing encounters with wildlife, landscapes, and cultures. Through photos, notes, and artifacts, it highlights the journeys impact on science and our view of a changing world.",image:oN,floor:"Ground Floor",time:"Aprox. 30 mins",type:"Permanent",icon:MV,buttonText:"Start journey",link:"safariPages/slider"},{id:5,name:"The Global Backyard",description:"The Global Backyard showcases the rich diversity of animal life worldwidestarting just outside our door. Featuring taxidermy specimens from every continent, the exhibition connects global ecosystems with often-overlooked local wildlife, offering a closer look at natures wonders and stories.",image:IV,floor:"2nd Floor",time:"Aprox. 1 hour",type:"Permanent",icon:LV,buttonText:"Start journey",link:"safariPages/slider"}],PV=({id:r})=>{const e=sN.find(t=>t.id===Number(r));return e?M.jsxs("div",{className:"exhibition-details-section",children:[M.jsx(Xg,{to:`/${e.link??"exhibitions"}`,children:M.jsxs("div",{className:"top-button",children:[e.icon&&M.jsx(e.icon,{style:{stroke:"var(--navbar-bg-color, var(--moss-700))"}}),M.jsx("h3",{children:e.buttonText})]})}),M.jsxs("div",{className:"exhibition-details-container",children:[M.jsx("h1",{children:e.name}),M.jsxs("div",{className:"tags",children:[M.jsx(N1,{icon:M.jsx(RV,{stroke:"var(--tag-fg-color)"}),label:e.floor}),M.jsx(N1,{icon:M.jsx(NV,{stroke:"var(--tag-fg-color)"}),label:e.time}),M.jsx(N1,{label:e.type})]}),M.jsx("p",{className:"small-text",children:e.description})]})]}):M.jsx("p",{children:"Exhibition not found."})},Cr=({to:r,onClick:e})=>{const t=wi(),n=()=>{e?e():r?t(r):window.history.back()};return M.jsx("button",{className:"back-button",onClick:n,children:M.jsx(Rd,{className:"back-arrow"})})},zV={moss:{background:"--moss-700",foreground:"--moss-150",tagColor:"--moss-850",routes:["/","/infoPages","/discover","/exhibitions/","/exhibitions/2","/map","/schedule"]},brown:{background:"--brown-700",foreground:"--brown-150",tagColor:"--brown-850",routes:["/exhibitions/1"]},orange:{background:"--orange-700",foreground:"--orange-150",tagColor:"--orange-850",routes:["/exhibitions/3"]},wheat:{background:"--wheat-700",foreground:"--wheat-150",tagColor:"--wheat-850",routes:["/exhibitions/4","/safariPages/ar"]},polar:{background:"--polar-700",foreground:"--polar-150",tagColor:"--polar-850",routes:["/exhibitions/5"]}};function uN(){X.useEffect(()=>{const r=document.getElementById("root");return r==null||r.classList.add("allow-landscape"),()=>{r==null||r.classList.remove("allow-landscape")}},[])}const lN=X.createContext({shouldHideNavbar:!1,sectionTheme:{background:"--moss-700",foreground:"--moss-150",tagColor:"--moss-850"},navigateToSection:()=>{},isActive:()=>!1}),gv=()=>X.useContext(lN),VV=["/safariPages/slider","/safariPages/checkbox","/safariPages/poll","/safariPages/poll-results","/safariPages/choose","/safariPages/dialog"],FV=({children:r})=>{const e=Lo(),t=wi(),n=e.pathname,[i,a]=X.useState({background:"--moss-700",foreground:"--moss-150",tagColor:"--moss-850"}),[o,u]=X.useState({discover:"/",exhibitions:"/exhibitions",map:"/map",schedule:"/schedule"}),l=VV.some(p=>n.startsWith(p))||n.startsWith("/safariPages/");X.useEffect(()=>{n==="/"||n.startsWith("/infoPages/")?u(p=>({...p,discover:n})):n.startsWith("/exhibitions")?u(p=>({...p,exhibitions:n})):n.startsWith("/map")?u(p=>({...p,map:n})):n.startsWith("/schedule")&&u(p=>({...p,schedule:n}))},[n]),X.useEffect(()=>{const p=Object.values(zV).find(m=>m.routes.some(v=>n===v||n.startsWith(v+"/")));a(p?{background:p.background,foreground:p.foreground,tagColor:p.tagColor}:{background:"--moss-700",foreground:"--moss-150",tagColor:"--moss-850"})},[n]);const h=p=>{const m=o[p];t(m)},f=p=>{switch(p){case"discover":return n==="/"||n.startsWith("/infoPages/");case"exhibitions":return n.startsWith("/exhibitions");case"map":return n.startsWith("/map");case"schedule":return n.startsWith("/schedule");default:return!1}};return M.jsx(lN.Provider,{value:{shouldHideNavbar:l,sectionTheme:i,navigateToSection:h,isActive:f},children:r})},BV=()=>{const{id:r}=Cd(),e=sN.find(n=>n.id===Number(r)),{sectionTheme:t}=gv();return e?M.jsxs("div",{className:"exhibition-details",style:{backgroundImage:`url(${e.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",minHeight:"100vh",color:"white","--navbar-fg-color":`var(${t.foreground})`,"--navbar-bg-color":`var(${t.background})`,"--tag-fg-color":`var(${t.tagColor})`},children:[M.jsx("div",{className:"back-button-container",children:M.jsx(Cr,{to:"/exhibitions"})}),M.jsx(PV,{id:r})]}):M.jsx("p",{children:"Exhibition not found."})},Qc=({image:r,children:e,bodyClassName:t,wrapperClassName:n,popoutPercent:i=.2})=>{const h=X.useRef(null),[f,p]=X.useState({width:430,height:120});X.useEffect(()=>{const V=()=>{if(h.current){const{offsetWidth:R,offsetHeight:N}=h.current;p({width:R,height:N})}},T=new ResizeObserver(V);return h.current&&T.observe(h.current),window.addEventListener("resize",V),V(),()=>{T.disconnect(),window.removeEventListener("resize",V)}},[]);const{width:m,height:v}=f,b=m*.25,C=100*(.5-i),w=58,E=b-50-8-C,S=b-50-8,A=b+50+8,k=b+50+8+C,O=`
    M0 0 
    H${E} 
    A${C} ${C} 0 0 1 ${S} ${C}
    A${w} ${w} 0 0 0 ${A} ${C}
    A${C} ${C} 0 0 1 ${k} 0 
    H${m} 
    V${v} 
    H0 
    Z
  `;return M.jsxs("div",{className:`cutout-wrapper ${n??""}`,ref:h,children:[M.jsx("div",{className:`cutout-body ${t??""}`,style:{paddingTop:"18px"},children:e}),M.jsx("div",{className:"cutout-profile",style:{backgroundImage:`url(${r})`,width:100,height:100,left:`${b}px`,transform:`translate(-50%, -${i*100}%)`,borderRadius:50}}),M.jsx("svg",{width:"0",height:"0",style:{position:"absolute",top:0,left:0},children:M.jsx("clipPath",{id:"profileClip",children:M.jsx("path",{d:O})})})]})},jV=()=>M.jsxs("div",{style:{backgroundImage:`url(${oN})`,backgroundSize:"cover",backgroundPosition:"center",height:"100vh"},children:[M.jsx("h1",{children:"Map Page"}),M.jsx("p",{children:"This is the Map pagesss templatsdfjklhgdslkjgfhskldfghsdlfkjghdslkjghsdlkgjhdslgkjhsdfglkjhdsgflkjhe."}),M.jsx("p",{children:"This is the Map pagesss templatsdfjklhgdslkjgfhskldfghsdlfkjghdslkjghsdlkgjhdslgkjhsdfglkjhdsgflkjhe."}),M.jsxs(Qc,{image:px,children:[M.jsx("h1",{children:"Map Page"}),M.jsx("p",{children:"This is the Map pagesss templatsdfjklhgdslkjgfhskldfghsdlfkjghdslkjghsdlkgjhdslgkjhsdfglkjhdsgflkjhe."})]})]}),UV=({events:r,onClose:e,onSelectDate:t})=>{const[n,i]=X.useState(new Date),o=r.filter(f=>{const p=new Date(f.date);return p.getMonth()===n.getMonth()&&p.getFullYear()===n.getFullYear()}).reduce((f,p)=>{const m=new Date(p.date).getDate();return f[m]=p,f},{}),u=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),l=()=>{const f=new Date(n);f.setMonth(n.getMonth()-1),i(f)},h=()=>{const f=new Date(n);f.setMonth(n.getMonth()+1),i(f)};return M.jsx("div",{className:"calendar-overlay",children:M.jsxs("div",{className:"calendar-popup",children:[M.jsx("button",{className:"close-btn",onClick:e,children:""}),M.jsxs("div",{className:"calendar-header",children:[M.jsx("button",{onClick:l,children:"<"}),M.jsxs("h3",{children:[n.toLocaleString("default",{month:"long"})," ",n.getFullYear()]}),M.jsx("button",{onClick:h,children:">"})]}),M.jsx("div",{className:"calendar-grid",children:[...Array(u)].map((f,p)=>{const m=p+1,v=o[m];return M.jsx("div",{className:`calendar-day ${v?"has-event":""}`,onClick:()=>v&&t(v.id),children:m},m)})})]})})},WV="data:image/svg+xml,%3csvg%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.5%203C6.30653%203%205.16193%203.47411%204.31802%204.31802C3.47411%205.16193%203%206.30653%203%207.5V24.5C3%2025.6935%203.47411%2026.8381%204.31802%2027.682C5.16193%2028.5259%206.30653%2029%207.5%2029H24.5C25.6935%2029%2026.8381%2028.5259%2027.682%2027.682C28.5259%2026.8381%2029%2025.6935%2029%2024.5V7.5C29%206.30653%2028.5259%205.16193%2027.682%204.31802C26.8381%203.47411%2025.6935%203%2024.5%203H7.5ZM27%209H5V7.5C5%206.83696%205.26339%206.20107%205.73223%205.73223C6.20107%205.26339%206.83696%205%207.5%205H24.5C25.163%205%2025.7989%205.26339%2026.2678%205.73223C26.7366%206.20107%2027%206.83696%2027%207.5V9ZM5%2011H27V24.5C27%2025.163%2026.7366%2025.7989%2026.2678%2026.2678C25.7989%2026.7366%2025.163%2027%2024.5%2027H7.5C6.83696%2027%206.20107%2026.7366%205.73223%2026.2678C5.26339%2025.7989%205%2025.163%205%2024.5V11ZM21.5%2018C21.1022%2018%2020.7206%2017.842%2020.4393%2017.5607C20.158%2017.2794%2020%2016.8978%2020%2016.5C20%2016.1022%2020.158%2015.7206%2020.4393%2015.4393C20.7206%2015.158%2021.1022%2015%2021.5%2015C21.8978%2015%2022.2794%2015.158%2022.5607%2015.4393C22.842%2015.7206%2023%2016.1022%2023%2016.5C23%2016.8978%2022.842%2017.2794%2022.5607%2017.5607C22.2794%2017.842%2021.8978%2018%2021.5%2018ZM20%2021.5C20%2021.8978%2020.158%2022.2794%2020.4393%2022.5607C20.7206%2022.842%2021.1022%2023%2021.5%2023C21.8978%2023%2022.2794%2022.842%2022.5607%2022.5607C22.842%2022.2794%2023%2021.8978%2023%2021.5C23%2021.1022%2022.842%2020.7206%2022.5607%2020.4393C22.2794%2020.158%2021.8978%2020%2021.5%2020C21.1022%2020%2020.7206%2020.158%2020.4393%2020.4393C20.158%2020.7206%2020%2021.1022%2020%2021.5ZM16%2023C15.6022%2023%2015.2206%2022.842%2014.9393%2022.5607C14.658%2022.2794%2014.5%2021.8978%2014.5%2021.5C14.5%2021.1022%2014.658%2020.7206%2014.9393%2020.4393C15.2206%2020.158%2015.6022%2020%2016%2020C16.3978%2020%2016.7794%2020.158%2017.0607%2020.4393C17.342%2020.7206%2017.5%2021.1022%2017.5%2021.5C17.5%2021.8978%2017.342%2022.2794%2017.0607%2022.5607C16.7794%2022.842%2016.3978%2023%2016%2023ZM14.5%2016.5C14.5%2016.8978%2014.658%2017.2794%2014.9393%2017.5607C15.2206%2017.842%2015.6022%2018%2016%2018C16.3978%2018%2016.7794%2017.842%2017.0607%2017.5607C17.342%2017.2794%2017.5%2016.8978%2017.5%2016.5C17.5%2016.1022%2017.342%2015.7206%2017.0607%2015.4393C16.7794%2015.158%2016.3978%2015%2016%2015C15.6022%2015%2015.2206%2015.158%2014.9393%2015.4393C14.658%2015.7206%2014.5%2016.1022%2014.5%2016.5ZM10.5%2018C10.1022%2018%209.72064%2017.842%209.43934%2017.5607C9.15804%2017.2794%209%2016.8978%209%2016.5C9%2016.1022%209.15804%2015.7206%209.43934%2015.4393C9.72064%2015.158%2010.1022%2015%2010.5%2015C10.8978%2015%2011.2794%2015.158%2011.5607%2015.4393C11.842%2015.7206%2012%2016.1022%2012%2016.5C12%2016.8978%2011.842%2017.2794%2011.5607%2017.5607C11.2794%2017.842%2010.8978%2018%2010.5%2018Z'%20fill='black'/%3e%3c/svg%3e",cN="/nhm-app/assets/event1-9XRcnEEC.png",hN="/nhm-app/assets/event2-2DYN-jQG.png",fN="/nhm-app/assets/event3-wOsa1XGP.jpg",vS={June:[{id:"1",eventName:"Cinema Night in Yard",date:"2025-06-08",imgUrl:cN},{id:"2",eventName:"SafariParty",date:"2025-06-30",imgUrl:hN}],July:[{id:"3",eventName:"Scavenger hunt",date:"2025-07-20",imgUrl:fN}]};function HV(r){const e=new Date(r),t=e.getDate(),n=e.toLocaleString("default",{month:"long"});return`${t} ${n}`}const qV=()=>{const[r,e]=X.useState(!1),t=wi(),n=Object.values(vS).flat(),i=a=>{e(!1),t(`/schedule/event/${a}`)};return M.jsxs("div",{className:"schedule-page",children:[M.jsxs("div",{className:"schedule-header",children:[M.jsx("h1",{children:"Schedule"}),M.jsx("img",{src:WV,alt:"Calendar Icon",className:"calendar-icon",onClick:()=>e(!0)})]}),Object.entries(vS).map(([a,o])=>M.jsxs("div",{className:"month-section",children:[M.jsx("h2",{children:a}),M.jsx("div",{className:"events-grid",children:o.map(u=>M.jsx("div",{onClick:()=>i(u.id),style:{cursor:"pointer"},children:M.jsx(rN,{title:u.eventName,date:HV(u.date),imgUrl:u.imgUrl})},u.id))})]},a)),r&&M.jsx(UV,{events:n,onClose:()=>e(!1),onSelectDate:i})]})},GV=r=>X.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M10 19C14.9706 19 19 14.9706 19 10C19 5.02944 14.9706 1 10 1C5.02944 1 1 5.02944 1 10C1 14.9706 5.02944 19 10 19Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M9.307 7.739L13 7L12.261 10.693C12.1836 11.0801 11.9935 11.4356 11.7144 11.7148C11.4354 11.994 11.08 12.1844 10.693 12.262L7 13L7.739 9.307C7.81654 8.92011 8.00678 8.5648 8.28579 8.28579C8.5648 8.00678 8.92011 7.81654 9.307 7.739Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),$V=r=>X.createElement("svg",{width:20,height:22,viewBox:"0 0 20 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M10.5 18V21M8.5 21H12.5",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M11.5 15C7.63401 15 4.5 11.866 4.5 8C4.5 4.13401 7.63401 1 11.5 1C15.366 1 18.5 4.13401 18.5 8C18.5 11.866 15.366 15 11.5 15Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M6.5 3C7.154 3.038 7.492 3.359 8.073 3.973C9.123 5.083 10.173 5.175 10.873 4.805C11.922 4.25 11.04 3.352 12.272 2.865C13.075 2.545 13.187 1.68 12.74 1M18 9C16.5 9 16.234 10.247 15 10C12.5 9.5 11.792 10.059 11.792 11.251C11.792 12.443 11.792 12.443 11.272 13.337C10.934 13.919 10.815 14.5 11.489 15",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M4.5 1C3.55039 1.91901 2.79541 3.0197 2.28001 4.23655C1.76462 5.45339 1.49935 6.76151 1.5 8.083C1.5 13.56 5.977 18 11.5 18C14.1142 18.0063 16.6269 16.9886 18.5 15.165",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),KV=r=>X.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",...r},X.createElement("path",{d:"M7 4.639V18.5M13 1V15M1 6.71C1 5.236 1 4.5 1.393 4.07C1.53209 3.91703 1.70129 3.79447 1.89 3.71C2.422 3.474 3.121 3.707 4.519 4.173C5.586 4.529 6.119 4.707 6.659 4.688C6.8571 4.68149 7.05406 4.65536 7.247 4.61C7.772 4.485 8.24 4.173 9.176 3.55L10.558 2.628C11.758 1.828 12.357 1.428 13.045 1.337C13.733 1.244 14.417 1.472 15.784 1.928L16.949 2.316C17.939 2.646 18.434 2.811 18.717 3.204C19 3.597 19 4.12 19 5.162V13.291C19 14.764 19 15.501 18.607 15.931C18.4677 16.0832 18.2985 16.2051 18.11 16.289C17.578 16.526 16.879 16.293 15.481 15.827C14.414 15.471 13.881 15.293 13.341 15.312C13.1429 15.3185 12.9459 15.3446 12.753 15.39C12.228 15.515 11.76 15.827 10.824 16.45L9.442 17.372C8.242 18.172 7.643 18.572 6.955 18.663C6.267 18.756 5.583 18.528 4.216 18.072L3.051 17.684C2.061 17.354 1.566 17.189 1.283 16.796C1 16.403 1 15.88 1 14.838V6.71Z",stroke:"currentColor",strokeWidth:1.5})),XV=r=>X.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:.2,xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M3.625 0.25C2.72989 0.25 1.87145 0.605579 1.23851 1.23851C0.605579 1.87145 0.25 2.72989 0.25 3.625V16.375C0.25 17.2701 0.605579 18.1285 1.23851 18.7615C1.87145 19.3944 2.72989 19.75 3.625 19.75H16.375C17.2701 19.75 18.1285 19.3944 18.7615 18.7615C19.3944 18.1285 19.75 17.2701 19.75 16.375V3.625C19.75 2.72989 19.3944 1.87145 18.7615 1.23851C18.1285 0.605579 17.2701 0.25 16.375 0.25H3.625ZM18.25 4.75H1.75V3.625C1.75 3.12772 1.94754 2.65081 2.29917 2.29917C2.65081 1.94754 3.12772 1.75 3.625 1.75H16.375C16.8723 1.75 17.3492 1.94754 17.7008 2.29917C18.0525 2.65081 18.25 3.12772 18.25 3.625V4.75ZM1.75 6.25H18.25V16.375C18.25 16.8723 18.0525 17.3492 17.7008 17.7008C17.3492 18.0525 16.8723 18.25 16.375 18.25H3.625C3.12772 18.25 2.65081 18.0525 2.29917 17.7008C1.94754 17.3492 1.75 16.8723 1.75 16.375V6.25ZM14.125 11.5C13.8266 11.5 13.5405 11.3815 13.3295 11.1705C13.1185 10.9595 13 10.6734 13 10.375C13 10.0766 13.1185 9.79048 13.3295 9.5795C13.5405 9.36853 13.8266 9.25 14.125 9.25C14.4234 9.25 14.7095 9.36853 14.9205 9.5795C15.1315 9.79048 15.25 10.0766 15.25 10.375C15.25 10.6734 15.1315 10.9595 14.9205 11.1705C14.7095 11.3815 14.4234 11.5 14.125 11.5ZM13 14.125C13 14.4234 13.1185 14.7095 13.3295 14.9205C13.5405 15.1315 13.8266 15.25 14.125 15.25C14.4234 15.25 14.7095 15.1315 14.9205 14.9205C15.1315 14.7095 15.25 14.4234 15.25 14.125C15.25 13.8266 15.1315 13.5405 14.9205 13.3295C14.7095 13.1185 14.4234 13 14.125 13C13.8266 13 13.5405 13.1185 13.3295 13.3295C13.1185 13.5405 13 13.8266 13 14.125ZM10 15.25C9.70163 15.25 9.41548 15.1315 9.2045 14.9205C8.99353 14.7095 8.875 14.4234 8.875 14.125C8.875 13.8266 8.99353 13.5405 9.2045 13.3295C9.41548 13.1185 9.70163 13 10 13C10.2984 13 10.5845 13.1185 10.7955 13.3295C11.0065 13.5405 11.125 13.8266 11.125 14.125C11.125 14.4234 11.0065 14.7095 10.7955 14.9205C10.5845 15.1315 10.2984 15.25 10 15.25ZM8.875 10.375C8.875 10.6734 8.99353 10.9595 9.2045 11.1705C9.41548 11.3815 9.70163 11.5 10 11.5C10.2984 11.5 10.5845 11.3815 10.7955 11.1705C11.0065 10.9595 11.125 10.6734 11.125 10.375C11.125 10.0766 11.0065 9.79048 10.7955 9.5795C10.5845 9.36853 10.2984 9.25 10 9.25C9.70163 9.25 9.41548 9.36853 9.2045 9.5795C8.99353 9.79048 8.875 10.0766 8.875 10.375ZM5.875 11.5C5.57663 11.5 5.29048 11.3815 5.0795 11.1705C4.86853 10.9595 4.75 10.6734 4.75 10.375C4.75 10.0766 4.86853 9.79048 5.0795 9.5795C5.29048 9.36853 5.57663 9.25 5.875 9.25C6.17337 9.25 6.45952 9.36853 6.6705 9.5795C6.88147 9.79048 7 10.0766 7 10.375C7 10.6734 6.88147 10.9595 6.6705 11.1705C6.45952 11.3815 6.17337 11.5 5.875 11.5Z",fill:"currentColor"})),YV=()=>{const{sectionTheme:r,navigateToSection:e,isActive:t}=gv(),n=[{label:"Discover",icon:M.jsx(GV,{className:"navbar-icon"}),section:"discover"},{label:"Exhibitions",icon:M.jsx($V,{className:"navbar-icon"}),section:"exhibitions"},{label:"Map",icon:M.jsx(KV,{className:"navbar-icon"}),section:"map"},{label:"Schedule",icon:M.jsx(XV,{className:"navbar-icon"}),section:"schedule"}];return M.jsx("div",{style:{"--navbar-bg-color":`var(${r.background})`,"--navbar-fg-color":`var(${r.foreground})`},children:M.jsx("nav",{className:"navbar",children:n.map(({label:i,icon:a,section:o})=>M.jsxs("div",{onClick:()=>e(o),className:`navbar-item ${t(o)?"active":""}`,role:"button",tabIndex:0,"aria-label":i,children:[a,M.jsx("span",{children:i})]},o))})})},QV="/nhm-app/assets/youtubed-C0xMyjIM.jpg",ZV=r=>X.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M12 13.875C14.6924 13.875 16.875 11.6924 16.875 9C16.875 6.30761 14.6924 4.125 12 4.125C9.30761 4.125 7.125 6.30761 7.125 9C7.125 11.6924 9.30761 13.875 12 13.875Z",stroke:"currentColor",strokeWidth:2.25,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M4.125 21.375C4.125 17.625 7.125 13.875 12 13.875C16.875 13.875 19.875 17.625 19.875 21.375",stroke:"currentColor",strokeWidth:2.25,strokeLinecap:"round",strokeLinejoin:"round"})),JV=r=>X.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M7.5 16.875C9.36396 16.875 10.875 15.364 10.875 13.5C10.875 11.636 9.36396 10.125 7.5 10.125C5.63604 10.125 4.125 11.636 4.125 13.5C4.125 15.364 5.63604 16.875 7.5 16.875Z",stroke:"currentColor",strokeWidth:2.25,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M16.5 9.375C18.364 9.375 19.875 7.86396 19.875 6C19.875 4.13604 18.364 2.625 16.5 2.625C14.636 2.625 13.125 4.13604 13.125 6C13.125 7.86396 14.636 9.375 16.5 9.375Z",stroke:"currentColor",strokeWidth:2.25,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M11.625 13.875C11.625 12.375 12.75 9.375 16.5 9.375C20.25 9.375 21.375 12.375 21.375 13.875M2.625 21.375C2.625 19.875 3.75 16.875 7.5 16.875C11.25 16.875 12.375 19.875 12.375 21.375",stroke:"currentColor",strokeWidth:2.25,strokeLinecap:"round",strokeLinejoin:"round"})),tF=r=>X.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M21.3554 4.93311L12.3554 1.93311C12.1249 1.85531 11.8752 1.85531 11.6447 1.93311L2.64473 4.93311C2.42998 5.00423 2.24166 5.13845 2.10436 5.31823C1.96705 5.49802 1.88714 5.71502 1.87504 5.94092C1.87401 5.96059 1.87401 5.98031 1.87504 5.99998V13.5C1.87504 13.7984 1.99357 14.0845 2.20455 14.2955C2.41553 14.5065 2.70167 14.625 3.00004 14.625C3.29841 14.625 3.58456 14.5065 3.79554 14.2955C4.00652 14.0845 4.12504 13.7984 4.12504 13.5V7.56092L6.34786 8.30155C5.658 9.62201 5.453 11.1426 5.76853 12.5986C6.08405 14.0546 6.90013 15.3539 8.07473 16.2703C6.53763 17.0283 5.23676 18.1917 4.31254 19.635C4.22932 19.7587 4.17151 19.8977 4.14247 20.0439C4.11344 20.1902 4.11377 20.3407 4.14343 20.4868C4.17309 20.6329 4.2315 20.7717 4.31526 20.895C4.39902 21.0184 4.50647 21.1238 4.63134 21.2053C4.75622 21.2867 4.89604 21.3425 5.04268 21.3695C5.18932 21.3964 5.33985 21.3939 5.48552 21.3622C5.63119 21.3304 5.7691 21.2701 5.89123 21.1845C6.01335 21.099 6.11726 20.9901 6.19692 20.864C7.53473 18.8053 9.65629 17.625 12 17.625C14.3438 17.625 16.4654 18.8053 17.8079 20.864C17.8875 20.9901 17.9914 21.099 18.1135 21.1845C18.2357 21.2701 18.3736 21.3304 18.5193 21.3622C18.6649 21.3939 18.8155 21.3964 18.9621 21.3695C19.1087 21.3425 19.2486 21.2867 19.3734 21.2053C19.4983 21.1238 19.6057 21.0184 19.6895 20.895C19.7733 20.7717 19.8317 20.6329 19.8613 20.4868C19.891 20.3407 19.8913 20.1902 19.8623 20.0439C19.8333 19.8977 19.7755 19.7587 19.6922 19.635C18.7671 18.19 17.4645 17.0255 15.9254 16.2675C17.1 15.3511 17.916 14.0518 18.2316 12.5958C18.5471 11.1398 18.3421 9.6192 17.6522 8.29873L21.3554 7.06405C21.5791 6.9892 21.7736 6.84592 21.9114 6.65447C22.0493 6.46301 22.1234 6.23308 22.1234 5.99717C22.1234 5.76127 22.0493 5.53133 21.9114 5.33988C21.7736 5.14842 21.5791 5.00514 21.3554 4.9303V4.93311ZM12 4.18311L17.4422 5.99998L12 7.81405L6.56254 5.99998L12 4.18311ZM16.125 11.25C16.1252 11.8907 15.976 12.5226 15.6895 13.0957C15.4029 13.6688 14.9868 14.1672 14.4741 14.5515C13.9614 14.9358 13.3662 15.1953 12.7358 15.3096C12.1054 15.4239 11.457 15.3897 10.842 15.2099C10.2271 15.03 9.66246 14.7093 9.19297 14.2733C8.72349 13.8373 8.36203 13.2979 8.13724 12.698C7.91245 12.098 7.83052 11.4538 7.89795 10.8167C7.96537 10.1795 8.18029 9.56683 8.52567 9.02717L11.6447 10.0669C11.8753 10.1443 12.1248 10.1443 12.3554 10.0669L15.4744 9.02717C15.8998 9.69044 16.1257 10.462 16.125 11.25Z",fill:"currentColor",stroke:"currentColor",strokeWidth:.4})),eF=()=>M.jsxs("div",{className:"scrollable-container",children:[M.jsx("div",{className:"back-button-container",children:M.jsx(Cr,{to:"/"})}),M.jsxs("div",{className:"info-page-content content",children:[M.jsx("img",{src:QV,alt:"Ticket Prices"}),M.jsx("h1",{children:"Ticket Prices"}),M.jsxs("ul",{className:"highlighted-list",children:[M.jsxs("li",{children:[M.jsx("strong",{children:"Adults (18+ years):"})," 150 DKK/20 "]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Students:"})," 90 DKK/12  (with student card)"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Groups, per person:"})," 130 DKK/18 "]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Danish Nature Conservation Society:"})," 25% discount on admission for up to 2 people (with DN membership card)"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Jyllands-Posten:"})," 25% discount on admission for up to 2 people (with JP card)"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"AU employees:"})," 90 DKK (with employee card)"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Elderly Sagen members:"})," 90 DKK (with membership card)"]})]}),M.jsx("h2",{children:"There is free access for:"}),M.jsx("p",{children:"Children and young people under 18 years of age. Children under 12 years of age must be accompanied by adults. Biology and geology students upon presentation of student card and valid enrollment confirmation Companions for holders of companion cards (If access is desired to the museum's own events, a free companion ticket must be ordered in advance atbooking@nathist.dk)"}),M.jsx("h2",{children:"Annual Pass"}),M.jsx("p",{children:"The annual pass provides free access to the museum's exhibitions from the date of issue and for 12 months thereafter. Annual passes can only be renewed by visiting the museum. The annual pass gives a 50% discount on tickets to Denmark's othernatural history museums."}),M.jsxs("div",{className:"info-card-container",children:[M.jsx(ZV,{className:"info-card-icon"}),M.jsx("div",{className:"info-card-text",children:M.jsxs("span",{children:[M.jsx("strong",{children:"Annual pass SOLO"}),M.jsx("br",{}),"(Access for cardholder):295 DKK/40 "]})})]}),M.jsx("p",{children:"Buy your Annual Pass SOLO in the Museum Shop oras a gift certificate."}),M.jsxs("div",{className:"info-card-container",children:[M.jsx(JV,{className:"info-card-icon"}),M.jsx("div",{className:"info-card-text",children:M.jsxs("span",{children:[M.jsx("strong",{children:"Annual card PLUS"}),M.jsx("br",{}),"(Access for cardholder + one companion):395 DKK/53 "]})})]}),M.jsx("p",{children:"Buy your Annual Pass PLUS in the Museum Shop oras a gift certificate."}),M.jsxs("div",{className:"info-card-container",children:[M.jsx(tF,{className:"info-card-icon"}),M.jsx("div",{className:"info-card-text",children:M.jsxs("span",{children:[M.jsx("strong",{children:"Annual card STUD"}),M.jsx("br",{}),"(Access for cardholder. Student card must be presented upon registration):165 DKK/22 "]})})]}),M.jsx("p",{children:"Buy your STUD Annual Pass in the Museum Shop oras a gift certificate."}),M.jsx("h2",{children:"Visits in connection with teaching"}),M.jsxs("p",{className:"highlighted-text",children:[M.jsx("strong",{children:"Accompanying parents:"}),"150 DKK/person"]}),M.jsx("p",{children:"There is free access for: Pupils, students and teachers from secondary schools, primary schools and youth education. Teacher and pedagogue students for study and preparation purposes. Biology and geology students upon presentation of student card and valid enrollment confirmation Teachers and educators for work purposes We also refer you to our School Service, where you can read more about teaching presentations and tours."})]})]}),nF="/nhm-app/assets/opening-hours-Dr2kH3vC.jpg",rF=()=>M.jsxs("div",{className:"scrollable-container",children:[M.jsx("div",{className:"back-button-container",children:M.jsx(Cr,{to:"/"})}),M.jsxs("div",{className:"info-page-content content",children:[M.jsx("img",{src:nF,alt:"Opening Hours"}),M.jsx("h1",{children:"Opening Hours"}),M.jsxs("ul",{className:"highlighted-list",children:[M.jsxs("li",{children:[M.jsx("strong",{children:"Monday:"})," Closed"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Tuesday:"})," 9:00-16:00"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Wednesday:"})," 9:00-21:00"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Thursday:"})," 9:00-16:00"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Friday:"})," 9:00-16:00"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Saturday:"})," 9:00-16:00"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Sunday:"})," 9:00-16:00"]})]}),M.jsx("p",{children:"* We are open on Mondays during the school holidays this week: 7, 16, 17, 24, 27, 28, 29, 30, 31, 32, 42, 52 and 1."}),M.jsx("p",{children:"In addition, we are open on Maundy Thursday, Good Friday, Easter Sunday, Easter Monday, Whit Monday, Pentecost Sunday, Ascension Day and Constitution Day."}),M.jsx("p",{children:"Our only normal closing days are: Last Friday in April (Uniparken Sailing Race  April 25 in 2025) December 24, 25 and 31 and January 1."})]})]}),iF="/nhm-app/assets/parking-CohACtLm.jpg",aF=r=>X.createElement("svg",{width:20,height:23,viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M12 0.75C12 0.551088 12.079 0.360322 12.2197 0.21967C12.3603 0.0790176 12.5511 0 12.75 0L18.75 0C18.9489 0 19.1397 0.0790176 19.2803 0.21967C19.421 0.360322 19.5 0.551088 19.5 0.75V8.25C19.5 8.44891 19.421 8.63968 19.2803 8.78033C19.1397 8.92098 18.9489 9 18.75 9H16.5V21.75C16.5 21.9489 16.421 22.1397 16.2803 22.2803C16.1397 22.421 15.9489 22.5 15.75 22.5C15.5511 22.5 15.3603 22.421 15.2197 22.2803C15.079 22.1397 15 21.9489 15 21.75V9H12.75C12.5511 9 12.3603 8.92098 12.2197 8.78033C12.079 8.63968 12 8.44891 12 8.25V0.75ZM4.9785 3H10.5V4.5H4.9785C4.61387 4.49992 4.2617 4.63265 3.98783 4.87339C3.71397 5.11412 3.53717 5.44637 3.4905 5.808L3.078 9H10.6275C10.7827 9.43887 11.0701 9.81881 11.4503 10.0875C11.8304 10.3561 12.2845 10.5002 12.75 10.5H2.25C2.05109 10.5 1.86032 10.579 1.71967 10.7197C1.57902 10.8603 1.5 11.0511 1.5 11.25V15.75C1.5 15.9489 1.57902 16.1397 1.71967 16.2803C1.86032 16.421 2.05109 16.5 2.25 16.5H13.5V18H4.5V19.875C4.5 20.1734 4.38147 20.4595 4.1705 20.6705C3.95952 20.8815 3.67337 21 3.375 21C3.07663 21 2.79048 20.8815 2.5795 20.6705C2.36853 20.4595 2.25 20.1734 2.25 19.875V18C1.65326 18 1.08097 17.7629 0.65901 17.341C0.237053 16.919 2.45703e-08 16.3467 2.45703e-08 15.75V11.25C-7.00847e-05 10.7755 0.1499 10.313 0.428468 9.92886C0.707035 9.54469 1.09994 9.25842 1.551 9.111L1.566 9H0.75C0.551088 9 0.360322 8.92098 0.21967 8.78033C0.0790178 8.63968 2.45703e-08 8.44891 2.45703e-08 8.25C2.45703e-08 8.05109 0.0790178 7.86032 0.21967 7.71967C0.360322 7.57902 0.551088 7.5 0.75 7.5H1.7595L2.0025 5.616C2.09588 4.89249 2.44969 4.22779 2.99773 3.74628C3.54577 3.26478 4.25048 2.99947 4.98 3M13.125 12.3765C13.257 12.3765 13.3825 12.398 13.5015 12.441V14.559C13.3319 14.62 13.15 14.6392 12.9714 14.615C12.7928 14.5908 12.6226 14.5239 12.4753 14.42C12.328 14.3161 12.2079 14.1783 12.1252 14.0181C12.0424 13.858 11.9995 13.6803 12 13.5C12 12.879 12.5025 12.3765 13.1235 12.3765M6 13.5C6 13.6475 5.97094 13.7936 5.91448 13.9299C5.85802 14.0663 5.77526 14.1901 5.67093 14.2944C5.56661 14.3988 5.44275 14.4815 5.30645 14.538C5.17014 14.5944 5.02404 14.6235 4.8765 14.6235C4.72896 14.6235 4.58286 14.5944 4.44656 14.538C4.31025 14.4815 4.18639 14.3988 4.08207 14.2944C3.97774 14.1901 3.89498 14.0663 3.83852 13.9299C3.78206 13.7936 3.753 13.6475 3.753 13.5C3.753 13.202 3.87137 12.9163 4.08207 12.7056C4.29276 12.4949 4.57853 12.3765 4.8765 12.3765C5.17447 12.3765 5.46024 12.4949 5.67093 12.7056C5.88163 12.9163 6 13.202 6 13.5Z",fill:"none",stroke:"currentColor",strokeWidth:1.5})),oF=r=>X.createElement("svg",{width:18,height:22,viewBox:"0 0 18 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M1 9C1 5.229 1 3.343 2.172 2.172C3.344 1.001 5.229 1 9 1C12.771 1 14.657 1 15.828 2.172C16.999 3.344 17 5.229 17 9V11C17 14.771 17 16.657 15.828 17.828C14.656 18.999 12.771 19 9 19C5.229 19 3.343 19 2.172 17.828C1.001 16.656 1 14.771 1 11V9Z",stroke:"currentColor",strokeWidth:1.5}),X.createElement("path",{d:"M1 12H17M12.5 15H14M4 15H5.5M4 19L3 21M14 19L15 21M7 1V1.5C7 2.03043 7.21071 2.53914 7.58579 2.91421C7.96086 3.28929 8.46957 3.5 9 3.5C9.53043 3.5 10.0391 3.28929 10.4142 2.91421C10.7893 2.53914 11 2.03043 11 1.5V1",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),sF=()=>M.jsxs("div",{className:"scrollable-container",children:[M.jsx("div",{className:"back-button-container",children:M.jsx(Cr,{to:"/"})}),M.jsxs("div",{className:"info-page-content content",children:[M.jsx("img",{src:iF,alt:"Route and Parking"}),M.jsx("h1",{children:"Route and Parking"}),M.jsx("h2",{children:"Find your way by car"}),M.jsx("p",{children:"The entrance to the museum is on Wilhelm Meyers All, and you can get to the museum from Randersvej via Vennelyst Boulevard, from Langelandsgade or from Hegh-Guldbergs Gade."}),M.jsx("h2",{children:"Parking"}),M.jsx("p",{children:"It is possible to park in the museum's parking area. "}),M.jsxs("div",{className:"info-card-container",children:[M.jsx(aF,{className:"info-card-icon"}),M.jsx("div",{className:"info-card-text",children:M.jsx("span",{children:"Parking is paid for by card/cash at the parking meter or by using apps from EasyPark or Parkzone."})})]}),M.jsx("p",{children:"When paying by card and app, you only pay for the time used."}),M.jsx("p",{children:"In addition, parking is possible along Wilhelm Meyers All opposite the Natural History Museum according to municipal regulations ."}),M.jsx("p",{children:"Pay particular attention to the official parking signs and make sure that you register your car in the correct area code when using the parking app!"}),M.jsx("h2",{children:"Disabled Parking"}),M.jsx("p",{children:"There is a disabled parking space at the museum's main entrance, where parking is free with a valid disabled sign in the windshield. Parking outside this space is not free, even if you have a valid sign."}),M.jsx("h2",{children:"By bus & light rail"}),M.jsxs("div",{className:"info-card-container bus-info-card",children:[M.jsx(oF,{className:"info-card-icon"}),M.jsx("div",{className:"info-card-text",children:M.jsx("span",{children:"Parking is paid for by card/cash at the parking meter or by using apps from EasyPark or Parkzone."})})]}),M.jsxs("ul",{className:"highlighted-list no-style",children:[M.jsx("li",{children:"Take bus no. 12, 16, 18, 100 or Directions & Parking to Universitetsparken. From here it is approx. 400 meters to the museum."}),M.jsx("li",{children:"Take bus no. 2A or 13 to Kaserneboulevarden. From here it is approximately 550 meters to the museum."}),M.jsx("li",{children:"Take bus no. 5A to the University on Nordre Ringgade. From here it is approximately 650 meters to the museum."})]}),M.jsx("p",{children:"Please contact Midttrafik for bus information on tel. 70 21 02 30 or midttrafik.dk"})]})]}),uF="/nhm-app/assets/facebook-D7NSkzI-.jpg",lF="/nhm-app/assets/tripadvisor-DNqPbkdM.jpg",cF="/nhm-app/assets/youtubed-C0xMyjIM.jpg",hF="/nhm-app/assets/linkedin-B4maJWVe.jpg",fF="/nhm-app/assets/instagram-BumrExuF.jpg",dF=r=>X.createElement("svg",{width:96,height:96,viewBox:"0 0 96 96",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M48 10.5C40.5832 10.5 33.333 12.6993 27.1661 16.8199C20.9993 20.9404 16.1928 26.7971 13.3545 33.6494C10.5162 40.5016 9.77362 48.0416 11.2206 55.3159C12.6675 62.5902 16.239 69.272 21.4835 74.5165C26.728 79.761 33.4098 83.3325 40.6841 84.7794C47.9584 86.2264 55.4984 85.4838 62.3506 82.6455C69.2029 79.8072 75.0596 75.0007 79.1801 68.8339C83.3007 62.667 85.5 55.4168 85.5 48C85.4891 38.0577 81.5347 28.5258 74.5045 21.4956C67.4742 14.4653 57.9423 10.5109 48 10.5ZM49.5 82.4662V55.5H60C60.3978 55.5 60.7794 55.342 61.0607 55.0607C61.342 54.7794 61.5 54.3978 61.5 54C61.5 53.6022 61.342 53.2206 61.0607 52.9393C60.7794 52.658 60.3978 52.5 60 52.5H49.5V42C49.5 40.0109 50.2902 38.1032 51.6967 36.6967C53.1032 35.2902 55.0109 34.5 57 34.5H63C63.3978 34.5 63.7794 34.342 64.0607 34.0607C64.342 33.7794 64.5 33.3978 64.5 33C64.5 32.6022 64.342 32.2206 64.0607 31.9393C63.7794 31.658 63.3978 31.5 63 31.5H57C54.2152 31.5 51.5445 32.6062 49.5754 34.5754C47.6063 36.5445 46.5 39.2152 46.5 42V52.5H36C35.6022 52.5 35.2207 52.658 34.9394 52.9393C34.6581 53.2206 34.5 53.6022 34.5 54C34.5 54.3978 34.6581 54.7794 34.9394 55.0607C35.2207 55.342 35.6022 55.5 36 55.5H46.5V82.4662C37.4885 82.0741 28.9889 78.1682 22.8222 71.5855C16.6555 65.0027 13.312 56.2666 13.5082 47.2487C13.7043 38.2308 17.4244 29.6483 23.8715 23.3399C30.3186 17.0315 38.98 13.4989 48 13.4989C57.0201 13.4989 65.6814 17.0315 72.1285 23.3399C78.5756 29.6483 82.2957 38.2308 82.4919 47.2487C82.688 56.2666 79.3446 65.0027 73.1778 71.5855C67.0111 78.1682 58.5115 82.0741 49.5 82.4662Z",fill:"white"})),pF=r=>X.createElement("svg",{width:96,height:96,viewBox:"0 0 96 96",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M28.5 71.376C39.2696 71.376 48 62.6456 48 51.876C48 41.1064 39.2696 32.376 28.5 32.376C17.7304 32.376 9 41.1064 9 51.876C9 62.6456 17.7304 71.376 28.5 71.376Z",stroke:"white",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M67.5 71.376C78.2696 71.376 87 62.6456 87 51.876C87 41.1064 78.2696 32.376 67.5 32.376C56.7304 32.376 48 41.1064 48 51.876C48 62.6456 56.7304 71.376 67.5 71.376Z",stroke:"white",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M28.5 58.034C31.901 58.034 34.658 55.277 34.658 51.876C34.658 48.475 31.901 45.718 28.5 45.718C25.0991 45.718 22.342 48.475 22.342 51.876C22.342 55.277 25.0991 58.034 28.5 58.034Z",stroke:"white",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M67.5 58.034C70.901 58.034 73.658 55.277 73.658 51.876C73.658 48.475 70.901 45.718 67.5 45.718C64.0991 45.718 61.342 48.475 61.342 51.876C61.342 55.277 64.0991 58.034 67.5 58.034Z",stroke:"white",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M21.458 32.376H9L14.716 38.092",stroke:"white",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M81.2841 38.092C70.9101 27.718 60.1921 24.626 48.0001 24.626C35.8101 24.626 25.0901 27.718 14.7161 38.09M53.7161 65.66L48.0001 71.376L42.2841 65.66",stroke:"white",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M74.542 32.376H87L81.284 38.092",stroke:"white",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})),mF=r=>X.createElement("svg",{width:96,height:96,viewBox:"0 0 96 96",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M56 48L42 56V40L56 48Z",fill:"white",stroke:"white",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M8 50.832V45.168C8 33.588 8 27.796 11.62 24.072C15.244 20.344 20.948 20.184 32.352 19.86C37.752 19.708 43.272 19.6 48 19.6C52.728 19.6 58.244 19.708 63.648 19.86C75.052 20.184 80.756 20.344 84.376 24.072C87.996 27.8 88 33.592 88 45.168V50.828C88 62.412 88 68.2 84.38 71.928C80.756 75.652 75.056 75.816 63.648 76.136C58.248 76.292 52.728 76.4 48 76.4C43.272 76.4 37.756 76.292 32.352 76.136C20.948 75.816 15.244 75.656 11.62 71.928C7.996 68.2 8 62.408 8 50.832Z",stroke:"white",strokeWidth:3})),gF=r=>X.createElement("svg",{width:96,height:96,viewBox:"0 0 96 96",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M28 68V40M84 32V64C84 69.3043 81.8929 74.3914 78.1421 78.1421C74.3914 81.8929 69.3043 84 64 84H32C26.6957 84 21.6086 81.8929 17.8579 78.1421C14.1071 74.3914 12 69.3043 12 64V32C12 26.6957 14.1071 21.6086 17.8579 17.8579C21.6086 14.1071 26.6957 12 32 12H64C69.3043 12 74.3914 14.1071 78.1421 17.8579C81.8929 21.6086 84 26.6957 84 32Z",stroke:"white",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M44 68V55M44 55V40M44 55C44 40 68 40 68 55V68M28 28.04L28.04 27.996",stroke:"white",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"})),vF=r=>X.createElement("svg",{width:96,height:96,viewBox:"0 0 96 96",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M10 48C10 30.088 10 21.128 15.564 15.564C21.128 10 30.084 10 48 10C65.912 10 74.872 10 80.436 15.564C86 21.128 86 30.084 86 48C86 65.912 86 74.872 80.436 80.436C74.872 86 65.916 86 48 86C30.088 86 21.128 86 15.564 80.436C10 74.872 10 65.916 10 48Z",stroke:"white",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M70.032 26H69.992M66 48C66 52.7739 64.1036 57.3523 60.7279 60.7279C57.3523 64.1036 52.7739 66 48 66C43.2261 66 38.6477 64.1036 35.2721 60.7279C31.8964 57.3523 30 52.7739 30 48C30 43.2261 31.8964 38.6477 35.2721 35.2721C38.6477 31.8964 43.2261 30 48 30C52.7739 30 57.3523 31.8964 60.7279 35.2721C64.1036 38.6477 66 43.2261 66 48Z",stroke:"white",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"})),yF=()=>M.jsxs("div",{className:"social-media-card",children:[M.jsxs("div",{className:"social-media-square top-left-square",style:{backgroundImage:`url(${uF})`},children:[M.jsx("div",{className:"dim-overlay"}),M.jsx(dF,{className:"icon"})]}),M.jsxs("div",{className:"social-media-square top-right-square",style:{backgroundImage:`url(${lF})`},children:[M.jsx("div",{className:"dim-overlay"}),M.jsx(pF,{className:"icon"})]}),M.jsxs("div",{className:"social-media-square bottom-left-square",style:{backgroundImage:`url(${cF})`},children:[M.jsx("div",{className:"dim-overlay"}),M.jsx(mF,{className:"icon"})]}),M.jsxs("div",{className:"social-media-square bottom-right-square",style:{backgroundImage:`url(${hF})`},children:[M.jsx("div",{className:"dim-overlay"}),M.jsx(gF,{className:"icon"})]}),M.jsx("div",{className:"social-media-center-square",children:M.jsxs("div",{className:"social-media-center-inner",style:{backgroundImage:`url(${fF})`,backgroundSize:"cover",backgroundPosition:"center"},children:[M.jsx("div",{className:"dim-overlay"}),M.jsx(vF,{className:"icon"})]})})]}),bF=()=>M.jsxs("div",{className:"scrollable-container",children:[M.jsx("div",{className:"back-button-container",children:M.jsx(Cr,{to:"/"})}),M.jsxs("div",{className:"info-page-content content",children:[M.jsx("h1",{children:"Social Media"}),M.jsx(yF,{}),M.jsxs("ul",{className:"highlighted-list no-style",style:{marginTop:32},children:[M.jsxs("li",{children:[M.jsx("strong",{children:"Instagram:"})," ",M.jsx("a",{href:"https://www.instagram.com/nathistaarhus/",target:"_blank",rel:"noopener noreferrer",children:"@nathistaarhus"})]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Facebook:"})," ",M.jsx("a",{href:"https://www.facebook.com/nathistaarhus",target:"_blank",rel:"noopener noreferrer",children:"/nathistaarhus"})]}),M.jsxs("li",{children:[M.jsx("strong",{children:"YouTube:"})," ",M.jsx("a",{href:"https://www.youtube.com/@nathistaarhus",target:"_blank",rel:"noopener noreferrer",children:"@nathistaarhus"})]}),M.jsxs("li",{children:[M.jsx("strong",{children:"LinkedIn:"})," ",M.jsx("a",{href:"https://www.linkedin.com/company/nathistaarhus",target:"_blank",rel:"noopener noreferrer",children:"/company/nathistaarhus"})]}),M.jsxs("li",{children:[M.jsx("strong",{children:"TripAdvisor:"})," ",M.jsx("a",{href:"https://www.tripadvisor.com/Attraction_Review-g189530-d243708-Reviews-Natural_History_Museum_Aarhus-Aarhus_East_Jutland_Jutland.html",target:"_blank",rel:"noopener noreferrer",children:"Natural History Museum Aarhus"})]})]})]})]}),xF="/nhm-app/assets/contact-info-TeFPTmiF.Jpg",wF=()=>M.jsxs("div",{className:"scrollable-container",children:[M.jsx("div",{className:"back-button-container",children:M.jsx(Cr,{to:"/"})}),M.jsxs("div",{className:"info-page-content content",children:[M.jsx("img",{src:xF,alt:"Opening Hours"}),M.jsx("h1",{children:"Contact Information"}),M.jsxs("ul",{className:"highlighted-list no-style",children:[M.jsxs("li",{children:[M.jsx("strong",{children:"Address:"})," Wilhelm Meyers All 10, 8000 Aarhus C"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Email:"})," info@nathist.dk"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"Phone:"})," +45 87 15 54 15"]}),M.jsxs("li",{children:[M.jsx("strong",{children:"CVR"})," 29073910"]})]}),M.jsxs("p",{children:["The Danish Veterinary and Food Administration's smiley reports "," ",M.jsx("a",{href:"https://www.findsmiley.dk/67613",target:"_blank",rel:"noopener noreferrer",children:"click here"})]})]})]}),vv=({icon:r,heading:e,description:t})=>M.jsxs("div",{className:"notification",children:[M.jsx("div",{className:"notification-icon",children:r}),M.jsxs("div",{className:"notification-content",children:[M.jsx("h3",{children:e}),M.jsx("p",{className:"small-text",children:t})]})]}),CF=r=>X.createElement("svg",{width:40,height:40,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M35.8285 16.4049C36.7618 19.2232 36.7352 22.2666 36.6702 24.8849L36.6668 25.0416C36.6558 25.4836 36.4696 25.9031 36.1492 26.2079C35.8288 26.5126 35.4005 26.6776 34.9585 26.6666C34.5165 26.6555 34.0969 26.4693 33.7922 26.149C33.4874 25.8286 33.3224 25.4003 33.3335 24.9582L33.3385 24.8032C33.4035 22.1416 33.3902 19.6499 32.6635 17.4532C32.1134 15.7974 31.2436 14.2657 30.1035 12.9449C27.7879 10.2759 24.5104 8.63136 20.9866 8.37032C17.4628 8.10927 13.9788 9.25291 11.2952 11.5516C9.96969 12.6861 8.88165 14.0715 8.09363 15.6281C7.3056 17.1846 6.83317 18.8817 6.70349 20.6216C6.61683 21.7749 6.63683 22.4549 6.66683 23.4182C6.68516 24.0382 6.70849 24.7766 6.70849 25.8332C6.70849 26.2753 6.5329 26.6992 6.22034 27.0117C5.90778 27.3243 5.48386 27.4999 5.04183 27.4999C4.5998 27.4999 4.17588 27.3243 3.86332 27.0117C3.55076 26.6992 3.37516 26.2753 3.37516 25.8332C3.37516 25.0149 3.35683 24.3432 3.33849 23.7249C3.30849 22.6116 3.28183 21.6766 3.38016 20.3749C3.54247 18.1979 4.13343 16.0745 5.11907 14.1267C6.1047 12.1789 7.46559 10.4451 9.12349 9.0249C12.4737 6.14554 16.83 4.71402 21.2352 5.0449C25.6382 5.37257 29.7329 7.42887 32.6252 10.7649C34.052 12.417 35.1404 14.3333 35.8285 16.4049Z",fill:"#130902"}),X.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.0915 26.1649L15.5482 31.3816C15.6029 32.0046 15.5343 32.6323 15.3464 33.2288C15.1585 33.8254 14.8549 34.379 14.4529 34.8582C14.051 35.3374 13.5586 35.7327 13.0039 36.0215C12.4491 36.3103 11.8429 36.4871 11.2199 36.5416C9.39565 36.701 7.58279 36.1294 6.18004 34.9523C4.77729 33.7752 3.89955 32.0891 3.73987 30.2649L3.32321 25.5216C3.266 24.8674 3.33823 24.2083 3.53577 23.582C3.73332 22.9557 4.0523 22.3744 4.47451 21.8714C4.89673 21.3684 5.41389 20.9535 5.99647 20.6504C6.57906 20.3473 7.21564 20.162 7.86987 20.1049C9.63111 19.951 11.3814 20.503 12.7356 21.6394C14.0899 22.7759 14.9374 24.4037 15.0915 26.1649ZM8.15987 23.4249C7.71965 23.4635 7.31276 23.6753 7.02866 24.0137C6.74456 24.3522 6.60651 24.7897 6.64487 25.2299L7.06154 29.9749C7.14415 30.9181 7.59783 31.7898 8.32287 32.3986C9.04792 33.0074 9.98501 33.3034 10.9282 33.2216C11.1153 33.2054 11.2974 33.1526 11.464 33.066C11.6306 32.9794 11.7785 32.8608 11.8993 32.717C12.02 32.5732 12.1112 32.407 12.1677 32.2279C12.2241 32.0488 12.2447 31.8603 12.2282 31.6733L11.7715 26.4566C11.7336 26.0203 11.61 25.5958 11.408 25.2073C11.2059 24.8189 10.9292 24.474 10.5938 24.1924C10.2584 23.9109 9.87085 23.6982 9.45322 23.5665C9.03559 23.4348 8.59611 23.3867 8.15987 23.4249ZM36.2582 30.5016L36.7149 25.2849C36.7696 24.6619 36.701 24.0342 36.5131 23.4377C36.3251 22.8411 36.0215 22.2875 35.6196 21.8083C35.2177 21.3291 34.7253 20.9338 34.1705 20.645C33.6158 20.3562 33.0096 20.1794 32.3865 20.1249C30.5623 19.9655 28.7495 20.5371 27.3467 21.7142C25.944 22.8913 25.0662 24.5774 24.9065 26.4016L24.4899 31.1449C24.4327 31.7991 24.5049 32.4582 24.7024 33.0845C24.9 33.7108 25.219 34.2921 25.6412 34.7951C26.0634 35.2981 26.5806 35.713 27.1631 36.0161C27.7457 36.3192 28.3823 36.5045 29.0365 36.5616C30.7978 36.7155 32.548 36.1635 33.9023 35.0271C35.2566 33.8906 36.104 32.2628 36.2582 30.5016ZM29.3265 33.2416C28.8863 33.203 28.4794 32.9912 28.1953 32.6528C27.9112 32.3143 27.7732 31.8768 27.8115 31.4366L28.2282 26.6916C28.3108 25.7485 28.7645 24.8767 29.4895 24.2679C30.2146 23.6591 31.1517 23.3631 32.0949 23.4449C32.4722 23.4788 32.8208 23.6607 33.0644 23.9508C33.308 24.241 33.4268 24.6158 33.3949 24.9933L32.9382 30.2099C32.9002 30.6462 32.7767 31.0707 32.5746 31.4592C32.3726 31.8477 32.0959 32.1925 31.7605 32.4741C31.4251 32.7556 31.0375 32.9683 30.6199 33.1C30.2023 33.2317 29.7628 33.2798 29.3265 33.2416Z",fill:"#130902"})),dN=({buttonText:r,nextPage:e})=>{const[t,n]=X.useState(!1),i=wi(),a=()=>{n(!0)};return X.useEffect(()=>{if(t){const o=setTimeout(()=>{i(e)},500);return()=>clearTimeout(o)}},[t,i]),M.jsx("div",{className:`slider-container ${t?"active":""}`,onClick:a,children:M.jsxs("div",{className:"slider-bg",children:[!t&&M.jsx("div",{className:"arrows",children:">>>"}),M.jsx("div",{className:"go-button",children:r})]})})},EF=r=>X.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M10.9695 1.89292C11.248 1.62962 11.6167 1.48291 12 1.48291C12.3833 1.48291 12.752 1.62962 13.0305 1.89292L20.2965 8.76142C20.7465 9.18592 21 9.77842 21 10.3964V18.7514C21 19.3482 20.7629 19.9205 20.341 20.3424C19.919 20.7644 19.3467 21.0014 18.75 21.0014H15.75C15.4544 21.0014 15.1617 20.9432 14.8886 20.83C14.6155 20.7168 14.3674 20.551 14.1585 20.3419C13.9495 20.1328 13.7838 19.8846 13.6708 19.6114C13.5579 19.3383 13.4998 19.0455 13.5 18.7499V14.9999C13.5 14.801 13.421 14.6102 13.2803 14.4696C13.1397 14.3289 12.9489 14.2499 12.75 14.2499H11.25C11.0511 14.2499 10.8603 14.3289 10.7197 14.4696C10.579 14.6102 10.5 14.801 10.5 14.9999V18.7499C10.5 19.3467 10.2629 19.919 9.84099 20.3409C9.41903 20.7629 8.84674 20.9999 8.25 20.9999H5.25C4.65326 20.9999 4.08097 20.7629 3.65901 20.3409C3.23705 19.919 3 19.3467 3 18.7499V10.3949C3 9.77692 3.255 9.18442 3.705 8.75992L10.9695 1.89292ZM12 2.98192L4.734 9.85192C4.66024 9.92185 4.60146 10.006 4.56123 10.0994C4.52101 10.1927 4.50017 10.2933 4.5 10.3949V18.7499C4.5 18.9488 4.57902 19.1396 4.71967 19.2803C4.86032 19.4209 5.05109 19.4999 5.25 19.4999H8.25C8.44891 19.4999 8.63968 19.4209 8.78033 19.2803C8.92098 19.1396 9 18.9488 9 18.7499V14.9999C9 14.4032 9.23705 13.8309 9.65901 13.4089C10.081 12.987 10.6533 12.7499 11.25 12.7499H12.75C13.3467 12.7499 13.919 12.987 14.341 13.4089C14.7629 13.8309 15 14.4032 15 14.9999V18.7499C15 18.9488 15.079 19.1396 15.2197 19.2803C15.3603 19.4209 15.5511 19.4999 15.75 19.4999H18.75C18.9489 19.4999 19.1397 19.4209 19.2803 19.2803C19.421 19.1396 19.5 18.9488 19.5 18.7499V10.3949C19.5 10.293 19.4793 10.1922 19.4391 10.0986C19.3988 10.005 19.3399 9.92053 19.266 9.85042L12 2.98192Z",fill:"white"})),Po=({to:r,onClick:e})=>{const t=wi(),n=()=>{e?e():r&&t(r)};return M.jsx("button",{className:"home-button",onClick:n,children:M.jsx(EF,{className:"home"})})},_F=()=>M.jsxs("div",{className:"slider-page",children:[M.jsxs("div",{className:"top-buttons",children:[M.jsx(Cr,{}),M.jsx(Po,{to:"/"})]}),M.jsxs("div",{className:"content",children:[M.jsx(vv,{icon:M.jsx(CF,{}),heading:"This contains audio!",description:"We recommend using headphones."}),M.jsxs("div",{className:"header",children:[M.jsx("h1",{children:"Explore the expedition to"}),M.jsx("p",{className:"big-text",children:"AFRICA"})]})]}),M.jsx(dN,{buttonText:"GO",nextPage:"/safariPages/scene/1"})]}),TF=({label:r,checked:e})=>M.jsxs("div",{className:"checkbox",children:[M.jsx("div",{className:`rectangle ${e?"checked":""}`}),M.jsx("p",{className:`label ${e?"crossed":""}`,children:r})]}),SF=[{id:"1",label:"Hat",hasOverlay:!0},{id:"5",label:"Belts",hasOverlay:!1},{id:"6",label:"Shirts",hasOverlay:!1},{id:"4",label:"Lenses",hasOverlay:!1},{id:"2",label:"Film",hasOverlay:!0},{id:"3",label:"Finette",hasOverlay:!0}];function AF({toggleOverlay:r}){const[e,t]=X.useState({}),n=i=>{t(a=>({...a,[i.id]:!a[i.id]})),i.hasOverlay&&r(i.id)};return M.jsx("div",{className:"checkboxes-container",children:SF.map(i=>M.jsx("div",{onClick:()=>n(i),children:M.jsx(TF,{label:i.label,checked:!!e[i.id]})},i.id))})}const Zc=({to:r,onClick:e,text:t})=>{const n=wi(),i=()=>{e?e():r&&n(r)};return M.jsxs("button",{className:"continue-button",onClick:i,children:[M.jsx("h3",{children:t}),M.jsx(Rd,{className:"arrow"})]})},RF=({message:r})=>M.jsx("div",{className:"overlay",children:r}),NF={1:{id:1,message:"Ah, theres my hat. I wont have to borrow Jakobsens for the whole trip."},2:{id:5,message:"Alright  belts, shirts, lenses, film check."},3:{id:6,message:"And my loyal Finette  shes been through rain, dust, and war. Shell manage Africa."}};function IF({visibleOverlays:r}){return M.jsx(M.Fragment,{children:r.map(e=>M.jsx(RF,{message:NF[e].message},e))})}const Jc=({percentage:r})=>M.jsxs("div",{className:"progress-container",children:[M.jsxs("p",{className:"progress-label",children:[r,"%"]}),M.jsx("div",{className:"progress-bar",children:M.jsx("div",{className:"progress-fill",style:{width:`${r}%`}})})]}),ir="/nhm-app/assets/knud-BoH_QVOC.jpg",kF=()=>{const[r,e]=X.useState([]),t=n=>{const i=Number(n);e(a=>a.includes(i)?a.filter(o=>o!==i):[...a,i])};return M.jsxs("div",{className:"checkbox-page",children:[M.jsxs("div",{className:"top-buttons",children:[M.jsx(Cr,{to:"/safariPages/notification/1"}),M.jsx(Jc,{percentage:19}),M.jsx(Po,{to:"/"})]}),M.jsxs("div",{className:"content",children:[M.jsx(IF,{visibleOverlays:r}),M.jsxs(Qc,{image:ir,wrapperClassName:"wrapper",children:[M.jsx(AF,{toggleOverlay:t}),M.jsx(Zc,{to:"/safariPages/scene/3",text:"Continue"})]})]})]})},yv=({text:r,children:e,style:t,speed:n=30})=>{const[i,a]=X.useState(""),[o,u]=X.useState(0);X.useEffect(()=>{a(""),u(0)},[r]),X.useEffect(()=>{if(o<r.length){const h=setTimeout(()=>{a(f=>f+r[o]),u(f=>f+1)},n);return()=>clearTimeout(h)}},[o,r,n]);const l=h=>h.split(`
`).map((f,p)=>M.jsxs(R9.Fragment,{children:[f,M.jsx("br",{})]},p));return M.jsxs("div",{className:"text-box",style:t,children:[M.jsx("p",{children:l(i)}),e]})},DF=()=>{const r=wi(),e=async t=>{await gV(t),r("/safariPages/poll-results")};return M.jsxs("div",{className:"poll-page",children:[M.jsxs("div",{className:"top-buttons",children:[M.jsx(Cr,{}),M.jsx(Jc,{percentage:81}),M.jsx(Po,{to:"/"})]}),M.jsx("div",{className:"scene-content",children:M.jsx(yv,{text:"Does understanding make it right?",children:M.jsxs("div",{className:"buttons-container",children:[M.jsx("button",{className:"poll-button",onClick:()=>e("yes"),children:"Yes"}),M.jsx("button",{className:"poll-button",onClick:()=>e("no"),children:"No"})]})})})]})},OF=()=>{const[r,e]=X.useState({yes:"0%",no:"0%"}),[t,n]=X.useState({yes:0,no:0});return X.useEffect(()=>{(async()=>{const{yes:a,no:o}=await vV(),u=a+o,l=u?Math.round(a/u*100):0,h=100-l;n({yes:l,no:h}),setTimeout(()=>{e({yes:`${l}%`,no:`${h}%`})},100)})()},[]),M.jsxs("div",{className:"vertical-bars",children:[M.jsxs("div",{className:"bar-column",children:[M.jsx("p",{children:"YES"}),M.jsx("div",{className:"bar-wrapper",children:M.jsx("div",{className:"bar yes-bar",style:r.yes?{height:r.yes}:void 0})}),M.jsxs("span",{children:[t.yes,"% of visitors"]})]}),M.jsxs("div",{className:"bar-column",children:[M.jsx("p",{children:"NO"}),M.jsx("div",{className:"bar-wrapper",children:M.jsx("div",{className:"bar no-bar",style:r.no?{height:r.no}:void 0})}),M.jsxs("span",{children:[t.no,"% of visitors"]})]})]})},MF=()=>M.jsxs("div",{className:"poll-results-page",children:[M.jsxs("div",{className:"top-buttons",children:[M.jsx(Cr,{}),M.jsx(Jc,{percentage:81}),M.jsx(Po,{to:"/"})]}),M.jsx("div",{className:"content",children:M.jsxs(Qc,{image:"",wrapperClassName:"wrapper",popoutPercent:1.2,bodyClassName:"cutout-body",children:[M.jsxs(yv,{text:"",children:[M.jsx("h2",{style:{fontSize:"21px"},children:"What did the other visitors think?"}),M.jsx(OF,{})]}),M.jsx(Zc,{text:"Continue",to:"/safariPages/notification/3"})]})})]}),zr="/nhm-app/assets/jakobsen-Bwv6DtvP.jpg",LF="/nhm-app/assets/scene1-bg-BBrkxkWq.mp4",PF="/nhm-app/assets/scene2-bg-BfXkcuYk.jpg",zF="/nhm-app/assets/scene3-bg-DMDzr3ZB.jpg",VF="/nhm-app/assets/scene4-bg-5KefhCUf.jpg",FF="/nhm-app/assets/scene5-bg-DtMhu-Oh.jpg",BF="/nhm-app/assets/scene6-bg-BsXCGb6E.jpg",Am="/nhm-app/assets/scene78910-bg-pnRRPy8p.jpg",jF="/nhm-app/assets/scene11-bg-CiLg6FpY.jpg",UF="/nhm-app/assets/scene12-bg-C3nyavbb.jpg",WF="/nhm-app/assets/scene13-bg-BnVc0KtT.jpg",yS="/nhm-app/assets/scene14-bg-C4Bw7hhL.jpg",HF="/nhm-app/assets/scene16-bg-De2RfeAe.jpg",qF="/nhm-app/assets/safari-scene-1-CDzhIBCZ.mp3",GF="/nhm-app/assets/safari-scene-2-qeDgX49i.mp3",$F="/nhm-app/assets/safari-scene-5-D-4Gf_Zh.mp3",KF="/nhm-app/assets/safari-scene-6-DFK3_I-7.mp3",XF="/nhm-app/assets/safari-scene-7-DrWcWd_g.mp3",YF="/nhm-app/assets/safari-scene-8-CQ5AdzMO.mp3",QF="/nhm-app/assets/safari-scene-10-BcagWgfB.mp3",ZF="/nhm-app/assets/safari-scene-11-CCF3iteC.mp3",JF="/nhm-app/assets/safari-scene-10.1-Ba8YvJ-w.mp3",tB="/nhm-app/assets/safari-scene-11.1-k0HxHK5r.mp3",eB="/nhm-app/assets/safari-scene-13-D2Hr1Jic.mp3",nB="/nhm-app/assets/safari-scene-15-kgVWileX.mp3",rB="/nhm-app/assets/safari-scene-17-hz-NiuzL.mp3",iB="/nhm-app/assets/safari-scene-22-CFo0l4jW.mp3",aB="/nhm-app/assets/safari-scene-23-s7XpDX_f.mp3",oB="/nhm-app/assets/safari-scene-25-CnnTVjev.mp3",sB=[{id:1,text:`Its 1947, a group of explorers from Denmark is preparing to go for an expedition to Africa - not for gold or glory, but to hunt and bring back wild animals for the museum.

Knud Elmdahl -  a well-known nature photographer picked to document the expedition in films and pictures.`,video:LF,audio:qF,progress:5,nextPage:"/safariPages/scene/2",previousPage:"/safariPages/slider",character:!1,characterImage:"",buttonText:"Continue"},{id:2,text:`I remember this stop like it was yesterday. The unexpectedly warm wood, the partial shadow under the roof, the scent of dust and earth lingering in the air. I've sat at countless train stops back home in Denmark, yet something about this place felt strangely unfamiliar, like uncharted territory. It brought back memories of packing in a rush.

Did I forget anything? I know my camera is here, the most essential thing. It's so warm, I could probably manage with just the camera if needed. Still, I should probably double-check my suitcase, just to be sure.`,image:PF,audio:GF,progress:10,nextPage:"/safariPages/notification/1",previousPage:"/safariPages/scene/1",character:!0,characterImage:ir,buttonText:"Continue"},{id:3,text:"Hey Knud! The cars are here! Hurry  we dont wanna be late for camping. I wanna unpack my weapons and get set up. Its important to get a win on the first day  sets the mood, you know? Brings good luck.",image:zF,audio:$F,progress:24,nextPage:"/safariPages/scene/4",previousPage:"/safariPages/checkbox",character:!0,characterImage:zr,buttonText:"Continue"},{id:4,text:`At that moment, I still didnt quite understand what Jakobsen meant by wins.

I came here to capture beauty  or at least thats what I told myself. The landscapes the animals the people. But theres a line between capturing and taking, isnt there?...

Sometimes I think the camera did more damage than the bullets. We told ourselves it was for science, for adventure, for pride.

Yet my photos feel vain.

Id like to believe these images serve a purpose  that by trapping those moments of cruelty inside the four black walls of my film, they stay there. Frozen.`,image:VF,audio:KF,progress:29,nextPage:"/safariPages/scene/5",previousPage:"/safariPages/scene/3",character:!0,characterImage:ir,buttonText:"Continue"},{id:5,text:`But Im here to tell a story  not get lost in my own thoughts.

Which brings me to the first friend I met on the expedition: the leopard turtle.

Look at it.

Its shell, its carapace...almost identical to our helmets. Same curve. Same purpose. Protection. Survival. They retreat when danger comes  and so do we. Desperately trying to set up camp before nightfall. We blend into the terrain, we wait, we hope not to be seen.

Are we really so different?`,image:FF,audio:XF,progress:35,nextPage:"/safariPages/scene/6",previousPage:"/safariPages/scene/4",character:!0,characterImage:ir,buttonText:"Continue"},{id:6,text:`Look. These are gazelle horns.

Theyre easier to hunt than you'd think. They live in groupsmostly females and their young. One shot, and the whole herd panics. Easy to pick off a second one if youre fast. You dont aim for the biggest. You aim for the slowest. The weakest. Thats how it works out here.

People get soft when they talk about animals. But its just instinct. Predator, prey. Thats the whole game.`,image:BF,audio:YF,progress:38,nextPage:"/safariPages/choose",previousPage:"/safariPages/scene/5",character:!0,characterImage:zr,buttonText:"Continue"},{id:7,text:"So, Jakobsen, do you have family? Kids?",image:Am,audio:QF,progress:48,nextPage:"/safariPages/scene/8",previousPage:"/safariPages/choose",character:!0,characterImage:ir,buttonText:"Continue"},{id:8,text:`Thats not your business.

Out here, personal things get people killed. So drop it. Lets better be back to work. There is my notebook with all the pictures that I took.`,image:Am,audio:ZF,progress:52,nextPage:"/safariPages/notification/2",previousPage:"/safariPages/scene/7",character:!0,characterImage:zr,buttonText:"Check notebook"},{id:9,text:"Is it your notebook on the table?",image:Am,audio:JF,progress:48,nextPage:"/safariPages/scene/10",previousPage:"/safariPages/choose",character:!0,characterImage:ir,buttonText:"Continue"},{id:10,text:"Yes, I draw this pictures I want to catch all of it to not forget important details.",image:Am,audio:tB,progress:52,nextPage:"/safariPages/notification/2",previousPage:"/safariPages/scene/9",character:!0,characterImage:zr,buttonText:"Check notebook"},{id:11,text:`We need to capture all real scenes with animalsevery detail, every instinctto represent it perfectly in Denmark.

Its not just about the hunt; its about understanding the behavior, the patterns.

Thats how you make it real.`,image:jF,audio:eB,progress:62,nextPage:"/safariPages/ar/1",previousPage:"/safariPages/scene/10",character:!0,characterImage:zr,buttonText:"Take a picture"},{id:12,text:`You see, Knud, the savannah's a fascinating place. Its all about the rhythms of migration. Every year, like clockwork, these plant-eatersgazelles, zebras, wildebeestsstart moving, following the rainsalways on the run, looking over their shoulder.

Its a harsh life, governed by the hunt. The predatorstheyre relentless. But that's nature. The brutality, the survival, its normal here. You dont question ityou just do it...

Speak of the devil! The lions, lets get closer `,image:UF,audio:nB,progress:67,nextPage:"/safariPages/ar/2",previousPage:"/safariPages/ar/1",character:!0,characterImage:zr,buttonText:"Take a picture"},{id:13,text:`Photographing the zebras was no easy task  but the lions were on a completely different level. Capturing them up close as they feasted on their prey their heavy breaths from the hunt, mouths soaked in red.

Jakobsen spoke about the lions as if he knew them personally. He said they assigned roles  some scout, some hunt, some just watch.

Just like us. We both kill.And yet I wonder  does the lion feel remorse, like I do?

How does Jakobsen feel? I had to know.`,image:WF,audio:rB,progress:71,nextPage:"/safariPages/dialog",previousPage:"/safariPages/ar/2",character:!0,characterImage:ir,buttonText:"Continue"},{id:14,text:`I used to think he did this for the thrill... the hunt... some twisted pride. But its not that. Not really. Its something else. Something deeper.

Hes not just preserving bodies. He is trying to preserve wonder... trying to give it to someone who cant be here to see it for himself. 

Look at his passion. His eyes... you can see his devotion.

Its not just taxidermy.`,image:yS,audio:iB,progress:90,nextPage:"/safariPages/scene/15",previousPage:"/safariPages/notification/3",character:!0,characterImage:ir,buttonText:"Continue"},{id:15,text:"Hey, Knud! Come, help me with these bones. I still have some to sort before we go back to Denmark.",image:yS,audio:aB,progress:95,nextPage:"/safariPages/notification/4",previousPage:"/safariPages/scene/14",character:!0,characterImage:zr,buttonText:"Continue"},{id:16,text:"I still dont know what we really brought back with us. Was it knowledge? Was it beauty? Or was it something we had no right to take? Maybe one day Ill look at those photographs and feel proud. But right now... all I feel is the weight of it.",image:HF,audio:oB,progress:99,nextPage:"/safariPages/sliderEnd",previousPage:"/safariPages/notification/4",character:!0,characterImage:ir,buttonText:"Continue"}];/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uB=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),lB=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),bS=r=>{const e=lB(r);return e.charAt(0).toUpperCase()+e.slice(1)},pN=(...r)=>r.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),cB=r=>{for(const e in r)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var hB={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fB=X.forwardRef(({color:r="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:i="",children:a,iconNode:o,...u},l)=>X.createElement("svg",{ref:l,...hB,width:e,height:e,stroke:r,strokeWidth:n?Number(t)*24/Number(e):t,className:pN("lucide",i),...!a&&!cB(u)&&{"aria-hidden":"true"},...u},[...o.map(([h,f])=>X.createElement(h,f)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nd=(r,e)=>{const t=X.forwardRef(({className:n,...i},a)=>X.createElement(fB,{ref:a,iconNode:e,className:pN(`lucide-${uB(bS(r))}`,`lucide-${r}`,n),...i}));return t.displayName=bS(r),t};/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dB=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],pB=Nd("camera",dB);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mB=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],gB=Nd("info",mB);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vB=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],yB=Nd("pause",vB);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bB=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],xB=Nd("play",bB);/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wB=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],CB=Nd("refresh-cw",wB);function vr(r,e,t,n){return new(t||(t=Promise))(function(i,a){function o(h){try{l(n.next(h))}catch(f){a(f)}}function u(h){try{l(n.throw(h))}catch(f){a(f)}}function l(h){var f;h.done?i(h.value):(f=h.value,f instanceof t?f:new t(function(p){p(f)})).then(o,u)}l((n=n.apply(r,e||[])).next())})}let Id=class{constructor(){this.listeners={}}on(e,t,n){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),n==null?void 0:n.once){const i=()=>{this.un(e,i),this.un(e,t)};return this.on(e,i),i}return()=>this.un(e,t)}un(e,t){var n;(n=this.listeners[e])===null||n===void 0||n.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(n=>n(...t))}};const Rm={decode:function(r,e){return vr(this,void 0,void 0,function*(){const t=new AudioContext({sampleRate:e});return t.decodeAudioData(r).finally(()=>t.close())})},createBuffer:function(r,e){return typeof r[0]=="number"&&(r=[r]),function(t){const n=t[0];if(n.some(i=>i>1||i<-1)){const i=n.length;let a=0;for(let o=0;o<i;o++){const u=Math.abs(n[o]);u>a&&(a=u)}for(const o of t)for(let u=0;u<i;u++)o[u]/=a}}(r),{duration:e,length:r[0].length,sampleRate:r[0].length/e,numberOfChannels:r.length,getChannelData:t=>r==null?void 0:r[t],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function mN(r,e){const t=e.xmlns?document.createElementNS(e.xmlns,r):document.createElement(r);for(const[n,i]of Object.entries(e))if(n==="children")for(const[a,o]of Object.entries(e))typeof o=="string"?t.appendChild(document.createTextNode(o)):t.appendChild(mN(a,o));else n==="style"?Object.assign(t.style,i):n==="textContent"?t.textContent=i:t.setAttribute(n,i.toString());return t}function xS(r,e,t){const n=mN(r,e||{});return t==null||t.appendChild(n),n}var EB=Object.freeze({__proto__:null,createElement:xS,default:xS});const _B={fetchBlob:function(r,e,t){return vr(this,void 0,void 0,function*(){const n=yield fetch(r,t);if(n.status>=400)throw new Error(`Failed to fetch ${r}: ${n.status} (${n.statusText})`);return function(i,a){vr(this,void 0,void 0,function*(){if(!i.body||!i.headers)return;const o=i.body.getReader(),u=Number(i.headers.get("Content-Length"))||0;let l=0;const h=p=>vr(this,void 0,void 0,function*(){l+=(p==null?void 0:p.length)||0;const m=Math.round(l/u*100);a(m)}),f=()=>vr(this,void 0,void 0,function*(){let p;try{p=yield o.read()}catch{return}p.done||(h(p.value),yield f())});f()})}(n.clone(),e),n.blob()})}};let TB=class extends Id{constructor(e){super(),this.isExternalMedia=!1,e.media?(this.media=e.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),e.playbackRate!=null&&this.onMediaEvent("canplay",()=>{e.playbackRate!=null&&(this.media.playbackRate=e.playbackRate)},{once:!0})}onMediaEvent(e,t,n){return this.media.addEventListener(e,t,n),()=>this.media.removeEventListener(e,t,n)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}canPlayType(e){return this.media.canPlayType(e)!==""}setSrc(e,t){const n=this.getSrc();if(e&&n===e)return;this.revokeSrc();const i=t instanceof Blob&&(this.canPlayType(t.type)||!e)?URL.createObjectURL(t):e;n&&(this.media.src="");try{this.media.src=i}catch{this.media.src=e}}destroy(){this.isExternalMedia||(this.media.pause(),this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(e){this.media=e}play(){return vr(this,void 0,void 0,function*(){return this.media.play()})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=Math.max(0,Math.min(e,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(e,t){t!=null&&(this.media.preservesPitch=t),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}},Db=class Ob extends Id{constructor(e,t){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.subscriptions=[],this.options=e;const n=this.parentFromOptionsContainer(e.container);this.parent=n;const[i,a]=this.initHtml();n.appendChild(i),this.container=i,this.scrollContainer=a.querySelector(".scroll"),this.wrapper=a.querySelector(".wrapper"),this.canvasWrapper=a.querySelector(".canvases"),this.progressWrapper=a.querySelector(".progress"),this.cursor=a.querySelector(".cursor"),t&&a.appendChild(t),this.initEvents()}parentFromOptionsContainer(e){let t;if(typeof e=="string"?t=document.querySelector(e):e instanceof HTMLElement&&(t=e),!t)throw new Error("Container not found");return t}initEvents(){const e=t=>{const n=this.wrapper.getBoundingClientRect(),i=t.clientX-n.left,a=t.clientY-n.top;return[i/n.width,a/n.height]};if(this.wrapper.addEventListener("click",t=>{const[n,i]=e(t);this.emit("click",n,i)}),this.wrapper.addEventListener("dblclick",t=>{const[n,i]=e(t);this.emit("dblclick",n,i)}),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{const{scrollLeft:t,scrollWidth:n,clientWidth:i}=this.scrollContainer,a=t/n,o=(t+i)/n;this.emit("scroll",a,o,t,t+i)}),typeof ResizeObserver=="function"){const t=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{t().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const e=this.parent.clientWidth;e===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=e,this.reRender())}initDrag(){this.subscriptions.push(function(e,t,n,i,a=3,o=0,u=100){if(!e)return()=>{};const l=matchMedia("(pointer: coarse)").matches;let h=()=>{};const f=p=>{if(p.button!==o)return;p.preventDefault(),p.stopPropagation();let m=p.clientX,v=p.clientY,b=!1;const C=Date.now(),w=O=>{if(O.preventDefault(),O.stopPropagation(),l&&Date.now()-C<u)return;const V=O.clientX,T=O.clientY,R=V-m,N=T-v;if(b||Math.abs(R)>a||Math.abs(N)>a){const D=e.getBoundingClientRect(),{left:L,top:P}=D;b||(n==null||n(m-L,v-P),b=!0),t(R,N,V-L,T-P),m=V,v=T}},E=O=>{if(b){const V=O.clientX,T=O.clientY,R=e.getBoundingClientRect(),{left:N,top:D}=R;i==null||i(V-N,T-D)}h()},S=O=>{O.relatedTarget&&O.relatedTarget!==document.documentElement||E(O)},A=O=>{b&&(O.stopPropagation(),O.preventDefault())},k=O=>{b&&O.preventDefault()};document.addEventListener("pointermove",w),document.addEventListener("pointerup",E),document.addEventListener("pointerout",S),document.addEventListener("pointercancel",S),document.addEventListener("touchmove",k,{passive:!1}),document.addEventListener("click",A,{capture:!0}),h=()=>{document.removeEventListener("pointermove",w),document.removeEventListener("pointerup",E),document.removeEventListener("pointerout",S),document.removeEventListener("pointercancel",S),document.removeEventListener("touchmove",k),setTimeout(()=>{document.removeEventListener("click",A,{capture:!0})},10)}};return e.addEventListener("pointerdown",f),()=>{h(),e.removeEventListener("pointerdown",f)}}(this.wrapper,(e,t,n)=>{this.emit("drag",Math.max(0,Math.min(1,n/this.wrapper.getBoundingClientRect().width)))},e=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,e/this.wrapper.getBoundingClientRect().width)))},e=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,e/this.wrapper.getBoundingClientRect().width)))}))}getHeight(e,t){var n;const i=((n=this.audioData)===null||n===void 0?void 0:n.numberOfChannels)||1;if(e==null)return 128;if(!isNaN(Number(e)))return Number(e);if(e==="auto"){const a=this.parent.clientHeight||128;return t!=null&&t.every(o=>!o.overlay)?a/i:a}return 128}initHtml(){const e=document.createElement("div"),t=e.attachShadow({mode:"open"}),n=this.options.cspNonce&&typeof this.options.cspNonce=="string"?this.options.cspNonce.replace(/"/g,""):"";return t.innerHTML=`
      <style${n?` nonce="${n}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[e,t]}setOptions(e){if(this.options.container!==e.container){const t=this.parentFromOptionsContainer(e.container);t.appendChild(this.container),this.parent=t}e.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=e,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(e){this.scrollContainer.scrollLeft=e}setScrollPercentage(e){const{scrollWidth:t}=this.scrollContainer,n=t*e;this.setScroll(n)}destroy(){var e,t;this.subscriptions.forEach(n=>n()),this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(t=this.unsubscribeOnScroll)===null||t===void 0||t.forEach(n=>n()),this.unsubscribeOnScroll=[]}createDelay(e=10){let t,n;const i=()=>{t&&clearTimeout(t),n&&n()};return this.timeouts.push(i),()=>new Promise((a,o)=>{i(),n=o,t=setTimeout(()=>{t=void 0,n=void 0,a()},e)})}convertColorValues(e){if(!Array.isArray(e))return e||"";if(e.length<2)return e[0]||"";const t=document.createElement("canvas"),n=t.getContext("2d"),i=t.height*(window.devicePixelRatio||1),a=n.createLinearGradient(0,0,0,i),o=1/(e.length-1);return e.forEach((u,l)=>{const h=l*o;a.addColorStop(h,u)}),a}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(e,t,n,i){const a=e[0],o=e[1]||e[0],u=a.length,{width:l,height:h}=n.canvas,f=h/2,p=this.getPixelRatio(),m=t.barWidth?t.barWidth*p:1,v=t.barGap?t.barGap*p:t.barWidth?m/2:0,b=t.barRadius||0,C=l/(m+v)/u,w=b&&"roundRect"in n?"roundRect":"rect";n.beginPath();let E=0,S=0,A=0;for(let k=0;k<=u;k++){const O=Math.round(k*C);if(O>E){const R=Math.round(S*f*i),N=R+Math.round(A*f*i)||1;let D=f-R;t.barAlign==="top"?D=0:t.barAlign==="bottom"&&(D=h-N),n[w](E*(m+v),D,m,N,b),E=O,S=0,A=0}const V=Math.abs(a[k]||0),T=Math.abs(o[k]||0);V>S&&(S=V),T>A&&(A=T)}n.fill(),n.closePath()}renderLineWaveform(e,t,n,i){const a=o=>{const u=e[o]||e[0],l=u.length,{height:h}=n.canvas,f=h/2,p=n.canvas.width/l;n.moveTo(0,f);let m=0,v=0;for(let b=0;b<=l;b++){const C=Math.round(b*p);if(C>m){const E=f+(Math.round(v*f*i)||1)*(o===0?-1:1);n.lineTo(m,E),m=C,v=0}const w=Math.abs(u[b]||0);w>v&&(v=w)}n.lineTo(m,f)};n.beginPath(),a(0),a(1),n.fill(),n.closePath()}renderWaveform(e,t,n){if(n.fillStyle=this.convertColorValues(t.waveColor),t.renderFunction)return void t.renderFunction(e,n);let i=t.barHeight||1;if(t.normalize){const a=Array.from(e[0]).reduce((o,u)=>Math.max(o,Math.abs(u)),0);i=a?1/a:1}t.barWidth||t.barGap||t.barAlign?this.renderBarWaveform(e,t,n,i):this.renderLineWaveform(e,t,n,i)}renderSingleCanvas(e,t,n,i,a,o,u){const l=this.getPixelRatio(),h=document.createElement("canvas");h.width=Math.round(n*l),h.height=Math.round(i*l),h.style.width=`${n}px`,h.style.height=`${i}px`,h.style.left=`${Math.round(a)}px`,o.appendChild(h);const f=h.getContext("2d");if(this.renderWaveform(e,t,f),h.width>0&&h.height>0){const p=h.cloneNode(),m=p.getContext("2d");m.drawImage(h,0,0),m.globalCompositeOperation="source-in",m.fillStyle=this.convertColorValues(t.progressColor),m.fillRect(0,0,h.width,h.height),u.appendChild(p)}}renderMultiCanvas(e,t,n,i,a,o){const u=this.getPixelRatio(),{clientWidth:l}=this.scrollContainer,h=n/u;let f=Math.min(Ob.MAX_CANVAS_WIDTH,l,h),p={};if(f===0)return;if(t.barWidth||t.barGap){const w=t.barWidth||.5,E=w+(t.barGap||w/2);f%E!=0&&(f=Math.floor(f/E)*E)}const m=w=>{if(w<0||w>=v||p[w])return;p[w]=!0;const E=w*f,S=Math.min(h-E,f);if(S<=0)return;const A=e.map(k=>{const O=Math.floor(E/h*k.length),V=Math.floor((E+S)/h*k.length);return k.slice(O,V)});this.renderSingleCanvas(A,t,S,i,E,a,o)},v=Math.ceil(h/f);if(!this.isScrollable){for(let w=0;w<v;w++)m(w);return}const b=this.scrollContainer.scrollLeft/h,C=Math.floor(b*v);if(m(C-1),m(C),m(C+1),v>1){const w=this.on("scroll",()=>{const{scrollLeft:E}=this.scrollContainer,S=Math.floor(E/h*v);Object.keys(p).length>Ob.MAX_NODES&&(a.innerHTML="",o.innerHTML="",p={}),m(S-1),m(S),m(S+1)});this.unsubscribeOnScroll.push(w)}}renderChannel(e,t,n,i){var{overlay:a}=t,o=function(f,p){var m={};for(var v in f)Object.prototype.hasOwnProperty.call(f,v)&&p.indexOf(v)<0&&(m[v]=f[v]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function"){var b=0;for(v=Object.getOwnPropertySymbols(f);b<v.length;b++)p.indexOf(v[b])<0&&Object.prototype.propertyIsEnumerable.call(f,v[b])&&(m[v[b]]=f[v[b]])}return m}(t,["overlay"]);const u=document.createElement("div"),l=this.getHeight(o.height,o.splitChannels);u.style.height=`${l}px`,a&&i>0&&(u.style.marginTop=`-${l}px`),this.canvasWrapper.style.minHeight=`${l}px`,this.canvasWrapper.appendChild(u);const h=u.cloneNode();this.progressWrapper.appendChild(h),this.renderMultiCanvas(e,o,n,l,u,h)}render(e){return vr(this,void 0,void 0,function*(){var t;this.timeouts.forEach(l=>l()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);const n=this.getPixelRatio(),i=this.scrollContainer.clientWidth,a=Math.ceil(e.duration*(this.options.minPxPerSec||0));this.isScrollable=a>i;const o=this.options.fillParent&&!this.isScrollable,u=(o?i:a)*n;if(this.wrapper.style.width=o?"100%":`${a}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=e,this.emit("render"),this.options.splitChannels)for(let l=0;l<e.numberOfChannels;l++){const h=Object.assign(Object.assign({},this.options),(t=this.options.splitChannels)===null||t===void 0?void 0:t[l]);this.renderChannel([e.getChannelData(l)],h,u,l)}else{const l=[e.getChannelData(0)];e.numberOfChannels>1&&l.push(e.getChannelData(1)),this.renderChannel(l,this.options,u,0)}Promise.resolve().then(()=>this.emit("rendered"))})}reRender(){if(this.unsubscribeOnScroll.forEach(n=>n()),this.unsubscribeOnScroll=[],!this.audioData)return;const{scrollWidth:e}=this.scrollContainer,{right:t}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&e!==this.scrollContainer.scrollWidth){const{right:n}=this.progressWrapper.getBoundingClientRect();let i=n-t;i*=2,i=i<0?Math.floor(i):Math.ceil(i),i/=2,this.scrollContainer.scrollLeft+=i}}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e,t=!1){const{scrollLeft:n,scrollWidth:i,clientWidth:a}=this.scrollContainer,o=e*i,u=n,l=n+a,h=a/2;if(this.isDragging)o+30>l?this.scrollContainer.scrollLeft+=30:o-30<u&&(this.scrollContainer.scrollLeft-=30);else{(o<u||o>l)&&(this.scrollContainer.scrollLeft=o-(this.options.autoCenter?h:0));const f=o-n-h;t&&this.options.autoCenter&&f>0&&(this.scrollContainer.scrollLeft+=Math.min(f,10))}{const f=this.scrollContainer.scrollLeft,p=f/i,m=(f+a)/i;this.emit("scroll",p,m,f,f+a)}}renderProgress(e,t){if(isNaN(e))return;const n=100*e;this.canvasWrapper.style.clipPath=`polygon(${n}% 0, 100% 0, 100% 100%, ${n}% 100%)`,this.progressWrapper.style.width=`${n}%`,this.cursor.style.left=`${n}%`,this.cursor.style.transform=`translateX(-${Math.round(n)===100?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(e,t)}exportImage(e,t,n){return vr(this,void 0,void 0,function*(){const i=this.canvasWrapper.querySelectorAll("canvas");if(!i.length)throw new Error("No waveform data");if(n==="dataURL"){const a=Array.from(i).map(o=>o.toDataURL(e,t));return Promise.resolve(a)}return Promise.all(Array.from(i).map(a=>new Promise((o,u)=>{a.toBlob(l=>{l?o(l):u(new Error("Could not export image"))},e,t)})))})}};Db.MAX_CANVAS_WIDTH=8e3,Db.MAX_NODES=10;let SB=class extends Id{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}},I1=class extends Id{constructor(e=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return vr(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(e){if(this.currentSrc=e,this._duration=void 0,!e)return this.buffer=null,void this.emit("emptied");fetch(e).then(t=>{if(t.status>=400)throw new Error(`Failed to fetch ${e}: ${t.status} (${t.statusText})`);return t.arrayBuffer()}).then(t=>this.currentSrc!==e?null:this.audioContext.decodeAudioData(t)).then(t=>{this.currentSrc===e&&(this.buffer=t,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})}_play(){var e;if(!this.paused)return;this.paused=!1,(e=this.bufferNode)===null||e===void 0||e.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let t=this.playedDuration*this._playbackRate;(t>=this.duration||t<0)&&(t=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,t),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var e;this.paused=!0,(e=this.bufferNode)===null||e===void 0||e.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return vr(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(e){const t=e-this.currentTime,n=this.bufferNode;n==null||n.stop(this.audioContext.currentTime+t),n==null||n.addEventListener("ended",()=>{n===this.bufferNode&&(this.bufferNode=null,this.pause())},{once:!0})}setSinkId(e){return vr(this,void 0,void 0,function*(){return this.audioContext.setSinkId(e)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this.bufferNode&&(this.bufferNode.playbackRate.value=e)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(e){const t=!this.paused;t&&this._pause(),this.playedDuration=e/this._playbackRate,t&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var e,t;return(e=this._duration)!==null&&e!==void 0?e:((t=this.buffer)===null||t===void 0?void 0:t.duration)||0}set duration(e){this._duration=e}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.value=e,this.emit("volumechange")}get muted(){return this._muted}set muted(e){this._muted!==e&&(this._muted=e,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(e){return/^(audio|video)\//.test(e)}getGainNode(){return this.gainNode}getChannelData(){const e=[];if(!this.buffer)return e;const t=this.buffer.numberOfChannels;for(let n=0;n<t;n++)e.push(this.buffer.getChannelData(n));return e}};const AB={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};let Mb=class gN extends TB{static create(e){return new gN(e)}constructor(e){const t=e.media||(e.backend==="WebAudio"?new I1:void 0);super({media:t,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},AB,e),this.timer=new SB;const n=t?void 0:this.getMediaElement();this.renderer=new Db(this.options,n),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const i=this.options.url||this.getSrc()||"";Promise.resolve().then(()=>{this.emit("init");const{peaks:a,duration:o}=this.options;(i||a&&o)&&this.load(i,a,o).catch(()=>null)})}updateProgress(e=this.getCurrentTime()){return this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),e}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){const e=this.updateProgress();this.emit("timeupdate",e),this.emit("audioprocess",e),this.stopAtPosition!=null&&this.isPlaying()&&e>=this.stopAtPosition&&this.pause()}}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{const e=this.updateProgress();this.emit("timeupdate",e)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("emptied",()=>{this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("ended",()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",()=>{var e;this.emit("error",(e=this.getMediaElement().error)!==null&&e!==void 0?e:new Error("Media error")),this.stopAtPosition=null}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(e,t)=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",e*this.getDuration()),this.emit("click",e,t))}),this.renderer.on("dblclick",(e,t)=>{this.emit("dblclick",e,t)}),this.renderer.on("scroll",(e,t,n,i)=>{const a=this.getDuration();this.emit("scroll",e*a,t*a,n,i)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",e=>{this.emit("dragstart",e)}),this.renderer.on("dragend",e=>{this.emit("dragend",e)}));{let e;this.subscriptions.push(this.renderer.on("drag",t=>{if(!this.options.interact)return;let n;this.renderer.renderProgress(t),clearTimeout(e),this.isPlaying()?n=0:this.options.dragToSeek===!0?n=200:typeof this.options.dragToSeek=="object"&&this.options.dragToSeek!==void 0&&(n=this.options.dragToSeek.debounceTime),e=setTimeout(()=>{this.seekTo(t)},n),this.emit("interaction",t*this.getDuration()),this.emit("drag",t)}))}}initPlugins(){var e;!((e=this.options.plugins)===null||e===void 0)&&e.length&&this.options.plugins.forEach(t=>{this.registerPlugin(t)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach(e=>e()),this.mediaSubscriptions=[]}setOptions(e){this.options=Object.assign({},this.options,e),e.duration&&!e.peaks&&(this.decodedData=Rm.createBuffer(this.exportPeaks(),e.duration)),e.peaks&&e.duration&&(this.decodedData=Rm.createBuffer(e.peaks,e.duration)),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),e.mediaControls!=null&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){return e._init(this),this.plugins.push(e),this.subscriptions.push(e.once("destroy",()=>{this.plugins=this.plugins.filter(t=>t!==e)})),e}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(e){return this.renderer.setScroll(e)}setScrollTime(e){const t=e/this.getDuration();this.renderer.setScrollPercentage(t)}getActivePlugins(){return this.plugins}loadAudio(e,t,n,i){return vr(this,void 0,void 0,function*(){var a;if(this.emit("load",e),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,!t&&!n){const u=this.options.fetchParams||{};window.AbortController&&!u.signal&&(this.abortController=new AbortController,u.signal=(a=this.abortController)===null||a===void 0?void 0:a.signal);const l=f=>this.emit("loading",f);t=yield _B.fetchBlob(e,l,u);const h=this.options.blobMimeType;h&&(t=new Blob([t],{type:h}))}this.setSrc(e,t);const o=yield new Promise(u=>{const l=i||this.getDuration();l?u(l):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",()=>u(this.getDuration()),{once:!0}))});if(!e&&!t){const u=this.getMediaElement();u instanceof I1&&(u.duration=o)}if(n)this.decodedData=Rm.createBuffer(n,o||0);else if(t){const u=yield t.arrayBuffer();this.decodedData=yield Rm.decode(u,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(e,t,n){return vr(this,void 0,void 0,function*(){try{return yield this.loadAudio(e,void 0,t,n)}catch(i){throw this.emit("error",i),i}})}loadBlob(e,t,n){return vr(this,void 0,void 0,function*(){try{return yield this.loadAudio("",e,t,n)}catch(i){throw this.emit("error",i),i}})}zoom(e){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks({channels:e=2,maxLength:t=8e3,precision:n=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const i=Math.min(e,this.decodedData.numberOfChannels),a=[];for(let o=0;o<i;o++){const u=this.decodedData.getChannelData(o),l=[],h=u.length/t;for(let f=0;f<t;f++){const p=u.slice(Math.floor(f*h),Math.ceil((f+1)*h));let m=0;for(let v=0;v<p.length;v++){const b=p[v];Math.abs(b)>Math.abs(m)&&(m=b)}l.push(Math.round(m*n)/n)}a.push(l)}return a}getDuration(){let e=super.getDuration()||0;return e!==0&&e!==1/0||!this.decodedData||(e=this.decodedData.duration),e}toggleInteraction(e){this.options.interact=e}setTime(e){this.stopAtPosition=null,super.setTime(e),this.updateProgress(e),this.emit("timeupdate",e)}seekTo(e){const t=this.getDuration()*e;this.setTime(t)}play(e,t){const n=Object.create(null,{play:{get:()=>super.play}});return vr(this,void 0,void 0,function*(){e!=null&&this.setTime(e);const i=yield n.play.call(this);return t!=null&&(this.media instanceof I1?this.media.stopAt(t):this.stopAtPosition=t),i})}playPause(){return vr(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}setMediaElement(e){this.unsubscribePlayerEvents(),super.setMediaElement(e),this.initPlayerEvents()}exportImage(){return vr(this,arguments,void 0,function*(e="image/png",t=1,n="dataURL"){return this.renderer.exportImage(e,t,n)})}destroy(){var e;this.emit("destroy"),(e=this.abortController)===null||e===void 0||e.abort(),this.plugins.forEach(t=>t.destroy()),this.subscriptions.forEach(t=>t()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}};Mb.BasePlugin=class extends Id{constructor(r){super(),this.subscriptions=[],this.options=r}onInit(){}_init(r){this.wavesurfer=r,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(r=>r())}},Mb.dom=EB;const RB=r=>{const e=Math.floor(r/60),t=Math.floor(r%60).toString().padStart(2,"0");return`${e}:${t}`},mx=({src:r})=>{const[e,t]=X.useState(!1),[n,i]=X.useState("0:00"),a=X.useRef(null),o=X.useRef(null);X.useEffect(()=>{if(!a.current)return;const l=Mb.create({container:a.current,waveColor:"#A8B778",progressColor:"#252D0D",height:48,barWidth:2,cursorWidth:0});o.current=l,l.load(r);const h=()=>{const p=l.getDuration();i(RB(p))},f=()=>{t(!1)};return l.on("ready",h),l.on("finish",f),()=>{l.un("ready",h),l.un("finish",f),l.destroy()}},[r]);const u=()=>{const l=o.current;l&&(l.isPlaying()?(l.pause(),t(!1)):(l.play(),t(!0)))};return M.jsxs("div",{className:"audio-player",children:[M.jsx("button",{onClick:u,className:"audio-button",children:e?M.jsx(yB,{size:20}):M.jsx(xB,{size:20})}),M.jsx("div",{className:"waveform",ref:a}),M.jsx("p",{className:"duration",children:n})]})},NB=()=>{const{id:r}=Cd(),e=parseInt(r||"1",10),t=sB.find(i=>i.id===e),n=t!=null&&t.character?.2:1.2;return t?M.jsxs("div",{className:"basic-scene",style:{height:"100vh",width:"100%",position:"relative",overflow:"hidden"},children:[t.video?M.jsx("div",{className:"media-background",children:M.jsx("video",{src:t.video,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"media-element"})}):M.jsx("div",{className:"media-background",style:{backgroundImage:`url(${t.image})`}}),M.jsxs("div",{className:"top-buttons",children:[M.jsx(Cr,{to:t.previousPage}),M.jsx(Jc,{percentage:t.progress}),M.jsx(Po,{to:"/"})]}),M.jsxs(Qc,{image:t.characterImage,wrapperClassName:"wrapper",popoutPercent:n,bodyClassName:"cutout-body",children:[M.jsx(mx,{src:t.audio}),M.jsx(yv,{text:t.text}),M.jsx(Zc,{to:t.nextPage,text:t.buttonText})]})]}):M.jsx("div",{children:"Scene not found."})},IB="/nhm-app/assets/notification1-BfKdwSBT.jpg",kB="/nhm-app/assets/notification2-CkgK2Hgc.jpg",DB="/nhm-app/assets/notification3-ZGthwkle.jpg",OB="/nhm-app/assets/notification4-B1OlbDrC.jpg",MB=[{id:1,image:IB,header:"You feel stressed!",text:"Make sure you got everything.",nextPage:"/safariPages/checkbox",previousPage:"/safariPages/scene/2",buttonText:"Continue",progress:"15%"},{id:2,image:kB,header:"You are really interested!",text:"Check Jokobsens notebook that lay on the table",nextPage:"/safariPages/scene/11",previousPage:"/safariPages/scene/10",buttonText:"I checked it",progress:"59%"},{id:3,image:DB,header:"A new day begins.",text:"Jakobsen is busy with taxidermy",nextPage:"/safariPages/scene/14",previousPage:"/safariPages/dialog",buttonText:"Continue",progress:"86%"},{id:4,image:OB,header:"They're not just bones.",text:"Step close - see what they reveal.",nextPage:"/safariPages/scene/16",previousPage:"/safariPages/scene/15",buttonText:"Continue",progress:"97%"}],LB=r=>X.createElement("svg",{width:40,height:40,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},X.createElement("path",{d:"M20 35C28.2843 35 35 28.2843 35 20C35 11.7157 28.2843 5 20 5C11.7157 5 5 11.7157 5 20C5 28.2843 11.7157 35 20 35Z",stroke:"#131706",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),X.createElement("path",{d:"M20 26V20M20 14H20.015",stroke:"#131706",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})),PB=()=>{const{id:r}=Cd(),e=parseInt(r||"1",10),t=MB.find(n=>n.id===e);return t?M.jsxs("div",{className:"notification-scene",style:{backgroundImage:`url(${t.image})`,backgroundSize:"cover",backgroundPosition:"top",height:"100vh",width:"100%"},children:[M.jsxs("div",{className:"top-buttons",children:[M.jsx(Cr,{to:t.previousPage}),M.jsx(Po,{to:"/"})]}),M.jsxs("div",{className:"content-notification",children:[M.jsx(vv,{icon:M.jsx(LB,{}),heading:t.header,description:t.text}),M.jsx(Zc,{to:t.nextPage,text:t.buttonText})]})]}):M.jsx("div",{children:"Scene not found."})},zB=()=>M.jsxs("div",{className:"slider-page-end",children:[M.jsxs("div",{className:"top-buttons",children:[M.jsx(Cr,{}),M.jsx(Po,{to:"/"})]}),M.jsx("div",{className:"content",children:M.jsx("div",{className:"header",style:{color:"white"},children:M.jsx("h1",{children:"Was there ever a right path or just the illusion of one?"})})}),M.jsx(dN,{buttonText:"END",nextPage:"/safariPages/extra"})]}),VB="/nhm-app/assets/safari-scene-9-302DS1sc.mp3",FB=()=>{const r=wi(),e=t=>{r(t==="family"?"/safariPages/scene/7":"/safariPages/scene/9")};return M.jsxs("div",{className:"choose-page",children:[M.jsxs("div",{className:"top-buttons",children:[M.jsx(Cr,{}),M.jsx(Jc,{percentage:43}),M.jsx(Po,{to:"/"})]}),M.jsx("div",{className:"content",children:M.jsxs(Qc,{image:ir,wrapperClassName:"wrapper",children:[M.jsx(mx,{src:VB}),M.jsxs(yv,{text:"Haha, right, like my wifeshed never understand how it really works out here. Shes all about saving the poor animals.",children:[M.jsx("br",{}),M.jsx("p",{children:"Ask Jakobsen:"}),M.jsxs("div",{className:"buttons-container",children:[M.jsx("button",{className:"question-button",onClick:()=>e("family"),children:"So, Jakobsen, do you have family? Kids?"}),M.jsx("button",{className:"question-button",onClick:()=>e("notebook"),children:"Is it your notebook on the table?"})]})]})]})})]})},BB=({image:r,text:e,character:t,speed:n,onTypingDone:i,scrollRef:a})=>{const[o,u]=X.useState(""),[l,h]=X.useState(0);return X.useEffect(()=>{u(""),h(0)},[e]),X.useEffect(()=>{if(l<e.length){const f=setTimeout(()=>{u(p=>p+e[l]),h(p=>p+1),a!=null&&a.current&&(a.current.scrollTop=a.current.scrollHeight)},n);return()=>clearTimeout(f)}else i&&i()},[l,e,n,i]),M.jsxs("div",{className:"dialog-box",children:[M.jsx("img",{src:r,alt:t}),M.jsx("p",{children:o})]})},wS=[{id:1,character:"Knud",image:ir,text:"Ive been thinking Maybe we shouldnt be doing this. I meandoesnt it feel wrong to you? All of it?"},{id:2,character:"Jakobsen",image:zr,text:"Man up."},{id:3,character:"Knud",image:ir,text:"Seriously. Dont you feel anything? Dont you feel like this is completely messed up?"},{id:4,character:"Jakobsen",image:zr,text:"..."},{id:5,character:"Knud",image:ir,text:"Im deleting the pictures. I dont want to be a part of this anymore."},{id:6,character:"Jakobsen",image:zr,text:"Youre not deleting anything."},{id:7,character:"Knud",image:ir,text:"Why not? Why the hell are we even doing this? These animals this whole thingits not right!"},{id:8,character:"Jakobsen",image:zr,text:"Stop asking so many damn questions and just do your job."},{id:9,character:"Knud",image:ir,text:"How?! How are you so calm about this? How do you sleep at night, like none of this matters?"},{id:10,character:"Jakobsen",image:zr,text:"Because I have to! I made a promise  Im not backing out now."},{id:11,character:"Knud",image:ir,text:"...A promise?"},{id:12,character:"Jakobsen",image:zr,text:"My son Hes paralyzed. Hell never walk, never run. But he loves animals. I want him to touch them, see them up close, feel what its like to be near something wild. Thisthis is the only way."},{id:13,character:"Knud",image:ir,text:"Couldnt you just take him somewhere? A sanctuary, or... Africas big, there are safer ways to"},{id:14,character:"Jakobsen",image:zr,text:"No. You dont get it. Not everyone can just hop on a plane and go on a safari. Hes too weak. Too sick. This this is all I can give him."},{id:15,character:"Jakobsen",image:zr,text:"Lets just get some rest.Weve got a long day tomorrow."},{id:16,character:"Knud",image:ir,text:"(to himself): I understand the love behind itthe passion, the desperation to share something beautiful with his son. But does understanding make it right?"}],jB="/nhm-app/assets/safari-scene-18-CUyBgl3y.mp3",UB=70,WB=800,HB=()=>{const[r,e]=X.useState(0),[t,n]=X.useState(!1),i=X.useRef(null);return X.useEffect(()=>{if(t&&r<wS.length-1){const a=setTimeout(()=>{e(o=>o+1),n(!1)},WB);return()=>clearTimeout(a)}},[t,r]),X.useEffect(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},[r]),M.jsxs("div",{className:"choose-page",children:[M.jsxs("div",{className:"top-buttons",children:[M.jsx(Cr,{to:"/safariPages/scene/13"}),M.jsx(Jc,{percentage:76}),M.jsx(Po,{to:"/"})]}),M.jsx("div",{className:"content",children:M.jsxs(Qc,{image:"",wrapperClassName:"wrapper",popoutPercent:1.2,bodyClassName:"cutout-body",children:[M.jsx(mx,{src:jB}),M.jsx("div",{className:"replies-container",ref:i,children:wS.slice(0,r+1).map(({id:a,image:o,text:u,character:l},h)=>{const f=h===r;return M.jsx(BB,{image:o,text:u,character:l,speed:UB,onTypingDone:f?()=>n(!0):void 0,scrollRef:i},a)})}),M.jsx(Zc,{to:"/safariPages/poll",text:"Continue"})]})})]})},CS="/nhm-app/assets/lion-scene-dRtypf9q.mp4",vN=[{id:1,previousPage:"/safariPages/scene/11",nextPage:"/safariPages/ar/2",notificationText:"Point your camera at the zebras and take a picture.",successText:"Remember the zebras in the savannah!",failText:"You missed the zebras!",buttonText:"Take a picture",videoUrl:CS},{id:2,previousPage:"/safariPages/ar/1",nextPage:"/safariPages/scene/13",notificationText:"Point your camera at the lions and take a picture.",successText:"Remember the hungry lions!",failText:"You missed the lions!",buttonText:"Take a picture",videoUrl:CS}],qB=({color:r,onClick:e,className:t})=>M.jsx("button",{onClick:e,className:`capture-button ${t??""}`,style:r?{backgroundColor:r}:void 0,"aria-label":"Capture",children:M.jsx(pB,{size:42,color:"#fff"})}),GB=()=>{uN();const{id:r}=Cd(),e=r?parseInt(r,10):null,t=vN.find(f=>f.id===e),n=X.useRef(null),i=X.useRef(null),[a,o]=X.useState(!1),{sectionTheme:u}=gv(),l=wi();X.useEffect(()=>((async()=>{try{const p=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});n.current&&(n.current.srcObject=p,n.current.onloadedmetadata=()=>{var m;(m=n.current)==null||m.play(),o(!0)})}catch(p){console.error("Error accessing camera",p)}})(),()=>{var p;(p=n.current)!=null&&p.srcObject&&n.current.srcObject.getTracks().forEach(v=>v.stop())}),[]);const h=()=>{if(!i.current||!n.current)return;const f=n.current,p=i.current,m=p.getContext("2d");if(!m)return;const v=f.videoWidth,b=f.videoHeight,{width:C,height:w}=f.getBoundingClientRect();p.width=C,p.height=w;const E=v/b,S=C/w;let A=0,k=0,O=v,V=b;E>S?(O=b*S,A=(v-O)/2):(V=v/S,k=(b-V)/2),m.drawImage(f,A,k,O,V,0,0,p.width,p.height);const T=p.toDataURL("image/png");requestAnimationFrame(()=>{l("/safariPages/ar-result",{state:{image:T,sceneId:e}})})};return t?M.jsx("div",{className:"ar-page-container",children:M.jsxs("div",{className:"ar-scene",children:[M.jsx("video",{ref:n,className:"ar-video",muted:!0,playsInline:!0}),M.jsx("canvas",{ref:i,style:{display:"none"}}),M.jsx("div",{className:"content-notif",children:M.jsx(vv,{icon:M.jsx(gB,{}),heading:"Capture the moment",description:t.notificationText})}),M.jsx("div",{className:"ar-focus-box"}),M.jsx(qB,{className:"ar-capture-button",color:`var(${u.background})`,onClick:h}),M.jsx("div",{className:"ar-top-buttons",children:M.jsx(Cr,{to:t.previousPage})}),!a&&M.jsx("div",{className:"ar-loading-overlay",children:M.jsx("div",{children:" Loading camera..."})})]})}):M.jsx("div",{children:"Scene not found"})},$B={1:{title:"Cinema Night in Yard",date:"08 June 2025",time:"20:0023:00",location:"Museum Yard",accessibility:"Wheelchair access",image:cN,description:"A magical outdoor movie experience with popcorn, bean bags, and a big screen. Bring a blanket and enjoy the stars!",highlights:["Classic documentaries and nature films","Outdoor seating and snacks","Family-friendly atmosphere"]},2:{title:"Safari Party",date:"30 June 2025",time:"18:0022:00",location:"Museum Garden",accessibility:"Wheelchair access",image:hN,description:"Dress up and dance under the stars! Explore African-inspired art, music, and food at this immersive celebration.",highlights:["Live African drumming and dance","Face painting and costumes","Tropical food and drinks"]},3:{title:"Scavenger Hunt",date:"20 July 2025",time:"12:0015:00",location:"Inside Museum",accessibility:"Wheelchair access",image:fN,description:"Discover hidden secrets in our exhibits during this exciting scavenger hunt for all ages!",highlights:["Solve clues and win prizes","Perfect for families and kids","Learn while you explore"]}},KB=()=>{const{id:r}=Cd(),e=wi(),t=$B[r||""];return t?M.jsx("div",{id:"root",children:M.jsx("div",{className:"scrollable-container",children:M.jsxs("div",{className:"event-detail-page",children:[M.jsx(Cr,{onClick:()=>e(-1)}),M.jsx("img",{src:t.image,alt:t.title,className:"event-image"}),M.jsxs("div",{className:"event-info",children:[M.jsx("p",{className:"event-date",children:t.date}),M.jsx("h1",{children:t.title}),M.jsxs("div",{className:"event-tags",children:[M.jsx("span",{className:"tag",children:t.location}),M.jsx("span",{className:"tag",children:t.time}),M.jsx("span",{className:"tag",children:t.accessibility})]}),M.jsx("p",{className:"event-description",children:t.description}),M.jsx("h3",{children:"Highlights include:"}),M.jsx("ul",{children:t.highlights.map((n,i)=>M.jsx("li",{children:n},i))})]})]})})}):M.jsx("div",{children:"Event not found."})};var k1={},Su={};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var yN=function(r,e){return(yN=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(r,e)};function aa(r,e){function t(){this.constructor=r}yN(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ft(r,e,t,n){return new(t||(t=Promise))(function(i,a){function o(h){try{l(n.next(h))}catch(f){a(f)}}function u(h){try{l(n.throw(h))}catch(f){a(f)}}function l(h){h.done?i(h.value):new t(function(f){f(h.value)}).then(o,u)}l((n=n.apply(r,[])).next())})}function Bt(r,e){var t,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(l){return function(h){return function(f){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(i=2&f[0]?n.return:f[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,f[1])).done)return i;switch(n=0,i&&(f=[2&f[0],i.value]),f[0]){case 0:case 1:i=f;break;case 4:return o.label++,{value:f[1],done:!1};case 5:o.label++,n=f[1],f=[0];continue;case 7:f=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(f[0]===6||f[0]===2)){o=0;continue}if(f[0]===3&&(!i||f[1]>i[0]&&f[1]<i[3])){o.label=f[1];break}if(f[0]===6&&o.label<i[1]){o.label=i[1],i=f;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(f);break}i[2]&&o.ops.pop(),o.trys.pop();continue}f=e.call(r,o)}catch(p){f=[6,p],n=0}finally{t=i=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([l,h])}}}var bN=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},r.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,n,i=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(a){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];return function(l,h,f){l[decodeURIComponent(h)]=decodeURIComponent(f||"")}(n,o[0],o[1]),o.join("=")}),n);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(a){var o=a.split(":"),u=o[0],l=o[1];e.urlFlags[u]=function(h,f){if((f=f.toLowerCase())==="true"||f==="false")return f==="true";if(""+ +f===f)return+f;throw new Error("Could not parse value flag value "+f+" for flag "+h+".")}(u,l)})}},r}();function gt(){return gx}var gx=null,Nc=new Map;function xN(r,e){var t=vx(r,e);return Nc.get(t)}function Lb(r){for(var e=Nc.entries(),t=[];;){var n=e.next(),i=n.done,a=n.value;if(i)break;var o=a[0],u=a[1];o.split("_")[0]===r&&t.push(u)}return t}function Pb(r){var e=r.kernelName,t=r.backendName,n=vx(e,t);if(Nc.has(n))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");Nc.set(n,r)}function XB(r,e){var t=vx(r,e);if(!Nc.has(t))throw new Error("The kernel '"+r+"' for backend '"+e+"' is not registered");Nc.delete(t)}function vx(r,e){return e+"_"+r}function ES(r){for(var e=r.length,t=0,n=0;e>0;)n=Math.random()*e|0,t=r[--e],r[e]=r[n],r[n]=t}function Rg(r,e,t){return Math.max(r,Math.min(e,t))}function yx(r){return r%2==0?r:r+1}function wN(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function $(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function Me(r,e,t){t===void 0&&(t=""),$(or(r,e),function(){return t+" Shapes "+r+" and "+e+" must match"})}function al(r){$(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Do(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||yr(r)&&!t)for(var n=0;n<r.length;++n)Do(r[n],e,t);else e.push(r);return e}function jt(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function or(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function wn(r){return r%1==0}function CN(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function Ng(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function Uu(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function zb(r,e,t){return e===void 0&&(e=function(n){return 0}),new Promise(function(n,i){var a=0,o=function(){if(r())n();else{var u=e(++a);t!=null&&a>=t?i():setTimeout(o,u)}};o()})}function EN(r,e){for(var t=1,n=-1,i=0;i<r.length;++i)if(r[i]>=0)t*=r[i];else if(r[i]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+i);n=i}else if(r[i]<0)throw Error("Shapes can not be < 0. Found "+r[i]+" at dim "+i);if(n===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+r);return r}if(t===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var a=r.slice();return a[n]=e/t,a}function ur(r,e){var t=e.length;return $((r=r==null?e.map(function(n,i){return i}):[].concat(r)).every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+r}),$(r.every(function(n){return wn(n)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(n){return n<0?t+n:n})}function ys(r,e){for(var t=[],n=[],i=e!=null&&Array.isArray(e)&&e.length===0,a=e==null||i?null:ur(e,r).sort(),o=0,u=0;u<r.length;++u){if(a!=null){if(a[o]===u&&r[u]!==1)throw new Error("Can't squeeze axis "+u+" since its dim '"+r[u]+"' is not 1");(a[o]==null||a[o]>u)&&r[u]===1&&(t.push(r[u]),n.push(u)),a[o]<=u&&o++}r[u]!==1&&(t.push(r[u]),n.push(u))}return{newShape:t,keptDims:n}}function id(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else{if(r!=="bool")throw new Error("Unknown data type "+r);t=new Uint8Array(e)}return t}function ad(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else{if(r!=="string")throw new Error("Unknown data type "+r);t=new Array(e)}return t}function _N(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function TN(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function SN(r,e){return e!=="complex64"&&(e!=="float32"||r==="complex64")&&(e!=="int32"||r==="float32"||r==="complex64")&&(e!=="bool"||r!=="bool")}function yr(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function bx(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function AN(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function xs(r){return typeof r=="string"||r instanceof String}function RN(r){return typeof r=="boolean"}function NN(r){return typeof r=="number"}function th(r){return Array.isArray(r)?th(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":NN(r)?"float32":xs(r)?"string":RN(r)?"bool":"float32"}function Fs(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Ig(r,e){for(var t=e;t<r;++t)if(r%t==0)return t;return r}function qs(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function xx(r,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Do(r)),t&&_N(r,e),function(a,o){return a instanceof Float32Array&&o==="float32"||a instanceof Int32Array&&o==="int32"||a instanceof Uint8Array&&o==="bool"}(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var n=new Uint8Array(r.length),i=0;i<n.length;++i)Math.round(r[i])!==0&&(n[i]=1);return n}throw new Error("Unknown data type "+e)}function Vb(r,e){if(r.length===0)return e[0];var t=r.reduce(function(n,i){return n*i});if(t===0)return[];if(t!==e.length)throw new Error("["+r+"] does not match the input size.");return function n(i,a,o){var u=new Array;if(a.length===1)for(var l=a[0],h=0;h<l;h++)u[h]=o[i+h];else{l=a[0];var f=a.slice(1),p=f.reduce(function(m,v){return m*v});for(h=0;h<l;h++)u[h]=n(i+h*p,f,o)}return u}(0,r,e)}function wx(r,e){for(var t=eh(r,e),n=0;n<t.length;n++)t[n]=1;return t}function eh(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function Yi(){return gt().platform.now()}function Cx(r){r.forEach(function(e){$(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function IN(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",gt().platform.encode(r,e)}function od(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",gt().platform.decode(r,e)}var Ht=Object.freeze({shuffle:ES,clamp:Rg,nearestLargerEven:yx,sum:wN,randUniform:function(r,e){var t=Math.random();return e*t+(1-t)*r},distSquared:function(r,e){for(var t=0,n=0;n<r.length;n++){var i=Number(r[n])-Number(e[n]);t+=i*i}return t},assert:$,assertShapesMatch:Me,assertNonNull:al,flatten:Do,sizeFromShape:jt,isScalarShape:function(r){return r.length===0},arraysEqual:or,isInt:wn,tanh:CN,sizeToSquarishShape:Ng,createShuffledIndices:function(r){for(var e=new Uint32Array(r),t=0;t<r;++t)e[t]=t;return ES(e),e},rightPad:Uu,repeatedTry:zb,inferFromImplicitShape:EN,parseAxisParam:ur,squeezeShape:ys,getTypedArrayFromDType:id,getArrayFromDType:ad,checkConversionForErrors:_N,isValidDtype:TN,hasEncodingLoss:SN,isTypedArray:yr,bytesPerElement:bx,bytesFromStringArray:AN,isString:xs,isBoolean:RN,isNumber:NN,inferDtype:th,isFunction:Fs,nearestDivisor:Ig,computeStrides:qs,toTypedArray:xx,toNestedArray:Vb,makeOnesTypedArray:wx,makeZerosTypedArray:eh,now:Yi,assertNonNegativeIntegerDimensions:Cx,fetch:function(r,e){return gt().platform.fetch(r,e)},encodeString:IN,decodeString:od}),YB=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new QB)}return r.prototype.profileKernel=function(e,t,n){var i,a=this,o=this.backendTimer.time(function(){i=n()});return i.forEach(function(u){u.data().then(function(l){(function(h,f,p){if(f!=="float32")return!1;for(var m=0;m<h.length;m++){var v=h[m];if(isNaN(v)||!isFinite(v))return console.warn("Found "+v+" in the result of '"+p+"'"),!0}})(l,u.dtype,e),o.then(function(h){var f="";h.getExtraProfileInfo!=null&&(f=h.getExtraProfileInfo()),a.logger.logKernelProfile(e,u,l,h.kernelMs,t,f)})})}),i},r}(),QB=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,i,a,o){var u=Uu(i+"ms",9),l=Uu(e,25),h=t.rank,f=t.size,p=Uu(t.shape.toString(),14),m="";for(var v in a){var b=a[v].shape,C=b.length;m+=v+": "+C+"D "+(C>0?b:"")+" "}console.log("%c"+l+"	%c"+u+"	%c"+h+"D "+p+"	%c"+f+"	%c"+m+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}(),_S=20,wf=3,D1=7;function ZB(r,e,t,n){var i=qs(e),a=function(h,f,p,m){var v=jt(f),b=m[m.length-1],C=new Array(b).fill(0),w=f.length,E=p==="complex64"?Ef(h):h;if(w>1)for(var S=0;S<v/b;S++)for(var A=S*b,k=0;k<b;k++)C[k]=Math.max(C[k],Cf(E[A+k],0,p).length);return C}(r,e,t,i),o=e.length,u=function h(f,p,m,v,b,C){C===void 0&&(C=!0);var w=m==="complex64"?2:1,E=p[0],S=p.length;if(S===0){if(m==="complex64"){var A=Ef(f);return[Cf(A[0],0,m)]}return m==="bool"?[kN(f[0])]:[f[0].toString()]}if(S===1){if(E>_S){var k=wf*w,O=Array.from(f.slice(0,k)),V=Array.from(f.slice(E-wf*w,E));return m==="complex64"&&(O=Ef(O),V=Ef(V)),["["+O.map(function(K,Q){return Cf(K,b[Q],m)}).join(", ")+", ..., "+V.map(function(K,Q){return Cf(K,b[E-wf+Q],m)}).join(", ")+"]"]}var T=m==="complex64"?Ef(f):Array.from(f);return["["+T.map(function(K,Q){return Cf(K,b[Q],m)}).join(", ")+"]"]}var R=p.slice(1),N=v.slice(1),D=v[0]*w,L=[];if(E>_S){for(var P=0;P<wf;P++){var B=P*D,Z=B+D;L.push.apply(L,h(f.slice(B,Z),R,m,N,b,!1))}L.push("...");for(var P=E-wf;P<E;P++){var B=P*D,Z=B+D;L.push.apply(L,h(f.slice(B,Z),R,m,N,b,P===E-1))}}else for(var P=0;P<E;P++){var B=P*D,Z=B+D;L.push.apply(L,h(f.slice(B,Z),R,m,N,b,P===E-1))}var rt=S===2?",":"";L[0]="["+L[0]+rt;for(var P=1;P<L.length-1;P++)L[P]=" "+L[P]+rt;for(var q=`,
`,P=2;P<S;P++)q+=`
`;return L[L.length-1]=" "+L[L.length-1]+"]"+(C?"":q),L}(r,e,t,i,a),l=["Tensor"];return n&&(l.push("  dtype: "+t),l.push("  rank: "+o),l.push("  shape: ["+e+"]"),l.push("  values:")),l.push(u.map(function(h){return"    "+h}).join(`
`)),l.join(`
`)}function Cf(r,e,t){return Uu(Array.isArray(r)?parseFloat(r[0].toFixed(D1))+" + "+parseFloat(r[1].toFixed(D1))+"j":xs(r)?"'"+r+"'":t==="bool"?kN(r):parseFloat(r.toFixed(D1)).toString(),e)}function kN(r){return r===0?"false":"true"}function Ef(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var Ic=function(){function r(e,t,n){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=jt(e),n!=null){var a=n.length;$(a===this.size,function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||ad(t,this.size),this.strides=qs(e)}return r.prototype.set=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];n.length===0&&(n=[0]),$(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var a=this.locToIndex(n);this.values[a]=e},r.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var n=0,i=0,a=e;i<a.length;i++){var o=a[i];if(o<0||o>=this.shape[n]){var u="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(u)}n++}for(var l=e[e.length-1],h=0;h<e.length-1;++h)l+=this.strides[h]*e[h];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return Na().makeTensor(this.values,this.shape,this.dtype)},r}(),Na=null,vt=null,DN=null,Ge=function(){function r(e,t,n,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=jt(e),this.strides=qs(e),this.dataId=n,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),$(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},r.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},r.prototype.as4D=function(e,t,n,i){return this.throwIfDisposed(),this.reshape([e,t,n,i])},r.prototype.as5D=function(e,t,n,i,a){return this.throwIfDisposed(),this.reshape([e,t,n,i,a])},r.prototype.asType=function(e){return this.throwIfDisposed(),vt.cast(this,e)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return Ft(this,void 0,void 0,function(){var e;return Bt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,vt.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return vt.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ft(this,void 0,void 0,function(){var e;return Bt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Vb(this.shape,e)]}})})},r.prototype.arraySync=function(){return Vb(this.shape,this.dataSync())},r.prototype.data=function(){return Ft(this,void 0,void 0,function(){var e,t;return Bt(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=Na().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(i){return od(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataSync=function(){this.throwIfDisposed();var e=Na().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return od(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Ft(this,void 0,void 0,function(){var e;return Bt(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Na().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(Na().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(e){return e===void 0&&(e=!1),vt.print(this,e)},r.prototype.reshape=function(e){return this.throwIfDisposed(),vt.reshape(this,e)},r.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},r.prototype.expandDims=function(e){return e===void 0&&(e=0),vt.expandDims(this,e)},r.prototype.cumsum=function(e,t,n){return e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1),vt.cumsum(this,e,t,n)},r.prototype.squeeze=function(e){return this.throwIfDisposed(),vt.squeeze(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),vt.clone(this)},r.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),vt.oneHot(this,e,t,n)},r.prototype.toString=function(e){return e===void 0&&(e=!1),ZB(this.dataSync(),this.shape,this.dtype,e)},r.prototype.tile=function(e){return this.throwIfDisposed(),vt.tile(this,e)},r.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),vt.gather(this,e,t)},r.prototype.matMul=function(e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!1),this.throwIfDisposed(),vt.matMul(this,e,t,n)},r.prototype.dot=function(e){return this.throwIfDisposed(),vt.dot(this,e)},r.prototype.norm=function(e,t,n){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),vt.norm(this,e,t,n)},r.prototype.slice=function(e,t){return this.throwIfDisposed(),vt.slice(this,e,t)},r.prototype.reverse=function(e){return this.throwIfDisposed(),vt.reverse(this,e)},r.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof r&&(e=[e]),vt.concat([this].concat(e),t)},r.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),vt.split(this,e,t)},r.prototype.stack=function(e,t){return t===void 0&&(t=0),vt.stack([this,e],t)},r.prototype.unstack=function(e){return e===void 0&&(e=0),vt.unstack(this,e)},r.prototype.pad=function(e,t){return t===void 0&&(t=0),vt.pad(this,e,t)},r.prototype.batchNormalization=function(e,t,n,i,a){return n===void 0&&(n=.001),DN("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,a,i,n)},r.prototype.batchNorm=function(e,t,n,i,a){return a===void 0&&(a=.001),this.throwIfDisposed(),vt.batchNorm(this,e,t,n,i,a)},r.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),vt.all(this,e,t)},r.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),vt.any(this,e,t)},r.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),vt.logSumExp(this,e,t)},r.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),vt.sum(this,e,t)},r.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),vt.prod(this,e,t)},r.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),vt.mean(this,e,t)},r.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),vt.min(this,e,t)},r.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),vt.max(this,e,t)},r.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),vt.argMin(this,e)},r.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),vt.argMax(this,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),vt.cast(this,e)},r.prototype.add=function(e){return this.throwIfDisposed(),vt.add(this,e)},r.prototype.addStrict=function(e){return this.throwIfDisposed(),vt.addStrict(this,e)},r.prototype.atan2=function(e){return this.throwIfDisposed(),vt.atan2(this,e)},r.prototype.sub=function(e){return this.throwIfDisposed(),vt.sub(this,e)},r.prototype.subStrict=function(e){return this.throwIfDisposed(),vt.subStrict(this,e)},r.prototype.pow=function(e){return this.throwIfDisposed(),vt.pow(this,e)},r.prototype.powStrict=function(e){return this.throwIfDisposed(),vt.powStrict(this,e)},r.prototype.mul=function(e){return this.throwIfDisposed(),vt.mul(this,e)},r.prototype.mulStrict=function(e){return this.throwIfDisposed(),vt.mulStrict(this,e)},r.prototype.div=function(e){return this.throwIfDisposed(),vt.div(this,e)},r.prototype.floorDiv=function(e){return this.throwIfDisposed(),vt.floorDiv(this,e)},r.prototype.divStrict=function(e){return this.throwIfDisposed(),vt.divStrict(this,e)},r.prototype.minimum=function(e){return this.throwIfDisposed(),vt.minimum(this,e)},r.prototype.minimumStrict=function(e){return this.throwIfDisposed(),vt.minimumStrict(this,e)},r.prototype.maximum=function(e){return this.throwIfDisposed(),vt.maximum(this,e)},r.prototype.maximumStrict=function(e){return this.throwIfDisposed(),vt.maximumStrict(this,e)},r.prototype.mod=function(e){return this.throwIfDisposed(),vt.mod(this,e)},r.prototype.modStrict=function(e){return this.throwIfDisposed(),vt.modStrict(this,e)},r.prototype.squaredDifference=function(e){return this.throwIfDisposed(),vt.squaredDifference(this,e)},r.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),vt.squaredDifferenceStrict(this,e)},r.prototype.transpose=function(e){return this.throwIfDisposed(),vt.transpose(this,e)},r.prototype.notEqual=function(e){return this.throwIfDisposed(),vt.notEqual(this,e)},r.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),vt.notEqualStrict(this,e)},r.prototype.less=function(e){return this.throwIfDisposed(),vt.less(this,e)},r.prototype.lessStrict=function(e){return this.throwIfDisposed(),vt.lessStrict(this,e)},r.prototype.equal=function(e){return this.throwIfDisposed(),vt.equal(this,e)},r.prototype.equalStrict=function(e){return this.throwIfDisposed(),vt.equalStrict(this,e)},r.prototype.lessEqual=function(e){return this.throwIfDisposed(),vt.lessEqual(this,e)},r.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),vt.lessEqualStrict(this,e)},r.prototype.greater=function(e){return this.throwIfDisposed(),vt.greater(this,e)},r.prototype.greaterStrict=function(e){return this.throwIfDisposed(),vt.greaterStrict(this,e)},r.prototype.greaterEqual=function(e){return this.throwIfDisposed(),vt.greaterEqual(this,e)},r.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),vt.greaterEqualStrict(this,e)},r.prototype.logicalAnd=function(e){return this.throwIfDisposed(),vt.logicalAnd(this,e)},r.prototype.logicalOr=function(e){return this.throwIfDisposed(),vt.logicalOr(this,e)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),vt.logicalNot(this)},r.prototype.logicalXor=function(e){return this.throwIfDisposed(),vt.logicalXor(this,e)},r.prototype.where=function(e,t){return this.throwIfDisposed(),vt.where(e,this,t)},r.prototype.neg=function(){return this.throwIfDisposed(),vt.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),vt.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),vt.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),vt.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),vt.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),vt.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),vt.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),vt.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),vt.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),vt.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),vt.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),vt.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),vt.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),vt.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),vt.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),vt.abs(this)},r.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),vt.clipByValue(this,e,t)},r.prototype.relu=function(){return this.throwIfDisposed(),vt.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),vt.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),vt.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),vt.selu(this)},r.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),vt.leakyRelu(this,e)},r.prototype.prelu=function(e){return this.throwIfDisposed(),vt.prelu(this,e)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),vt.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),vt.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),vt.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),vt.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),vt.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),vt.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),vt.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),vt.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),vt.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),vt.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),vt.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),vt.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),vt.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),vt.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),vt.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),vt.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),vt.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),vt.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),vt.round(this)},r.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),vt.step(this,e)},r.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),vt.softmax(this,e)},r.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),vt.logSoftmax(this,e)},r.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),vt.image.resizeBilinear(this,e,t)},r.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),vt.image.resizeNearestNeighbor(this,e,t)},r.prototype.conv1d=function(e,t,n,i,a,o){return i===void 0&&(i="NWC"),a===void 0&&(a=1),this.throwIfDisposed(),vt.conv1d(this,e,t,n,i,a,o)},r.prototype.conv2d=function(e,t,n,i,a,o){return i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),vt.conv2d(this,e,t,n,i,a,o)},r.prototype.conv2dTranspose=function(e,t,n,i,a){return this.throwIfDisposed(),vt.conv2dTranspose(this,e,t,n,i,a)},r.prototype.depthwiseConv2D=function(e,t,n,i,a,o){return i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),vt.depthwiseConv2d(this,e,t,n,i,a,o)},r.prototype.separableConv2d=function(e,t,n,i,a,o){return a===void 0&&(a=[1,1]),o===void 0&&(o="NHWC"),this.throwIfDisposed(),vt.separableConv2d(this,e,t,n,i,a,o)},r.prototype.avgPool=function(e,t,n,i){return this.throwIfDisposed(),vt.avgPool(this,e,t,n,i)},r.prototype.maxPool=function(e,t,n,i){return this.throwIfDisposed(),vt.maxPool(this,e,t,n,i)},r.prototype.localResponseNormalization=function(e,t,n,i){return e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5),vt.localResponseNormalization(this,e,t,n,i)},r.prototype.pool=function(e,t,n,i,a){return this.throwIfDisposed(),vt.pool(this,e,t,n,i,a)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),Na().makeVariable(this,e,t,n)},r.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),vt.unsortedSegmentSum(this,e,t)},r.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),vt.batchToSpaceND(this,e,t)},r.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),vt.spaceToBatchND(this,e,t)},r.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),vt.topk(this,e,t)},r.prototype.stridedSlice=function(e,t,n,i,a,o,u,l){return i===void 0&&(i=0),a===void 0&&(a=0),o===void 0&&(o=0),u===void 0&&(u=0),l===void 0&&(l=0),this.throwIfDisposed(),vt.stridedSlice(this,e,t,n,i,a,o,u,l)},r.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),vt.depthToSpace(this,e,t)},r.prototype.fft=function(){return this.throwIfDisposed(),vt.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),vt.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),vt.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),vt.spectral.irfft(this)},r}();Object.defineProperty(Ge,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var Fb,Bb,jb,Ub,Wb,sd=function(r){function e(t,n,i,a){var o=r.call(this,t.shape,t.dtype,t.dataId,a)||this;return o.trainable=n,o.name=i,o}return aa(e,r),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!or(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Na().disposeTensor(this),this.dataId=t.dataId,Na().incRef(this,null)},e.prototype.dispose=function(){Na().disposeVariable(this),this.isDisposedInternal=!0},e}(Ge);Object.defineProperty(sd,Symbol.hasInstance,{value:function(r){return r instanceof Ge&&r.assign!=null&&r.assign instanceof Function}}),function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"}(Fb||(Fb={})),function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"}(Bb||(Bb={})),function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"}(jb||(jb={})),function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"}(Ub||(Ub={})),function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"}(Wb||(Wb={}));var JB={float32:Ub,int32:Bb,bool:jb,complex64:Wb};function Pn(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return JB[r][e]}function O1(r){return Pn(r,"int32")}function Cn(r,e){if(r.dtype===e.dtype)return[r,e];var t=Pn(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function ON(r,e){$(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+e.dtype+") input must match"})}function Ex(r){var e=[];return function t(n,i,a){if(n!=null){if(n instanceof Ge)return void i.push(n);if(o=n,!(!Array.isArray(o)&&typeof o!="object")){var o,u=n;for(var l in u){var h=u[l];a.has(h)||(a.add(h),t(h,i,a))}}}}(r,e,new Set),e}var M1,Oa=Object.freeze({makeTypesMatch:Cn,assertTypesMatch:ON,isTensorInList:function(r,e){for(var t=0;t<e.length;t++)if(e[t].id===r.id)return!0;return!1},getTensorsInContainer:Ex}),TS=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),tj=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new TS}return r.prototype.ready=function(){return Ft(this,void 0,void 0,function(){var e,t,n;return Bt(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Ft(this,void 0,void 0,function(){var t,n,i;return Bt(this,function(a){switch(a.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return i=a.sent(),[3,3];case 2:i=n,a.label=3;case 3:if(!i)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new YB(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this;Lb(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this;Lb(e).forEach(function(n){n.disposeFunc!=null&&n.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=n.factory();if(Promise.resolve(i)===i){var a=++this.pendingBackendInitId,o=i.then(function(u){return!(a<t.pendingBackendInitId)&&(t.registry[e]=u,t.pendingBackendInit=null,!0)}).catch(function(u){return!(a<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(u.stack||u.message),!1)});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(u){return console.warn("Initialization of backend "+e+" failed"),console.warn(u.stack||u.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],i=this.initializeBackend(n),a=i.success,o=i.asyncInit;if(o||a)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),i=n.backend,a=this.readSync(t);i.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n,i=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun(function(){return i.startScope(a)},function(){return i.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},r.prototype.scopedRun=function(e,t,n){e();try{var i=n();return t(),i}catch(a){throw t(),a}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(i){return{x:function(){return i.toFloat()}}},[]),t},r.prototype.runKernel=function(e,t,n,i,a){return this.runKernelFunc(null,t,null,e,n,i,a)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var i=this.backend.numDataIds(),a=0;n.forEach(function(l){a+=l.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],u=i-t-a-o;if(u>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+u+" data ids) after running '"+e+"'")},r.prototype.runKernelFunc=function(e,t,n,i,a,o,u){var l,h=this;o===void 0&&(o=[]),u===void 0&&(u=[]);var f,p=[],m=this.isTapeOn(),v=this.state.activeScope!=null?this.state.activeScope.name:"",b=function(A){m&&(p=A.map(function(k){return h.keep(h.clone(k))}))},C=this.state.numBytes,w=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var E,S=xN(i,this.backendName);return f=S!=null?function(){var A=h.backend.numDataIds();E=S.kernelFunc({inputs:t,attrs:a,backend:h.backend});var k=Array.isArray(E)?E:[E];h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(v,A,k);var O=k.map(function(T){var R=T.dataId,N=T.shape,D=T.dtype;return h.makeTensorFromDataId(R,N,D)}),V=O.filter(function(T,R){return u[R]});return b(o.slice().concat(V)),O}:function(){var A=h.backend.numDataIds();E=h.tidy(function(){return e(h.backend,b)});var k=Array.isArray(E)?E:[E];return h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(v,A,k),k},this.scopedRun(function(){return h.state.kernelDepth++},function(){return h.state.kernelDepth--},function(){l=h.ENV.getBool("DEBUG")?h.profiler.profileKernel(v,t,function(){return f()}):f()}),m&&this.addTapeNode(v,t,l,n,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:v,bytesAdded:this.state.numBytes-C,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-w,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(A){return t[A].shape}),outputShapes:l.map(function(A){return A.shape})}),Array.isArray(E)?l:l[0]},r.prototype.makeTensor=function(e,t,n,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",i=i||this.backend;var a=e;n==="string"&&xs(e[0])&&(a=e.map(function(f){return IN(f)}));var o=i.write(a,t,n),u=new Ge(t,n,o,this.nextTensorId());if(this.incRef(u,i),n==="string"){var l=this.state.tensorInfo.get(o),h=AN(a);this.state.numBytes+=h-l.bytes,l.bytes=h}return u},r.prototype.makeTensorFromDataId=function(e,t,n,i){var a=new Ge(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,i),a},r.prototype.makeVariable=function(e,t,n,i){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var a=new sd(e,t,n,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},r.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,n===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*bx(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof sd||this.track(e)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Ft(this,void 0,void 0,function(){var t,n;return Bt(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(a){return a.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,i,a){var o=this,u={id:this.state.nextTapeNodeId++,name:e,inputs:t,outputs:n,saved:a};i!=null&&(u.gradient=function(l){return l=l.map(function(h,f){if(h==null){var p=n[f],m=eh(p.size,p.dtype);return o.makeTensor(m,p.shape,p.dtype)}return h}),i(l.length>1?l:l[0],a)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=Ex(e),i=new Set(n.map(function(l){return l.id})),a=0;a<this.state.activeScope.track.length;a++){var o=this.state.activeScope.track[a];o.kept||i.has(o.id)||o.dispose()}var u=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(l){l.kept||l.scopeId!==u.id||t.track(l)})},r.prototype.gradients=function(e,t,n,i){var a=this;if(i===void 0&&(i=!1),$(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun(function(){return a.startTape()},function(){return a.endTape()},function(){return a.tidy("forward",e)});$(o instanceof Ge,function(){return"The result y returned by f() must be a tensor."});var u=function(l,h,f){for(var p={},m={},v=0;v<h.length;v++)p[h[v].id]=!0;for(v=0;v<l.length;v++){var b=(V=l[v]).inputs;for(var C in b){for(var w=b[C],E=!1,S=0;S<h.length;S++)if(p[w.id]){V.outputs.forEach(function(D){return p[D.id]=!0}),E=!0,m[V.id]=!0;break}if(E)break}}var A={};A[f.id]=!0;var k={};for(v=l.length-1;v>=0;v--)for(b=(V=l[v]).inputs,S=0;S<V.outputs.length;S++)if(A[V.outputs[S].id]){for(var C in b)A[b[C].id]=!0,k[V.id]=!0;break}var O=[];for(v=0;v<l.length;v++){var V;if(m[(V=l[v]).id]&&k[V.id]){var T={};for(var C in V.inputs){var R=V.inputs[C];p[R.id]&&(T[C]=R)}var N=Object.assign({},V);N.inputs=T,N.outputs=V.outputs,O.push(N)}}return O}(this.state.activeTape,t,o);if(!i&&u.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var l,h,f={};f[o.id]=n??(l=o.shape,h=wx(jt(l),"float32"),J.makeTensor(h,l,"float32")),function(m,v,b){for(var C=function(E){var S=v[E],A=[];if(S.outputs.forEach(function(T){var R=m[T.id];R!=null?A.push(R):A.push(null)}),S.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+S.name+".");var k=S.gradient(A),O=function(T){if(!(T in k))throw new Error("Cannot backprop through input "+T+". Available gradients found: "+Object.keys(k)+".");var R=b(function(){return k[T]()});if(R.dtype!=="float32")throw new Error("Error in gradient for op "+S.name+". The gradient of input "+T+" must have 'float32' dtype, but has '"+R.dtype+"'");var N=S.inputs[T];if(!or(R.shape,N.shape))throw new Error("Error in gradient for op "+S.name+". The gradient of input '"+T+"' has shape '"+R.shape+"', which does not match the shape of the input '"+N.shape+"'");if(m[N.id]==null)m[N.id]=R;else{var D=m[N.id];m[N.id]=D.add(R),D.dispose()}};for(var V in S.inputs)O(V)},w=v.length-1;w>=0;w--)C(w)}(f,u,function(m){return a.tidy(m)});var p=t.map(function(m){return f[m.id]});return a.state.gradientDepth===0&&(a.state.activeTape.forEach(function(m){for(var v in m.saved)m.saved[v].dispose()}),a.state.activeTape=null),{value:o,grads:p}})},r.prototype.customGrad=function(e){var t=this;return $(Fs(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];$(i.every(function(u){return u instanceof Ge}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return i.forEach(function(u,l){o[l]=u}),t.runKernelFunc(function(u,l){return $((n=e.apply(void 0,i.concat([l]))).value instanceof Ge,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),$(Fs(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},o,function(u,l){var h=n.gradFunc(u,l),f=Array.isArray(h)?h:[h];$(f.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),$(f.every(function(m){return m instanceof Ge}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return f.forEach(function(m,v){p[v]=function(){return m}}),p})}},r.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},r.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},r.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},r.prototype.time=function(e){return Ft(this,void 0,void 0,function(){var t,n;return Bt(this,function(i){switch(i.label){case 0:return t=Yi(),[4,this.backend.time(e)];case 1:return(n=i.sent()).wallMs=Yi()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new TS,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r}(),J=function(){var r=function(){if(M1==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}M1=t}return M1}();if(r._tfengine==null){var e=new bN(r);r._tfengine=new tj(e)}return function(t){gx=t}(r._tfengine.ENV),Na=function(){return r._tfengine},r._tfengine}();function MN(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var vo=gt();vo.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),vo.registerFlag("IS_BROWSER",function(){return MN()}),vo.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),vo.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),vo.registerFlag("PROD",function(){return!1}),vo.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return vo.getBool("DEBUG")}),vo.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),vo.registerFlag("IS_TEST",function(){return!1});var ud,pi,hi,ku={},L1={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function LN(r,e){ku[r]=e}function Ua(r){r in ku||(ku[r]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=PN(t);return n.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete ku[t]},!1),t===1?n.getContext("webgl",L1)||n.getContext("experimental-webgl",L1):n.getContext("webgl2",L1)}(r));var e=ku[r];return e.isContextLost()?(delete ku[r],Ua(r)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),ku[r])}function PN(r){if(typeof OffscreenCanvas<"u"&&r===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function bv(r,e){return[e,r]}function Uf(r){var e=jt(r);return Ng(Math.ceil(e/4))}function kd(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function _x(r,e){var t,n,i,a,o,u,l,h,f,p=r;return gt().getNumber("WEBGL_VERSION")===2?(t=p.R32F,n=p.R16F,i=p.RGBA16F,a=p.RGBA32F,o=p.RED,u=4,l=1,h=p.HALF_FLOAT,f=p.FLOAT):(t=r.RGBA,n=r.RGBA,i=r.RGBA,a=p.RGBA,o=r.RGBA,u=4,l=4,h=e!=null?e.HALF_FLOAT_OES:null,f=r.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:l,textureTypeHalfFloat:h,textureTypeFloat:f}}function Mt(r,e,t){var n=t();return e&&function(i){var a=i.getError();if(a!==i.NO_ERROR)throw new Error("WebGL Error: "+VN(i,a))}(r),n}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(ud||(ud={})),function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"}(pi||(pi={})),function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(hi||(hi={}));var ej=596e-10,nj=65504;function zN(r){return!!(gt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||ej<Math.abs(r)&&Math.abs(r)<nj)}function VN(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Qm(r,e,t){return zo(r,e,function(){return r.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function FN(r,e,t){var n=zo(r,e,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Mt(r,e,function(){return r.shaderSource(n,t)}),Mt(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function BN(r,e,t){var n=zo(r,e,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Mt(r,e,function(){return r.shaderSource(n,t)}),Mt(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw function(i,a){var o=rj.exec(a);if(o==null)return console.log("Couldn't parse line number in error: "+a),void console.log(i);for(var u=+o[1],l=i.split(`
`),h=l.length.toString().length+2,f=l.map(function(w,E){return Uu((E+1).toString(),h)+w}),p=0,m=0;m<f.length;m++)p=Math.max(f[m].length,p);var v=f.slice(0,u-1),b=f.slice(u-1,u),C=f.slice(u);console.log(v.join(`
`)),console.log(a.split(`
`)[0]),console.log("%c "+Uu(b[0],p),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(C.join(`
`))}(t,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var Zm,Jm,rj=/ERROR: [0-9]+:([0-9]+):/g;function jN(r,e){return zo(r,e,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function UN(r,e,t){if(Mt(r,e,function(){return r.linkProgram(t)}),r.getProgramParameter(t,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function tg(r,e,t){if(Mt(r,e,function(){return r.validateProgram(t)}),r.getProgramParameter(t,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function WN(r,e,t){var n=zo(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Mt(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Mt(r,e,function(){return r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function HN(r,e,t){var n=zo(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Mt(r,e,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)}),Mt(r,e,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function qN(r,e){return zo(r,e,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function GN(r,e){var t=gt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="["+r+"x"+e+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t)throw n="["+r+"x"+e+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function $N(r,e){return zo(r,e,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Hb(r,e,t,n,i,a,o,u){var l=r.getAttribLocation(t,n);return l!==-1&&(Mt(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,i)}),Mt(r,e,function(){return r.vertexAttribPointer(l,a,r.FLOAT,!1,o,u)}),Mt(r,e,function(){return r.enableVertexAttribArray(l)}),!0)}function KN(r,e,t,n){JN(r,n),Mt(r,e,function(){return r.activeTexture(r.TEXTURE0+n)}),Mt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)})}function XN(r,e,t,n){return zo(r,e,function(){return r.getUniformLocation(t,n)},'uniform "'+n+'" not present in program.')}function YN(r,e,t){return r.getUniformLocation(e,t)}function QN(r,e,t,n,i,a){Mt(r,e,function(){return KN(r,e,n,a)}),Mt(r,e,function(){return r.uniform1i(i,a)})}function eg(r,e,t,n){Mt(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,n)}),Mt(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)})}function qb(r,e,t){Mt(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),Mt(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function Df(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+ZN(r,e))}function ZN(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function zo(r,e,t,n){var i=Mt(r,e,function(){return t()});if(i==null)throw new Error(n);return i}function JN(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function ld(r,e){return e===void 0&&(e=2),jt(r.slice(0,r.length-e))}function cd(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function ng(r){var e=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(e=[ld(r)].concat(cd(r))),e}function tI(r,e){var t;e===void 0&&(e=!1);var n=gt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,(r=r.map(function(h,f){return f>=r.length-2?yx(r[f]):r[f]})).length===1&&(r=[2,r[0]])),r.length!==2){var i=ys(r);r=i.newShape}var a=jt(r);if(r.length<=1&&a<=n)return[1,a];if(r.length===2&&r[0]<=n&&r[1]<=n)return r;if(r.length===3&&r[0]*r[1]<=n&&r[2]<=n)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=n&&r[1]*r[2]<=n)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n)return[r[0],r[1]*r[2]*r[3]];if(e){var o=ld(r),u=2,l=2;return r.length&&(u=(t=cd(r))[0],l=t[1]),Ng(a=o*(u/2)*(l/2)).map(function(h){return 2*h})}return Ng(a)}function Nm(r){return r%2==0}function Of(r,e){if(or(r=r.slice(-2),e=e.slice(-2))||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r.slice(-1)[0],n=e.slice(-1)[0];if(t===n||Nm(t)&&Nm(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&Nm(r[0])&&Nm(e[0])}function eI(r){if(Zm==null){var e=Ua(r);Zm=e.getParameter(e.MAX_TEXTURE_SIZE)}return Zm}function nI(r){if(Jm==null){var e=Ua(r);Jm=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Jm)}function rI(r){if(r===0)return 0;var e=Ua(r);return Zi(e,"EXT_disjoint_timer_query_webgl2")&&r===2?2:Zi(e,"EXT_disjoint_timer_query")?1:0}function Zi(r,e){return r.getExtension(e)!=null}function Gb(r){try{if(Ua(r)!=null)return!0}catch{return!1}return!1}function iI(r){if(r===0)return!1;var e=Ua(r);if(r===1){if(!Zi(e,"OES_texture_float"))return!1}else if(!Zi(e,"EXT_color_buffer_float"))return!1;return $b(e)}function aI(r){if(r===0)return!1;var e=Ua(r);if(r!==1){if(Zi(e,"EXT_color_buffer_float"))return $b(e);if(Zi(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(n,i){var a=_x(n,i),o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,a.internalFormatHalfFloat,1,1,0,a.textureFormatFloat,a.textureTypeHalfFloat,null);var u=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,u),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o,0);var l=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(o),n.deleteFramebuffer(u),l}(e,t)}return!1}return!!Zi(e,"OES_texture_float")&&!!Zi(e,"WEBGL_color_buffer_float")&&$b(e)}function $b(r){var e=_x(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var n=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,n),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var i=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(n),i}function oI(r){return r===2&&Ua(r).fenceSync!=null}var ij=Object.freeze({callAndCheck:Mt,canBeRepresented:zN,getWebGLErrorMessage:VN,getExtensionOrThrow:Qm,createVertexShader:FN,createFragmentShader:BN,createProgram:jN,linkProgram:UN,validateProgram:tg,createStaticVertexBuffer:WN,createStaticIndexBuffer:HN,getNumChannels:function(){return gt().getNumber("WEBGL_VERSION")===2?1:4},createTexture:qN,validateTextureSize:GN,createFramebuffer:$N,bindVertexBufferToProgramAttribute:Hb,bindTextureUnit:KN,unbindTextureUnit:function(r,e,t){JN(r,t),Mt(r,e,function(){return r.activeTexture(r.TEXTURE0+t)}),Mt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:XN,getProgramUniformLocation:YN,bindTextureToProgramUniformSampler:QN,bindCanvasToFramebuffer:function(r,e){Mt(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),Mt(r,e,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),Mt(r,e,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})},bindColorTextureToFramebuffer:eg,unbindColorTextureFromFramebuffer:qb,validateFramebuffer:Df,getFramebufferErrorMessage:ZN,getBatchDim:ld,getRowsCols:cd,getShapeAs3D:ng,getTextureShapeFromLogicalShape:tI,isReshapeFree:Of,getWebGLMaxTextureSize:eI,resetMaxTextureSize:function(){Zm=null},resetMaxTexturesInShader:function(){Jm=null},getMaxTexturesInShader:nI,getWebGLDisjointQueryTimerVersion:rI,hasExtension:Zi,isWebGLVersionEnabled:Gb,isCapableOfRenderingToFloatTexture:iI,isDownloadFloatTextureEnabled:aI,isWebGLFenceEnabled:oI}),te=gt();function aj(){gt().set("PROD",!0)}function oj(){gt().set("DEBUG",!0)}function sj(){gt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function xv(r){gt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function uj(){J.disposeVariables()}function lj(){return J}function Kb(){return J.memory()}function cj(r){return J.profile(r)}function ft(r,e){return J.tidy(r,e)}function de(r){Ex(r).forEach(function(e){return e.dispose()})}function za(r){return J.keep(r)}function hj(r){return J.time(r)}function fj(r){return J.setBackend(r)}function dj(){return J.ready()}function pj(){return J.backendName}function mj(r){J.removeBackend(r)}function gj(r){return J.findBackend(r)}function vj(r){return J.findBackendFactory(r)}function yj(r,e,t){return t===void 0&&(t=1),J.registerBackend(r,e,t)}function sI(){return J.backend}function bj(r,e){gt().setPlatform(r,e)}function Xb(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];gt().getBool("IS_TEST")||console.warn.apply(console,r)}function Va(r,e){var t=r;if(yr(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||yr(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&gt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(a,o,u){if(u=u||[],!Array.isArray(a)&&!yr(a))return void $(o.length===0,function(){return"Element arr["+u.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"});$(o.length>0,function(){return"Element arr["+u.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"}),$(a.length===o[0],function(){return"Element arr["+u.join("][")+"] should have "+o[0]+" elements, but has "+a.length+" elements"});for(var l=o.slice(1),h=0;h<a.length;++h)i(a[h],l,u.concat(h))}(r,n,[]),n}function SS(r,e,t,n){if(r!=null&&(r!=="numeric"&&r!==e||r==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+n+"' must be "+r+" tensor, but got "+e+" tensor")}function G(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof Ge)return SS(n,r.dtype,e,t),r;var i=th(r);if(i!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(i=n),SS(n,i,e,t),r==null||!yr(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var a=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=Va(r,i);yr(r)||Array.isArray(r)||(r=[r]);var u=i!=="string"?xx(r,i,gt().getBool("DEBUG")):Do(r,[],!0);return J.makeTensor(u,o,i)}function hd(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(i,a){return G(i,e+"["+a+"]",t)},n)}function Tx(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function uI(r,e,t){for(var n=r.length+e.length,i=[],a=0,o=0,u=0;u<n;u++)t.indexOf(u)===-1?i.push(r[a++]):i.push(e[o++]);return i}function gr(r,e){for(var t=[],n=r.length,i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);return[t,e.map(function(a){return r[a]})]}function vi(r,e){return uI(r,e.map(function(t){return 1}),e)}function Yr(r,e,t){$(Tx(e,t),function(){return r+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function oa(r,e){if(Tx(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(i){return t.push(i)}),t}function wv(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function sa(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function lI(r,e){var t=r[0].length;r.forEach(function(i,a){$(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+a+"] must be the same as the rank of the rest ("+t+")"})}),$(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var n=r[0];r.forEach(function(i,a){for(var o=0;o<t;o++)$(o===e||i[o]===n[o],function(){return"Error in concat"+t+"D: Shape of tensors["+a+"] ("+i+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+a+"."})})}function Xu(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}function tt(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];J.startScope(t);try{var u=n.apply(void 0,a);return u instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),J.endScope(u),u}catch(l){throw J.endScope(null),l}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}te.registerFlag("HAS_WEBGL",function(){return te.getNumber("WEBGL_VERSION")>0}),te.registerFlag("WEBGL_VERSION",function(){return Gb(2)?2:Gb(1)?1:0}),te.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return te.get("WEBGL_VERSION")===2}),te.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),te.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),te.registerFlag("WEBGL_PACK",function(){return te.getBool("HAS_WEBGL")}),te.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return te.getBool("WEBGL_PACK")}),te.registerFlag("WEBGL_PACK_CLIP",function(){return te.getBool("WEBGL_PACK")}),te.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),te.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return te.getBool("WEBGL_PACK")}),te.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return te.getBool("WEBGL_PACK")}),te.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return te.getBool("WEBGL_PACK")}),te.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return te.getBool("WEBGL_PACK")}),te.registerFlag("WEBGL_PACK_REDUCE",function(){return te.getBool("WEBGL_PACK")}),te.registerFlag("WEBGL_LAZILY_UNPACK",function(){return te.getBool("WEBGL_PACK")}),te.registerFlag("WEBGL_CONV_IM2COL",function(){return te.getBool("WEBGL_PACK")}),te.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return eI(te.getNumber("WEBGL_VERSION"))}),te.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return nI(te.getNumber("WEBGL_VERSION"))}),te.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=te.getNumber("WEBGL_VERSION");return r===0?0:rI(r)}),te.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return te.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r}),te.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return iI(te.getNumber("WEBGL_VERSION"))}),te.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!te.getBool("WEBGL_FORCE_F16_TEXTURES")&&te.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),te.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return aI(te.getNumber("WEBGL_VERSION"))}),te.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return oI(te.getNumber("WEBGL_VERSION"))}),te.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return te.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),DN=xv;var Kn=tt({complex_:function(r,e){var t=G(r,"real","complex"),n=G(e,"imag","complex");return Me(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex()."),J.runKernelFunc(function(i){return i.complex(t,n)},{$real:t,$imag:n})}}),Qr=tt({real_:function(r){var e=G(r,"input","real");return J.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),zi=tt({imag_:function(r){var e=G(r,"input","imag");return J.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Rn(r,e,t){return Gs(r,e,Va(r,t),t)}function Gs(r,e,t,n){if(n==null&&(n=th(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!yr(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Cx(e);var i=jt(e),a=jt(t);$(i===a,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+a});for(var o=0;o<t.length;++o){var u=t[o],l=o!==t.length-1||u!==jt(e.slice(o));$(t[o]===e[o]||!l,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return yr(r)||Array.isArray(r)||(r=[r]),e=e||t,r=n!=="string"?xx(r,n,gt().getBool("DEBUG")):Do(r,[],!0),J.makeTensor(r,e,n)}function zt(r,e){if((yr(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&yr(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Gs(r,[],[],e)}function Jr(r,e){al(r);var t=Va(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Gs(r,null,t,e)}function _o(r,e,t){if(al(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Va(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Gs(r,e,n,t)}function Sx(r,e,t){if(al(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Va(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Gs(r,e,n,t)}function vs(r,e,t){if(al(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Va(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Gs(r,e,n,t)}function cI(r,e,t){if(al(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Va(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Gs(r,e,n,t)}function hI(r,e,t){if(al(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Va(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Gs(r,e=e||n,n,t)}function Ax(r,e,t,n){return e===void 0&&(e=!0),J.makeVariable(r,e,t,n)}function Wa(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Wa(r,"float32"),n=Ue(r,"float32");return Kn(t,n)}var i=wx(jt(r),e);return J.makeTensor(i,r,e)}function Ue(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Ue(r,"float32"),n=Ue(r,"float32");return Kn(t,n)}var i=eh(jt(r),e);return J.makeTensor(i,r,e)}function nh(r,e,t){return J.runKernelFunc(function(n){return n.fill(r,e,t)},{})}function Rx(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");return J.runKernelFunc(function(n){return n.linspace(r,e,t)},{})}function Cv(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");if(r===e||r<e&&t<0||e<r&&t>1)return Ue([0],n);var i=eh(Math.abs(Math.ceil((e-r)/t)),n);e<r&&t===1&&(t=-1),i[0]=r;for(var a=1;a<i.length;a++)i[a]=i[a-1]+t;return Jr(i,n)}var yi=tt({onesLike_:function(r){var e=G(r,"x","onesLike");if(e.dtype==="complex64"){var t=yi(Qr(e)),n=Te(zi(e));return Kn(t,n)}return J.runKernelFunc(function(i){return i.onesLike(e)},{$x:e},function(i,a){return{$x:function(){return Te(i)}}})}}),Te=tt({zerosLike_:function(r){var e=G(r,"x","zerosLike");return J.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,n){return{$x:function(){return Te(t)}}})}}),Ir=tt({concat_:function(r,e){e===void 0&&(e=0),$(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=hd(r,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(o){if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+o.dtype+". ")}),e=ur(e,t[0].shape)[0];var n=Xu(t.map(function(o){return o.shape}),e);if(jt(n)===0)return Rn([],n);if((t=t.filter(function(o){return o.size>0})).length===1)return t[0];var i=t.map(function(o){return o.shape});lI(i,e);var a=t;return J.runKernelFunc(function(o){return o.concat(t,e)},a,function(o){var u=i.map(function(l){return l[e]});return To(o,u,e).map(function(l){return function(){return l}})})}}),Nx=tt({concat1d_:function(r){return Ir(r,0)}}),Ix=tt({concat2d_:function(r,e){return Ir(r,e)}}),kx=tt({concat3d_:function(r,e){return Ir(r,e)}}),Dx=tt({concat4d_:function(r,e){return Ir(r,e)}}),To=tt({split_:function(r,e,t){t===void 0&&(t=0);var n,i=G(r,"x","split");return t=ur(t,i.shape)[0],typeof e=="number"?($(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(i.shape[t]/e)):($(i.shape[t]===e.reduce(function(a,o){return a+o}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e),J.runKernelFunc(function(a){return a.split(i,n,t)},{$x:i},function(a){return{$x:function(){return Ir(a,t)}}})}});function ol(r,e){return r(e={exports:{}},e.exports),e.exports}var xj=ol(function(r){(function(e,t,n){function i(u){var l,h=this,f=(l=4022871197,function(p){p=p.toString();for(var m=0;m<p.length;m++){var v=.02519603282416938*(l+=p.charCodeAt(m));v-=l=v>>>0,l=(v*=l)>>>0,l+=4294967296*(v-=l)}return 23283064365386963e-26*(l>>>0)});h.next=function(){var p=2091639*h.s0+23283064365386963e-26*h.c;return h.s0=h.s1,h.s1=h.s2,h.s2=p-(h.c=0|p)},h.c=1,h.s0=f(" "),h.s1=f(" "),h.s2=f(" "),h.s0-=f(u),h.s0<0&&(h.s0+=1),h.s1-=f(u),h.s1<0&&(h.s1+=1),h.s2-=f(u),h.s2<0&&(h.s2+=1),f=null}function a(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var h=new i(u),f=l&&l.state,p=h.next;return p.int32=function(){return 4294967296*h.next()|0},p.double=function(){return p()+11102230246251565e-32*(2097152*p()|0)},p.quick=p,f&&(typeof f=="object"&&a(f,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.alea=o})(0,r)}),wj=ol(function(r){(function(e,t,n){function i(u){var l=this,h="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var p=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^p^p>>>8},u===(0|u)?l.x=u:h+=u;for(var f=0;f<h.length+64;f++)l.x^=0|h.charCodeAt(f),l.next()}function a(u,l){return l.x=u.x,l.y=u.y,l.z=u.z,l.w=u.w,l}function o(u,l){var h=new i(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(m===0);return m},p.int32=h.next,p.quick=p,f&&(typeof f=="object"&&a(f,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xor128=o})(0,r)}),Cj=ol(function(r){(function(e,t,n){function i(u){var l=this,h="";l.next=function(){var p=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^p^p<<1)|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,u===(0|u)?l.x=u:h+=u;for(var f=0;f<h.length+64;f++)l.x^=0|h.charCodeAt(f),f==h.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function a(u,l){return l.x=u.x,l.y=u.y,l.z=u.z,l.w=u.w,l.v=u.v,l.d=u.d,l}function o(u,l){var h=new i(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(m===0);return m},p.int32=h.next,p.quick=p,f&&(typeof f=="object"&&a(f,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xorwow=o})(0,r)}),Ej=ol(function(r){(function(e,t,n){function i(u){var l=this;l.next=function(){var h,f,p=l.x,m=l.i;return h=p[m],f=(h^=h>>>7)^h<<24,f^=(h=p[m+1&7])^h>>>10,f^=(h=p[m+3&7])^h>>>3,f^=(h=p[m+4&7])^h<<7,h=p[m+7&7],f^=(h^=h<<13)^h<<9,p[m]=f,l.i=m+1&7,f},function(h,f){var p,m=[];if(f===(0|f))m[0]=f;else for(f=""+f,p=0;p<f.length;++p)m[7&p]=m[7&p]<<15^f.charCodeAt(p)+m[p+1&7]<<13;for(;m.length<8;)m.push(0);for(p=0;p<8&&m[p]===0;++p);for(p==8?m[7]=-1:m[p],h.x=m,h.i=0,p=256;p>0;--p)h.next()}(l,u)}function a(u,l){return l.x=u.x.slice(),l.i=u.i,l}function o(u,l){u==null&&(u=+new Date);var h=new i(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(m===0);return m},p.int32=h.next,p.quick=p,f&&(f.x&&a(f,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xorshift7=o})(0,r)}),_j=ol(function(r){(function(e,t,n){function i(u){var l=this;l.next=function(){var h,f,p=l.w,m=l.X,v=l.i;return l.w=p=p+1640531527|0,f=m[v+34&127],h=m[v=v+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,f=m[v]=f^h,l.i=v,f+(p^p>>>16)|0},function(h,f){var p,m,v,b,C,w=[],E=128;for(f===(0|f)?(m=f,f=null):(f+="\0",m=0,E=Math.max(E,f.length)),v=0,b=-32;b<E;++b)f&&(m^=f.charCodeAt((b+32)%f.length)),b===0&&(C=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,b>=0&&(C=C+1640531527|0,v=(p=w[127&b]^=m+C)==0?v+1:0);for(v>=128&&(w[127&(f&&f.length||0)]=-1),v=127,b=512;b>0;--b)m=w[v+34&127],p=w[v=v+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,w[v]=m^p;h.w=C,h.X=w,h.i=v}(l,u)}function a(u,l){return l.i=u.i,l.w=u.w,l.X=u.X.slice(),l}function o(u,l){u==null&&(u=+new Date);var h=new i(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(m===0);return m},p.int32=h.next,p.quick=p,f&&(f.X&&a(f,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xor4096=o})(0,r)}),Tj=ol(function(r){(function(e,t,n){function i(u){var l=this,h="";l.next=function(){var p=l.b,m=l.c,v=l.d,b=l.a;return p=p<<25^p>>>7^m,m=m-v|0,v=v<<24^v>>>8^b,b=b-p|0,l.b=p=p<<20^p>>>12^m,l.c=m=m-v|0,l.d=v<<16^m>>>16^b,l.a=b-p|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,u===Math.floor(u)?(l.a=u/4294967296|0,l.b=0|u):h+=u;for(var f=0;f<h.length+20;f++)l.b^=0|h.charCodeAt(f),l.next()}function a(u,l){return l.a=u.a,l.b=u.b,l.c=u.c,l.d=u.d,l}function o(u,l){var h=new i(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(m===0);return m},p.int32=h.next,p.quick=p,f&&(typeof f=="object"&&a(f,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.tychei=o})(0,r)}),Du=ol(function(r){(function(e,t){var n,i=this,a=256,o=6,u="random",l=t.pow(a,o),h=t.pow(2,52),f=2*h,p=a-1;function m(E,S,A){var k=[],O=C(function R(N,D){var L,P=[],B=typeof N;if(D&&B=="object")for(L in N)try{P.push(R(N[L],D-1))}catch{}return P.length?P:B=="string"?N:N+"\0"}((S=S==1?{entropy:!0}:S||{}).entropy?[E,w(e)]:E??function(){try{var R;return n&&(R=n.randomBytes)?R=R(a):(R=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(R)),w(R)}catch{var N=i.navigator,D=N&&N.plugins;return[+new Date,i,D,i.screen,w(e)]}}(),3),k),V=new v(k),T=function(){for(var R=V.g(o),N=l,D=0;R<h;)R=(R+D)*a,N*=a,D=V.g(1);for(;R>=f;)R/=2,N/=2,D>>>=1;return(R+D)/N};return T.int32=function(){return 0|V.g(4)},T.quick=function(){return V.g(4)/4294967296},T.double=T,C(w(V.S),e),(S.pass||A||function(R,N,D,L){return L&&(L.S&&b(L,V),R.state=function(){return b(V,{})}),D?(t[u]=R,N):R})(T,O,"global"in S?S.global:this==t,S.state)}function v(E){var S,A=E.length,k=this,O=0,V=k.i=k.j=0,T=k.S=[];for(A||(E=[A++]);O<a;)T[O]=O++;for(O=0;O<a;O++)T[O]=T[V=p&V+E[O%A]+(S=T[O])],T[V]=S;(k.g=function(R){for(var N,D=0,L=k.i,P=k.j,B=k.S;R--;)N=B[L=p&L+1],D=D*a+B[p&(B[L]=B[P=p&P+N])+(B[P]=N)];return k.i=L,k.j=P,D})(a)}function b(E,S){return S.i=E.i,S.j=E.j,S.S=E.S.slice(),S}function C(E,S){for(var A,k=E+"",O=0;O<k.length;)S[p&O]=p&(A^=19*S[p&O])+k.charCodeAt(O++);return w(S)}function w(E){return String.fromCharCode.apply(0,E)}if(t["seed"+u]=m,C(t.random(),e),r.exports){r.exports=m;try{n=require("crypto")}catch{}}})([],Math)});Du.alea=xj,Du.xor128=wj,Du.xorwow=Cj,Du.xorshift7=Ej,Du.xor4096=_j,Du.tychei=Tj;var Ev=Du.alea,Ox=function(){function r(e,t,n,i,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=a||Math.random();this.random=Ev(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,i=!1;!i;){var a=void 0,o=void 0,u=void 0;do u=(a=2*this.random()-1)*a+(o=2*this.random()-1)*o;while(u>=1||u===0);var l=Math.sqrt(-2*Math.log(u)/u);t=this.mean+this.stdDev*a*l,n=this.mean+this.stdDev*o*l,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),Sj=function(){function r(e,t,n,i){this.alpha=e,this.beta=1/t,this.dtype=n;var a=i||Math.random();this.randu=Ev(a.toString()),this.randn=new Ox(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,i,a,o;;){do i=this.randn.nextValue(),o=1+this.c*i;while(o<=0);if(o*=o*o,t=1-.331*(e=i*i)*e,n=.5*e+this.d*(1-o+Math.log(o)),(a=this.randu())<t||Math.log(a)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),Aj=function(){function r(e,t,n,i){var a=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return a.dtype==null||a.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Ev(i)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function ie(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",Cx(r),new Ic(r,e,t)}function fI(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}var _v=tt({batchToSpaceND_:function(r,e,t){var n=G(r,"x","batchToSpaceND"),i=e.reduce(function(a,o){return a*o});return $(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),$(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),$(n.shape[0]%i==0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),J.runKernelFunc(function(a){return a.batchToSpaceND(n,e,t)},{$x:n},function(a){return{$x:function(){return a.spaceToBatchND(e,t)}}})}}),Tv=tt({cast_:function(r,e){var t=G(r,"x","cast");if(!TN(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={dtype:e};return J.runKernelFunc(function(i){return i.cast(t,e)},{x:t},function(i){return{x:function(){return i.clone()}}},"Cast",n)}}),dI=tt({clone_:function(r){var e=G(r,"x","clone",null);return J.runKernelFunc(function(){return J.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),pI=tt({cumsum_:function(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var i=G(r,"x","cumsum"),a=oa([e|=0],i.rank),o=i;a!=null&&(o=i.transpose(a));var u=sa(1,i.rank)[0],l=J.runKernelFunc(function(h){return h.cumsum(o,u,t,n)},{permutedX:o},function(h){return{permutedX:function(){return h.cumsum(e,t,!n)}}});return a!=null&&(l=l.transpose(a)),l}}),Mx=tt({depthToSpace_:function(r,e,t){t===void 0&&(t="NHWC");var n=G(r,"x","depthToSpace"),i=t==="NHWC"?n.shape[1]:n.shape[2],a=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];return $(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+n.shape}),$(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+e+` for depthToSpace with input shape
          `+n.shape}),$(o%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+n.shape}),J.runKernelFunc(function(u){return u.depthToSpace(n,e,t)},{$x:n})}}),fi=tt({expandDims_:function(r,e){e===void 0&&(e=0);var t=G(r,"x","expandDims",null);$(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n=t.shape.slice();return e<0&&($(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),n.splice(e,0,1),Dd(t,n)}}),Sv=tt({eye_:function(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var i=ie([r,e],n),a=r<=e?r:e,o=0;o<a;++o)i.set(1,o,o);var u=i.toTensor().as2D(r,e);if(t==null)return u;if(t.length===1)return Ns(fi(u,0),[t[0],1,1]);if(t.length===2)return Ns(fi(fi(u,0),0),[t[0],t[1],1,1]);if(t.length===3)return Ns(fi(fi(fi(u,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),Lx=tt({multinomial_:function(r,e,t,n){n===void 0&&(n=!1);var i=G(r,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var u=o===1?i.as2D(1,-1):i,l=J.runKernelFunc(function(h){return h.multinomial(u,n,e,t)},{logits2D:u});return o===1?l.as1D():l}}),kc=tt({oneHot_:function(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=G(r,"indices","oneHot","int32"),a=i.shape.concat([e]);return i=i.flatten(),J.runKernelFunc(function(o){return o.oneHot(i,e,t,n)},{$indices:i},function(o){return{$indices:function(){return Ue(i.shape,"float32")}}}).reshape(a)}}),$s=tt({pad_:function(r,e,t){t===void 0&&(t=0);var n=G(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=e.map(function(a){return a[0]});return J.runKernelFunc(function(a){return a.pad(n,e,t)},{$x:n},function(a){return{$x:function(){return a.slice(i,n.shape)}}})}}),mI=tt({pad1d_:function(r,e,t){return t===void 0&&(t=0),$(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),$s(r,[e],t)}}),gI=tt({pad2d_:function(r,e,t){return t===void 0&&(t=0),$(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),$s(r,e,t)}}),vI=tt({pad3d_:function(r,e,t){return t===void 0&&(t=0),$(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),$s(r,e,t)}}),yI=tt({pad4d_:function(r,e,t){return t===void 0&&(t=0),$(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),$s(r,e,t)}}),bI=tt({rand_:function(r,e,t){var n=jt(r),i=null;if(t==null||t==="float32")i=new Float32Array(n);else if(t==="int32")i=new Int32Array(n);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(n)}for(var a=0;a<n;a++)i[a]=e();return J.makeTensor(i,r,t)}}),Px=tt({randomNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var a=new Ox(e,t,n,!1,i),o=ie(r,n),u=0;u<o.values.length;u++)o.values[u]=a.nextValue();return o.toTensor()}}),xI=tt({randomGamma_:function(r,e,t,n,i){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var a=new Sj(e,t,n,i),o=ie(r,n),u=0;u<o.values.length;u++)o.values[u]=a.nextValue();return o.toTensor()}}),sl=tt({randomUniform_:function(r,e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var a=ie(r,n),o=new Aj(e,t,null,i),u=0;u<a.values.length;u++)a.values[u]=o.nextValue();return a.toTensor()}}),Dd=tt({reshape_:function(r,e){var t=G(r,"x","reshape",null);e=EN(e,t.size),$(t.size===jt(e),function(){return"new shape and old shape must have the same number of elements."});var n={shape:e};return J.runKernelFunc(function(i){return i.reshape(t,e)},{x:t},function(i){return{x:function(){return i.reshape(t.shape)}}},"Reshape",n)}}),Av=tt({spaceToBatchND_:function(r,e,t){var n=G(r,"x","spaceToBatchND");return $(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),$(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),$(n.shape.reduce(function(i,a,o){return o>0&&o<=e.length?i&&(a+t[o-1][0]+t[o-1][1])%e[o-1]==0:i},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),J.runKernelFunc(function(i){return i.spaceToBatchND(n,e,t)},{$x:n},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),Od=tt({squeeze_:function(r,e){var t=G(r,"x","squeeze");return Dd(t,ys(t.shape,e).newShape)}}),na=tt({stack_:function(r,e){e===void 0&&(e=0);var t=hd(r,"tensors","stack");if($(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var n=t[0].rank,i=t[0].shape,a=t[0].dtype;$(e<=n,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(u){Me(i,u.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(u){$(a===u.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=t.map(function(u){return u.expandDims(e)});return Ir(o,e)}}),Ns=tt({tile_:function(r,e){var t=G(r,"x","tile",null);return $(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}),J.runKernelFunc(function(n,i){var a=n.tile(t,e);return i([t]),a},{$x:t},function(n,i){var a=i[0];return{$x:function(){var o=Te(a);if(a.rank===1)for(var u=0;u<e[0];++u)o=o.add(n.slice([u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(u=0;u<e[0];++u)for(var l=0;l<e[1];++l)o=o.add(n.slice([u*a.shape[0],l*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(u=0;u<e[0];++u)for(l=0;l<e[1];++l)for(var h=0;h<e[2];++h)o=o.add(n.slice([u*a.shape[0],l*a.shape[1],h*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(a.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(u=0;u<e[0];++u)for(l=0;l<e[1];++l)for(h=0;h<e[2];++h)for(var f=0;f<e[3];++f)o=o.add(n.slice([u*a.shape[0],l*a.shape[1],h*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return o}}})}}),Md=tt({truncatedNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var a=new Ox(e,t,n,!0,i),o=ie(r,n),u=0;u<o.values.length;u++)o.values[u]=a.nextValue();return o.toTensor()}}),Yu=tt({unstack_:function(r,e){e===void 0&&(e=0),e=e||0;var t=G(r,"x","unstack");return $(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length),J.runKernelFunc(function(n){return n.unstack(t,e)},{$x:t},function(n){return{$x:function(){return na(n,e)}}})}}),zx=function(r,e){return Ft(this,void 0,void 0,function(){var t,n,i,a,o,u,l,h,f,p;return Bt(this,function(m){switch(m.label){case 0:return t=G(r,"x","setdiff1d"),n=G(e,"y","setdiff1d"),$(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),$(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),$(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return i=m.sent(),[4,n.data()];case 2:for(a=m.sent(),o=new Set(a),u=0,f=0;f<i.length;f++)o.has(i[f])||u++;for(l=new Ic([u],t.dtype),h=new Ic([u],"int32"),f=0,p=0;f<i.length;f++)o.has(i[f])||(l.values[p]=i[f],h.values[p]=f,p++);return[2,[l.toTensor(),h.toTensor()]]}})})};function kg(r,e,t,n){n===void 0&&(n=!0);var i=[];if(n)(i=i.concat(e.slice(0))).push(r[0]/t),i=i.concat(r.slice(1));else{i=i.concat(r[0]);for(var a=e.length,o=0;o<a;++o)i=i.concat([r[o+1]/e[o],e[o]]);i=i.concat(r.slice(a+1))}return i}function Dg(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var i=e+1;i<r;++i)i<=2*e?(n.push(i),n.push(i-(e+1))):n.push(i)}else{var a=[],o=[];for(i=1;i<r;++i)i>=2*e+1||i%2==1?o.push(i):a.push(i);n.push.apply(n,a),n.push(0),n.push.apply(n,o)}return n}function Og(r,e,t,n){n===void 0&&(n=!0);var i=[];n?i.push(r[0]/t):i.push(r[0]*t);for(var a=1;a<r.length;++a)a<=e.length?n?i.push(e[a-1]*r[a]):i.push(r[a]/e[a-1]):i.push(r[a]);return i}function wI(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function CI(r,e,t){for(var n=r.slice(0,1),i=0;i<t;++i)n.push(r[i+1]-e[i][0]-e[i][1]);return n}function EI(r,e){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var t=e.shape,n=t[t.length-1],i=1,a=0;a<t.length-1;++a)i*=t[a];var o=r.shape,u=t.slice();u.pop();var l=1;for(a=n;a<r.rank;++a)l*=o[a],u.push(o[a]);var h=qs(r.shape).map(function(f){return f/l}).concat([1]).slice(0,n);return[u,i,l,h]}var _I=30;function P1(r){return r<=_I?r:Ig(r,Math.floor(Math.sqrt(r)))}function Rj(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}(function(n,i,a){var o=i.rank>1?i.shape[i.rank-1]:1,u=i.rank>1?i.rank-1:1,l="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+a.shape+", indices.shape: "+i.shape+", shape: "+n+", sliceDim: "+o+", and batchDim: "+u+".";if(a.rank<u)throw new Error(l+" update.rank < "+u+". ");if(n.length<o+(a.rank-u))throw new Error(l+" Output shape length < "+(o+(a.rank-u)));if(a.rank!==u+n.length-o)throw new Error(l+" update.rank != "+(u+n.length-o));for(var h=0;h<u;++h)if(a.shape[h]!==i.shape[h])throw new Error(l+" updates.shape["+h+"] ("+a.shape[h]+") != indices.shape["+h+"] ("+i.shape[h]+").");for(h=0;h<a.rank-u;++h)if(a.shape[h+u]!==n[h+o])throw new Error(l+" updates.shape["+(h+u)+"] ("+a.shape[h+u]+") != shape["+(h+u)+"] ("+n[h+u]+")")})(t,e,r)}function Mg(r,e,t){for(var n=e.rank>1?e.shape[e.rank-1]:1,i=t.length,a=1,o=n;o<i;++o)a*=t[o];var u=n<1?1:n;return{sliceRank:n,numUpdates:e.size/u,sliceSize:a,strides:qs(t.slice(0,n)).concat([1]),outputSize:jt(t)}}function TI(r,e,t){$(r.rank===e.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+e+" must match the rank of the array ("+r.rank+")."}),$(r.rank===t.length,function(){return"Error in slice"+r.rank+"D: Length of size "+t+" must match the rank of the array ("+r.rank+")."});for(var n=function(a){$(e[a]+t[a]<=r.shape[a],function(){return"Error in slice"+r.rank+"D: begin["+a+"] + size["+a+"] ("+(e[a]+t[a])+") would overflow input.shape["+a+"] ("+r.shape[a]+")"})},i=0;i<r.rank;++i)n(i)}function Yb(r){for(var e=[],t=0;r>0;)1&r&&e.push(t),r/=2,t++;return e}function Rv(r,e,t){for(var n=[],i=0;i<r.length;i++)n[i]=Math.ceil((e[i]-r[i])/t[i]);return n}function SI(r,e,t,n,i){var a=e[i],o=t[i]||1;(r&1<<i||a==null)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=n[i];return a<0&&(a+=u),a=Rg(0,a,u-1)}function AI(r,e,t,n,i){var a=e[i],o=t[i]||1;(r&1<<i||a==null)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=n[i];return a<0&&(a+=u),a=o>0?Rg(0,a,u):Rg(-1,a,u-1)}function Vx(r,e,t){for(var n=t.length,i=0;i<t.length;i++)if(t[i]>1){n=i;break}for(i=n+1;i<t.length;i++)if(e[i]>0||t[i]!==r[i])return!1;return!0}function Fx(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}var Nj=Object.freeze({assertParamsValid:TI,maskToAxes:Yb,computeOutShape:Rv,startForAxis:SI,stopForAxis:AI,isSliceContinous:Vx,computeFlatOffset:Fx});function Ij(r){return $(Fs(r),function(){return"The f passed in grad(f) must be a function"}),function(e,t){var n=G(e,"x","tf.grad",null),i=t!=null?G(t,"dy","tf.grad"):null;return J.tidy(function(){var a=J.gradients(function(){return r(n)},[n],i),o=a.value,u=a.grads;return i!=null&&Me(o.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Nv(u),u[0]})}}function kj(r){return $(Fs(r),function(){return"The f passed in grads(f) must be a function"}),function(e,t){$(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var n=hd(e,"args","tf.grads",null),i=t!=null?G(t,"dy","tf.grads"):null;return J.tidy(function(){var a=J.gradients(function(){return r.apply(void 0,n)},n,i),o=a.value,u=a.grads;return i!=null&&Me(o.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Nv(u),u})}}function Dj(r){return $(Fs(r),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,t){$(e instanceof Ge,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),$(t==null||t instanceof Ge,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var n=J.gradients(function(){return r(e)},[e],t),i=n.grads,a=n.value;return Nv(i),{grad:i[0],value:a}}}function Oj(r){return $(Fs(r),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,t){$(Array.isArray(e)&&e.every(function(i){return i instanceof Ge}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),$(t==null||t instanceof Ge,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var n=J.gradients(function(){return r.apply(void 0,e)},e,t);return t!=null&&Me(n.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Nv(n.grads),n}}function RI(r,e){$(Fs(r),function(){return"The f passed in variableGrads(f) must be a function"}),$(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof sd}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var n in e=[],J.registeredVariables)e.push(J.registeredVariables[n]);var i=t?e.filter(function(f){return!f.trainable}):null,a=e.length;$((e=e.filter(function(f){return f.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var o=J.gradients(r,e,null,!0),u=o.value,l=o.grads;$(l.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),$(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+u.rank+" tensor"});var h={};return e.forEach(function(f,p){l[p]!=null&&(h[f.name]=l[p])}),i!=null&&i.forEach(function(f){return h[f.name]=null}),{value:u,grads:h}}function rh(r){return J.customGrad(r)}function Nv(r){if(r.filter(function(e){return e==null}).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}var ul=tt({softmax_:function(r,e){e===void 0&&(e=-1);var t=G(r,"logits","softmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return rh(function(n,i){var a=n.logSumExp([e],!0),o=n.toFloat().sub(a).exp();return i([o]),{value:o,gradFunc:function(u,l){var h=l[0],f=u.mul(h);return f.sub(f.sum([e],!0).mul(h))}}})(t)}}),Iv=tt({logSoftmax_:function(r,e){e===void 0&&(e=-1);var t=G(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return rh(function(n,i){var a=n.max(e,!0),o=n.sub(a),u=o.toFloat().sub(o.exp().sum(e,!0).log());return i([u]),{value:u,gradFunc:function(l,h){var f=h[0].exp();return l.sub(l.sum(e,!0).mul(f))}}})(t)}}),Bx=function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),jx=function(){function r(){}return r.prototype.time=function(e){return mt()},r.prototype.read=function(e){return mt()},r.prototype.readSync=function(e){return mt()},r.prototype.numDataIds=function(){return mt()},r.prototype.disposeData=function(e){return mt()},r.prototype.fromPixels=function(e,t){return mt()},r.prototype.write=function(e,t,n){return mt()},r.prototype.move=function(e,t,n,i){return mt()},r.prototype.memory=function(){return mt()},r.prototype.floatPrecision=function(){return mt()},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(e,t,n,i){return mt()},r.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,mt()},r.prototype.slice=function(e,t,n){return mt()},r.prototype.stridedSlice=function(e,t,n,i){return mt()},r.prototype.unstack=function(e,t){return mt()},r.prototype.reverse=function(e,t){return mt()},r.prototype.concat=function(e,t){return mt()},r.prototype.neg=function(e){return mt()},r.prototype.add=function(e,t){return mt()},r.prototype.addN=function(e){return mt()},r.prototype.subtract=function(e,t){return mt()},r.prototype.multiply=function(e,t){return mt()},r.prototype.realDivide=function(e,t){return mt()},r.prototype.floorDiv=function(e,t){return mt()},r.prototype.sum=function(e,t){return mt()},r.prototype.prod=function(e,t){return mt()},r.prototype.unsortedSegmentSum=function(e,t,n){return mt()},r.prototype.argMin=function(e,t){return mt()},r.prototype.argMax=function(e,t){return mt()},r.prototype.equal=function(e,t){return mt()},r.prototype.notEqual=function(e,t){return mt()},r.prototype.less=function(e,t){return mt()},r.prototype.lessEqual=function(e,t){return mt()},r.prototype.greater=function(e,t){return mt()},r.prototype.greaterEqual=function(e,t){return mt()},r.prototype.logicalNot=function(e){return mt()},r.prototype.logicalAnd=function(e,t){return mt()},r.prototype.logicalOr=function(e,t){return mt()},r.prototype.where=function(e){return mt()},r.prototype.select=function(e,t,n){return mt()},r.prototype.topk=function(e,t,n){return mt()},r.prototype.min=function(e,t){return mt()},r.prototype.minimum=function(e,t){return mt()},r.prototype.mod=function(e,t){return mt()},r.prototype.max=function(e,t){return mt()},r.prototype.maximum=function(e,t){return mt()},r.prototype.all=function(e,t){return mt()},r.prototype.any=function(e,t){return mt()},r.prototype.squaredDifference=function(e,t){return mt()},r.prototype.ceil=function(e){return mt()},r.prototype.floor=function(e){return mt()},r.prototype.round=function(e){return mt()},r.prototype.sign=function(e){return mt()},r.prototype.isNaN=function(e){return mt()},r.prototype.isInf=function(e){return mt()},r.prototype.isFinite=function(e){return mt()},r.prototype.pow=function(e,t){return mt()},r.prototype.exp=function(e){return mt()},r.prototype.expm1=function(e){return mt()},r.prototype.log=function(e){return mt()},r.prototype.log1p=function(e){return mt()},r.prototype.sqrt=function(e){return mt()},r.prototype.rsqrt=function(e){return mt()},r.prototype.square=function(e){return mt()},r.prototype.reciprocal=function(e){return mt()},r.prototype.relu=function(e){return mt()},r.prototype.relu6=function(e){return mt()},r.prototype.prelu=function(e,t){return mt()},r.prototype.elu=function(e){return mt()},r.prototype.eluDer=function(e,t){return mt()},r.prototype.selu=function(e){return mt()},r.prototype.int=function(e){return mt()},r.prototype.clip=function(e,t,n){return mt()},r.prototype.abs=function(e){return mt()},r.prototype.complexAbs=function(e){return mt()},r.prototype.sigmoid=function(e){return mt()},r.prototype.softplus=function(e){return mt()},r.prototype.sin=function(e){return mt()},r.prototype.cos=function(e){return mt()},r.prototype.tan=function(e){return mt()},r.prototype.asin=function(e){return mt()},r.prototype.acos=function(e){return mt()},r.prototype.atan=function(e){return mt()},r.prototype.atan2=function(e,t){return mt()},r.prototype.sinh=function(e){return mt()},r.prototype.cosh=function(e){return mt()},r.prototype.tanh=function(e){return mt()},r.prototype.asinh=function(e){return mt()},r.prototype.acosh=function(e){return mt()},r.prototype.atanh=function(e){return mt()},r.prototype.erf=function(e){return mt()},r.prototype.step=function(e,t){return mt()},r.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,mt()},r.prototype.conv2d=function(e,t,n){return mt()},r.prototype.conv2dDerInput=function(e,t,n){return mt()},r.prototype.conv2dDerFilter=function(e,t,n){return mt()},r.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,mt()},r.prototype.depthwiseConv2D=function(e,t,n){return mt()},r.prototype.depthwiseConv2DDerInput=function(e,t,n){return mt()},r.prototype.depthwiseConv2DDerFilter=function(e,t,n){return mt()},r.prototype.conv3d=function(e,t,n){return mt()},r.prototype.conv3dDerInput=function(e,t,n){return mt()},r.prototype.conv3dDerFilter=function(e,t,n){return mt()},r.prototype.maxPool=function(e,t){return mt()},r.prototype.maxPoolBackprop=function(e,t,n,i){return mt()},r.prototype.avgPool=function(e,t){return mt()},r.prototype.avgPoolBackprop=function(e,t,n){return mt()},r.prototype.avgPool3d=function(e,t){return mt()},r.prototype.avgPool3dBackprop=function(e,t,n){return mt()},r.prototype.maxPool3d=function(e,t){return mt()},r.prototype.maxPool3dBackprop=function(e,t,n,i){return mt()},r.prototype.reshape=function(e,t){return mt()},r.prototype.cast=function(e,t){return mt()},r.prototype.tile=function(e,t){return mt()},r.prototype.pad=function(e,t,n){return mt()},r.prototype.transpose=function(e,t){return mt()},r.prototype.gather=function(e,t,n){return mt()},r.prototype.gatherND=function(e,t){return mt()},r.prototype.scatterND=function(e,t,n){return mt()},r.prototype.batchToSpaceND=function(e,t,n){return mt()},r.prototype.spaceToBatchND=function(e,t,n){return mt()},r.prototype.resizeBilinear=function(e,t,n,i){return mt()},r.prototype.resizeBilinearBackprop=function(e,t,n){return mt()},r.prototype.resizeNearestNeighbor=function(e,t,n,i){return mt()},r.prototype.resizeNearestNeighborBackprop=function(e,t,n){return mt()},r.prototype.batchNormalization=function(e,t,n,i,a,o){return mt()},r.prototype.localResponseNormalization4D=function(e,t,n,i,a){return mt()},r.prototype.LRNGrad=function(e,t,n,i,a,o,u){return mt()},r.prototype.multinomial=function(e,t,n,i){return mt()},r.prototype.oneHot=function(e,t,n,i){return mt()},r.prototype.cumsum=function(e,t,n,i){return mt()},r.prototype.nonMaxSuppression=function(e,t,n,i,a){return mt()},r.prototype.fft=function(e){return mt()},r.prototype.ifft=function(e){return mt()},r.prototype.complex=function(e,t){return mt()},r.prototype.real=function(e){return mt()},r.prototype.imag=function(e){return mt()},r.prototype.cropAndResize=function(e,t,n,i,a,o){return mt()},r.prototype.depthToSpace=function(e,t,n){return mt()},r.prototype.split=function(e,t,n){return mt()},r.prototype.sparseToDense=function(e,t,n,i){return mt()},r.prototype.diag=function(e){return mt()},r.prototype.fill=function(e,t,n){throw new Error("Not yet implemented.")},r.prototype.onesLike=function(e){return mt()},r.prototype.zerosLike=function(e){return mt()},r.prototype.linspace=function(e,t,n){return mt()},r.prototype.dispose=function(){return mt()},r}();function mt(){throw new Error("Not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Vu(r,e){for(var t=r.length,n=[],i=0;i<t;i++){var a=t-1-i,o=r[a]||1;(e[e.length-1-i]||1)>1&&o===1&&n.unshift(a)}return n}function Bn(r,e){for(var t=[],n=0;n<e.length;n++){var i=r[r.length-n-1],a=e.length-n-1,o=e[a];(i==null||i===1&&o>1)&&t.unshift(a)}return t}function Ee(r,e){for(var t=[],n=Math.max(r.length,e.length),i=0;i<n;i++){var a=r[r.length-i-1];a==null&&(a=1);var o=e[e.length-i-1];if(o==null&&(o=1),a===1)t.unshift(o);else if(o===1)t.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+r+" and "+e+".");t.unshift(a)}}return t}function Dc(r,e,t,n,i,a,o){o===void 0&&(o="channelsLast");var u,l=Lg(e),h=l[0],f=l[1];if(o==="channelsLast")u=[h,f,r[3],r[3]];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);u=[h,f,r[1],r[1]]}return Ks(r,u,t,n,i,a,!1,o)}function fd(r,e,t,n,i,a,o){o===void 0&&(o="NDHWC");var u,l,h=Qb(e),f=h[0],p=h[1],m=h[2];if(o==="NDHWC")l="channelsLast",u=[f,p,m,r[4],r[4]];else{if(o!=="NCDHW")throw new Error("Unknown dataFormat "+o);l="channelsFirst",u=[f,p,m,r[1],r[1]]}return dd(r,u,t,n,i,!1,l,a)}function Ks(r,e,t,n,i,a,o,u){o===void 0&&(o=!1),u===void 0&&(u="channelsLast");var l=[-1,-1,-1,-1],h=l[0],f=l[1],p=l[2],m=l[3];if(u==="channelsLast")h=r[0],f=r[1],p=r[2],m=r[3];else{if(u!=="channelsFirst")throw new Error("Unknown dataFormat "+u);h=r[0],m=r[1],f=r[2],p=r[3]}var v,b=e[0],C=e[1],w=e[3],E=Lg(t),S=E[0],A=E[1],k=Lg(n),O=k[0],V=k[1],T=yc(b,O),R=yc(C,V),N=function(Z,rt,q,K,Q,ut,W,et){var dt,lt,St;if(typeof Z=="number"){var Nt=Z===0?"VALID":"NUMBER";dt={top:Z,bottom:Z,left:Z,right:Z,type:Nt};var Rt=function(se,Jt,ze,Ae,Ke){Ae==null&&(Ae=Ux(se,Jt,ze));var Dr=se[0],En=se[1],In=Wf((Dr-Jt+2*Ae)/ze+1,Ke);$(wn(In),function(){return"The output # of rows ("+In+") must be an integer. Change the stride and/or zero pad parameters"});var un=Wf((En-Jt+2*Ae)/ze+1,Ke);return $(wn(un),function(){return"The output # of columns ("+un+") must be an integer. Change the stride and/or zero pad parameters"}),[In,un]}([rt,q],ut,K,Z,et);lt=Rt[0],St=Rt[1]}else if(Z==="same"){lt=Math.ceil(rt/K),St=Math.ceil(q/Q);var Ut=Math.max(0,(lt-1)*K+ut-rt),Pt=Math.max(0,(St-1)*Q+W-q),Xt=Math.floor(Ut/2),Le=Ut-Xt,Zt=Math.floor(Pt/2),ye=Pt-Zt;dt={top:Xt,bottom:Le,left:Zt,right:ye,type:"SAME"}}else{if(Z!=="valid")throw Error("Unknown padding parameter: "+Z);dt={top:0,bottom:0,left:0,right:0,type:"VALID"},lt=Math.ceil((rt-ut+1)/K),St=Math.ceil((q-W+1)/Q)}return{padInfo:dt,outHeight:lt,outWidth:St}}(i,f,p,S,A,T,R,a),D=N.padInfo,L=N.outHeight,P=N.outWidth,B=o?w*m:w;return u==="channelsFirst"?v=[h,B,L,P]:u==="channelsLast"&&(v=[h,L,P,B]),{batchSize:h,dataFormat:u,inHeight:f,inWidth:p,inChannels:m,outHeight:L,outWidth:P,outChannels:B,padInfo:D,strideHeight:S,strideWidth:A,filterHeight:b,filterWidth:C,effectiveFilterHeight:T,effectiveFilterWidth:R,dilationHeight:O,dilationWidth:V,inShape:r,outShape:v,filterShape:e}}function dd(r,e,t,n,i,a,o,u){a===void 0&&(a=!1),o===void 0&&(o="channelsLast");var l=[-1,-1,-1,-1,-1],h=l[0],f=l[1],p=l[2],m=l[3],v=l[4];if(o==="channelsLast")h=r[0],f=r[1],p=r[2],m=r[3],v=r[4];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);h=r[0],v=r[1],f=r[2],p=r[3],m=r[4]}var b,C=e[0],w=e[1],E=e[2],S=e[4],A=Qb(t),k=A[0],O=A[1],V=A[2],T=Qb(n),R=T[0],N=T[1],D=T[2],L=yc(C,R),P=yc(w,N),B=yc(E,D),Z=function(W,et,dt,lt,St,Nt,Rt,Ut,Pt,Xt,Le){var Zt,ye,se,Jt;if(typeof W=="number"){var ze=W===0?"VALID":"NUMBER";Zt={top:W,bottom:W,left:W,right:W,front:W,back:W,type:ze};var Ae=function(fe,le,dn,Re,Ei,Hr){Ei==null&&(Ei=Ux(fe,le,Re));var Fi=fe[0],Bi=fe[1],ji=fe[2],lr=Wf((Fi-le+2*Ei)/Re+1,Hr);$(wn(lr),function(){return"The output # of depths ("+lr+") must be an integer. Change the stride and/or zero pad parameters"});var ca=Wf((Bi-le+2*Ei)/Re+1,Hr);$(wn(ca),function(){return"The output # of rows ("+ca+") must be an integer. Change the stride and/or zero pad parameters"});var Ui=Wf((ji-le+2*Ei)/Re+1,Hr);return $(wn(Ui),function(){return"The output # of columns ("+Ui+") must be an integer. Change the stride and/or zero pad parameters"}),[lr,ca,Ui,dn]}([et,dt,lt,1],Ut,1,St,W,Le);ye=Ae[0],se=Ae[1],Jt=Ae[2]}else if(W==="same"){ye=Math.ceil(et/St),se=Math.ceil(dt/Nt),Jt=Math.ceil(lt/Rt);var Ke=(ye-1)*St+Ut-et,Dr=(se-1)*Nt+Pt-dt,En=(Jt-1)*Rt+Xt-lt,In=Math.floor(Ke/2),un=Ke-In,Er=Math.floor(Dr/2),re=Dr-Er,Un=Math.floor(En/2),ln=En-Un;Zt={top:Er,bottom:re,left:Un,right:ln,front:In,back:un,type:"SAME"}}else{if(W!=="valid")throw Error("Unknown padding parameter: "+W);Zt={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},ye=Math.ceil((et-Ut+1)/St),se=Math.ceil((dt-Pt+1)/Nt),Jt=Math.ceil((lt-Xt+1)/Rt)}return{padInfo:Zt,outDepth:ye,outHeight:se,outWidth:Jt}}(i,f,p,m,k,O,V,L,P,B,u),rt=Z.padInfo,q=Z.outDepth,K=Z.outHeight,Q=Z.outWidth,ut=a?S*v:S;return o==="channelsFirst"?b=[h,ut,q,K,Q]:o==="channelsLast"&&(b=[h,q,K,Q,ut]),{batchSize:h,dataFormat:o,inDepth:f,inHeight:p,inWidth:m,inChannels:v,outDepth:q,outHeight:K,outWidth:Q,outChannels:ut,padInfo:rt,strideDepth:k,strideHeight:O,strideWidth:V,filterDepth:C,filterHeight:w,filterWidth:E,effectiveFilterDepth:L,effectiveFilterHeight:P,effectiveFilterWidth:B,dilationDepth:R,dilationHeight:N,dilationWidth:D,inShape:r,outShape:b,filterShape:e}}function Ux(r,e,t,n){n===void 0&&(n=1);var i=yc(e,n);return Math.floor((r[0]*(t-1)-t+i)/2)}function Lg(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Qb(r){return typeof r=="number"?[r,r,r]:r}function yc(r,e){return e<=1?r:r+(r-1)*(e-1)}function Wf(r,e){if(!e)return r;switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function Qu(r){var e=Lg(r),t=e[0],n=e[1],i=e[2];return t===1&&n===1&&i===1}function jr(r,e){return Qu(r)||Qu(e)}function kv(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function Wx(r,e,t){if(e==="complex64"){if(r.dtype==="complex64")return r.clone();var n=Ue(r.shape),i=r.toFloat(),a=t.complex(i,n);return n.dispose(),i.dispose(),a}if(!SN(r.dtype,e))return J.makeTensorFromDataId(r.dataId,r.shape,e);if(r.dtype==="complex64"){var o=t.real(r);return a=o.cast(e),o.dispose(),a}if(e==="int32")return t.int(r);if(e==="bool"){var u=zt(0,r.dtype);return a=t.notEqual(r,u),u.dispose(),a}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+e)}function Pg(r,e){return J.makeTensorFromDataId(r.dataId,e,r.dtype)}function Hx(r,e,t){var n=(e-r)/(t-1),i=eh(t,"float32");i[0]=r;for(var a=1;a<i.length;a++)i[a]=i[a-1]+n;return Jr(i,"float32")}var Mj=Object.freeze({castTensor:Wx,reshapeTensor:Pg,linspaceImpl:Hx,upcastType:Pn,axesAreInnerMostDims:Tx,combineLocations:uI,computeOutAndReduceShapes:gr,expandShapeToKeepDim:vi,assertAxesAreInnerMostDims:Yr,getAxesPermutation:oa,getUndoAxesPermutation:wv,getInnerMostAxes:sa,getBroadcastDims:Vu,getReductionAxes:Bn,assertAndGetBroadcastShape:Ee,assertParamsConsistent:lI,computeOutShape:Xu,computePool2DInfo:Dc,computePool3DInfo:fd,computeConv2DInfo:Ks,computeConv3DInfo:dd,computeDefaultPad:Ux,tupleValuesAreOne:Qu,eitherStridesOrDilationsAreOne:jr,convertConv2DDataFormat:kv});function Zb(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+e.length+".");for(var t=new Float32Array(2*r.length),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function AS(r,e){return{real:r[2*e],imag:r[2*e+1]}}function Lj(r,e,t,n){r[2*n]=e,r[2*n+1]=t}function Pj(r,e,t){var n=(t?2:-2)*Math.PI*(r/e);return{real:Math.cos(n),imag:Math.sin(n)}}function qx(r,e,t,n,i){for(var a=Array.from(e).map(function(v,b){return{score:v,boxIndex:b}}).filter(function(v){return v.score>i}).sort(function(v,b){return b.score-v.score}),o=[],u=0;u<a.length;u++){var l=a[u],h=l.score,f=l.boxIndex;if(h<i)break;for(var p=!1,m=o.length-1;m>=0;--m)if(zj(r,f,o[m])>=n){p=!0;break}if(!p&&(o.push(f),o.length>=t))break}return Jr(o,"int32")}function zj(r,e,t){var n=r.subarray(4*e,4*e+4),i=r.subarray(4*t,4*t+4),a=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),u=Math.max(n[0],n[2]),l=Math.max(n[1],n[3]),h=Math.min(i[0],i[2]),f=Math.min(i[1],i[3]),p=Math.max(i[0],i[2]),m=Math.max(i[1],i[3]),v=(u-a)*(l-o),b=(p-h)*(m-f);if(v<=0||b<=0)return 0;var C=Math.max(a,h),w=Math.max(o,f),E=Math.min(u,p),S=Math.min(l,m),A=Math.max(E-C,0)*Math.max(S-w,0);return A/(v+b-A)}function NI(r,e,t){var n=new Array(r.rank).fill(0),i=r.shape.slice();return e.map(function(a){i[t]=a;var o=r.slice(n,i);return n[t]+=a,o})}function II(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];var i=ie(t,r.dtype);for(n=0;n<i.values.length;++n){for(var a=i.indexToLoc(n),o=new Array(r.rank),u=0;u<o.length;u++)o[u]=a[u]%r.shape[u];var l=r.locToIndex(o);i.values[n]=r.values[l]}return i.toTensor()}function kI(r,e,t,n,i){for(var a=e[e.length-1],o=[r.length/a,a],u=o[0],l=o[1],h=id(t,u*n),f=id("int32",u*n),p=0;p<u;p++){for(var m=p*l,v=r.subarray(m,m+l),b=[],C=0;C<v.length;C++)b.push({value:v[C],index:C});b.sort(function(k,O){return O.value-k.value});var w=p*n,E=h.subarray(w,w+n),S=f.subarray(w,w+n);for(C=0;C<n;C++)E[C]=b[C].value,S[C]=b[C].index}var A=e.slice();return A[A.length-1]=n,[Rn(h,A,t),Rn(f,A,"int32")]}function Gx(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);var i=ie(r,"int32"),a=ie([t.length,r.length],"int32");for(n=0;n<t.length;n++){var o=i.indexToLoc(t[n]),u=n*r.length;a.values.set(o,u)}return a.toTensor()}var Vj=function(){return function(r,e){this.outputShape=[],this.outputShape=r,this.variableNames=e.map(function(i,a){return"T"+a});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+n+`;
        setOutput(result);
      }
    `}}(),Fj=function(){return function(r,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=e.map(function(i,a){return"T"+a});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+n+`;
        setOutput(result);
      }
    `}}(),Bj=function(){return function(r,e,t){this.variableNames=["A"];var n=r.windowSize,i=r.batchSize,a=r.inSize,o=Math.ceil(a/n);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var u=e==="max"?">":"<",l=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+n+`; i++) {
          int inIdx = `+l+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+u+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}();function DI(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return r+"."+t})}function Zr(r,e){return e===1?[r]:DI(r,e)}function Nr(){var r,e,t,n,i,a,o,u,l,h;return gt().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",i="texture",a="outputColor",o="out vec4 outputColor;",u=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",i="texture2D",a="gl_FragColor",o="",u=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:u,defineSpecialInf:l,defineRound:h}}function Fu(r,e,t){t===void 0&&(t="index");var n=qs(e);return n.map(function(i,a){return"int "+r[a]+" = "+t+" / "+i+"; "+(a===n.length-1?"int "+r[a+1]+" = "+t+" - "+r[a]+" * "+i:"index -= "+r[a]+" * "+i)+";"}).join("")}function $x(r){var e=qs(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var OI=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function jj(r,e,t,n){var i=[];r.forEach(function(v){var b=jt(v.shapeInfo.logicalShape);v.shapeInfo.isUniform?i.push("uniform float "+v.name+(b>1?"["+b+"]":"")+";"):(i.push("uniform sampler2D "+v.name+";"),i.push("uniform int offset"+v.name+";"))});var a,o,u=i.join(`
`),l=r.map(function(v){return function(b,C,w){w===void 0&&(w=!1);var E="";E+=w?MI(b):hc(b);var S=b.shapeInfo.logicalShape,A=C.logicalShape;return S.length<=A.length&&(E+=w?function(k,O){var V,T=k.name,R=T.charAt(0).toUpperCase()+T.slice(1),N="get"+R+"AtOutCoords",D=k.shapeInfo.logicalShape.length,L=O.logicalShape.length,P=Vu(k.shapeInfo.logicalShape,O.logicalShape),B=rn(L),Z=L-D,rt=["x","y","z","w","u","v"];V=D===0?"":L<2&&P.length>=1?"coords = 0;":P.map(function(dt){return"coords."+rt[dt+Z]+" = 0;"}).join(`
`);var q="";q=L<2&&D>0?"coords":k.shapeInfo.logicalShape.map(function(dt,lt){return"coords."+rt[lt+Z]}).join(", ");var K="return outputValue;",Q=jt(k.shapeInfo.logicalShape)===1,ut=jt(O.logicalShape)===1;if(D!==1||Q||ut){if(Q&&!ut)K=L===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(P.length){var W=D-2,et=D-1;P.indexOf(W)>-1&&P.indexOf(et)>-1?K="return vec4(outputValue.x);":P.indexOf(W)>-1?K="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":P.indexOf(et)>-1&&(K="return vec4(outputValue.xx, outputValue.zz);")}}else K=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+N+`() {
      `+B+` coords = getOutputCoords();
      `+V+`
      vec4 outputValue = get`+R+"("+q+`);
      `+K+`
    }
  `}(b,C):function(k,O){var V=k.name,T=V.charAt(0).toUpperCase()+V.slice(1),R="get"+T+"AtOutCoords",N=O.texShape,D=k.shapeInfo.texShape,L=k.shapeInfo.logicalShape.length,P=O.logicalShape.length;if(!k.shapeInfo.isUniform&&L===P&&k.shapeInfo.flatOffset==null&&or(D,N))return`
      float `+R+`() {
        return sampleTexture(`+V+`, resultUV);
      }
    `;var B,Z=rn(P),rt=Vu(k.shapeInfo.logicalShape,O.logicalShape),q=P-L,K=["x","y","z","w","u","v"];B=L===0?"":P<2&&rt.length>=1?"coords = 0;":rt.map(function(ut){return"coords."+K[ut+q]+" = 0;"}).join(`
`);var Q="";return Q=P<2&&L>0?"coords":k.shapeInfo.logicalShape.map(function(ut,W){return"coords."+K[W+q]}).join(", "),`
    float `+R+`() {
      `+Z+` coords = getOutputCoords();
      `+B+`
      return get`+T+"("+Q+`);
    }
  `}(b,C)),E}(v,e,n)}).join(`
`),h=e.texShape,f=Nr(),p=function(v){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+v.texture2D+`(textureSampler, uv).r;
    }
  `}(f),m=function(v){return v.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+v.varyingFs+` vec2 resultUV;
    `+v.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+v.defineSpecialNaN+`
    `+v.defineSpecialInf+`
    `+v.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Uj+`
    `+Wj+`
    `+Hj+`
  `}(f);return e.isPacked?(a=function(v,b){switch(v.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(k,O){var V=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)];return V[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+V[1]+`.0);
      }
    `:V[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+V[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+V[0]+", "+V[1]+`));
      return 2 * (resTexRC.x * `+V[1]+` + resTexRC.y);
    }
  `}(0,b);case 2:return function(k,O){var V=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)];if(or(k,O))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+V[0]+", "+V[1]+`));
      }
    `;var T=Math.ceil(k[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+V[0]+", "+V[1]+`));

      int index = resTexRC.x * `+V[1]+` + resTexRC.y;
      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec2(r, c);
    }
  `}(v,b);case 3:return C=v,w=b,E=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)],S=Math.ceil(C[2]/2),A=S*Math.ceil(C[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      int index = resTexRC.x * `+E[1]+` + resTexRC.y;

      int b = index / `+A+`;
      index -= b * `+A+`;

      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(k,O){for(var V=[Math.ceil(O[0]/2),Math.ceil(O[1]/2)],T=Math.ceil(k[k.length-1]/2),R=T*Math.ceil(k[k.length-2]/2),N=R,D="",L="b, r, c",P=2;P<k.length-1;P++)N*=k[k.length-P-1],D=`
      int b`+P+" = index / "+N+`;
      index -= b`+P+" * "+N+`;
    `+D,L="b"+P+", "+L;return`
    ivec`+k.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+V[0]+", "+V[1]+`));
      int index = resTexRC.x * `+V[1]+` + resTexRC.y;

      `+D+`

      int b = index / `+R+`;
      index -= b * `+R+`;

      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec`+k.length+"("+L+`);
    }
  `}(v,b)}var C,w,E,S,A}(e.logicalShape,h),o=function(v){return`
    void setOutput(vec4 val) {
      `+v.output+` = val;
    }
  `}(f)):(a=function(v,b){switch(v.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(E,S){return S[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+S[1]+`.0);
      }
    `:S[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+S[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+S[0]+", "+S[1]+`));
      return resTexRC.x * `+S[1]+` + resTexRC.y;
    }
  `}(0,b);case 2:return function(E,S){return or(E,S)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+S[0]+", "+S[1]+`));
      }
    `:E[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+S[0]+", "+S[1]+`));
        int index = resTexRC.x * `+S[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:E[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+S[0]+", "+S[1]+`));
        int index = resTexRC.x * `+S[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+S[0]+", "+S[1]+`));
      int index = resTexRC.x * `+S[1]+` + resTexRC.y;
      int r = index / `+E[1]+`;
      int c = index - r * `+E[1]+`;
      return ivec2(r, c);
    }
  `}(v,b);case 3:return C=b,w=Fu(["r","c","d"],v),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      `+w+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(E,S){var A=Fu(["r","c","d","d2"],E);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+S[0]+", "+S[1]+`));
      int index = resTexRC.x * `+S[1]+` + resTexRC.y;
      `+A+`
      return ivec4(r, c, d, d2);
    }
  `}(v,b);case 5:return function(E,S){var A=Fu(["r","c","d","d2","d3"],E);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+S[0]+`,
                             `+S[1]+`));

      int index = resTexRC.x * `+S[1]+` + resTexRC.y;

      `+A+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(v,b);case 6:return function(E,S){var A=Fu(["r","c","d","d2","d3","d4"],E);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+S[0]+", "+S[1]+`));
      int index = resTexRC.x * `+S[1]+` + resTexRC.y;

      `+A+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(v,b);default:throw new Error(v.length+"-D output sampling is not yet supported")}var C,w}(e.logicalShape,h),o=function(v){return`
    void setOutput(float val) {
      `+v.output+` = vec4(val, 0, 0, 0);
    }
  `}(f)),n&&(m+=qj),[m,p,o,u,a,l,t].join(`
`)}function hc(r){var e=r.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+n+";}";var a=t.shapeInfo.texShape,o=a[0],u=a[1];if(o===1&&u===1)return`
      float `+i+`() {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var l=t.shapeInfo.texShape,h=l[0],f=l[1],p=Au(n);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+h+", "+f+", "+p+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 1:return function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+ac(t)+`
      }
    `;var a=t.shapeInfo.texShape,o=a[0],u=a[1];if(u===1&&o===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var l=Au(n);return u===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+l+") + 0.5) / "+o+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:o===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+l+") + 0.5) / "+u+`.0, 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+o+", "+u+", index + "+l+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 2:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=t.shapeInfo.texShape;if(o!=null&&or(n,o)){var u=o[0],l=o[1];return`
    float `+a+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+u+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var h=ys(n),f=h.newShape,p=h.keptDims,m=f;if(m.length<n.length){var v=fc(t,m);return`
      `+hc(v)+`
      float `+a+`(int row, int col) {
        return `+a+"("+dc(["row","col"],p)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+n[1]+`, 1)));
        `+ac(t)+`
      }
    `;var b=o[0],C=o[1],w=Au(i);return C===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+w+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+b+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:b===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+w+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+C+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+a+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+n[1]+" + col + "+w+`;
    vec2 uv = uvFromFlat(`+b+", "+C+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(r);case 3:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[1]*n[2],u=n[2],l=ys(n),h=l.newShape,f=l.keptDims,p=h;if(p.length<n.length){var m=fc(t,p);return`
        `+hc(m)+`
        float `+a+`(int row, int col, int depth) {
          return `+a+"("+dc(["row","col","depth"],f)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+o+", "+u+`, 1)));
        `+ac(t)+`
      }
    `;var v=t.shapeInfo.texShape,b=v[0],C=v[1],w=t.shapeInfo.flatOffset;if(C===o&&w==null)return`
        float `+a+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+u+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+C+".0, "+b+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(C===u&&w==null)return`
    float `+a+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+n[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+C+".0, "+b+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var E=Au(i);return`
      float `+a+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+o+" + col * "+u+" + depth + "+E+`;
        vec2 uv = uvFromFlat(`+b+", "+C+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(r);case 4:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[3],u=n[2]*o,l=n[1]*u,h=ys(n),f=h.newShape,p=h.keptDims;if(f.length<n.length){var m=fc(t,f);return`
      `+hc(m)+`
      float `+a+`(int row, int col, int depth, int depth2) {
        return `+a+"("+dc(["row","col","depth","depth2"],p)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+l+", "+u+", "+o+`, 1)));
        `+ac(t)+`
      }
    `;var v=t.shapeInfo.flatOffset,b=t.shapeInfo.texShape,C=b[0],w=b[1];if(w===l&&v==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+u+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+w+".0, "+C+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(w===o&&v==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n[1]*n[2]+", "+n[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+w+".0, "+C+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var E=Au(i);return`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+` +
          depth * `+o+` + depth2;
      vec2 uv = uvFromFlat(`+C+", "+w+", index + "+E+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);case 5:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[4],u=n[3]*o,l=n[2]*u,h=n[1]*l,f=ys(n),p=f.newShape,m=f.keptDims;if(p.length<n.length){var v=fc(t,p);return`
      `+hc(v)+`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        return `+a+"("+dc(["row","col","depth","depth2","depth3"],m)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+h+", "+l+", "+u+", "+o+`)) +
          depth3;
        `+ac(t)+`
      }
    `;var b=t.shapeInfo.flatOffset,C=t.shapeInfo.texShape,w=C[0],E=C[1];if(E===h&&b==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+l+", "+u+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+E+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(E===o&&b==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]+`,
               `+n[2]*n[3]+", "+n[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+E+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var S=Au(i);return`
    float `+a+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+h+" + col * "+l+" + depth * "+u+` +
          depth2 * `+o+" + depth3 + "+S+`;
      vec2 uv = uvFromFlat(`+w+", "+E+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);case 6:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=ys(n),u=o.newShape,l=o.keptDims;if(u.length<n.length){var h=fc(t,u);return`
      `+hc(h)+`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+a+"("+dc(["row","col","depth","depth2","depth3","depth4"],l)+`);
      }
    `}var f=n[5],p=n[4]*f,m=n[3]*p,v=n[2]*m,b=n[1]*v;if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+b+", "+v+", "+m+", "+p+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+f+`, 1)));
        `+ac(t)+`
      }
    `;var C=t.shapeInfo.flatOffset,w=t.shapeInfo.texShape,E=w[0],S=w[1];if(S===b&&C==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+v+", "+m+", "+p+", "+f+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+S+".0, "+E+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(S===f&&C==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]*n[4]+`,
               `+n[2]*n[3]*n[4]+`,
               `+n[3]*n[4]+`,
               `+n[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+S+".0, "+E+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var A=Au(i);return`
    float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+b+" + col * "+v+" + depth * "+m+` +
          depth2 * `+p+" + depth3 * "+f+" + depth4 + "+A+`;
      vec2 uv = uvFromFlat(`+E+", "+S+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function MI(r){var e,t,n;switch(r.shapeInfo.logicalShape.length){case 0:return e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=Nr(),`
    vec4 `+t+`() {
      return `+n.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var a=i.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=Nr();return`
    vec4 `+o+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+l[0]+", "+l[1]+`, index);
      return `+h.texture2D+"("+a+`, uv);
    }
  `}(r);case 2:return function(i){var a=i.shapeInfo.logicalShape,o=i.name,u="get"+o.charAt(0).toUpperCase()+o.slice(1),l=i.shapeInfo.texShape,h=l[0],f=l[1],p=Nr();if(l!=null&&or(a,l))return`
      vec4 `+u+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+f+".0, "+h+`.0);

        return `+p.texture2D+"("+o+`, uv);
      }
    `;var m=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],v=Math.ceil(a[1]/2);return`
    vec4 `+u+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+v+", "+m[0]+", "+m[1]+`, row, col);
      return `+p.texture2D+"("+o+`, uv);
    }
  `}(r);case 3:return function(i){var a=i.shapeInfo.logicalShape,o=i.name,u="get"+o.charAt(0).toUpperCase()+o.slice(1),l=i.shapeInfo.texShape,h=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];if(a[0]===1){var f=a.slice(1),p=fc(i,f);return`
        `+MI(p)+`
        vec4 `+u+`(int b, int row, int col) {
          return `+u+"("+dc(["b","row","col"],[1,2])+`);
        }
      `}var m=h[0],v=h[1],b=Math.ceil(a[2]/2),C=b*Math.ceil(a[1]/2),w=Nr();return`
    vec4 `+u+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+m+", "+v+", "+C+", "+b+`, b, row, col);
      return `+w.texture2D+"("+o+`, uv);
    }
  `}(r);default:return function(i){for(var a=i.shapeInfo.logicalShape,o=a.length,u=i.name,l="get"+u.charAt(0).toUpperCase()+u.slice(1),h=i.shapeInfo.texShape,f=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)],p=f[0],m=f[1],v=Math.ceil(a[o-1]/2),b=v*Math.ceil(a[o-2]/2),C="int b, int row, int col",w="b * "+b+" + (row / 2) * "+v+" + (col / 2)",E=2;E<o-1;E++)C="int b"+E+", "+C,b*=a[o-E-1],w="b"+E+" * "+b+" + "+w;var S=Nr();return`
    vec4 `+l+"("+C+`) {
      int index = `+w+`;
      int texR = index / `+m+`;
      int texC = index - texR * `+m+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+m+", "+p+`);
      return `+S.texture2D+"("+u+`, uv);
    }
  `}(r)}}var Uj=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Wj=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Hj=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,qj=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Au(r){return"offset"+r}function ac(r){var e=r.name,t=jt(r.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function rn(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function fc(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function dc(r,e){return e.map(function(t){return r[t]}).join(", ")}var Gj=function(){return function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,$(r.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=r[r.length-1],a=Math.ceil(i/e);this.outputShape=r.slice(0,-1),a>1&&this.outputShape.push(a),n||this.variableNames.push("bestIndicesA");var o,u,l=this.outputShape,h=l.length,f=rn(h),p=Zr("coords",h);if(a===1){var m=rn(u=h+1);o=`
        `+m+" sourceLocR = "+m+"("+p.join()+`, 0);
        ++`+p[h-1]+`;
        `+m+" sourceLocG = "+m+"("+p.join()+`, 0);
        ++`+p[h-2]+`;
        `+m+" sourceLocA = "+m+"("+p.join()+`, 0);
        --`+p[h-1]+`;
        `+m+" sourceLocB = "+m+"("+p.join()+`, 0);
        --`+p[h-2]+";"}else u=h,o=`
        `+f+` sourceLocR = coords;
        ++`+p[h-1]+`;
        `+f+` sourceLocG = coords;
        ++`+p[h-2]+`;
        `+f+` sourceLocA = coords;
        --`+p[h-1]+`;
        `+f+` sourceLocB = coords;
        --`+p[h-2]+";";var v=["x","y","z","w","u","v"].slice(0,u),b="."+v[u-1],C=v.map(function(R){return"int "+R}),w=Zr("sourceLocR",u-1).concat("inIdx.r"),E=Zr("sourceLocG",u-1).concat("inIdx.g"),S=Zr("sourceLocB",u-1).concat("inIdx.b"),A=Zr("sourceLocA",u-1).concat("inIdx.a"),k=t==="max"?"greaterThan":"lessThan",O=n?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+w.join()+`),
                             getBestIndicesAChannel(`+E.join()+`),
                             getBestIndicesAChannel(`+S.join()+`),
                             getBestIndicesAChannel(`+A.join()+")));",V=`vec4(
            getAChannel(`+w.join()+`),
            hasNextCol ? getAChannel(`+E.join()+`) : 0.,
            hasNextRow ? getAChannel(`+S.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+A.join()+") : 0.)",T=n?"":`
      float getBestIndicesAChannel(`+C.join()+`) {
        return getChannel(getBestIndicesA(`+v.join()+`),
                                          vec2(`+v.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+C.join()+`) {
        return getChannel(getA(`+v.join()+`),
                               vec2(`+v.slice(-2).join()+`));
      }
      `+T+`
      void main() {
        `+f+` coords = getOutputCoords();
        bool hasNextCol = `+p[h-1]+" < "+(l[h-1]-1)+`;
        bool hasNextRow = `+p[h-2]+" < "+(l[h-2]-1)+`;
        `+o+`
        ivec4 srcIdx = ivec4(sourceLocR`+b+", sourceLocG"+b+`,
          sourceLocB`+b+", sourceLocA"+b+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+V+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+O+`
          vec4 candidate = `+V+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+k+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}(),$j=function(){return function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,a=r.dilationHeight,o=r.dilationWidth,u=r.effectiveFilterHeight,l=r.effectiveFilterWidth,h=u-1-r.padInfo.top,f=l-1-r.padInfo.left,p=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+h+", "+f+`);
      const float avgMultiplier = float(`+p+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+l+`;
            wC+= `+o+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}(),Kj=function(){return function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,i=r.strideDepth,a=r.strideHeight,o=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,h=r.dilationWidth,f=r.effectiveFilterDepth,p=r.effectiveFilterHeight,m=r.effectiveFilterWidth,v=f-1-r.padInfo.front,b=p-1-r.padInfo.top,C=m-1-r.padInfo.left,w=1/(e*t*n);this.userCode=`
      const ivec3 pads = ivec3(`+v+", "+b+", "+C+`);
      const float avgMultiplier = float(`+w+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+f+`;
            wD += `+u+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+p+`;
              wR += `+l+`) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+m+`;
                wC += `+h+`) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),Xj=function(){return function(r,e,t,n,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Ee(r,e),Ee(r,t);var o="0.0";n!=null&&(Ee(r,n),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var u="1.0";i!=null&&(Ee(r,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+o+`;
        float scale = `+u+`;
        float inv = scale * inversesqrt(variance + float(`+a+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}(),Yj=function(){return function(r,e,t,n,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ee(r,e),Ee(r,t);var o="vec4(0.0)";n!=null&&(Ee(r,n),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(Ee(r,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+o+`;
        vec4 scale = `+u+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+a+`));

        setOutput((x - mean) * inv + offset);
      }
    `}}(),Qj="return areal * breal - aimag * bimag;",Zj="return areal * bimag + aimag * breal;",RS=function(){return function(r,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ee(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}(),z1="return a + b;",V1="return a - b;",NS="return a * b;",LI="return (a < 0.) ? b * a : a;",xn=function(){return function(r,e,t){this.variableNames=["A","B"],this.outputShape=Ee(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}(),PI=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,yo=function(){return function(r,e,t,n){n===void 0&&(n=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ee(e,t);var i=this.outputShape.length,a="";if(n)if(i===0||jt(this.outputShape)===1)a=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(a=`
          `+rn(i)+` coords = getOutputCoords();
        `,i===1)a+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var o=Zr("coords",i);a+=`
            bool nextRowOutOfBounds =
              (`+o[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+o[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+a+`

        setOutput(result);
      }
    `}}(),Jj=function(){function r(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,a){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(a,"maxVal")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r}(),tU=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,a){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(a,"maxVal")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r}(),eU=function(){return function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}(),nU=function(){return function(r){this.outputShape=[],this.outputShape=Xu(r,1),this.variableNames=r.map(function(u,l){return"T"+l});var e=new Array(r.length-1);e[0]=r[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+r[t][1];var n=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];n.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var a=e.length,o=e[e.length-1];n.push("else setOutput(getT"+a+"(yR, yC-"+o+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+n.join(`
        `)+`
      }
    `}}(),rU=function(){return function(r,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Xu(r,e);var t=this.outputShape,n=t.length,i=rn(n),a=Zr("coords",n),o=["x","y","z","w","u","v"].slice(0,n);this.variableNames=r.map(function(w,E){return"T"+E});var u=new Array(r.length-1);u[0]=r[0][e];for(var l=1;l<u.length;l++)u[l]=u[l-1]+r[l][e];var h=o[e],f=o.slice(-2),p=o.join(),m="if ("+h+" < "+u[0]+`) {
        return getChannel(
            getT0(`+p+"), vec2("+f.join()+`));
        }`;for(l=1;l<u.length;l++){var v=u[l-1];m+=`
        if (`+h+" < "+u[l]+"  && "+h+" >= "+u[l-1]+`) {
          return getChannel(
            getT`+l+"("+Im(o,h,v)+`),
            vec2(`+Im(f,h,v)+`));
        }`}var b=u.length,C=u[u.length-1];m+=`
        return getChannel(
          getT`+b+"("+Im(o,h,C)+`),
          vec2(`+Im(f,h,C)+"));",this.userCode=`
      float getValue(`+o.map(function(w){return"int "+w})+`) {
        `+m+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+a+`), 0., 0., 0.);

        `+a[n-1]+" = "+a[n-1]+` + 1;
        if (`+a[n-1]+" < "+t[n-1]+`) {
          result.g = getValue(`+a+`);
        }

        `+a[n-2]+" = "+a[n-2]+` + 1;
        if (`+a[n-2]+" < "+t[n-2]+`) {
          result.a = getValue(`+a+`);
        }

        `+a[n-1]+" = "+a[n-1]+` - 1;
        if (`+a[n-2]+" < "+t[n-2]+` &&
            `+a[n-1]+" < "+t[n-1]+`) {
          result.b = getValue(`+a+`);
        }
        setOutput(result);
      }
    `}}();function Im(r,e,t){var n=r.indexOf(e);return r.map(function(i,a){return a===n?i+" - "+t:i}).join()}var iU=function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,a=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+a+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),aU=function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,a=r.dataFormat==="channelsLast",o=e-1-r.padInfo.top,u=t-1-r.padInfo.left,l=a?1:2,h=a?2:3,f=a?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+f+`];

        ivec2 dyCorner = ivec2(coords[`+l+"], coords["+h+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+a+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),oU=function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,i=r.padInfo.front,a=r.padInfo.top,o=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+a+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+n+" - "+o+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),sU=function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,i=r.strideDepth,a=r.strideHeight,o=r.strideWidth,u=e-1-r.padInfo.front,l=t-1-r.padInfo.top,h=n-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+l+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+n+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+n+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),uU=function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,a=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+a+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),lU=function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,a=e-1-r.padInfo.top,o=t-1-r.padInfo.left,u=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+u+`; dm++) {
              int d2 = d1 * `+u+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),IS=function(){return function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.padInfo.top,a=r.padInfo.left,o=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,h=r.dilationWidth,f=r.filterHeight,p=r.filterWidth,m=4*Math.floor(r.inChannels/4),v=r.inChannels%4,b=r.dataFormat==="channelsLast",C=b?1:2,w=b?2:3,E=b?3:1,S="",A="";t&&(S=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,A="result = activation(result);");var k=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+S+`

      const ivec2 strides = ivec2(`+o+", "+u+`);
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+E+`];

        ivec2 xRCCorner =
            ivec2(coords[`+C+"], coords["+w+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+m+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+b+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(v===1)+`) {

              if (`+b+`) {
                dotProd +=
                    getX(batch, xR, xC, `+m+`) *
                    getW(wR, wC, `+m+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+m+`, xR, xC) *
                    getW(wR, wC, `+m+`, d2);
              }

            } else if (`+(v===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+m+`, d2),
                getW(wR, wC, `+m+` + 1, d2)
              );

              if (`+b+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+m+`),
                  getX(batch, xR, xC, `+m+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+m+`, xR, xC),
                  getX(batch, `+m+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(v===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+m+`, d2),
                getW(wR, wC, `+m+` + 1, d2),
                getW(wR, wC, `+m+` + 2, d2)
              );

              if (`+b+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+m+`),
                  getX(batch, xR, xC, `+m+` + 1),
                  getX(batch, xR, xC, `+m+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+m+`, xR, xC),
                  getX(batch, `+m+` + 1, xR, xC),
                  getX(batch, `+m+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+k+`
        `+A+`
        setOutput(result);
      }
    `}}(),cU=function(){return function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var e=r.padInfo.front,t=r.padInfo.top,n=r.padInfo.left,i=r.strideDepth,a=r.strideHeight,o=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,h=r.dilationWidth,f=r.filterDepth,p=r.filterHeight,m=r.filterWidth,v=4*Math.floor(r.inChannels/4),b=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+a+", "+o+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+n+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+f+`; wF++) {
          int xF = xFCorner + wF * `+u+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`; wR++) {
            int xR = xRCorner + wR * `+l+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+m+`; wC++) {
              int xC = xCCorner + wC * `+h+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+v+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(b===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+v+`) *
                  getW(wF, wR, wC, `+v+`, d2);
              } else if (`+(b===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+v+`),
                  getX(batch, xF, xR, xC, `+v+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+v+`, d2),
                  getW(wF, wR, wC, `+v+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(b===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+v+`),
                  getX(batch, xF, xR, xC, `+v+` + 1),
                  getX(batch, xF, xR, xC, `+v+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+v+`, d2),
                  getW(wF, wR, wC, `+v+` + 1, d2),
                  getW(wF, wR, wC, `+v+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),kS=function(){return function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.inHeight,a=r.inWidth,o=r.padInfo.top,u=r.padInfo.left,l=r.strideHeight,h=r.strideWidth,f=r.dilationHeight,p=r.dilationWidth,m=r.filterHeight,v=r.filterWidth,b=r.outChannels/r.inChannels,C="",w="";t&&(C=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,w="result = activation(result);");var E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+C+`

      const ivec2 strides = ivec2(`+l+", "+h+`);
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+b+`;
        int q = d2 - d1 * `+b+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+m+`; wR++) {
          int xR = xRCorner + wR * `+f+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC++) {
            int xC = xCCorner + wC * `+p+`;

            if (xC < 0 || xC >= `+a+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+E+`
        `+w+`
        setOutput(result);
      }
    `}}(),DS=function(){return function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var i=r.inHeight,a=r.inWidth,o=r.padInfo.top,u=r.padInfo.left,l=r.strideHeight,h=r.strideWidth,f=r.dilationHeight,p=r.dilationWidth,m=r.filterHeight,v=r.filterWidth,b=v,C="int xR; int xC; int xCOffset;",w=0;w<m;w++)for(var E=0;E<v;E++)C+=`
          vec4 xTexelR`+w+"C"+2*E+` = vec4(0.);
          vec4 wR`+w+"C"+E+` = vec4(0.);
          vec4 xR`+w+"C"+E+" = vec4(0.);";for(w=0;w<m;w++)for(var S=0;S<b;S++){if(C+=`
          xR = xRCorner + `+w*f+`;
          xC = xCCorner + `+(E=2*S)*p+`;
        `,h===1){if(E<v&&(C+=u%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  xTexelR`+w+"C"+E+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+w+"C"+E+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);
                  xR`+w+"C"+E+" = vec4(previous.zw, xTexelR"+w+"C"+E+`.xy);
                } else {
                  xR`+w+"C"+E+" = vec4(0, 0, xTexelR"+w+"C"+E+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+a+`) {
                  xTexelR`+w+"C"+E+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+w+"C"+E+` = vec4(0.);
                }

                xR`+w+"C"+E+" = xTexelR"+w+"C"+E+`;
              `,E+1<v)){var A=u%2==0?yx(p):p;p%2==0&&u%2==1||p%2!=0&&u%2!=1?(C+=`
                  xCOffset = xC + `+u%2+" + "+A+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+w+"C"+(E+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,p>1&&(C+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+a+`) {
                      xTexelR`+w+"C"+E+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+w+"C"+E+` = vec4(0.);
                    }
                  `),C+=`
                  xR`+w+"C"+(E+1)+` = vec4(
                    xTexelR`+w+"C"+E+".zw, xTexelR"+w+"C"+(E+2)+`.xy);
                `):C+=`
                  xCOffset = xC + `+A+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+w+"C"+(E+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+w+"C"+(E+1)+" = xTexelR"+w+"C"+(E+2)+`;
                `}}else E<v&&(C+=`
              if(xR >= 0 && xR < `+i+`) {
            `,u%2==1?(C+=`
                xCOffset = xC + 1 - `+h+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+w+"C"+E+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+w+"C"+E+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+a+`) {
                  xTexelR`+w+"C"+(E+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+w+"C"+(E+2)+` = vec4(0.);
                }

                xR`+w+"C"+E+` = vec4(
                  xTexelR`+w+"C"+E+".zw, xTexelR"+w+"C"+(E+2)+`.zw);
              `,E+1<v&&(C+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+h+`;
                  if(xCOffset >= 0 && xCOffset < `+a+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+w+"C"+(E+1)+" = vec4(xTexelR"+w+"C"+(E+2)+`.xy, final.xy);
                `)):(C+=`
                if(xC >= 0 && xC < `+a+`) {
                  xTexelR`+w+"C"+E+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+w+"C"+E+` = vec4(0.);
                }

                xCOffset = xC + `+h+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+w+"C"+(E+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+w+"C"+(E+2)+` = vec4(0.);
                }

                xR`+w+"C"+E+` = vec4(
                  xTexelR`+w+"C"+E+".xy, xTexelR"+w+"C"+(E+2)+`.xy);
              `,E+1<v&&(C+=`
                  xR`+w+"C"+(E+1)+` = vec4(
                    xTexelR`+w+"C"+E+".zw, xTexelR"+w+"C"+(E+2)+`.zw);
                `)),C+="}");E<v&&(C+=`
            vec4 wTexelR`+w+"C"+E+" = getW("+w+", "+E+`, d1, q);
            wR`+w+"C"+E+" = vec4(wTexelR"+w+"C"+E+".xz, wTexelR"+w+"C"+E+`.xz);
          `,E+1<v&&(C+=`
              vec4 wTexelR`+w+"C"+(E+1)+" = getW("+w+", "+(E+1)+`, d1, q);
              wR`+w+"C"+(E+1)+` =
                vec4(wTexelR`+w+"C"+(E+1)+".xz, wTexelR"+w+"C"+(E+1)+".xz);"))}for(w=0;w<m;w++)for(E=0;E<v;E++)C+="dotProd += xR"+w+"C"+E+" * wR"+w+"C"+E+";";var k="",O="";t&&(k=n?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,O="result = activation(result);");var V=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+k+`

      const ivec2 strides = ivec2(`+l+", "+h+`);
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+C+`

        vec4 result = dotProd;
        `+V+`
        `+O+`
        setOutput(result);
      }
    `}}(),hU=function(){return function(r,e,t,n,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=r[0],o=r[1],u=r[2],l=r[3],h=e[0],f=t[0],p=t[1];this.outputShape=[h,f,p,l];var m=n==="bilinear"?1:0,v=[o-1+".0",u-1+".0"],b=v[0],C=v[1],w=f>1?[""+(o-1)/(f-1),"(y2-y1) * height_ratio","y1*"+b+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+b],E=w[0],S=w[1],A=w[2],k=p>1?[""+(u-1)/(p-1),"(x2-x1) * width_ratio","x1*"+C+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+C],O=k[0],V=k[1],T=k[2];this.userCode=`
      const float height_ratio = float(`+E+`);
      const float width_ratio = float(`+O+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+a+`) {
          return;
        }

        float height_scale = `+S+`;
        float width_scale = `+V+`;

        float in_y = `+A+`;
        if( in_y < 0.0 || in_y > `+b+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+T+`;
        if( in_x < 0.0 || in_x > `+C+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+m+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}(),fU=function(){return function(r,e,t){this.variableNames=["x"],this.outputShape=r;var n=r.length,i=r[r.length-1],a=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+rn(n)+` coords = getOutputCoords();
        int end = `+OS(n,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+a+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+OS(n,"coords")+` = idx;
          val += getX(`+function(o,u){if(o===1)return""+u;if(o===2)return u+".x, "+u+".y";if(o===3)return u+".x, "+u+".y, "+u+".z";if(o===4)return u+".x, "+u+".y, "+u+".z, "+u+".w";throw Error("Cumulative sum for rank "+o+" is not yet supported")}(n,"coords")+`);
        }
        setOutput(val);
      }
    `}}();function OS(r,e){if(r===1)return""+e;if(r===2)return e+".y";if(r===3)return e+".z";if(r===4)return e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var dU=function(){return function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=ud.DENSE;var e=Uf(r),t=Nr();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Fu(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `}}(),pU=function(){return function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=ud.DENSE;var e=Uf(r),t=Nr();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Fu(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `}}(),mU=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}(),gU=function(){return function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}(),vU=function(){return function(r){this.variableNames=["A"],this.outTexUsage=pi.DOWNLOAD;var e=Nr();this.outputShape=r,this.userCode=`
      `+OI+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `}}(),yU=function(){return function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=pi.DOWNLOAD;var e=Nr();this.outputShape=r,this.userCode=`
      `+OI+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `}}(),bU=function(){return function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var n=Nr(),i=e[0],a=e[1];this.outputShape=r;var o="result";t&&(o="floor(result * 255. + 0.5)"),this.userCode=`
      `+$x(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+a+`;
        int c = imod(flatIndex, `+a+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+i+`.0);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+o+`, 0., 0., 0.);
      }
    `}}(),xU=function(){return function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Nr(),i=e[0],a=e[1];this.outputShape=r;var o="",u="result";t&&(u="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var h=0;h<=1;h++){var f=2*l+h;o+=`
          localCoords = coords;
          if(localCoords[2] + `+h+" < "+r[2]+`) {
            localCoords[2] += `+h+`;
            if(localCoords[1] + `+l+" < "+r[1]+`) {
              localCoords[1] += `+l+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+a+`;
              c = imod(flatIndex, `+a+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+i+`.0);
              values = `+n.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+f+`] = values[0];
              } else if(offset == 1) {
                result[`+f+`] = values[1];
              } else if(offset == 2) {
                result[`+f+`] = values[2];
              } else {
                result[`+f+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+$x(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+o+`

        `+n.output+" = "+u+`;
      }
    `}}(),wU="return real * expR - imag * expI;",CU="return real * expI + imag * expR;",MS=function(){return function(r,e,t){this.variableNames=["real","imag"];var n=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=t?n+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+n+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+n+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+a+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}(),EU=function(){function r(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.valueLoc==null&&(t.valueLoc=n.getUniformLocationNoThrow(i,"value")),n.gl.uniform1f(t.valueLoc,e)}},r}(),_U=function(){return function(r){this.variableNames=["A"];var e=Nr(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}(),TU=function(){return function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Nr(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+n+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `}}(),SU=function(){return function(r,e,t){this.variableNames=["A","indices"];var n=r.slice();n[t]=e,this.outputShape=n,this.rank=n.length;var i=rn(this.rank),a=function(o,u){var l=o.length;if(l>4)throw Error("Gather for rank "+l+" is not yet supported");if(l===1)return"int(getIndices(resRC))";for(var h=["resRC.x","resRC.y","resRC.z","resRC.w"],f=[],p=0;p<o.length;p++)p===u?f.push("int(getIndices("+h[p]+"))"):f.push(""+h[p]);return f.join()}(r,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `}}(),AU=function(){return function(r,e,t){this.sliceDim=r,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var n=rn(e.length),i=rn(t.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+n+" strides = "+n+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+a+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}();function zI(r,e){var t=Nr();return FN(r,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function VI(r,e){return WN(r,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function FI(r,e){return HN(r,e,new Uint16Array([0,1,2,2,1,3]))}function Ld(r,e,t,n,i,a,o){GN(t,n);var u=qN(r,e),l=r.TEXTURE_2D;return Mt(r,e,function(){return r.bindTexture(l,u)}),Mt(r,e,function(){return r.texParameteri(l,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Mt(r,e,function(){return r.texParameteri(l,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Mt(r,e,function(){return r.texParameteri(l,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Mt(r,e,function(){return r.texParameteri(l,r.TEXTURE_MAG_FILTER,r.NEAREST)}),Mt(r,e,function(){return r.texImage2D(l,0,i,t,n,0,a,o,null)}),Mt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)}),u}function BI(r,e,t,n,i){var a=bv(t,n);return Ld(r,e,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,r.FLOAT)}function jI(r,e,t,n,i){var a=bv(t,n);return Ld(r,e,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function UI(r,e,t,n,i){var a=bv(t,n);return Ld(r,e,a[0],a[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function WI(r,e,t,n,i){var a=kd(t,n);return Ld(r,e,a[0],a[1],i.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function HI(r,e,t,n,i){var a=kd(t,n);return Ld(r,e,a[0],a[1],i.internalFormatPackedHalfFloat,r.RGBA,i.textureTypeHalfFloat)}function qI(r,e,t,n){return Mt(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Hb(r,e,t,"clipSpacePos",n,3,20,0)&&Hb(r,e,t,"uv",n,2,20,12)}function GI(r,e,t,n,i,a,o){var u,l,h;Mt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),a instanceof Uint8Array?(u=new Uint8Array(n*i*4),l=r.UNSIGNED_BYTE,h=r.RGBA):(u=new Float32Array(n*i*4),l=r.FLOAT,h=o.internalFormatPackedFloat),u.set(a),Mt(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,h,n,i,0,r.RGBA,l,u)}),Mt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function $I(r,e,t,n){Mt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),n.data instanceof Uint8Array?Mt(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.width,n.height,0,r.RGBA,r.UNSIGNED_BYTE,n.data)}):Mt(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)}),Mt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function KI(r,e,t,n,i){var a=r.createBuffer();Mt(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,a)});var o=16*t*n;return Mt(r,e,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,o,r.STREAM_READ)}),Mt(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,0)}),Mt(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),a}function XI(r,e,t){var n=r,i=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,i),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),i}function YI(r,e,t,n,i){var a=bv(t,n),o=a[0],u=a[1],l=new Uint8Array(t*n*4);return Mt(r,e,function(){return r.readPixels(0,0,o,u,i.downloadTextureFormat,r.UNSIGNED_BYTE,l)}),new Float32Array(l.buffer)}function QI(r,e,t,n,i,a,o,u){var l=r,h=new Float32Array(function(f,p){var m=kd(f,p);return m[0]*m[1]*4}(a,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,h),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),h}function ZI(r,e,t,n){var i=new Float32Array(t*n*4);return Mt(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,i)}),i}var RU=Object.freeze({createVertexShader:zI,createVertexBuffer:VI,createIndexBuffer:FI,createFloat32MatrixTexture:BI,createFloat16MatrixTexture:jI,createUnsignedBytesMatrixTexture:UI,createPackedMatrixTexture:WI,createFloat16PackedMatrixTexture:HI,bindVertexProgramAttributeStreams:qI,uploadDenseMatrixToTexture:GI,uploadPixelDataToTexture:$I,createBufferFromOutputTexture:KI,downloadFloat32MatrixFromBuffer:XI,downloadByteEncodedFloatMatrixFromOutputTexture:YI,downloadPackedMatrixFromBuffer:QI,downloadMatrixFromPackedOutputTexture:ZI}),JI=function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=gt().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,LN(t,e)):this.gl=Ua(t),gt().getNumber("WEBGL_VERSION")===1)this.textureFloatExtension=Qm(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),this.textureHalfFloatExtension=Qm(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float");else if(Zi(this.gl,"EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension("EXT_color_buffer_float");else{if(!Zi(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=VI(this.gl,this.debug),this.indexBuffer=FI(this.gl,this.debug),this.framebuffer=$N(this.gl,this.debug),this.textureConfig=_x(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return gt().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Mt(t,this.debug,function(){return t.finish()}),Mt(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Mt(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Mt(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Mt(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Mt(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),BI(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),jI(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),UI(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),$I(this.gl,this.debug,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,i){this.throwIfDisposed(),GI(this.gl,this.debug,e,t,n,i,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),HI(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),WI(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(qb(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Mt(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,function(){return YI(i.gl,i.debug,t,n,i.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,i,a,o){return QI(this.gl,e,0,0,0,a,o,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return XI(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var i=KI(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t,n,i=this;if(gt().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,o=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var u=a.clientWaitSync(o,0,0);return u===a.ALREADY_SIGNALED||u===a.CONDITION_SATISFIED},t=o}else gt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return i.isQueryAvailable(t,gt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,function(){return ZI(i.gl,i.debug,t,n)})},r.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=BN(t,this.debug,e),i=zI(t,this.debug),a=jN(t,this.debug);return Mt(t,this.debug,function(){return t.attachShader(a,i)}),Mt(t,this.debug,function(){return t.attachShader(a,n)}),UN(t,this.debug,a),this.debug&&tg(t,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=qI(t,this.debug,this.program,this.vertexBuffer)),a},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Mt(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&tg(this.gl,this.debug,this.program),Mt(this.gl,this.debug,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?XN(this.gl,this.debug,e,t):YN(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Mt(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),QN(this.gl,this.debug,this.program,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var i=kd(t,n),a=i[0],o=i[1];this.setOutputMatrixTextureDriver(e,a,o)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,i){this.setOutputMatrixWriteRegionDriver(n,e,i,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&tg(this.gl,this.debug,this.program),Df(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Mt(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Mt(this.gl,this.debug,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Qm(this.gl,this.debug,gt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(gt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var i=this.getQueryTimerExtensionWebGL1(),a=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,a),a},r.prototype.endQuery=function(){if(gt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(e){return Ft(this,void 0,void 0,function(){var t=this;return Bt(this,function(n){switch(n.label){case 0:return[4,zb(function(){return t.disposed||t.isQueryAvailable(e,gt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,gt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,i=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),a&&!this.disjoint},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=function(n){for(var i=0;i<n.length;++i){var a=n[i]();if(!a)break}return i-1}(this.itemsToPoll.map(function(n){return n.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||zb(function(){return n.pollItems(),n.itemsToPoll.length===0})},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),eg(this.gl,this.debug,e,this.framebuffer),this.debug&&Df(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(eg(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Df(this.gl)):qb(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var i=this.gl;eg(i,this.debug,e,this.framebuffer),this.debug&&Df(i),this.outputTexture=e,Mt(i,this.debug,function(){return i.viewport(0,0,t,n)}),Mt(i,this.debug,function(){return i.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,i){var a=this;this.throwIfDisposed(),Mt(this.gl,this.debug,function(){return a.gl.scissor(e,t,n,i)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function LS(r,e){if(r.length!==e.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+e.length+" inputs");r.forEach(function(t,n){var i=t.logicalShape,a=e[n],o=a.shape;if(!or(i,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+o+" must match");if(!t.isUniform||!a.isUniform){var u=t.texShape,l=a.isUniform?null:a.texData.texShape;if(!or(u,l))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+u+" and "+l+" must match")}})}var NU=function(){return function(r,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var n=t.filterWidth,i=t.inChannels,a=t.strideWidth,o=t.strideHeight,u=t.padInfo,l=t.outWidth,h=t.dilationWidth,f=t.dilationHeight,p=t.dataFormat,m=u.left,v=u.top,b=i*n,C=Nr(),w=p==="channelsLast",E=w?0:1,S=w?1:2,A="",k=0;k<=1;k++)for(var O=0;O<=1;O++)A+=`
          blockIndex = rc.y + `+O+`;
          pos = rc.x + `+k+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+l+")) * "+o+" - "+v+`;
            d0 = offsetY + `+f+" * (pos / "+b+`);

            if(d0 < `+e[E]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+l+".) * "+a+". - "+m+`.);
              d1 = offsetX + `+h+" * (int(mod(float(pos), "+b+".) / "+i+`.));

              if(d1 < `+e[S]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+w+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*k+O)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*k+O)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+A+`

        `+C.output+` = result;
      }
    `}}(),IU=function(){return function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[];var a,o=e,u=r[3]-1;this.outputShape=r;var l="float("+t+") + float("+n+") * sum";a=i===.5?"inversesqrt("+l+")":i===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+u+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+a+`;
        setOutput(val);
      }
    `}}(),kU=function(){return function(r,e,t,n,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=e,this.bias=t,this.alpha=n,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+n+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+n+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}(),DU=function(){return function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,o=e,u=r[3]-1;this.outputShape=r;var l="float("+t+") + float("+n+") * sum";a=i===.5?"inversesqrt("+l+")":i===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+o+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+o+"; j <= "+o+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+u+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+a+`;
        setOutput(result);
      }
    `}}(),OU=function(){return function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideHeight,t=r.strideWidth,n=r.dilationHeight,i=r.effectiveFilterHeight,a=r.effectiveFilterWidth,o=i-1-r.padInfo.top,u=a-1-r.padInfo.left,l=i*a-1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+n+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+a+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+l+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+a+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}(),MU=function(){return function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,i=r.dilationDepth,a=r.dilationHeight,o=r.dilationWidth,u=r.effectiveFilterDepth,l=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=u-1-r.padInfo.front,p=l-1-r.padInfo.top,m=h-1-r.padInfo.left,v=u*l*h-1;this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+p+", "+m+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+u+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+l+`;
              wR += `+a+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+o+`) {
              float dyC = float(dyCCorner + wC) / `+n+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+v+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+l+" * "+h+` +
                  wR * `+h+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),F1=function(){return function(r,e,t,n,i,a,o){t===void 0&&(t=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),a===void 0&&(a=null),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var u=t?r[1]:r[2],l=Math.ceil(u/2),h=t?"i * 2, rc.y":"rc.y, i * 2",f=n?"rc.z, i * 2":"i * 2, rc.z",p=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",b="";a&&(v=o?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`vec4 activation(vec4 x) {
          `+a+`
        }`,b="result = activation(result);");var C=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const float sharedDimension = `+l+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+l+`; i++) {
          vec4 a = getMatrixA(rc.x, `+h+`);
          vec4 b = getMatrixB(rc.x, `+f+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+p[0]+" * "+m[0]+`);
          result += (`+p[1]+" * "+m[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+C+`

        `+b+`

        setOutput(result);
      }
    `}}(),LU=function(){function r(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.seedLoc==null&&(t.seedLoc=n.getUniformLocation(i,"seed")),n.gl.uniform1f(t.seedLoc,e)}},r}(),PU=function(){return function(r,e,t,n){this.variableNames=["indices"],this.outputShape=[r,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+n+"), float("+t+`),
                      float(index == coords.y)));
      }
    `}}(),zU=function(){return function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var e=r.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Zr("rc",e),n=rn(e),i=function(u,l,h){if(u===1)return"rc > "+l[0];for(var f="",p=u-2;p<u;p++)f+=h[p]+" >= "+l[p],p<u-1&&(f+="||");return f}(e,r,t),a=function(u,l,h,f){if(u===1)return"";var p=f.slice(-2);return`
    int r = `+p[0]+`;
    int c = `+p[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+l+`;
    bool rEdge = rp1 >= `+h+`;
  `}(e,r[r.length-1],r[r.length-2],t),o=function(u,l){var h=u.length,f=function(p,m){for(var v=[],b=0;b<=1;b++)for(var C=0;C<=1;C++){for(var w=(b===0?"r":"rp1")+", "+(C===0?"c":"cp1"),E=2;E<p;E++)w=m[m.length-1-E]+","+w;v.push(w)}return v}(h,l);return h===1?`getA(rc),
            rc + 1 >= `+u[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+f[0]+`),
          cEdge ? 0. : getA(`+f[1]+`),
          rEdge ? 0. : getA(`+f[2]+`),
          rEdge || cEdge ? 0. : getA(`+f[3]+")"}(r,t);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+a+`

            setOutput(vec4(`+o+`));
          }
        }
      `}}}(),VU=function(){return function(r,e,t){this.variableNames=["x"],this.outputShape=e.map(function(l,h){return l[0]+r[h]+l[1]});var n=r.length,i=rn(n),a=e.map(function(l){return l[0]}).join(","),o=e.map(function(l,h){return l[0]+r[h]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=n!==1?`
      `+i+" start = "+i+"("+a+`);
      `+i+" end = "+i+"("+o+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+u+`));
        }
      }
    `:`
        int start = `+a+`;
        int end = `+o+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}}(),FU=function(){return function(r,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(w,E){return w[0]+r[E]+w[1]});for(var n=r.length,i=rn(n),a=e.map(function(w){return w[0]}).join(","),o=e.map(function(w,E){return w[0]+r[E]}).join(","),u=Zr("rc",n),l=Zr("source",n),h=u[n-1]+" < "+this.outputShape[n-1],f=n===1?"source":"vec2("+l.slice(-2).join()+")",p=[i+" rc = outputLoc;",u[n-1]+` += 1;
       if(`+h+`) {
      `,n===1?"":`}
       rc = outputLoc;
       `+u[n-2]+` += 1;
       if(`+u[n-2]+" < "+this.outputShape[n-2]+") {",n===1?"":"  "+u[n-1]+` += 1;
         if(`+h+") {"],m=n===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",v="",b=0,C=n===1?2:4;b<C;b++)v+=`
        `+p[b]+`
        if (`+m+`) {
          result[`+b+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+b+"] = getChannel(getX("+l.join()+"), "+f+`);
        }
      `;v+=n===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+a+`);
      const `+i+" end = "+i+"("+o+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+v+`
        setOutput(result);
      }
    `}}(),B1=function(){return function(r,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,i=r.strideHeight,a=r.strideWidth,o=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left;this.outputShape=r.outShape;var m=e==="avg",v="0.0";if(m||(v="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+a+`);
        const ivec2 pads = ivec2(`+f+", "+p+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+l+`;
              wR += `+o+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+u+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+h+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var b=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(b="avgValue / count");var C=4*Math.floor(n/4),w=n%4,E=`
      if (`+m+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+a+`);
      const ivec2 pads = ivec2(`+f+", "+p+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+l+`;
            wR += `+o+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+C+`; wC += 4) {
            int xC = xCCorner + wC * `+u+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              getValue(batch, xR, xC + 3 * `+u+`, d)
            );

            `+E+`
          }

          int xC = xCCorner + `+C+`;
          if (`+(w===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+E+`
          } else if (`+(w===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              initializationValue,
              initializationValue
            );

            `+E+`
          } else if (`+(w===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+u+`, d),
              getValue(batch, xR, xC + 2 * `+u+`, d),
              initializationValue
            );

            `+E+`
          }
        }
        setOutput(`+b+`);
      }
    `}}}(),j1=function(){return function(r,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,i=r.strideDepth,a=r.strideHeight,o=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,h=r.dilationWidth,f=r.effectiveFilterDepth,p=r.effectiveFilterHeight,m=r.effectiveFilterWidth,v=r.padInfo.front,b=r.padInfo.top,C=r.padInfo.left;this.outputShape=r.outShape;var w=e==="avg",E="0.0";if(w||(E="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+a+", "+o+`);
        const ivec3 pads = ivec3(`+v+", "+b+", "+C+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+f+`;
              wD += `+u+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+p+`;
                wR += `+l+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+m+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+p+" * "+m+` +
                      wR * `+m+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var S=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(S="avgValue / count");var A=4*Math.floor(n/4),k=n%4,O=`
      if (`+w+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+a+", "+o+`);
      const ivec3 pads = ivec3(`+v+", "+b+", "+C+`);
      const float initializationValue = `+E+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+E+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+f+`;
            wD += `+u+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`;
            wR += `+l+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+A+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+O+`
            }

            int xC = xCCorner + `+A+`;
            if (`+(k===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+O+`
            } else if (`+(k===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+O+`
            } else if (`+(k===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+O+`
            }
          }
          setOutput(`+S+`);
        }
      }
    `}}}(),BU=function(){return function(r,e){this.variableNames=["x"];var t=r.windowSize,n=r.batchSize,i=r.inSize,a=Math.ceil(i/t);this.outputShape=[n,a];var o="0.0",u="";e==="prod"?o="1.0":e==="min"?(o="1.0 / 1e-20",u="min"):e==="max"&&(o="-1.0 / 1e-20",u="max");var l=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?l="sumValue":e==="prod"?l="prodValue":e==="all"?l="allValue":e==="any"&&(l="anyValue");var h=4*Math.floor(t/4),f=t%4,p=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+u+`(values, minMaxValue);
      }
    `,m="vec4";e==="all"?(o="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,m="bvec4"):e==="any"&&(o="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,m="bvec4");var v="";i%t>0&&(v=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+o+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+v+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+o+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+h+`; i += 4) {
          int inIdx = inOffset + i;
          `+m+" values = "+m+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+p+`
        }

        int inIdx = inOffset + `+h+`;
        if (`+(f===1)+`) {
          `+m+" values = "+m+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(f===2)+`) {
          `+m+" values = "+m+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(f===3)+`) {
          `+m+" values = "+m+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+p+`
        }
        setOutput(`+l+`);
      }
    `}}(),jU=function(){return function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var t="",n=0;n<4;n++){var i="thisRC = rc;";n%2==1&&(i+="thisRC.z += 1;"),n>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+n+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(n>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Fu(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+$x(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+t+`

        setOutput(result);
      }
    `}}(),UU=function(){return function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],a=n[2],o=r.shape,u=o[1],l=o[2],h=[t&&u>1?i-1:i,t&&l>1?a-1:a],f=[t&&u>1?u-1:u,t&&l>1?l-1:l],p=h[0]/f[0],m=h[1]/f[1],v=1/p,b=1/m,C=2*Math.ceil(v)+2,w=2*Math.ceil(b)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+m+`);

        const float invHeightScale = float(`+v+`);
        const float invWidthScale = float(`+b+`);

        const int winHeight = int(`+C+`);
        const int winWidth = int(`+w+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(a-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),WU=function(){return function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],a=r[1],o=r[2],u=r[3];this.outputShape=[i,e,t,u];var l=[n&&e>1?a-1:a,n&&t>1?o-1:o],h=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/h[0]+`,
          `+l[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}(),HU=function(){return function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=r[0],a=r[1],o=r[2],u=r[3];this.outputShape=[i,e,t,u];var l=[n&&e>1?a-1:a,n&&t>1?o-1:o],h=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+l[0]/h[0]+`,
          `+l[1]/h[1]+`,
          `+l[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+a+".0, "+o+`.0,
                                     `+o+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(u-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}(),qU=function(){return function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],a=n[2],o=r.shape,u=o[1],l=o[2],h=[t&&u>1?i-1:i,t&&l>1?a-1:a],f=[t&&u>1?u-1:u,t&&l>1?l-1:l],p=h[0]/f[0],m=h[1]/f[1],v=1/p,b=1/m,C=2*Math.ceil(v)+2,w=2*Math.ceil(b)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+m+`);

        const float invHeightScale = float(`+v+`);
        const float invWidthScale = float(`+b+`);

        const int winHeight = int(`+C+`);
        const int winWidth = int(`+w+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float sourceFracRow =
              float(`+h[0]+`) *
                (float(dyR) / float(`+f[0]+`));

            float sourceFracCol =
                float(`+h[1]+`) *
                  (float(dyC) / float(`+f[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+a+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),GU=function(){return function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],a=r[1],o=r[2],u=r[3];this.outputShape=[i,e,t,u];var l=[n&&e>1?a-1:a,n&&t>1?o-1:o],h=[n&&e>1?e-1:e,n&&t>1?t-1:t],f=n?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/h[0]+`,
          `+l[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+f+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}(),$U=function(){return function(r,e){this.variableNames=["x"];var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=r,t!==1){var n=r.map(function(a,o){return function(u){return e.indexOf(u)!==-1&&r[u]!==1?r[u]+" - coords["+u+"] - 1":"coords["+u+"]"}(o)}).join(","),i=rn(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+n+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `}}(),KU=function(){return function(r,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=r;var n=Zr("rc",t),i=n[t-1]+" + 1 < "+this.outputShape[t-1],a=n[t-2]+" + 1 < "+this.outputShape[t-2],o=rn(t);function u(l){var h=r.map(function(f,p){return function(m,v){return e.indexOf(m)!==-1&&r[m]!==1?r[m]+" - "+v[m]+" - 1":""+v[m]}(p,l)});return"getChannel(getX("+h.join(",")+"), vec2("+h.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+o+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(l){return u(l)}(n.slice())+`;
          if(`+i+`){
            result.g = `+function(l){return l[t-1]="("+l[t-1]+" + 1)",u(l)}(n.slice())+`;
          }
          if(`+a+`) {
            result.b = `+function(l){return l[t-2]="("+l[t-2]+" + 1)",u(l)}(n.slice())+`;
            if(`+i+`) {
              result.a = `+function(l){return l[t-1]="("+l[t-1]+" + 1)",l[t-2]="("+l[t-2]+" + 1)",u(l)}(n.slice())+`;
            }
          }
          setOutput(result);
        }
    `}}(),PS=function(){return function(r,e,t,n,i,a,o){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var u=rn(i.length),l=rn(a.length),h="";t===1?h="i":t===2&&(h="i, j");var f="getIndices("+h+")",p="";n===1?p="i":n===2&&(p="i, coords[1]");var m="getUpdates("+p+")",v=e>1?"strides[j]":"strides";this.userCode=`
        `+u+" strides = "+u+"("+i+`);

        void main() {
          `+l+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+f+`);
              flattenedIndex += index * `+v+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+m+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}(),XU=function(){return function(r,e){this.variableNames=["x","segmentIds"];var t=r.windowSize,n=r.batchSize,i=r.inSize,a=r.numSegments,o=a*Math.ceil(i/t);this.outputShape=[n,o];var u=4*Math.floor(t/4),l=t%4,h=`
        sumValue += dot(values, segFilter);
    `,f="";i%t>0&&(f=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var p="";i%t>0&&(p=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+p+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+a+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+a+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(l===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(l===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(l===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(sumValue);
      }
    `}}(),YU=function(){return function(r,e,t){var n,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",n="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],u=[],l=0;l<e.length;l++)u.push(""+a[l]),l<r&&o.push(""+a[l]);n=o.join(),i=u.join()}var h=rn(t);this.userCode=`
      void main() {
        `+h+` resRC = getOutputCoords();
        float cVal = getC(`+n+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `}}(),QU=function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=rn(this.rank),i="uniform int start["+this.rank+"];",a=function(o){if(o===1)return"sourceLoc";if(o<=6)return U1.slice(0,o).map(function(u){return"sourceLoc."+u}).join(",");throw Error("Slicing for rank "+o+" is not yet supported")}(this.rank);t=`
        `+n+` sourceLoc;
        `+n+` coords = getOutputCoords();
        `+e.map(function(o,u){return"sourceLoc."+U1[u]+" = start["+u+"] + coords."+U1[u]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+a+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r}(),U1=["x","y","z","w","u","v"],ZU=function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=rn(this.rank),n=Zr("coords",this.rank),i=Zr("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",o="getChannel(getSource("+i.join()+"), "+a+")",u=`
      result.x = `+o+`;
      if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+o+`;
        --`+i[this.rank-1]+`;
      }
    `,l=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(f,p){return"start["+p+"]"}).join()+");":e.map(function(f,p){return i[p]+" = "+n[p]+" + start["+p+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+h+`
        vec4 result = vec4(0.);
        `+u+`
        `+l+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r}(),JU=function(){return function(r,e,t){this.variableNames=["x"],this.outputShape=t;var n=t.length,i=rn(t.length),a=rn(t.length),o="";if(n===1)o="coords * strides + begin";else{var u=0;o=t.map(function(l,h){return u++,t.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(u-1)+"] * strides["+h+"] + begin["+h+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+r+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+o+`));
      }
    `}}(),tW=function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(e,t,n){var i,a=zS(t,n),o=VS(e,a,n);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var u=this.freeTextures[o].shift();return this.usedTextures[o].push(u),u}return this.numUsedTextures++,this.log(),a===hi.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===hi.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===hi.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===hi.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===hi.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(i),i},r.prototype.releaseTexture=function(e,t,n,i){if(this.freeTextures!=null){var a=VS(t,zS(n,i),i);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(e),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[a],u=o.indexOf(e);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(u,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r}();function zS(r,e){if(r===pi.UPLOAD)return hi.PACKED_2X2_FLOAT32;if(r===pi.RENDER||r==null)return function(t){return gt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?hi.PACKED_2X2_FLOAT32:hi.UNPACKED_FLOAT32:t?hi.PACKED_2X2_FLOAT16:hi.UNPACKED_FLOAT16}(e);if(r===pi.DOWNLOAD||r===pi.PIXELS)return hi.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function VS(r,e,t){return r[0]+"_"+r[1]+"_"+e+"_"+t}var eW=function(){return function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[n]*e[n];this.outputShape=t,this.rank=t.length;var i=rn(this.rank),a=function(o){var u=o.length;if(u>5)throw Error("Tile for rank "+u+" is not yet supported");if(u===1)return"imod(resRC, "+o[0]+")";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],h=[],f=0;f<o.length;f++)h.push("imod("+l[f]+", "+o[f]+")");return h.join()}(r);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `}}(),nW=function(){return function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];this.outputShape=t,this.rank=t.length;var i=rn(this.rank),a=function(o){var u=o.length;if(u>6)throw Error("Transpose for rank "+u+" is not yet supported");for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],h=new Array(u),f=0;f<o.length;f++)h[o[f]]=l[f];return h.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+a+`));
    }
    `}}(),rW=function(){return function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=rn(this.rank),a=DI("rc",this.rank),o=new Array(this.rank);for(n=0;n<e.length;n++)o[e[n]]=a[n];var u="vec2("+o.slice(-2).join()+")",l="++"+a[this.rank-1]+" < "+t[this.rank-1],h="getChannel(getA("+o.join()+"), "+u+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+h+`;
      if(`+l+`) {
        result[1] = `+h+`;
      }
      --`+a[this.rank-1]+`;
      if(++`+a[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+h+`;
        if(`+l+`) {
          result[3] = `+h+`;
        }
      }
      setOutput(result);
    }
    `}}(),Kx=1.7580993408473768,Xx=1.0507009873554805,he=function(){return function(r,e){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}(),ua="if (isnan(x)) return x;",iW="return x;",FS="return abs(x);",tk=ua+`
  return (x < 0.0) ? 0.0 : x;
`,ek=ua+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,nk="return (x >= 0.0) ? x : (exp(x) - 1.0);",aW=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Kx+`;
  float scale = `+Xx+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,BS="return -x;",jS="return ceil(x);",US="return floor(x);",WS="return exp(x);",HS="return exp(x) - 1.0;",oW=ua+`
  return sin(x);
`,sW=ua+`
  return cos(x);
`,uW=ua+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,lW=ua+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,cW=ua+`
  return atan(x);
`,hW=ua+"return log(x + sqrt(x * x + 1.0));",fW=ua+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,dW=ua+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,km="return x;",pW="return x;",rk=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ik=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ak=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,_f=function(){return function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}(),mW=function(){return function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var e=r.length,t=Zr("rc",e),n=rn(e),i=function(u,l){if(u===1)return"rc";for(var h="",f=0;f<u;f++)h+=l[f],f<u-1&&(h+=",");return h}(e,t),a=t.slice(-2),o=e<=1?"rc":"vec2("+a.join(",")+")";this.userCode=`
      void main() {
        `+n+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+o+`));
      }
    `}}(),Dm={};function Om(r,e){if(e===void 0&&(e=!1),r==="linear")return e?pW:iW;if(r==="relu")return e?rk:tk;if(r==="elu")return e?ak:nk;if(r==="relu6")return e?ik:ek;if(r==="prelu")return e?PI:LI;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var gW=600,ok=function(r){function e(t){var n,i=r.call(this)||this;if(i.gpgpu=t,i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!gt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var a=Ua(gt().getNumber("WEBGL_VERSION"));i.binaryCache=((n=gt().getNumber("WEBGL_VERSION"))in Dm||(Dm[n]={}),Dm[n]),i.gpgpu=new JI(a),i.canvas=a.canvas,i.gpgpuCreatedLocally=!0}else i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new tW(i.gpgpu),i.numMBBeforeWarning=gt().global.screen==null?1024:gt().global.screen.height*gt().global.screen.width*window.devicePixelRatio*gW/1024/1024,i.texData=new Bx(i,J),i}return aa(e,r),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.fromPixels=function(t,n){if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var i=typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement,a=t.data instanceof Uint8Array,o=typeof ImageData<"u"&&t instanceof ImageData,u=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement,l=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,h=u?[t.videoWidth,t.videoHeight]:[t.width,t.height],f=h[0],p=h[1],m=[p,f],v=[p,f,n];if(!(i||a||o||u||l))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);(l||u)&&(this.fromPixels2DContext==null&&(this.fromPixels2DContext=PN(gt().getNumber("WEBGL_VERSION")).getContext("2d")),this.fromPixels2DContext.canvas.width=f,this.fromPixels2DContext.canvas.height=p,this.fromPixels2DContext.drawImage(t,0,0,f,p),t=this.fromPixels2DContext.canvas);var b,C,w=this.makeTensorInfo(m,"int32");return this.texData.get(w.dataId).usage=pi.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(w.dataId),t),gt().getBool("WEBGL_PACK")?(b=new TU(v),C=this.compileAndRun(b,[w])):(b=new _U(v),C=this.compileAndRun(b,[w])),this.disposeData(w.dataId),C},e.prototype.write=function(t,n,i){if(gt().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var a={};return this.texData.set(a,{shape:n,dtype:i,values:t,usage:pi.UPLOAD}),a},e.prototype.move=function(t,n,i,a){if(gt().getBool("DEBUG")&&this.checkNumericalProblems(n),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:a,values:n,usage:pi.UPLOAD})},e.prototype.readSync=function(t){var n=this.texData.get(t),i=n.values,a=n.dtype,o=n.complexTensors,u=n.slice,l=n.shape,h=n.isPacked;if(u!=null){var f=void 0;f=h?new _f(l,km):new he(l,km);var p=this.runWebGLProgram(f,[{dataId:t,shape:l,dtype:a}],a),m=this.readSync(p.dataId);return this.disposeData(p.dataId),m}if(i!=null)return this.convertAndCacheOnCPU(t);if(a==="string")return i;var v,b,C=this.activeTimers!=null;return C&&(v=Yi()),a==="complex64"?b=Zb(o.real.dataSync(),o.imag.dataSync()):b=this.getValuesFromTexture(t),C&&(this.downloadWaitMs+=Yi()-v),this.convertAndCacheOnCPU(t,b)},e.prototype.read=function(t){return Ft(this,void 0,void 0,function(){var n,i,a,o,u,l,h,f,p,m,v,b,C,w,E,S,A,k,O,V,T,R;return Bt(this,function(N){switch(N.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(D){return n.push(D)})];if(i=this.texData.get(t),a=i.values,o=i.shape,u=i.slice,l=i.dtype,h=i.complexTensors,f=i.isPacked,u!=null)return p=void 0,p=f?new _f(o,km):new he(o,km),m=this.runWebGLProgram(p,[{dataId:t,shape:o,dtype:l}],l),v=this.read(m.dataId),this.disposeData(m.dataId),[2,v];if(a!=null)return[2,this.convertAndCacheOnCPU(t)];if(!gt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&gt().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return b=null,l!=="complex64"&&gt().get("WEBGL_BUFFER_SUPPORTED")&&(C=this.decode(t),w=this.texData.get(C.dataId),b=(R=this.gpgpu).createBufferFromTexture.apply(R,[w.texture].concat(Uf(o)))),this.pendingRead.set(t,[]),l==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:N.sent(),N.label=2;case 2:return l!=="complex64"?[3,4]:[4,Promise.all([h.real.data(),h.imag.data()])];case 3:return S=N.sent(),A=S[0],k=S[1],E=Zb(A,k),[3,5];case 4:b==null?E=this.getValuesFromTexture(t):(O=jt(o),E=this.gpgpu.downloadFloat32MatrixFromBuffer(b,O)),N.label=5;case 5:return C!=null&&this.disposeData(C.dataId),V=this.convertAndCacheOnCPU(t,E),T=this.pendingRead.get(t),this.pendingRead.delete(t),T.forEach(function(D){return D(V)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,V]}})})},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var i=t[n];if(!zN(i))throw gt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var n,i=this.texData.get(t),a=i.shape,o=i.dtype,u=i.isPacked,l=jt(a);if(gt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var h=this.decode(t),f=this.texData.get(h.dataId),p=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,[f.texture].concat(Uf(a))).subarray(0,l);return this.disposeData(h.dataId),p}var m=gt().getBool("WEBGL_PACK")&&u===!0,v=m?ng(a):a,b=m?new yU(v):new vU(v),C=this.runWebGLProgram(b,[{shape:v,dtype:o,dataId:t}],"float32"),w=this.texData.get(C.dataId),E=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(w.texture,w.texShape[0],w.texShape[1]).subarray(0,l);return this.disposeData(C.dataId),E},e.prototype.time=function(t){return Ft(this,void 0,void 0,function(){var n,i,a,o,u,l,h;return Bt(this,function(f){switch(f.label){case 0:return n=this.activeTimers,i=[],a=!1,this.programTimersStack==null?(this.programTimersStack=i,a=!0):this.activeTimers.push(i),this.activeTimers=i,t(),o=Do(this.activeTimers.map(function(p){return p.query})).filter(function(p){return p!=null}),u=Do(this.activeTimers.map(function(p){return p.name})).filter(function(p){return p!=null}),this.activeTimers=n,a&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return l=f.sent(),h={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:wN(l),getExtraProfileInfo:function(){return l.map(function(p,m){return{name:u[m],ms:p}}).map(function(p){return p.name+": "+p.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,h]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return gt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:Yi(),endMs:null}},e.prototype.endTimer=function(t){return gt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=Yi(),t)},e.prototype.getQueryTime=function(t){return Ft(this,void 0,void 0,function(){var n;return Bt(this,function(i){return gt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(n=t).endMs-n.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var n=this.texData.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),i=n.texture,a=n.dtype,o=n.texShape,u=n.usage,l=n.isPacked,h=n.slice,f=h&&h.origDataId||t,p=this.dataRefCount.get(f);p>1?this.dataRefCount.set(f,p-1):(this.dataRefCount.delete(f),i!=null&&(this.numBytesInGPU-=this.computeBytes(o,a),this.textureManager.releaseTexture(i,o,u,l)));var m=this.texData.get(t);m.texture=null,m.texShape=null,m.isPacked=!1,m.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return gt().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=J.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,n){var i=this;return n===void 0&&(n=128),this.getCPUBackend()!=null&&t.every(function(a){return i.texData.get(a.dataId).texture==null&&a.size<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,n){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:J.keep(t.clone()),imag:J.keep(n.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,n,i);if(jt(i)===0)return Rn([],i,t.dtype);var a=this.texData.get(t.dataId).isPacked,o=Vx(t.shape,n,i);if(a||!o){var u=gt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ZU(i):new QU(i),l=u.getCustomSetupFunc(n);return this.compileAndRun(u,[t],null,l)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,n,i)},e.prototype.shallowSlice=function(t,n,i){var a=this.texData.get(t.dataId),o=this.makeOutput(i,t.dtype),u=this.texData.get(o.dataId);Object.assign(u,a),u.shape=i,u.dtype=t.dtype;var l=Fx(n,t.strides);a.slice&&(l+=a.slice.flatOffset),u.slice={flatOffset:l,origDataId:a.slice&&a.slice.origDataId||t.dataId};var h=this.dataRefCount.get(u.slice.origDataId)||1;return this.dataRefCount.set(u.slice.origDataId,h+1),o},e.prototype.stridedSlice=function(t,n,i,a){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,n,i,a);var o=Rv(n,i,a);if(o.some(function(l){return l===0}))return Rn([],o);var u=new JU(n,a,o);return this.compileAndRun(u,[t])},e.prototype.reverse=function(t,n){var i=gt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new KU(t.shape,n):new $U(t.shape,n);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,n){if(t[0].dtype==="complex64"){var i=t.map(function(v){return Qr(v)}),a=t.map(function(v){return zi(v)});return Kn(this.concat(i,n),this.concat(a,n))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,n);if(t.length===1)return t[0];if(t.length>gt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),u=this.concat(t.slice(0,o),n),l=this.concat(t.slice(o),n);return this.concat([u,l],n)}if(gt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var h=new rU(t.map(function(v){return v.shape}),n);return this.compileAndRun(h,t)}var f=Xu(t.map(function(v){return v.shape}),n),p=t.map(function(v){return v.as2D(-1,jt(v.shape.slice(n)))}),m=new nU(p.map(function(v){return v.shape}));return this.compileAndRun(m,p).reshape(f)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(gt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,BS,t.dtype);var n=new he(t.shape,BS);return this.compileAndRun(n,[t])},e.prototype.batchMatMul=function(t,n,i,a){var o=i?t.shape[2]:t.shape[1],u=a?n.shape[1]:n.shape[2],l=i?t.shape[1]:t.shape[2],h=t.shape[0];if((o===1||u===1)&&l>1e3){i&&(t=t.transpose([0,2,1])),a&&(n=n.transpose([0,2,1]));var f=u===1?t:t.as3D(h,l,1),p=u===1?2:1,m=u===1?n.as3D(h,1,l):n;return this.multiply(f,m).sum(p,!0)}var v=Pn(t.dtype,n.dtype),b=new F1(t.shape,[h,o,u],i,a);return this.compileAndRun(b,[t,n],v)},e.prototype.fusedBatchMatMul=function(t){var n=t.a,i=t.b,a=t.transposeA,o=t.transposeB,u=t.bias,l=t.activation,h=t.preluActivationWeights,f=a?n.shape[2]:n.shape[1],p=o?i.shape[1]:i.shape[2],m=n.shape[0],v=Pn(n.dtype,i.dtype),b=u!=null,C=h!=null,w=l?Om(l,!0):null,E=new F1(n.shape,[m,f,p],a,o,b,w,C),S=[n,i];return u&&S.push(u),h&&S.push(h),this.compileAndRun(E,S,v)},e.prototype.multiply=function(t,n){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),a=this.texData.get(n.dataId),o=new RS(Qj,t.shape,n.shape),u=new RS(Zj,t.shape,n.shape),l=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(n,a.complexTensors.real),this.makeComplexComponentTensorInfo(n,a.complexTensors.imag)],h=this.compileAndRun(o,l),f=this.compileAndRun(u,l),p=this.complex(h,f);return h.dispose(),f.dispose(),p}if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.multiply(t,n);if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,NS,t.dtype);var m=new xn(NS,t.shape,n.shape);return this.compileAndRun(m,[t,n],t.dtype)},e.prototype.batchNormalization=function(t,n,i,a,o,u){var l=[t,n,i],h=null;u!=null&&(h=u.shape,l.push(u));var f=null;if(o!=null&&(f=o.shape,l.push(o)),gt().getBool("WEBGL_PACK_NORMALIZATION")){var p=new Yj(t.shape,n.shape,i.shape,h,f,a);return this.compileAndRun(p,l)}var m=new Xj(t.shape,n.shape,i.shape,h,f,a);return this.compileAndRun(m,l)},e.prototype.localResponseNormalization4D=function(t,n,i,a,o){var u=gt().getBool("WEBGL_PACK_NORMALIZATION")?new DU(t.shape,n,i,a,o):new IU(t.shape,n,i,a,o);return this.compileAndRun(u,[t])},e.prototype.LRNGrad=function(t,n,i,a,o,u,l){var h=new kU(n.shape,a,o,u,l);return this.compileAndRun(h,[n,i,t])},e.prototype.tile=function(t,n){if(t.dtype==="string"){var i=this.readSync(t.dataId).map(function(o){return od(o)});return II(ie(t.shape,t.dtype,i),n)}var a=new eW(t.shape,n);return this.compileAndRun(a,[t])},e.prototype.pad=function(t,n,i){var a=gt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new FU(t.shape,n,i):new VU(t.shape,n,i);return this.compileAndRun(a,[t])},e.prototype.transpose=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,n);var i=gt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new rW(t.shape,n):new nW(t.shape,n);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,n,i){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.gather(t,n,i);var a=new SU(t.shape,n.size,i);return this.compileAndRun(a,[t,n])},e.prototype.batchToSpaceND=function(t,n,i){$(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var a=n.reduce(function(p,m){return p*m}),o=kg(t.shape,n,a),u=Dg(o.length,n.length),l=Og(t.shape,n,a),h=wI(i,n.length),f=CI(l,i,n.length);return t.reshape(o).transpose(u).reshape(l).slice(h,f)},e.prototype.spaceToBatchND=function(t,n,i){$(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var a=n.reduce(function(m,v){return m*v}),o=[[0,0]];o.push.apply(o,i);for(var u=1+n.length;u<t.shape.length;++u)o.push([0,0]);var l=t.pad(o),h=kg(l.shape,n,a,!1),f=Dg(h.length,n.length,!1),p=Og(l.shape,n,a,!1);return l.reshape(h).transpose(f).reshape(p)},e.prototype.reduce=function(t,n,i){var a=t.shape[0],o=t.shape[1],u=P1(o),l=new BU({windowSize:u,inSize:o,batchSize:a},n),h=this.compileAndRun(l,[t],i);return h.shape[1]===1?h:this.reduce(h,n,i)},e.prototype.argReduce=function(t,n,i){i===void 0&&(i=null);var a=t.shape[0],o=t.shape[1];i!=null&&(a=i.shape[0],o=i.shape[1]);var u=P1(o),l=new Bj({windowSize:u,inSize:o,batchSize:a},n,i==null),h=[t];i!=null&&h.push(i);var f=this.compileAndRun(l,h,"int32");return f.shape[1]===1?f:this.argReduce(t,n,f)},e.prototype.argReducePacked=function(t,n,i){i===void 0&&(i=null);var a=i!=null?i.shape:t.shape,o=P1(a[a.length-1]),u=new Gj(a,o,n,i==null),l=i==null?[t]:[t,i],h=this.compileAndRun(u,l,"int32");return h.rank===t.rank?this.argReducePacked(t,n,h):h},e.prototype.sum=function(t,n){Yr("sum",n,t.rank);var i=gr(t.shape,n),a=i[0],o=jt(i[1]),u=t.as2D(-1,o),l=O1(t.dtype);return this.reduce(u,"sum",l).reshape(a)},e.prototype.prod=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,n);var i=gr(t.shape,n),a=i[0],o=jt(i[1]),u=t.as2D(-1,o),l=O1(t.dtype);return this.reduce(u,"prod",l).reshape(a)},e.prototype.unsortedSegmentSum=function(t,n,i){var a=0,o=oa([a],t.rank),u=t;o!=null&&(u=t.transpose(o),a=sa(1,t.rank)[0]);var l=function(v,b,C){for(var w=[],E=v.length,S=0;S<E;S++)S!==b?w.push(v[S]):w.push(C);return w}(u.shape,a,i),h=jt([u.shape[a]]),f=u.as2D(-1,h),p=O1(t.dtype),m=this.segOpCompute(f,"unsortedSegmentSum",n,p,i).reshape(l);return o!=null&&(m=m.transpose(wv(o))),m},e.prototype.segOpCompute=function(t,n,i,a,o){var u=t.shape[0],l=t.shape[1],h=function(m,v){var b,C=!1;for(m<=_I?(b=m,C=!0):b=Ig(m,Math.floor(Math.sqrt(m)));!C;)b>v||b===m?C=!0:b=Ig(m,b+1);return b}(l,o),f=new XU({windowSize:h,inSize:l,batchSize:u,numSegments:o},n),p=this.compileAndRun(f,[t,i],a);return p.shape[1]===o?p:(i=Cv(0,o).tile([l/h]),this.segOpCompute(p,n,i,a,o))},e.prototype.argMinMaxReduce=function(t,n,i){var a=[n];if(Yr("arg"+i.charAt(0).toUpperCase()+i.slice(1),a,t.rank),!gt().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=gr(t.shape,a),u=o[0],l=jt(o[1]),h=t.as2D(-1,l);return this.argReduce(h,i).reshape(u)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,n){return this.argMinMaxReduce(t,n,"min")},e.prototype.argMax=function(t,n){return this.argMinMaxReduce(t,n,"max")},e.prototype.cumsum=function(t,n,i,a){if(n!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+n);var o=new fU(t.shape,i,a);return this.compileAndRun(o,[t])},e.prototype.equal=function(t,n){if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(equal(a, b));
`,"bool");var i=new xn("return float(a == b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.notEqual=function(t,n){if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(notEqual(a, b));
`,"bool");var i=new xn("return float(a != b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.less=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.less(t,n);if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThan(a, b));
`,"bool");var i=new xn("return float(a < b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.lessEqual=function(t,n){if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new xn("return float(a <= b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.greater=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.greater(t,n);if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new xn("return float(a > b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.greaterEqual=function(t,n){if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new xn("return float(a >= b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.logicalNot=function(t){var n=new he(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(n,[t])},e.prototype.logicalAnd=function(t,n){if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new xn("return float(a >= 1.0 && b >= 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.logicalOr=function(t,n){if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new xn("return float(a >= 1.0 || b >= 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.select=function(t,n,i){var a=new YU(t.rank,n.shape,n.rank);return this.compileAndRun(a,[t,n,i],Pn(n.dtype,i.dtype))},e.prototype.where=function(t){Xb("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return Gx(t.shape,n)},e.prototype.topk=function(t,n,i){return kI(t.dataSync(),t.shape,t.dtype,n)},e.prototype.min=function(t,n){Yr("min",n,t.rank);var i=gr(t.shape,n),a=i[0],o=jt(i[1]),u=t.as2D(-1,o);return this.reduce(u,"min",u.dtype).reshape(a)},e.prototype.minimum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.minimum(t,n);var i=gt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yo(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new xn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.mod=function(t,n){var i=gt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yo(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new xn(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.max=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,n);Yr("max",n,t.rank);var i=gr(t.shape,n),a=i[0],o=jt(i[1]),u=t.as2D(-1,o);return this.reduce(u,"max",u.dtype).reshape(a)},e.prototype.maximum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.maximum(t,n);var i=gt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yo(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new xn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.all=function(t,n){Yr("all",n,t.rank);var i=gr(t.shape,n),a=i[0],o=jt(i[1]),u=t.as2D(-1,o);return this.reduce(u,"all",u.dtype).reshape(a)},e.prototype.any=function(t,n){Yr("any",n,t.rank);var i=gr(t.shape,n),a=i[0],o=jt(i[1]),u=t.as2D(-1,o);return this.reduce(u,"any",u.dtype).reshape(a)},e.prototype.squaredDifference=function(t,n){var i=gt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yo("return (a - b) * (a - b);",t.shape,n.shape):new xn("return (a - b) * (a - b);",t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.realDivide=function(t,n){if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new xn(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,n.shape);return this.compileAndRun(i,[t,n],"float32")},e.prototype.floorDiv=function(t,n){if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new xn(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,n.shape);return this.compileAndRun(i,[t,n],"int32")},e.prototype.add=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,z1);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.add(t,n);var i=Pn(t.dtype,n.dtype);if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,z1,i);var a=new xn(z1,t.shape,n.shape);return this.compileAndRun(a,[t,n],i)},e.prototype.packedUnaryOp=function(t,n,i){var a=new _f(t.shape,n);return this.compileAndRun(a,[t],i)},e.prototype.packedBinaryOp=function(t,n,i,a,o){o===void 0&&(o=!1);var u=new yo(i,t.shape,n.shape,o);return this.compileAndRun(u,[t,n],a)},e.prototype.complexSeparableBinaryOp=function(t,n,i){var a=this,o=this.texData.get(t.dataId),u=this.texData.get(n.dataId),l=[[o.complexTensors.real,u.complexTensors.real],[o.complexTensors.imag,u.complexTensors.imag]].map(function(m){var v=m[0],b=m[1],C=a.makeComplexComponentTensorInfo(t,v),w=a.makeComplexComponentTensorInfo(n,b),E=new xn(i,t.shape,n.shape);return a.compileAndRun(E,[C,w],Pn(v.dtype,b.dtype))}),h=l[0],f=l[1],p=this.complex(h,f);return h.dispose(),f.dispose(),p},e.prototype.makeComplexComponentTensorInfo=function(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>gt().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(t.length/2),i=this.addN(t.slice(0,n)),a=this.addN(t.slice(n));return this.addN([i,a])}var o=t.map(function(h){return h.dtype}).reduce(function(h,f){return Pn(h,f)}),u=t.map(function(h){return h.shape}),l=gt().getBool("WEBGL_PACK")?new Fj(t[0].shape,u):new Vj(t[0].shape,u);return this.compileAndRun(l,t,o)},e.prototype.subtract=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,V1);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.subtract(t,n);var i=Pn(t.dtype,n.dtype);if(gt().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,V1,t.dtype);var a=new xn(V1,t.shape,n.shape);return this.compileAndRun(a,[t,n],i)},e.prototype.pow=function(t,n){var i=gt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yo(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new xn(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,n.shape),a=Pn(t.dtype,n.dtype);return this.compileAndRun(i,[t,n],a)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(gt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,jS,t.dtype);var n=new he(t.shape,jS);return this.compileAndRun(n,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(gt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,US,t.dtype);var n=new he(t.shape,US);return this.compileAndRun(n,[t])},e.prototype.sign=function(t){var n=new he(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(n,[t])},e.prototype.isNaN=function(t){var n=new he(t.shape,"return float(isnan(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isInf=function(t){var n=new he(t.shape,"return float(isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isFinite=function(t){var n=new he(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.round=function(t){var n=new he(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(n,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(gt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,WS,t.dtype);var n=new he(t.shape,WS);return this.compileAndRun(n,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(gt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,HS,t.dtype);var n=new he(t.shape,HS);return this.compileAndRun(n,[t])},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(gt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var n=new he(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(n,[t])},e.prototype.log1p=function(t){var n=new he(t.shape,"return log(1.0 + x);");return this.compileAndRun(n,[t])},e.prototype.sqrt=function(t){var n=new he(t.shape,"return sqrt(x);");return this.compileAndRun(n,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var n=new he(t.shape,"return inversesqrt(x);");return this.compileAndRun(n,[t])},e.prototype.reciprocal=function(t){var n=new he(t.shape,"return 1.0 / x;");return this.compileAndRun(n,[t])},e.prototype.relu=function(t){var n;return n=gt().getBool("WEBGL_PACK")?new _f(t.shape,rk):new he(t.shape,tk),this.compileAndRun(n,[t])},e.prototype.relu6=function(t){var n;return n=gt().getBool("WEBGL_PACK")?new _f(t.shape,ik):new he(t.shape,ek),this.compileAndRun(n,[t])},e.prototype.prelu=function(t,n){var i=gt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yo(PI,t.shape,n.shape):new xn(LI,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.elu=function(t){if(gt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ak,t.dtype);var n=new he(t.shape,nk);return this.compileAndRun(n,[t])},e.prototype.eluDer=function(t,n){var i=gt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yo(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,n.shape):new xn("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.selu=function(t){var n=new he(t.shape,aW);return this.compileAndRun(n,[t])},e.prototype.int=function(t){var n=new he(t.shape,"return float(int(x));");return this.compileAndRun(n,[t],"int32")},e.prototype.clip=function(t,n,i){var a,o=(a=gt().getBool("WEBGL_PACK_CLIP")?new tU(t.shape):new Jj(t.shape)).getCustomSetupFunc(n,i);return this.compileAndRun(a,[t],null,o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(gt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,FS,t.dtype);var n=new he(t.shape,FS);return this.compileAndRun(n,[t])},e.prototype.complexAbs=function(t){var n=this.texData.get(t.dataId),i=new eU(t.shape),a=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)];return this.compileAndRun(i,a)},e.prototype.sigmoid=function(t){var n=new he(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(n,[t])},e.prototype.softplus=function(t){var n=new he(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(n,[t])},e.prototype.sin=function(t){var n=new he(t.shape,oW);return this.compileAndRun(n,[t])},e.prototype.cos=function(t){var n=new he(t.shape,sW);return this.compileAndRun(n,[t])},e.prototype.tan=function(t){var n=new he(t.shape,"return tan(x);");return this.compileAndRun(n,[t])},e.prototype.asin=function(t){var n=new he(t.shape,uW);return this.compileAndRun(n,[t])},e.prototype.acos=function(t){var n=new he(t.shape,lW);return this.compileAndRun(n,[t])},e.prototype.atan=function(t){var n=new he(t.shape,cW);return this.compileAndRun(n,[t])},e.prototype.atan2=function(t,n){var i=gt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yo(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new xn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.sinh=function(t){var n=new he(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.cosh=function(t){var n=new he(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.tanh=function(t){var n=new he(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(n,[t])},e.prototype.asinh=function(t){var n=new he(t.shape,hW);return this.compileAndRun(n,[t])},e.prototype.acosh=function(t){var n=new he(t.shape,fW);return this.compileAndRun(n,[t])},e.prototype.atanh=function(t){var n=new he(t.shape,dW);return this.compileAndRun(n,[t])},e.prototype.erf=function(t){var n=new he(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(n,[t])},e.prototype.step=function(t,n){var i=new he(t.shape,function(a){return a===void 0&&(a=0),ua+`
    return x > 0.0 ? 1.0 : float(`+a+`);
  `}(n));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,n,i,a,o,u){var l=t.shape,h=this.texData.get(t.dataId),f=i.inChannels,p=l[0]*l[1]*l[2],m=i.outChannels,v=i.dataFormat==="channelsLast",b=(p===1||m===1)&&f>1e3,C=l[2]%2!=0&&!!h.isPacked;if(b||!gt().getBool("WEBGL_LAZILY_UNPACK")||!gt().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!C){var w=v?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],E=this.reshape(t,[1,w,i.inChannels]),S=this.reshape(n,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:E,b:S,transposeA:!1,transposeB:!1,bias:a,activation:o,preluActivationWeights:u}),i.outShape)}var A=v?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),k={dataId:t.dataId,shape:[1,A,i.inChannels],dtype:t.dtype},O=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,$(Of(h.shape,k.shape),function(){return"packed reshape "+h.shape+" to "+k.shape+" isn't free"});var V=this.reshape(n,[1,i.inChannels,i.outChannels]),T=this.fusedBatchMatMul({a:k,b:V,transposeA:!1,transposeB:!1,bias:a,activation:o,preluActivationWeights:u}),R=this.texData.get(T.dataId);return $(R.isPacked,function(){return"batchMatMul result is expected to be packed"}),h.shape=O,R.shape=i.outShape,J.makeTensorFromDataId(T.dataId,i.outShape,T.dtype)},e.prototype.conv2dWithIm2Row=function(t,n,i,a,o,u){var l=i.filterWidth,h=i.filterHeight,f=i.inChannels,p=i.outWidth,m=i.outHeight,v=i.dataFormat==="channelsLast",b=l*h*f,C=m*p,w=[b,C],E=t.squeeze([0]),S=n.reshape([1,b,-1]),A=new NU(w,E.shape,i),k=this.compileAndRun(A,[E]).reshape([1,w[0],w[1]]),O=a!=null,V=u!=null,T=o?Om(o,!0):null,R=new F1(k.shape,[1,C,i.outChannels],!0,!1,O,T,V),N=[k,S];a&&N.push(a),V&&N.push(u);var D=this.compileAndRun(R,N);return v?D.reshape([1,m,p,i.outChannels]):D.reshape([1,i.outChannels,m,p])},e.prototype.fusedConv2d=function(t){var n=t.input,i=t.filter,a=t.convInfo,o=t.bias,u=t.activation,l=t.preluActivationWeights;if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(n,i,a,o,u,l);if(gt().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,i,a,o,u,l);var h=o!=null,f=l!=null,p=u?Om(u,!1):null,m=new IS(a,h,p,f),v=[n,i];return o&&v.push(o),l&&v.push(l),this.compileAndRun(m,v)},e.prototype.conv2d=function(t,n,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,n,i);if(gt().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,n,i);var a=new IS(i);return this.compileAndRun(a,[t,n])},e.prototype.conv2dDerInput=function(t,n,i){var a=new aU(i);return this.compileAndRun(a,[t,n])},e.prototype.conv2dDerFilter=function(t,n,i){var a=new iU(i);return this.compileAndRun(a,[t,n])},e.prototype.fusedDepthwiseConv2D=function(t){var n,i=t.input,a=t.filter,o=t.convInfo,u=t.bias,l=t.activation,h=t.preluActivationWeights,f=gt().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,p=l?Om(l,f):null,m=[i,a],v=u!=null,b=h!=null;return v&&m.push(u),b&&m.push(h),f?(n=new DS(o,v,p,b),this.compileAndRun(n,m)):(n=new kS(o,v,p,b),this.compileAndRun(n,m))},e.prototype.depthwiseConv2D=function(t,n,i){var a;return gt().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(a=new DS(i),this.compileAndRun(a,[t,n])):(a=new kS(i),this.compileAndRun(a,[t,n]))},e.prototype.depthwiseConv2DDerInput=function(t,n,i){var a=new lU(i);return this.compileAndRun(a,[t,n])},e.prototype.depthwiseConv2DDerFilter=function(t,n,i){var a=new uU(i);return this.compileAndRun(a,[t,n])},e.prototype.conv3d=function(t,n,i){var a=new cU(i);return this.compileAndRun(a,[t,n])},e.prototype.conv3dDerInput=function(t,n,i){var a=new sU(i);return this.compileAndRun(a,[t,n])},e.prototype.conv3dDerFilter=function(t,n,i){var a=new oU(i);return this.compileAndRun(a,[t,n])},e.prototype.maxPool=function(t,n){var i=new B1(n,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,n){var i=new B1(n,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,n,i,a){var o=new B1(a,"max",!0),u=this.compileAndRun(o,[n]),l=new OU(a),h=this.compileAndRun(l,[t,u],n.dtype);return u.dispose(),h},e.prototype.avgPoolBackprop=function(t,n,i){var a=new $j(i);return this.compileAndRun(a,[t],n.dtype)},e.prototype.cast=function(t,n){return Wx(t,n,this)},e.prototype.unstack=function(t,n){for(var i=t.shape[n],a=new Array(t.rank-1),o=0,u=0;u<t.rank;u++)u!==n&&(a[o++]=t.shape[u]);var l=new Array(t.rank).fill(0),h=t.shape.slice();h[n]=1;var f=new Array(i);for(u=0;u<f.length;u++)l[n]=u,f[u]=this.slice(t,l,h).reshape(a);return f},e.prototype.avgPool3d=function(t,n){var i=new j1(n,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,n,i){var a=new Kj(i);return this.compileAndRun(a,[t],n.dtype)},e.prototype.maxPool3d=function(t,n){var i=new j1(n,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,n,i,a){var o=new j1(a,"max",!0),u=this.compileAndRun(o,[n]),l=new MU(a),h=this.compileAndRun(l,[t,u],n.dtype);return u.dispose(),h},e.prototype.reshape=function(t,n){var i=this.texData.get(t.dataId);if(i.isPacked&&!Of(t.shape,n)&&(i.texture===null||!Of(i.shape,n))){var a=this.packedReshape(t,n);return J.makeTensorFromDataId(a.dataId,a.shape,a.dtype)}return Pg(t,n)},e.prototype.resizeBilinear=function(t,n,i,a){var o=gt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new HU(t.shape,n,i,a):new WU(t.shape,n,i,a);return this.compileAndRun(o,[t])},e.prototype.resizeBilinearBackprop=function(t,n,i){var a=new UU(t,n,i);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighbor=function(t,n,i,a){var o=new GU(t.shape,n,i,a);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,n,i){var a=new qU(t,n,i);return this.compileAndRun(a,[t])},e.prototype.multinomial=function(t,n,i,a){var o=n?t:ul(t),u=o.shape[0],l=o.shape[1],h=new LU(u,l,i),f=h.getCustomSetupFunc(a);return this.compileAndRun(h,[o],"int32",f)},e.prototype.oneHot=function(t,n,i,a){var o=new PU(t.size,n,i,a);return this.compileAndRun(o,[t])},e.prototype.diag=function(t){var n=new gU(t.size);return this.compileAndRun(n,[t])},e.prototype.nonMaxSuppression=function(t,n,i,a,o){return Xb("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),qx(t.dataSync(),n.dataSync(),i,a,o)},e.prototype.cropAndResize=function(t,n,i,a,o,u){var l=new hU(t.shape,n.shape,a,o,u);return this.compileAndRun(l,[t,n,i])},e.prototype.depthToSpace=function(t,n,i){$(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});var a=t.shape[0],o=i==="NHWC"?t.shape[1]:t.shape[2],u=i==="NHWC"?t.shape[2]:t.shape[3],l=i==="NHWC"?t.shape[3]:t.shape[1],h=o*n,f=u*n,p=l/(n*n),m=new mU(i==="NHWC"?[a,h,f,p]:[a,p,h,f],n,i);return this.compileAndRun(m,[t])},e.prototype.split=function(t,n,i){return NI(t,n,i)},e.prototype.scatterND=function(t,n,i){var a=Mg(0,t,i),o=a.sliceRank,u=a.numUpdates,l=a.sliceSize,h=a.strides,f=a.outputSize,p=[f/l,l],m=t.reshape([u,o]),v=n.reshape([u,l]);if(f===0)return Pg(Rn([]),i);var b=zt(0),C=new PS(u,o,m.rank,v.rank,h,p);return this.compileAndRun(C,[v,m,b]).reshape(i)},e.prototype.sparseToDense=function(t,n,i,a){var o=Mg(0,t,i),u=o.sliceRank,l=o.numUpdates,h=o.strides,f=o.outputSize,p=new PS(l,u,t.rank,n.rank,h,[f,1],!1);return this.compileAndRun(p,[n,t,a]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,n){var i=this.texData.get(t.dataId),a=new MS(wU,t.shape,n),o=new MS(CU,t.shape,n),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],l=this.compileAndRun(a,u),h=this.compileAndRun(o,u),f=this.complex(l,h).as2D(t.shape[0],t.shape[1]);return l.dispose(),h.dispose(),f},e.prototype.gatherND=function(t,n){var i=n.shape,a=i[i.length-1],o=EI(t,n),u=o[0],l=o[1],h=o[2],f=o[3],p=n.reshape([l,a]),m=t.reshape([t.size/h,h]),v=new AU(a,f,[l,h]);return this.compileAndRun(v,[m,p]).reshape(u)},e.prototype.fill=function(t,n,i){if((i=i||th(n))==="string"){var a=ad(i,jt(t));return a.fill(n),J.makeTensor(a,t,i,this)}var o=new EU(t,n),u=o.getCustomSetupFunc(n);return this.compileAndRun(o,[],i,u)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,n,i){return Hx(t,n,i)},e.prototype.makeTensorInfo=function(t,n){var i=this.write(null,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n){var i=this.makeTensorInfo(t,n).dataId;return J.makeTensorFromDataId(i,t,n,this)},e.prototype.unpackTensor=function(t){var n=new mW(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new zU(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,n){var i=[ld(t.shape)].concat(cd(t.shape)),a={dtype:t.dtype,shape:i,dataId:t.dataId},o=[ld(n)].concat(cd(n)),u=new jU(o,i),l=this.runWebGLProgram(u,[a],t.dtype,null,!0);return{dataId:l.dataId,shape:n,dtype:l.dtype}},e.prototype.decode=function(t){var n,i=this.texData.get(t),a=i.isPacked,o=i.shape,u=i.dtype,l=ng(o);return n=a?new pU(l):new dU(l),{dtype:u,shape:o,dataId:this.runWebGLProgram(n,[{shape:l,dtype:u,dataId:t}],u,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,n,i,a,o){var u=this;o===void 0&&(o=!1);var l=this.makeTensorInfo(t.outputShape,i),h=this.texData.get(l.dataId);if(t.packedOutput&&(h.isPacked=!0),t.outPackingScheme===ud.DENSE){var f=Uf(t.outputShape);h.texShape=f.map(function(A){return 2*A})}if(t.outTexUsage!=null&&(h.usage=t.outTexUsage),jt(l.shape)===0)return h.values=id(l.dtype,0),l;var p=[],m=n.map(function(A){if(A.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var k=u.texData.get(A.dataId);if(k.texture==null){if(!t.packedInputs&&jt(A.shape)<=gt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:A.shape,texData:null,isUniform:!0,uniformValues:k.values};t.packedInputs&&(k.isPacked=!0,k.shape=A.shape)}else if(!!k.isPacked!=!!t.packedInputs)A=k.isPacked?u.unpackTensor(A):u.packTensor(A),p.push(A),k=u.texData.get(A.dataId);else if(k.isPacked&&!Of(k.shape,A.shape)){var O=A,V=A.shape;A.shape=k.shape,A=u.packedReshape(A,V),p.push(A),k=u.texData.get(A.dataId),O.shape=V}return u.uploadToGPU(A.dataId),{shape:A.shape,texData:k,isUniform:!1}});this.uploadToGPU(l.dataId);var v,b={shape:l.shape,texData:h,isUniform:!1},C=function(A,k,O){var V="";k.concat(O).forEach(function(N){var D=N.texData!=null&&N.texData.slice!=null&&N.texData.slice.flatOffset>0,L=N.isUniform?"uniform":N.texData.texShape;V+=N.shape+"_"+L+"_"+D});var T=A.userCode,R=A.constructor.name;return R+="_"+V+"_"+T}(t,m,b),w=this.getAndSaveBinary(C,function(){return function(A,k,O,V){var T=k.userCode,R=O.map(function(Q,ut){var W={logicalShape:Q.shape,texShape:Q.isUniform?null:Q.texData.texShape,isUniform:Q.isUniform,isPacked:!Q.isUniform&&Q.texData.isPacked,flatOffset:null};return Q.texData!=null&&Q.texData.slice!=null&&Q.texData.slice.flatOffset>0&&(W.flatOffset=Q.texData.slice.flatOffset),{name:k.variableNames[ut],shapeInfo:W}}),N=R.map(function(Q){return Q.shapeInfo}),D={logicalShape:V.shape,texShape:V.texData.texShape,isUniform:!1,isPacked:V.texData.isPacked,flatOffset:null},L=jj(R,D,T,k.packedInputs),P=A.createProgram(L),B=null,Z=A.getUniformLocation(P,"NAN",!1);gt().getNumber("WEBGL_VERSION")===1&&(B=A.getUniformLocation(P,"INFINITY",!1));for(var rt={},q=0;q<k.variableNames.length;q++){var K=k.variableNames[q];rt[K]=A.getUniformLocation(P,K,!1),rt["offset"+K]=A.getUniformLocation(P,"offset"+K,!1)}return{program:k,source:L,webGLProgram:P,uniformLocations:rt,inShapeInfos:N,outShapeInfo:D,infLoc:B,nanLoc:Z}}(u.gpgpu,t,m,b)}),E=this.activeTimers!=null;if(E&&(v=this.startTimer()),function(A,k,O,V,T){LS(k.inShapeInfos,O),LS([k.outShapeInfo],[V]);var R=V.texData.texture,N=V.texData.texShape;V.texData.isPacked?A.setOutputPackedMatrixTexture(R,N[0],N[1]):A.setOutputMatrixTexture(R,N[0],N[1]),A.setProgram(k.webGLProgram),gt().getNumber("WEBGL_VERSION")===1&&k.infLoc!==null&&A.gl.uniform1f(k.infLoc,1/0),k.nanLoc!==null&&A.gl.uniform1f(k.nanLoc,NaN),O.forEach(function(D,L){var P=k.program.variableNames[L],B=k.uniformLocations[P],Z=k.uniformLocations["offset"+P];if(B!=null)if(D.isUniform)if(jt(D.shape)<2)A.gl.uniform1f(B,D.uniformValues[0]);else{var rt=D.uniformValues;rt instanceof Float32Array||(rt=new Float32Array(rt)),A.gl.uniform1fv(B,rt)}else D.texData.slice!=null&&Z!=null&&A.gl.uniform1i(Z,D.texData.slice.flatOffset),A.setInputMatrixTexture(D.texData.texture,B,L)}),T!=null&&T(A,k.webGLProgram),A.executeProgram()}(this.gpgpu,w,m,b,a),p.forEach(function(A){return u.disposeData(A.dataId)}),E&&(v=this.endTimer(v),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(v)})),!gt().getBool("WEBGL_LAZILY_UNPACK")&&h.isPacked&&o===!1){var S=this.unpackTensor(l);return this.disposeData(l.dataId),S}return l},e.prototype.compileAndRun=function(t,n,i,a,o){o===void 0&&(o=!1),i=i||n[0].dtype;var u=this.runWebGLProgram(t,n,i,a,o);return J.makeTensorFromDataId(u.dataId,u.shape,u.dtype)},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.fromPixels2DContext!=null&&this.fromPixels2DContext.canvas.remove&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ft(function(){if(!gt().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=gt().getBool("DEBUG");gt().set("DEBUG",!1);var i=t.abs(zt(1e-8)).dataSync()[0];if(gt().set("DEBUG",n),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var n,i=this.texData.get(t),a=i.shape,o=i.dtype,u=i.values,l=i.texture,h=i.usage,f=i.isPacked;if(l==null){var p,m=this.activeTimers!=null;m&&(p=Yi());var v=i.texShape;if(v==null&&(v=tI(a,f),i.texShape=v),u!=null){var b=ng(a),C=void 0,w=v[1],E=v[0],S=u instanceof Uint8Array;f?(w=(n=kd(v[0],v[1]))[0],E=n[1],C=new xU(b,[E,w],S)):C=new bU(b,[E,w],S);var A=this.makeTensorInfo([E,w],o);this.texData.get(A.dataId).usage=S?pi.PIXELS:pi.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(A.dataId),w,E,u);var k=this.runWebGLProgram(C,[A],o,null,!0),O=this.texData.get(k.dataId);i.texture=O.texture,i.texShape=O.texShape,i.isPacked=O.isPacked,i.usage=O.usage,this.disposeData(A.dataId),this.texData.delete(k.dataId),i.values=null,m&&(this.uploadWaitMs+=Yi()-p)}else{var V=this.acquireTexture(v,h,o,f);i.texture=V}}},e.prototype.convertAndCacheOnCPU=function(t,n){var i=this.texData.get(t),a=i.dtype;return this.releaseGPUData(t),n!=null&&(i.values=function(o,u){if(u==="float32"||u==="complex64")return o;if(u==="int32"||u==="bool"){for(var l=u==="int32"?new Int32Array(o.length):new Uint8Array(o.length),h=0;h<l.length;++h)l[h]=Math.round(o[h]);return l}throw new Error("Unknown dtype "+u)}(n,a)),i.values},e.prototype.acquireTexture=function(t,n,i,a){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,a)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*bx(n)},e}(jx);MN()&&J.registerBackend("webgl",function(){return new ok},2);var Yx=tt({square_:function(r){var e=G(r,"x","square"),t=[e];return J.runKernelFunc(function(n,i){return i([e]),n.square(e)},{x:e},function(n,i){var a=i[0];return{x:function(){return n.mul(a.toFloat().mul(2))}}},"Square",{},t,[])}}),Bs=tt({abs_:function(r){var e=G(r,"x","abs");return e.dtype==="complex64"?J.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):J.runKernelFunc(function(t,n){var i=t.abs(e);return n([e]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}},"Abs")}}),Qx=tt({acos_:function(r){var e=G(r,"x","acos");return J.runKernelFunc(function(t,n){var i=t.acos(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(zt(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),Zx=tt({acosh_:function(r){var e=G(r,"x","acosh");return J.runKernelFunc(function(t,n){var i=t.acosh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),Jx=tt({asin_:function(r){var e=G(r,"x","asin");return J.runKernelFunc(function(t,n){var i=t.asin(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(zt(1).sub(i.toFloat().square()).sqrt())}}})}}),tw=tt({asinh_:function(r){var e=G(r,"x","asinh");return J.runKernelFunc(function(t,n){var i=t.asinh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(zt(1).add(i.toFloat().square()).sqrt())}}})}}),ew=tt({atan_:function(r){var e=G(r,"x","atan");return J.runKernelFunc(function(t,n){var i=t.atan(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),nw=tt({atanh_:function(r){var e=G(r,"x","atanh");return J.runKernelFunc(function(t,n){var i=t.atanh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(zt(1).sub(i.toFloat().square()))}}})}}),rw=tt({ceil_:function(r){var e=G(r,"x","ceil");return J.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),Ur=tt({clipByValue_:function(r,e,t){var n=G(r,"x","clipByValue");return $(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}),J.runKernelFunc(function(i,a){var o=i.clip(n,e,t);return a([n]),o},{$x:n},function(i,a){var o=a[0];return{$x:function(){return i.where(o.greaterEqual(e).logicalAnd(o.lessEqual(t)),Te(i))}}})}}),iw=tt({cos_:function(r){var e=G(r,"x","cos");return J.runKernelFunc(function(t,n){var i=t.cos(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().sin().neg().mul(t)}}})}}),aw=tt({cosh_:function(r){var e=G(r,"x","cosh");return J.runKernelFunc(function(t,n){var i=t.cosh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),ow=tt({erf_:function(r){var e=G(r,"x","erf");return $(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),J.runKernelFunc(function(t,n){var i=t.erf(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),sw=tt({exp_:function(r){var e=G(r,"x","exp");return J.runKernelFunc(function(t,n){var i=t.exp(e);return n([i]),i},{$x:e},function(t,n){return{$x:function(){return t.mulStrict(n[0])}}})}}),uw=tt({expm1_:function(r){var e=G(r,"x","expm1");return J.runKernelFunc(function(t,n){var i=t.expm1(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.exp())}}})}}),Dv=tt({floor_:function(r){var e=G(r,"x","floor");return J.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),Oo=tt({log_:function(r){var e=G(r,"x","log");return J.runKernelFunc(function(t,n){var i=t.log(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat())}}})}}),lw=tt({log1p_:function(r){var e=G(r,"x","log1p");return J.runKernelFunc(function(t,n){var i=t.log1p(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.add(1))}}})}}),sk=tt({logSigmoid_:function(r){var e=G(r,"x","logSigmoid");return J.runKernelFunc(function(t,n){var i=t.softplus(e.neg()).neg();return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),ll=tt({neg_:function(r){var e=G(r,"x","neg");return J.runKernelFunc(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})}}),cw=tt({reciprocal_:function(r){var e=G(r,"x","reciprocal");return J.runKernelFunc(function(t,n){var i=t.reciprocal(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.square().neg())}}})}}),hw=tt({round_:function(r){var e=G(r,"x","round");return J.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),Ov=tt({rsqrt_:function(r){var e=G(r,"x","rsqrt");return J.runKernelFunc(function(t,n){var i=t.rsqrt(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.pow(1.5).mul(2)).neg()}}})}}),Mv=tt({sigmoid_:function(r){var e=G(r,"x","sigmoid");return J.runKernelFunc(function(t,n){var i=t.sigmoid(e);return n([i]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return t.mul(i.mul(zt(1).sub(i)))}}},"Sigmoid")}}),fw=tt({sign_:function(r){var e=G(r,"x","sign");return J.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),uk=tt({isNaN_:function(r){var e=G(r,"x","isNaN");return J.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),lk=tt({isInf_:function(r){var e=G(r,"x","isInf");return J.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),ck=tt({isFinite_:function(r){var e=G(r,"x","isFinite");return J.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Te(t)}}})}}),dw=tt({sin_:function(r){var e=G(r,"x","sin");return J.runKernelFunc(function(t,n){var i=t.sin(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().cos().mul(t)}}})}}),pw=tt({sinh_:function(r){var e=G(r,"x","sinh");return J.runKernelFunc(function(t,n){var i=t.sinh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),Pd=tt({softplus_:function(r){var e=G(r,"x","softplus");return J.runKernelFunc(function(t,n){var i=t.softplus(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),zd=tt({sqrt_:function(r){var e=G(r,"x","sqrt");return J.runKernelFunc(function(t,n){var i=t.sqrt(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),hk=tt({step_:function(r,e){e===void 0&&(e=0);var t=G(r,"x","step");return J.runKernelFunc(function(n){return n.step(t,e)},{$x:t},function(n){return{$x:function(){return Te(n)}}})}}),mw=tt({tan_:function(r){var e=G(r,"x","tan");return J.runKernelFunc(function(t,n){var i=t.tan(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.cos().square())}}})}}),Lv=tt({tanh_:function(r){var e=G(r,"x","tanh");return J.runKernelFunc(function(t,n){var i=t.tanh(e);return n([i]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return zt(1).sub(i.square()).mulStrict(t)}}})}});function fk(r,e,t,n,i,a){var o,u,l=G(r,"x","batchNorm"),h=G(e,"mean","batchNorm"),f=G(t,"variance","batchNorm");return i!=null&&(o=G(i,"scale","batchNorm")),n!=null&&(u=G(n,"offset","batchNorm")),$(l.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."}),$(h.rank===2||h.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."}),$(f.rank===2||f.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+f.rank+"."}),o!=null&&$(o.rank===2||o.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."}),u!=null&&$(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+u.rank+"."}),Vd(l,h,f,u,o,a)}function dk(r,e,t,n,i,a){var o,u,l=G(r,"x","batchNorm"),h=G(e,"mean","batchNorm"),f=G(t,"variance","batchNorm");return i!=null&&(o=G(i,"scale","batchNorm")),n!=null&&(u=G(n,"offset","batchNorm")),$(l.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."}),$(h.rank===3||h.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."}),$(f.rank===3||f.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+f.rank+"."}),o!=null&&$(o.rank===3||o.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."}),u!=null&&$(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+u.rank+"."}),Vd(l,h,f,u,o,a)}function pk(r,e,t,n,i,a){var o,u,l=G(r,"x","batchNorm"),h=G(e,"mean","batchNorm"),f=G(t,"variance","batchNorm");return i!=null&&(o=G(i,"scale","batchNorm")),n!=null&&(u=G(n,"offset","batchNorm")),$(l.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+l.rank+"."}),$(h.rank===4||h.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."}),$(f.rank===4||f.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+f.rank+"."}),o!=null&&$(o.rank===4||o.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."}),u!=null&&$(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+u.rank+"."}),Vd(l,h,f,u,o,a)}function Vd(r,e,t,n,i,a){a==null&&(a=.001);var o,u,l,h=G(r,"x","batchNorm"),f=G(e,"mean","batchNorm"),p=G(t,"variance","batchNorm");i!=null&&(o=G(i,"scale","batchNorm")),n!=null&&(u=G(n,"offset","batchNorm")),$(f.rank===p.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),$(u==null||f.rank===u.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),$(o==null||f.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),l=h.rank===0||h.rank===1?h.as4D(1,1,1,h.size):h.rank===2?h.as4D(1,1,h.shape[0],h.shape[1]):h.rank===3?h.as4D(1,h.shape[0],h.shape[1],h.shape[2]):h;var m=[h,f,p,o];return J.runKernelFunc(function(v,b){var C=v.batchNormalization(l,Mm(f),Mm(p),a,Mm(o),Mm(u));return b([h,f,p,o]),C},{x:h,mean:f,variance:p,scale:o,offset:u},function(v,b){var C=b,w=C[0],E=C[1],S=C[2],A=C[3],k=A??zt(1),O=Bn(E.shape,l.shape),V=[];if(E.rank===1){for(var T=0;T<l.shape.length-1;++T)V.push(l.shape[T]);V.push(1)}var R=w.sub(E),N=v.mul(k),D=Ov(S.add(zt(a))),L=D.mul(D).mul(D).mul(zt(-.5));return{x:function(){return E.rank===1?v.mul(Ns(D.as4D(1,1,1,E.shape[0]),V)).mul(k).reshape(w.shape):v.mul(D).mul(k).reshape(w.shape)},mean:function(){var P=D.mul(zt(-1)).mul(N);return E.rank===1&&(P=P.sum(O)),P.reshape(E.shape)},variance:function(){var P=L.mul(R).mul(N);return E.rank===1&&(P=P.sum(O)),P.reshape(E.shape)},scale:function(){var P=R.mul(D),B=v.mul(P);return E.rank===1&&(B=B.sum(O)),B.reshape(E.shape)},offset:function(){var P=v;return E.rank===1&&(P=P.sum(O)),P.reshape(E.shape)}}},"BatchNormalization",{varianceEpsilon:a},m).reshape(h.shape)}function Mm(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function Pv(){xv("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var mk=tt({batchNormalization2d_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Pv(),fk(r,e,t,a,i,n)}}),gk=tt({batchNormalization3d_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Pv(),dk(r,e,t,a,i,n)}}),vk=tt({batchNormalization4d_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Pv(),pk(r,e,t,a,i,n)}}),yk=tt({batchNormalization_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Pv(),Vd(r,e,t,a,i,n)}}),gw=tt({batchNorm_:Vd}),vw=tt({batchNorm2d_:fk}),yw=tt({batchNorm3d_:dk}),bw=tt({batchNorm4d_:pk}),Vo=tt({logicalAnd_:function(r,e){var t=G(r,"a","logicalAnd","bool"),n=G(e,"b","logicalAnd","bool");return Ee(t.shape,n.shape),J.runKernelFunc(function(i){return i.logicalAnd(t,n)},{$a:t,$b:n})}}),xw=tt({logicalNot_:function(r){var e=G(r,"x","logicalNot","bool");return J.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),zv=tt({logicalOr_:function(r,e){var t=G(r,"a","logicalOr","bool"),n=G(e,"b","logicalOr","bool");return Ee(t.shape,n.shape),J.runKernelFunc(function(i){return i.logicalOr(t,n)},{$a:t,$b:n})}}),bk=tt({logicalXor_:function(r,e){var t=G(r,"a","logicalXor","bool"),n=G(e,"b","logicalXor","bool");return Ee(t.shape,n.shape),zv(r,e).logicalAnd(Vo(r,e).logicalNot())}}),Mo=tt({where_:function(r,e,t){var n=G(e,"a","where"),i=G(t,"b","where"),a=G(r,"condition","where","bool");return Me(n.shape,i.shape,"Error in where: "),a.rank===1?$(a.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Me(a.shape,i.shape,"Error in where: "),J.runKernelFunc(function(o,u){var l=o.select(a,n,i);return u([a]),l},{$condition:a,$a:n,$b:i},function(o,u){var l=u[0];return{$condition:function(){return Te(l).toFloat()},$a:function(){return o.mul(l.cast(o.dtype))},$b:function(){return o.mul(l.logicalNot().cast(o.dtype))}}})}}),Vv=function(r){return Ft(this,void 0,void 0,function(){var e,t,n;return Bt(this,function(i){switch(i.label){case 0:return[4,(e=G(r,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),n=Gx(e.shape,t),r!==e&&e.dispose(),[2,n]}})})},xe=tt({add_:function(r,e){var t,n=G(r,"a","add"),i=G(e,"b","add");t=Cn(n,i),n=t[0],i=t[1];var a=Ee(n.shape,i.shape);return J.runKernelFunc(function(o){return o.add(n,i)},{a:n,b:i},function(o){return{a:function(){var u=o,l=Bn(n.shape,a);return l.length>0&&(u=u.sum(l)),u.reshape(n.shape)},b:function(){var u=o,l=Bn(i.shape,a);return l.length>0&&(u=u.sum(l)),u.reshape(i.shape)}}},"Add")}}),ww=tt({addN_:function(r){$(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),$(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var e=r.map(function(i,a){return G(i,"tensors"+a,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!or(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return J.runKernelFunc(function(i){return i.addN(e)},n,function(i){var a={};return e.forEach(function(o,u){a[u]=function(){return i.clone()}}),a})}}),xk=tt({addStrict_:function(r,e){var t=G(r,"a","addStrict"),n=G(e,"b","addStrict");return Me(t.shape,n.shape,"Error in addStrict: "),t.add(n)}}),Cw=tt({atan2_:function(r,e){var t,n=G(r,"a","atan2"),i=G(e,"b","atan2");t=Cn(n,i),n=t[0],i=t[1];var a=Ee(n.shape,i.shape);return J.runKernelFunc(function(o,u){var l=o.atan2(n,i);return u([n,i]),l},{$a:n,$b:i},function(o,u){var l=u[0],h=u[1];return{$a:function(){var f=xe(l.square(),h.square()),p=o.mul(h.div(f)),m=Bn(l.shape,a);return m.length>0&&(p=p.sum(m)),p.reshape(l.shape)},$b:function(){var f=xe(l.square(),h.square()),p=ll(o.mul(l.div(f))),m=Bn(h.shape,a);return m.length>0&&(p=p.sum(m)),p.reshape(h.shape)}}})}}),kr=tt({div_:function(r,e){var t,n=G(r,"a","div"),i=G(e,"b","div");if(t=Cn(n,i),n=t[0],i=t[1],n.dtype==="int32"&&i.dtype==="int32")return Fv(n,i);var a=Ee(n.shape,i.shape);return J.runKernelFunc(function(o,u){var l=o.realDivide(n,i);return u([n,i]),l},{a:n,b:i},function(o,u){var l=u[0],h=u[1];return{a:function(){var f=o.div(h.toFloat()),p=Bn(l.shape,a);return p.length>0?f.sum(p).reshape(l.shape):f},b:function(){var f=o.mul(l.toFloat()),p=Bn(h.shape,a);p.length>0&&(f=f.sum(p).reshape(h.shape));var m=h.square();return f.div(m.toFloat()).neg()}}},"Div")}}),wk=tt({divStrict_:function(r,e){var t=G(r,"a","div"),n=G(e,"b","div");return Me(t.shape,n.shape,"Error in divideStrict: "),t.div(n)}}),Fv=tt({floorDiv_:function(r,e){var t,n=G(r,"a","floorDiv"),i=G(e,"b","floorDiv");t=Cn(n,i),n=t[0],i=t[1];var a=Ee(n.shape,i.shape);return J.runKernelFunc(function(o,u){var l=o.floorDiv(n,i);return u([n,i]),l},{$a:n,$b:i},function(o,u){var l=u[0],h=u[1];return{$a:function(){var f=o.div(h.toFloat()),p=Bn(l.shape,a);return p.length>0?f.sum(p).reshape(l.shape):f},$b:function(){var f=o.mul(l.toFloat()),p=Bn(h.shape,a);p.length>0&&(f=f.sum(p).reshape(h.shape));var m=h.square();return f.div(m.toFloat()).neg()}}})}}),Ha=tt({maximum_:function(r,e){var t,n=G(r,"a","maximum"),i=G(e,"b","maximum");return t=Cn(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),Ee(n.shape,i.shape),J.runKernelFunc(function(a,o){var u=a.maximum(n,i);return o([n,i]),u},{$a:n,$b:i},function(a,o){var u=o[0],l=o[1];return{$a:function(){return a.mul(u.greaterEqual(l).toFloat())},$b:function(){return a.mul(u.less(l).toFloat())}}})}}),Ck=tt({maximumStrict_:function(r,e){var t=G(r,"a","maximumStrict"),n=G(e,"b","maximumStrict");return Me(t.shape,n.shape,"Error in maximumStrict: "),t.maximum(n)}}),ih=tt({minimum_:function(r,e){var t,n=G(r,"a","minimum"),i=G(e,"b","minimum");return t=Cn(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),Ee(n.shape,i.shape),J.runKernelFunc(function(a,o){var u=a.minimum(n,i);return o([n,i]),u},{$a:n,$b:i},function(a,o){var u=o[0],l=o[1];return{$a:function(){return a.mul(u.lessEqual(l).toFloat())},$b:function(){return a.mul(u.greater(l).toFloat())}}})}}),Ek=tt({minimumStrict_:function(r,e){var t=G(r,"a","minimumStrict"),n=G(e,"b","minimumStrict");return Me(t.shape,n.shape,"Error in minimumStrict: "),t.minimum(n)}}),Ew=tt({mod_:function(r,e){var t,n=G(r,"a","mod"),i=G(e,"b","mod");t=Cn(n,i),n=t[0],i=t[1];var a=Ee(n.shape,i.shape);return J.runKernelFunc(function(o,u){var l=o.mod(n,i);return u([n,i]),l},{$a:n,$b:i},function(o,u){var l=u[0],h=u[1];return{$a:function(){var f=Bn(l.shape,a);return f.length>0?o.sum(f).reshape(l.shape):o},$b:function(){var f=o.mul(l.div(h).floor().neg()),p=Bn(h.shape,a);return p.length>0?f.sum(p).reshape(h.shape):f}}})}}),_k=tt({modStrict_:function(r,e){var t=G(r,"a","modStrict"),n=G(e,"b","modStrict");return Me(t.shape,n.shape,"Error in modStrict: "),t.mod(n)}}),ne=tt({mul_:function(r,e){var t,n=G(r,"a","mul"),i=G(e,"b","mul");t=Cn(n,i),n=t[0],i=t[1];var a=Ee(n.shape,i.shape);return J.runKernelFunc(function(o,u){var l=o.multiply(n,i);return u([n,i]),l},{a:n,b:i},function(o,u){var l=u[0],h=u[1];return{a:function(){var f=o.mul(h.toFloat()),p=Bn(l.shape,a);return p.length>0?f.sum(p).reshape(l.shape):f},b:function(){var f=o.mul(l.toFloat()),p=Bn(h.shape,a);return p.length>0?f.sum(p).reshape(h.shape):f}}},"Mul")}}),Bv=tt({mulStrict_:function(r,e){var t=G(r,"a","mul"),n=G(e,"b","mul");return Me(t.shape,n.shape,"Error in multiplyStrict: "),t.mul(n)}}),Oc=tt({pow_:function(r,e){var t=G(r,"base","pow"),n=G(e,"exp","pow"),i=Ee(t.shape,n.shape);return r=t.cast(Pn(t.dtype,n.dtype)),e=n.cast(Pn(t.dtype,n.dtype)),J.runKernelFunc(function(a,o){var u=a.pow(t,n);return o([t,n,u]),u},{$base:t,$exp:n},function(a,o){var u=o[0],l=o[1],h=o[2];return{$base:function(){var f=l.toFloat(),p=a.mul(f.mul(u.pow(f.sub(zt(1))))),m=Bn(u.shape,i);return m.length>0&&(p=p.sum(m)),p.reshape(u.shape)},$exp:function(){var f=u.greater(0),p=u.log().where(f,Te(u)),m=a.mul(h.mul(p)),v=Bn(l.shape,i);return v.length>0&&(m=m.sum(v)),m.reshape(l.shape)}}})}}),Tk=tt({powStrict_:function(r,e){return Me(r.shape,e.shape,"Error in powStrict: "),r.pow(e)}}),_w=tt({squaredDifference_:function(r,e){var t,n=G(r,"a","squaredDifference"),i=G(e,"b","squaredDifference");return t=Cn(n,i),n=t[0],i=t[1],Ee(n.shape,i.shape),J.runKernelFunc(function(a,o){var u=a.squaredDifference(n,i);return o([n,i]),u},{$a:n,$b:i},function(a,o){var u=o[0],l=o[1],h=zt(2);return{$a:function(){return a.mul(u.sub(l).mul(h))},$b:function(){return a.mul(l.sub(u).mul(h))}}})}}),Sk=tt({squaredDifferenceStrict_:function(r,e){var t=G(r,"a","squaredDifferenceStrict"),n=G(e,"b","squaredDifferenceStrict");return Me(t.shape,n.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(n)}}),sr=tt({sub_:function(r,e){var t,n=G(r,"a","sub"),i=G(e,"b","sub");t=Cn(n,i),n=t[0],i=t[1];var a=Ee(n.shape,i.shape);return J.runKernelFunc(function(o){return o.subtract(n,i)},{a:n,b:i},function(o){return{a:function(){var u=o,l=Bn(n.shape,a);return l.length>0&&(u=u.sum(l)),u.reshape(n.shape)},b:function(){var u=o,l=Bn(i.shape,a);return l.length>0&&(u=u.sum(l)),u.neg().reshape(i.shape)}}},"Sub")}}),Ak=tt({subStrict_:function(r,e){var t=G(r,"a","subStrict"),n=G(e,"b","subStrict");return Me(t.shape,n.shape,"Error in subStrict: "),t.sub(n)}}),cl=tt({equal_:function(r,e){var t,n=G(r,"a","equal"),i=G(e,"b","equal");return t=Cn(n,i),n=t[0],i=t[1],Ee(n.shape,i.shape),J.runKernelFunc(function(a){return a.equal(n,i)},{$a:n,$b:i})}}),Rk=tt({equalStrict_:function(r,e){var t=G(r,"a","equalStrict"),n=G(e,"b","equalStrict");return Me(t.shape,n.shape,"Error in equalStrict: "),t.equal(n)}}),ah=tt({greater_:function(r,e){var t,n=G(r,"a","greater"),i=G(e,"b","greater");return t=Cn(n,i),n=t[0],i=t[1],Ee(n.shape,i.shape),J.runKernelFunc(function(a){return a.greater(n,i)},{$a:n,$b:i})}}),Fd=tt({greaterEqual_:function(r,e){var t,n=G(r,"a","greaterEqual"),i=G(e,"b","greaterEqual");return t=Cn(n,i),n=t[0],i=t[1],Ee(n.shape,i.shape),J.runKernelFunc(function(a,o){var u=a.greaterEqual(n,i);return o([n,i]),u},{$a:n,$b:i},function(a,o){var u=o[0],l=o[1];return{$a:function(){return Te(u)},$b:function(){return Te(l)}}})}}),Nk=tt({greaterEqualStrict_:function(r,e){var t=G(r,"a","greaterEqualStrict"),n=G(e,"b","greaterEqualStrict");return Me(t.shape,n.shape,"Error in greaterEqualStrict: "),t.greaterEqual(n)}}),Ik=tt({greaterStrict_:function(r,e){var t=G(r,"a","greaterStrict"),n=G(e,"b","greaterStrict");return Me(t.shape,n.shape,"Error in greaterStrict: "),t.greater(n)}}),Tw=tt({less_:function(r,e){var t,n=G(r,"a","less"),i=G(e,"b","less");return t=Cn(n,i),n=t[0],i=t[1],Ee(n.shape,i.shape),J.runKernelFunc(function(a){return a.less(n,i)},{$a:n,$b:i})}}),Sw=tt({lessEqual_:function(r,e){var t,n=G(r,"a","lessEqual"),i=G(e,"b","lessEqual");return t=Cn(n,i),n=t[0],i=t[1],Ee(n.shape,i.shape),J.runKernelFunc(function(a){return a.lessEqual(n,i)},{$a:n,$b:i})}}),kk=tt({lessEqualStrict_:function(r,e){var t=G(r,"a","lessEqualStrict"),n=G(e,"b","lessEqualStrict");return Me(t.shape,n.shape,"Error in lessEqualStrict: "),t.lessEqual(n)}}),Dk=tt({lessStrict_:function(r,e){var t=G(r,"a","lessStrict"),n=G(e,"b","lessStrict");return Me(t.shape,n.shape,"Error in lessStrict: "),t.less(n)}}),Mc=tt({notEqual_:function(r,e){var t,n=G(r,"a","notEqual"),i=G(e,"b","notEqual");return t=Cn(n,i),n=t[0],i=t[1],Ee(n.shape,i.shape),J.runKernelFunc(function(a){return a.notEqual(n,i)},{$a:n,$b:i})}}),Ok=tt({notEqualStrict_:function(r,e){var t=G(r,"a","notEqualStrict"),n=G(e,"b","notEqualStrict");return Me(t.shape,n.shape,"Error in notEqualStrict: "),t.notEqual(n)}});function qS(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function GS(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var oh=tt({gather_:function(r,e,t){t===void 0&&(t=0);var n=G(r,"x","gather"),i=G(e,"indices","gather","int32");t=ur(t,n.shape)[0];var a=function(o,u,l){for(var h=o.shape[l],f=[],p=1,m=1,v=0;v<l;v++)f.push(o.shape[v]),p*=o.shape[v];for(v=0;v<u.rank;v++)f.push(u.shape[v]);for(v=l+1;v<o.rank;v++)f.push(o.shape[v]),m*=o.shape[v];return{batchSize:p,sliceSize:m,dimSize:h,outputShape:f}}(n,i,t);return J.runKernelFunc(function(o,u){var l=o.gather(n,i.flatten(),t);return u([i]),l},{$x:n},function(o,u){var l=u[0];return{$x:function(){var h=n.shape,f=l.size,p=h.slice(0,t),m=p.length,v=h.slice(t,h.length).slice(1),b=v.length,C=qS(0,m),w=qS(m+1,m+1+b),E=GS([p,[f],v]),S=o.reshape(E),A=l.reshape([f]),k=GS([[m],C,w]),O=S.transpose(k),V=Aw(O,A,n.shape[t]),T=wv(k);return V=V.transpose(T)}}}).reshape(a.outputShape)}}),Aw=tt({unsortedSegmentSum_:function(r,e,t){var n=G(r,"x","unsortedSegmentSum"),i=G(e,"segmentIds","unsortedSegmentSum","int32");return $(wn(t),function(){return"numSegments must be of dtype int"}),J.runKernelFunc(function(a,o){var u=a.unsortedSegmentSum(n,i,t);return o([i]),u},{$x:n},function(a,o){var u=o[0];return{$x:function(){return function(l,h){for(var f=Ha(h,Te(h)),p=oh(l,f),m=Fd(h,zt(0,"int32")),v=p.rank-m.rank,b=0;b<v;++b)m=fi(m,b+1);m=Vo(m,Wa(p.shape,"bool"));var C=Te(p);return Mo(m,p,C)}(a,u)}}})}}),Mk=function(r,e,t){return Ft(this,void 0,void 0,function(){var n,i,a,o,u,l,h,f,p,m,v,b,C;return Bt(this,function(w){switch(w.label){case 0:for(n=G(r,"tensor","boolMask"),i=G(e,"mask","boolMask","bool"),a=t??0,o=i.rank,u=n.shape,$(o>0,function(){return"mask cannot be scalar"}),Me(u.slice(a,a+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),l=1,h=a;h<a+o;h++)l*=u[h];return f=u.slice(0,a).concat([l],u.slice(a+o)),p=n.reshape(f),m=i.reshape([-1]),[4,Vv(m)];case 1:return v=w.sent(),b=v.squeeze([1]),C=oh(p,b,a),r!==n&&n.dispose(),e!==i&&i.dispose(),b.dispose(),p.dispose(),m.dispose(),v.dispose(),[2,C]}})})};function Lk(r,e,t,n,i,a,o){a===void 0&&(a="NHWC"),$(r.length===e.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"});var u=r,l=e,h=!1;e.rank===3&&(h=!0,l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),u=[1,r[0],r[1],r[2]]),$(u.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+u.length+"."}),$(l.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+l.rank}),$(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var f=a==="NHWC"?u[3]:u[1],p=a==="NHWC"?l.shape[3]:l.shape[1];$(f===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+f+") must match input depth for filter "+t.shape[2]+"."}),$(p===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+p+") must match output depth for filter "+t.shape[3]+"."}),o!=null&&$(wn(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var m=kv(a),v=Ks(u,t.shape,n,1,i,o,!1,m),b=J.runKernelFunc(function(C,w){var E=C.conv2dDerInput(l,t,v);return w([t,l]),E},{dy4D:l,filter:t},function(C,w){var E=w[0],S=w[1];return{dy4D:function(){return hl(C,E,n,i,a,1,o)},filter:function(){return Rw(C,S,E.shape,n,i,a,o)}}});return h?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}function W1(r){var e=function(a){return typeof a=="number"?[a,a,a]:a.length===2?[a[0],a[1],1]:a}(r),t=e[0],n=e[1],i=e[2];return t===1&&n===1&&i===1}function Pk(r,e,t,n,i){$(r.length===e.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"});var a=r,o=e,u=!1;e.rank===4&&(u=!0,o=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),a=[1,r[0],r[1],r[2],r[3]]);var l=a[4],h=o.shape[4];$(a.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),$(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank}),$(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),$(l===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[3]+"."}),$(h===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[4]+"."});var f=dd(a,t.shape,n,1,i),p=J.runKernelFunc(function(m){return m.conv3dDerInput(o,t,f)},{dy5D:o});return u?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}var jv=tt({conv1d_:function(r,e,t,n,i,a,o){i===void 0&&(i="NWC"),a===void 0&&(a=1);var u=G(r,"x","conv1d"),l=G(e,"filter","conv1d"),h=u,f=!1;u.rank===2&&(f=!0,h=u.as3D(1,u.shape[0],u.shape[1])),$(h.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+h.rank+"."}),$(l.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."}),o!=null&&$(wn(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."}),$(h.shape[2]===l.shape[1],function(){return"Error in conv1d: depth of input ("+h.shape[2]+") must match input depth for filter "+l.shape[1]+"."}),$(jr(t,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+a+"'"}),$(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var p=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]),m=h.as4D(h.shape[0],1,h.shape[1],h.shape[2]),v=hl(m,p,[1,t],n,"NHWC",[1,a],o);return f?v.as2D(v.shape[2],v.shape[3]):v.as3D(v.shape[0],v.shape[2],v.shape[3])}}),hl=tt({conv2d_:function(r,e,t,n,i,a,o){i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]);var u=G(r,"x","conv2d"),l=G(e,"filter","conv2d"),h=u,f=!1;u.rank===3&&(f=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),$(h.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+h.rank+"."}),$(l.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."}),o!=null&&$(wn(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var p=i==="NHWC"?h.shape[3]:h.shape[1];$(p===l.shape[2],function(){return"Error in conv2d: depth of input ("+p+") must match input depth for filter "+l.shape[2]+"."}),$(jr(t,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"});var m=kv(i),v=Ks(h.shape,l.shape,t,a,n,o,!1,m),b=J.runKernelFunc(function(C,w){var E=C.conv2d(h,l,v);return w([l,h]),E},{x:h,$filter:l},function(C,w){var E=w,S=E[0],A=E[1];return $(Qu(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return zk(A.shape,C,S,t,n,i)},$filter:function(){return Rw(A,C,S.shape,t,n,i)}}});return f?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),Uv=tt({conv3d_:function(r,e,t,n,i,a){i===void 0&&(i="NDHWC"),a===void 0&&(a=[1,1,1]);var o=G(r,"x","conv3d"),u=G(e,"filter","conv3d"),l=o,h=!1;o.rank===4&&(h=!0,l=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),$(l.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+l.rank+"."}),$(u.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+u.rank+"."}),$(l.shape[4]===u.shape[3],function(){return"Error in conv3d: depth of input ("+l.shape[4]+") must match input depth for filter "+u.shape[3]+"."}),$(function(m,v){return W1(m)||W1(v)}(t,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),$(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var f=dd(l.shape,u.shape,t,a,n),p=J.runKernelFunc(function(m,v){var b=m.conv3d(l,u,f);return v([l,u]),b},{x:l,$filter:u},function(m,v){$(W1(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var b=v[0],C=v[1];return{x:function(){return Pk(b.shape,m,C,t,n)},$filter:function(){return function(w,E,S,A,k){var O=w;w.rank===4&&(O=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]));var V=E;V.rank===4&&(V=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3])),$(O.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+O.shape+"."}),$(V.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+V.shape+"."}),$(S.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+S+"."}),$(O.shape[4]===S[3],function(){return"Error in conv3dDerFilter: depth of input "+O.shape[4]+") must match input depth in filter ("+S[3]+"."}),$(V.shape[4]===S[4],function(){return"Error in conv3dDerFilter: depth of dy ("+V.shape[4]+") must match output depth for filter ("+S[4]+")."});var T=dd(O.shape,S,A,1,k);return J.runKernelFunc(function(R){return R.conv3dDerFilter(O,V,T)},{x5D:O,dy5D:V})}(b,m,C.shape,t,n)}}});return h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Rw=tt({conv2dDerFilter_:function(r,e,t,n,i,a,o){a===void 0&&(a="NHWC");var u=r;r.rank===3&&(u=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var l=e;l.rank===3&&(l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),$(u.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+u.shape+"."}),$(l.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+l.shape+"."}),$(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var h=a==="NHWC"?u.shape[3]:u.shape[1],f=a==="NHWC"?l.shape[3]:l.shape[1];$(h===t[2],function(){return"Error in conv2dDerFilter: depth of input "+h+") must match input depth in filter ("+t[2]+"."}),$(f===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+f+") must match output depth for filter ("+t[3]+")."}),o!=null&&$(wn(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var p=kv(a),m=Ks(u.shape,t,n,1,i,o,!1,p);return J.runKernelFunc(function(v){return v.conv2dDerFilter(u,l,m)},{x4D:u,dy4D:l})}}),zk=tt({conv2dDerInput_:Lk}),sh=tt({depthwiseConv2d_:function(r,e,t,n,i,a,o){a===void 0&&(a=[1,1]);var u=G(r,"x","depthwiseConv2d"),l=G(e,"filter","depthwiseConv2d"),h=u,f=!1;u.rank===3&&(f=!0,h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),$(h.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+h.rank+"."}),$(l.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+l.rank+"."}),$(h.shape[3]===l.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+l.shape[2]+"."}),a==null&&(a=[1,1]),$(jr(t,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),o!=null&&$(wn(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var p=Ks(h.shape,l.shape,t,a,n,o,!0),m=J.runKernelFunc(function(v,b){var C=v.depthwiseConv2D(h,l,p);return b([h,l]),C},{x:h,$filter:l},function(v,b){$(Qu(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var C=b[0],w=b[1];return{x:function(){return Vk(C.shape,v,w,p)},$filter:function(){return Fk(C,v,w.shape,p)}}});return f?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Vk=tt({depthwiseConv2dDerInput_:function(r,e,t,n){var i=e,a=!1;e.rank===3&&(a=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var o=J.runKernelFunc(function(u){return u.depthwiseConv2DDerInput(i,t,n)},{dy4D:i});return a?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),Fk=tt({depthwiseConv2dDerFilter_:function(r,e,t,n){var i=r;r.rank===3&&(i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e;return a.rank===3&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),J.runKernelFunc(function(o){return o.depthwiseConv2DDerFilter(i,a,n)},{x4D:i,dy4D:a})}}),Nw=tt({separableConv2d_:function(r,e,t,n,i,a,o){a===void 0&&(a=[1,1]),o===void 0&&(o="NHWC");var u=G(r,"x","separableConv2d"),l=G(e,"depthwiseFilter","separableConv2d"),h=G(t,"pointwiseFilter","separableConv2d"),f=u,p=!1;if(u.rank===3&&(p=!0,f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");$(f.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+f.rank+"."}),$(l.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+l.rank+"."}),$(h.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+l.rank+"."}),$(h.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."}),$(h.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+h.shape[1]+"."});var m=l.shape[2],v=l.shape[3];$(h.shape[2]===m*v,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+m*v+", but got "+h.shape[2]+"."});var b=sh(f,l,n,i,o,a),C=hl(b,h,1,"valid",o);return p?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Wv=tt({conv2dTranspose_:function(r,e,t,n,i,a){return Lk(t,G(r,"x","conv2dTranspose"),G(e,"filter","conv2dTranspose"),n,i,"NHWC",a)}}),Bk=tt({conv3dTranspose_:function(r,e,t,n,i){return Pk(t,G(r,"x","conv3dTranspose"),G(e,"filter","conv3dTranspose"),n,i)}}),Hv=tt({matMul_:function(r,e,t,n){var i;t===void 0&&(t=!1),n===void 0&&(n=!1);var a=G(r,"a","matMul"),o=G(e,"b","matMul");i=Cn(a,o),a=i[0],o=i[1];var u=t?a.shape[a.rank-2]:a.shape[a.rank-1],l=n?o.shape[o.rank-1]:o.shape[o.rank-2],h=t?a.shape[a.rank-1]:a.shape[a.rank-2],f=n?o.shape[o.rank-2]:o.shape[o.rank-1],p=a.shape.slice(0,-2),m=o.shape.slice(0,-2),v=jt(p),b=jt(m);$(a.rank>=2&&o.rank>=2&&a.rank===o.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."}),$(or(p,m),function(){return"Error in matMul: outer dimensions ("+p+") and ("+m+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."}),$(u===l,function(){return"Error in matMul: inner shapes ("+u+") and ("+l+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+t+" and transposeB="+n+" must match."});var C=a.shape.slice(0,-2).concat([h,f]),w=t?a.as3D(v,u,h):a.as3D(v,h,u),E=n?o.as3D(b,f,l):o.as3D(b,l,f),S={transposeA:t,transposeB:n};return J.runKernelFunc(function(A,k){var O=A.batchMatMul(w,E,t,n);return k([w,E]),O},{a:w,b:E},function(A,k){var O=k,V=O[0],T=O[1];return t||n?!t&&n?{a:function(){return A.matMul(T,!1,!1)},b:function(){return A.matMul(V,!0,!1)}}:t&&!n?{a:function(){return T.matMul(A,!1,!0)},b:function(){return V.matMul(A,!1,!1)}}:{a:function(){return T.matMul(A,!0,!0)},b:function(){return A.matMul(V,!0,!0)}}:{a:function(){return A.matMul(T,!1,!0)},b:function(){return V.matMul(A,!0,!1)}}},"BatchMatMul",S).reshape(C)}}),jk=tt({dot_:function(r,e){var t=G(r,"t1","dot"),n=G(e,"t2","dot");$(!(t.rank!==1&&t.rank!==2||n.rank!==1&&n.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+n.rank+"."});var i=t.rank===1?t.size:t.shape[1],a=n.rank===1?n.size:n.shape[0];return $(i===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."}),t.rank===1&&n.rank===1?t.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():t.rank===1&&n.rank===2?t.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():t.rank===2&&n.rank===1?t.matMul(n.as2D(-1,1)).as1D():t.matMul(n.as2D(n.shape[0],n.shape[1]))}}),Uk=tt({outerProduct_:function(r,e){var t=G(r,"v1","outerProduct"),n=G(e,"v2","outerProduct");return $(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+n.rank+"."}),t.as2D(-1,1).matMul(n.as2D(1,-1))}}),Fa=tt({reverse_:function(r,e){var t=G(r,"x","reverse");if(t.rank===0)return t.clone();var n=ur(e,t.shape);return J.runKernelFunc(function(i){return i.reverse(t,n)},{$x:t},function(i){return{$x:function(){return i.reverse(n)}}}).reshapeAs(t)}}),Wk=tt({reverse1d_:function(r){var e=G(r,"x","reverse");return $(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Fa(e,0)}}),Hk=tt({reverse2d_:function(r,e){var t=G(r,"x","reverse");return $(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Fa(t,e)}}),qk=tt({reverse3d_:function(r,e){var t=G(r,"x","reverse");return $(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Fa(t,e)}}),Gk=tt({reverse4d_:function(r,e){var t=G(r,"x","reverse");return $(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Fa(t,e)}});function $k(r,e,t,n,i,a){var o=G(r,"x","maxPool"),u=o,l=!1;o.rank===3&&(l=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),$(u.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+u.rank+"."}),$(jr(t,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"}),a!=null&&$(wn(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var h=Dc(u.shape,e,t,n,i,a),f=J.runKernelFunc(function(p,m){var v=p.maxPool(u,h);return m([u,v]),v},{x:u},function(p,m){var v=m[0],b=m[1];return{x:function(){return function(C,w,E,S,A,k,O,V){var T=G(C,"dy","maxPoolBackprop"),R=G(w,"input","maxPoolBackprop"),N=G(E,"output","maxPoolBackprop");$(R.rank===T.rank,function(){return"Rank of input ("+R.rank+") does not match rank of dy ("+T.rank+")"}),$(jr(A,k),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+A+" and dilations '"+k+"'"}),$(T.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+T.rank+"."}),$(R.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+R.rank+"."});var D=Dc(R.shape,S,A,k,O,V);return J.runKernelFunc(function(L){return L.maxPoolBackprop(T,R,N,D)},{$dy:T,$input:R})}(p,v,b,e,t,n,i)}}});return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function Kk(r,e,t,n,i,a){var o=G(r,"x","avgPool","float32");$(jr(t,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"});var u=o,l=!1;o.rank===3&&(l=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),$(u.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+u.rank+"."}),a!=null&&$(wn(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var h=Dc(u.shape,e,t,n,i,a),f=J.runKernelFunc(function(p){return p.avgPool(u,h)},{x:u},function(p){return{x:function(){return function(m,v,b,C,w,E){var S=G(m,"dy","avgPoolBackprop"),A=G(v,"input","avgPoolBackprop");$(A.rank===S.rank,function(){return"Rank of input ("+A.rank+") does not match rank of dy ("+S.rank+")"}),$(jr(C,w),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+C+" and dilations '"+w+"'"});var k=A,O=S,V=!1;A.rank===3&&(V=!0,k=A.as4D(1,A.shape[0],A.shape[1],A.shape[2]),O=S.as4D(1,S.shape[0],S.shape[1],S.shape[2])),$(O.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+O.rank+"."}),$(k.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+k.rank+"."});var T=Dc(k.shape,b,C,w,E),R=J.runKernelFunc(function(N){return N.avgPoolBackprop(O,k,T)},{dy4D:O,input4D:k});return V?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}(p,u,e,t,n,i)}}});return f=f.cast(o.dtype),l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}var qv=tt({maxPool_:function(r,e,t,n,i){return $k(r,e,t,1,n,i)}}),Gv=tt({avgPool_:function(r,e,t,n,i){return Kk(r,e,t,1,n,i)}}),Xk=tt({pool_:function(r,e,t,n,i,a){i==null&&(i=[1,1]),a==null&&(a=1),n===0&&(n="valid");var o=G(r,"x","maxPool"),u=o,l=!1;o.rank===3&&(l=!0,u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),$(jr(a,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"});var h,f=Dc(u.shape,e,a,i,n),p=[f.dilationHeight,f.dilationWidth];h=n==="same"?function(k,O){var V=k.map(function(N,D){return N+(N-1)*(O[D]-1)}).map(function(N){return N-1}),T=V.map(function(N){return Math.floor(N/2)}),R=V.map(function(N,D){return N-T[D]});return V.map(function(N,D){return[T[D],R[D]]})}([f.filterHeight,f.filterWidth],p):[[0,0],[0,0]];var m=p[0]===1&&p[1]===1,v=function(k,O,V){var T=V.map(function(Z){return Z[0]}),R=V.map(function(Z){return Z[1]}),N=k.concat(T,R),D=O.map(function(Z,rt){return(Z-N[rt]%Z)%Z}),L=R.map(function(Z,rt){return Z+D[rt]}),P=O.map(function(Z,rt){return[T[rt],L[rt]]}),B=O.map(function(Z,rt){return[0,D[rt]]});return[P,B]}([f.inHeight,f.inWidth],p,h),b=v[0],C=v[1],w=m?n:"valid",E=m?u:Av(u,p,b),S=(t==="avg"?function(){return Kk(E,e,a,1,w)}:function(){return $k(E,e,a,1,w)})(),A=m?S:_v(S,p,C);return l?A.as3D(A.shape[1],A.shape[2],A.shape[3]):A}}),$v=tt({maxPool3d_:function(r,e,t,n,i,a,o){a===void 0&&(a="NDHWC");var u=G(r,"x","maxPool3d"),l=u,h=!1;u.rank===4&&(h=!0,l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),o==null&&(o=[1,1,1]),$(l.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+l.rank+"."}),$(a==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),$(jr(t,o),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),i!=null&&$(wn(n),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var f=fd(l.shape,e,t,o,n,i,a),p=J.runKernelFunc(function(m,v){var b=m.maxPool3d(l,f);return v([l,b]),b},{x:l},function(m,v){var b=v[0],C=v[1];return{x:function(){return function(w,E,S,A,k,O,V,T){var R=G(w,"dy","maxPool3dBackprop"),N=G(E,"input","maxPool3dBackprop"),D=G(S,"output","maxPool3dBackprop"),L=R,P=N,B=D,Z=!1;N.rank===4&&(Z=!0,L=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),P=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3]),B=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3])),$(L.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+L.rank+"."}),$(P.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+P.rank+"."}),$(B.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+B.rank+"."}),O==null&&(O=[1,1,1]),$(jr(k,O),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+k+" and dilations '"+O+"'"}),T!=null&&$(wn(V),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+V+"."});var rt=fd(P.shape,A,k,O,V,T),q=J.runKernelFunc(function(K){return K.maxPool3dBackprop(L,P,B,rt)},{dy5D:L,input5D:P});return Z?q.as4D(q.shape[1],q.shape[2],q.shape[3],q.shape[4]):q}(m,b,C,e,t,o,n,i)}}});return h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Kv=tt({avgPool3d_:function(r,e,t,n,i,a,o){a===void 0&&(a="NDHWC");var u=G(r,"x","avgPool3d","float32"),l=u,h=!1;u.rank===4&&(h=!0,l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),o==null&&(o=[1,1,1]),$(l.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+l.rank+"."}),$(a==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),$(jr(t,o),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),i!=null&&$(wn(n),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var f=fd(l.shape,e,t,o,n,i,a),p=J.runKernelFunc(function(m){return m.avgPool3d(l,f)},{x:l},function(m){return{x:function(){return function(v,b,C,w,E,S,A){var k=G(v,"dy","avgPool3dBackprop"),O=G(b,"input","avgPool3dBackprop"),V=k,T=O,R=!1;O.rank===4&&(R=!0,V=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3]),T=O.as5D(1,O.shape[0],O.shape[1],O.shape[2],O.shape[3])),$(V.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+V.rank+"."}),$(T.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),E==null&&(E=[1,1,1]),$(jr(w,E),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+E+"'"}),A!=null&&$(wn(S),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+A+" but got pad "+S+"."});var N=fd(T.shape,C,w,E,S,A),D=J.runKernelFunc(function(L){return L.avgPool3dBackprop(V,T,N)},{dy5D:V,input5D:T});return R?D.as4D(D.shape[1],D.shape[2],D.shape[3],D.shape[4]):D}(m,l,e,t,o,n,i)}}});return p=p.cast(l.dtype),h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),bi=tt({slice_:function(r,e,t){var n,i,a=G(r,"x","slice");if(a.rank===0)throw new Error("Slicing scalar is not possible");(n=typeof e=="number"?[e].concat(new Array(a.rank-1).fill(0)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(0)):e.slice()).forEach(function(l){$(l!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=t==null?new Array(a.rank).fill(-1):typeof t=="number"?[t].concat(new Array(a.rank-1).fill(-1)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(-1)):t).map(function(l,h){return l>=0?l:($(l===-1,function(){return"Negative size values should be exactly -1 but got "+l+" for the slice() size at index "+h+"."}),a.shape[h]-n[h])}),TI(a,n,i);var o=a.shape,u={begin:n,size:i};return J.runKernelFunc(function(l){return l.slice(a,n,i)},{x:a},function(l){for(var h=[],f=0;f<l.rank;f++)h.push([n[f],o[f]-n[f]-i[f]]);return{x:function(){return l.pad(h)}}},"Slice",u)}}),Bd=tt({slice1d_:function(r,e,t){var n=G(r,"x","slice1d");return $(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),bi(n,[e],[t])}}),Xv=tt({slice2d_:function(r,e,t){var n=G(r,"x","slice2d");return $(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),bi(n,e,t)}}),jd=tt({slice3d_:function(r,e,t){var n=G(r,"x","slice3d");return $(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),bi(n,e,t)}}),Lc=tt({slice4d_:function(r,e,t){var n=G(r,"x","slice4d");return $(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),bi(n,e,t)}});function Yk(r,e,t,n,i){return e.rank<t.rank&&(e=e.reshape(vi(e.shape,n))),r.rank<t.rank&&(r=r.reshape(vi(r.shape,n))),{$x:function(){var a=r.mul(t.equal(e).cast(r.dtype));return i==null?a:a.transpose(i)}}}var Yv=tt({all_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=G(r,"x","all","bool"),i=ur(e,n.shape),a=i,o=oa(a,n.rank);o!=null&&(n=n.transpose(o),a=sa(a.length,n.rank));var u=J.runKernelFunc(function(h){return h.all(n,a)},{$x:n});if(t){var l=vi(u.shape,i);return u.reshape(l)}return u}}),pd=tt({any_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=G(r,"x","any","bool"),i=ur(e,n.shape),a=i,o=oa(a,n.rank);o!=null&&(n=n.transpose(o),a=sa(a.length,n.rank));var u=J.runKernelFunc(function(h){return h.any(n,a)},{$x:n});if(t){var l=vi(u.shape,i);return u.reshape(l)}return u}}),md=tt({argMax_:function(r,e){e===void 0&&(e=0);var t=G(r,"x","argMax");e==null&&(e=0);var n=ur(e,t.shape),i=oa(n,t.rank);return i!=null&&(t=t.transpose(i),n=sa(n.length,t.rank)),J.runKernelFunc(function(a,o){var u=a.argMax(t,n[0]);return o([t]),u},{$x:t},function(a,o){var u=o[0];return{$x:function(){return Te(u)}}})}}),Iw=tt({argMin_:function(r,e){e===void 0&&(e=0);var t=G(r,"x","argMin");e==null&&(e=0);var n=ur(e,t.shape),i=oa(n,t.rank);return i!=null&&(t=t.transpose(i),n=sa(n.length,t.rank)),J.runKernelFunc(function(a,o){var u=a.argMin(t,n[0]);return o([t]),u},{$x:t},function(a,o){var u=o[0];return{$x:function(){return Te(u)}}})}}),Qk=tt({logSumExp_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=G(r,"x","logSumExp"),i=ur(e,n.shape),a=n.max(i,!0),o=n.sub(a).exp().sum(i).log(),u=a.reshape(o.shape).add(o);if(t){var l=vi(u.shape,i);return u.reshape(l)}return u}}),js=tt({max_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=G(r,"x","max"),i=n,a=ur(e,n.shape),o=a,u=oa(o,n.rank);u!=null&&(n=n.transpose(u),o=sa(o.length,n.rank));var l=J.runKernelFunc(function(f,p){var m=f.max(n,o);return p([i,m]),m},{$x:n},function(f,p){return Yk(f,p[1],p[0],a,u)});if(t){var h=vi(l.shape,a);l=l.reshape(h)}return l}}),Nn=tt({mean_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=G(r,"x","mean"),i=ur(e,n.shape),a=jt(gr(n.shape,i)[1]);return rh(function(o){var u=zt(a);return{value:(u.dtype===o.dtype?o:o.cast(u.dtype)).div(u).sum(e,t),gradFunc:function(l){var h=o.shape.slice();return i.forEach(function(f){h[f]=1}),l.reshape(h).mul(Wa(o.shape,"float32")).div(a)}}})(n)}}),Qv=tt({min_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=G(r,"x","min"),i=n,a=ur(e,n.shape),o=a,u=oa(o,n.rank);u!=null&&(n=n.transpose(u),o=sa(o.length,n.rank));var l=J.runKernelFunc(function(f,p){var m=f.min(n,o);return p([i,m]),m},{$x:n},function(f,p){return Yk(f,p[1],p[0],a,u)});if(t){var h=vi(l.shape,a);l=l.reshape(h)}return l}}),Ud=tt({moments_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=ur(e,(r=G(r,"x","moments")).shape),i=r.mean(n,t),a=i.shape;t||(a=vi(i.shape,n));var o=r.toFloat().sub(i.reshape(a)).square();return{mean:i,variance:o.mean(n,t)}}}),ti=tt({sum_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=G(r,"x","sum");n.dtype==="bool"&&(n=n.toInt());var i=ur(e,n.shape);return rh(function(a){var o=oa(i,a.rank),u=i,l=a;o!=null&&(l=a.transpose(o),u=sa(u.length,a.rank));var h=J.runKernelFunc(function(p){return p.sum(l,u)},{permutedX:l});if(t){var f=vi(h.shape,i);h=h.reshape(f)}return{value:h,gradFunc:function(p){var m=a.shape.slice();return i.forEach(function(v){m[v]=1}),p.reshape(m).mul(Wa(a.shape,"float32"))}}})(n)}}),Zv=tt({prod_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=G(r,"x","prod");n.dtype==="bool"&&(n=n.toInt());var i=ur(e,n.shape),a=oa(i,n.rank),o=i,u=n;a!=null&&(u=n.transpose(a),o=sa(o.length,n.rank));var l=J.runKernelFunc(function(f){return f.prod(u,o)},{permutedX:u});if(t){var h=vi(l.shape,i);l=l.reshape(h)}return l}}),uh=tt({elu_:function(r){var e=G(r,"x","elu");return J.runKernelFunc(function(t,n){var i=t.elu(e);return n([i]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return J.runKernelFunc(function(a){return a.eluDer(t,i)},{dy:t,y:i})}}})}}),Jv=tt({leakyRelu_:function(r,e){e===void 0&&(e=.2);var t=G(r,"x","leakyRelu");return Ha(zt(e).mul(t),t)}}),ty=tt({prelu_:function(r,e){var t=G(r,"x","prelu"),n=G(e,"alpha","prelu");return J.runKernelFunc(function(i,a){var o=i.prelu(t,n);return a([t,n]),o},{x:t,alpha:n},function(i,a){var o=a[0],u=a[1],l=o.greater(0);return{x:function(){return Mo(l,i,i.mul(u))},alpha:function(){var h=Mo(l,Te(i),i.mul(o)),f=Bn(u.shape,i.shape);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)}}},"Prelu")}}),Xs=tt({relu_:function(r){var e=G(r,"x","relu");return e.dtype==="bool"?e.toInt():J.runKernelFunc(function(t,n){var i=t.relu(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mulStrict(i.step().toFloat())}}})}}),kw=tt({relu6_:function(r){var e=G(r,"x","relu6");return e.dtype==="bool"?e.toInt():J.runKernelFunc(function(t,n){var i=t.relu6(e);return n([e]),i},{$x:e},function(t,n){var i=n[0],a=i.lessEqual(6).mul(i.step());return{$x:function(){return t.mulStrict(a.toFloat())}}})}}),ey=tt({selu_:function(r){var e=G(r,"x","selu");return J.runKernelFunc(function(t,n){var i=t.selu(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){var a=i.greater(zt(0)),o=zt(Kx),u=zt(Xx),l=t.mul(u),h=t.mul(o).mul(i.toFloat().exp());return Mo(a,l,h)}}})}}),fn=tt({transpose_:function(r,e){var t=G(r,"x","transpose");return e==null&&(e=t.shape.map(function(n,i){return i}).reverse()),$(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(n){$(n>=0&&n<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1?t.clone():J.runKernelFunc(function(n){return n.transpose(t,e)},{$x:t},function(n){var i=wv(e);return{$x:function(){return n.transpose(i)}}})}}),Dw=tt({localResponseNormalization_:function(r,e,t,n,i){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5);var a=G(r,"x","localResponseNormalization");$(a.rank===4||a.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+a.rank+"."}),$(wn(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var o=a,u=!1;a.rank===3&&(u=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var l=J.runKernelFunc(function(h,f){var p=h.localResponseNormalization4D(o,e,t,n,i);return f([o,p]),p},{x4D:o},function(h,f){var p=f[0],m=f[1];return{x4D:function(){return J.runKernelFunc(function(v){return v.LRNGrad(h,p,m,e,t,n,i)},{})}}});return u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),Ow=tt({norm_:function(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1);var i=function u(l,h,f){if(f===void 0&&(f=null),l.rank===0)return l.abs();if(l.rank!==1&&f===null)return u(l.reshape([-1]),h,f);if(l.rank===1||typeof f=="number"||Array.isArray(f)&&f.length===1){if(h===1)return l.abs().sum(f);if(h===1/0)return l.abs().max(f);if(h===-1/0)return l.abs().min(f);if(h==="euclidean"||h===2)return l.abs().pow(zt(2,"int32")).sum(f).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}if(Array.isArray(f)&&f.length===2){if(h===1)return l.abs().sum(f[0]).max(f[1]-1);if(h===1/0)return l.abs().sum(f[1]).max(f[0]);if(h===-1/0)return l.abs().sum(f[1]).min(f[0]);if(h==="fro"||h==="euclidean")return l.square().sum(f).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}throw new Error("Error in norm: invalid axis: "+f)}(r=G(r,"x","norm"),e,t),a=i.shape;if(n){var o=ur(t,r.shape);a=vi(i.shape,o)}return i.reshape(a)}}),Zk=tt({basicLSTMCell_:function(r,e,t,n,i,a){var o=G(r,"forgetBias","basicLSTMCell"),u=G(e,"lstmKernel","basicLSTMCell"),l=G(t,"lstmBias","basicLSTMCell"),h=G(n,"data","basicLSTMCell"),f=G(i,"c","basicLSTMCell"),p=G(a,"h","basicLSTMCell"),m=h.concat(p,1).matMul(u).add(l),v=m.shape[0],b=m.shape[1]/4,C=[v,b],w=m.slice([0,0],C),E=m.slice([0,b],C),S=m.slice([0,2*b],C),A=m.slice([0,3*b],C),k=w.sigmoid().mulStrict(E.tanh()).addStrict(f.mulStrict(o.add(S).sigmoid())),O=k.tanh().mulStrict(A.sigmoid());return[k,O]}}),Jk=tt({multiRNNCell_:function(r,e,t,n){for(var i=G(e,"data","multiRNNCell"),a=hd(t,"c","multiRNNCell"),o=hd(n,"h","multiRNNCell"),u=i,l=[],h=0;h<r.length;h++){var f=r[h](u,a[h],o[h]);l.push(f[0]),l.push(f[1]),u=f[1]}var p=[],m=[];for(h=0;h<l.length;h+=2)p.push(l[h]),m.push(l[h+1]);return[p,m]}}),t5=tt({movingAverage_:function(r,e,t,n,i){i===void 0&&(i=!0);var a=G(r,"v","movingAverage"),o=G(e,"x","movingAverage"),u=G(t,"decay","movingAverage");ON(a,o),$(or(a.shape,o.shape),function(){return"Shape mismatch in v and x"});var l=zt(1),h=l.sub(u),f=o.sub(a).mul(h);if(i){$(n!=null,function(){return"When using zeroDebias: true, step is required."});var p=G(n,"step","movingAverage");f=f.div(l.sub(Oc(u,p)))}return a.add(f)}}),Mw=tt({stridedSlice_:function(r,e,t,n,i,a,o,u,l){if(i===void 0&&(i=0),a===void 0&&(a=0),o===void 0&&(o=0),u===void 0&&(u=0),l===void 0&&(l=0),n==null&&(n=new Array(e.length)),o!==0)throw new Error("ellipsis mask is not yet supported");var h=G(r,"x","stridedSlice"),f=Yb(u),p=h.shape.slice();f.forEach(function(w){e[w]=0,t[w]=1,p.splice(w,0,1)}),h=h.reshape(p);for(var m=0;m<h.rank;m++)e[m]=SI(i,e,n,h.shape,m),t[m]=AI(a,t,n,h.shape,m),n[m]=n[m]||1;var v=Yb(l);v.forEach(function(w){t[w]=e[w]+1,n[w]=1});var b=Rv(e,t,n),C=b.filter(function(w,E){return v.indexOf(E)===-1});return n.every(function(w){return w===1})?bi(h,e,b).reshape(C):J.runKernelFunc(function(w){return w.stridedSlice(h,e,t,n)},{$x:h}).reshape(C)}}),Lw=tt({topk_:function(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=G(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=n.shape[n.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var a=J.runKernelFunc(function(o){return o.topk(n,e,t)},{$x:n});return{values:a[0],indices:a[1]}}}),Pw=tt({scatterND_:function(r,e,t){var n=G(r,"indices","scatterND","int32"),i=G(e,"updates","scatterND");return Rj(i,n,t),J.runKernelFunc(function(a){return a.scatterND(n,i,t)},{$indices:n,$updates:i})}}),Wd=tt({fft_:function(r){$(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return J.runKernelFunc(function(i){return i.fft(n)},{input:r}).reshape(r.shape)}}),Pc=tt({ifft_:function(r){$(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return J.runKernelFunc(function(i){return i.ifft(n)},{input:r}).reshape(r.shape)}}),Hd=tt({rfft_:function(r,e){$(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t,n=r.shape[r.shape.length-1],i=r.size/n;if(e!=null&&e<n){var a=r.shape.map(function(E){return 0}),o=r.shape.map(function(E){return E});o[r.shape.length-1]=e,t=r.slice(a,o),n=e}else if(e!=null&&e>n){var u=r.shape.map(function(E){return E});u[r.shape.length-1]=e-n,t=r.concat(Ue(u),r.shape.length-1),n=e}else t=r;var l=t.zerosLike(),h=Kn(t,l).as2D(i,n),f=Wd(h),p=Math.floor(n/2)+1,m=Qr(f),v=zi(f),b=m.split([p,n-p],m.shape.length-1),C=v.split([p,n-p],v.shape.length-1),w=t.shape.slice();return w[t.shape.length-1]=p,Kn(b[0],C[0]).reshape(w)}}),ny=tt({irfft_:function(r){var e=r.shape[r.shape.length-1],t=r.size/e;if(e<=2){var n=r.as2D(t,e),i=Pc(n);return Qr(i)}var a=[t,2*(e-1)],o=Qr(r).as2D(t,e),u=zi(r).as2D(t,e),l=o.slice([0,1],[t,e-2]).reverse(1),h=u.slice([0,1],[t,e-2]).reverse(1).mul(zt(-1)),f=o.concat(l,1),p=u.concat(h,1);return n=Kn(f,p).as2D(a[0],a[1]),i=Pc(n),Qr(i)}}),e5=Object.freeze({fft:Wd,ifft:Pc,rfft:Hd,irfft:ny}),ry=tt({sparseToDense_:function(r,e,t,n){n===void 0&&(n=0);var i=G(r,"sparseIndices","sparseToDense","int32"),a=G(e,"sparseValues","sparseToDense"),o=G(n,"defaultValue","sparseToDense",a.dtype);return function(u,l,h,f){if(u.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+u.dtype+".");if(u.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+u.shape+".");var p=u.rank>0?u.shape[0]:1,m=u.rank>1?u.shape[1]:1;if(h.length!==m)throw new Error("outputShape has incorrect number of elements:, "+h.length+", should be: "+m+".");var v=l.size;if(l.rank!==0&&(l.rank!==1||v!==p))throw new Error("sparseValues has incorrect shape "+l.shape+", should be [] or ["+p+"]");if(l.dtype!==f.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,t,o),J.runKernelFunc(function(u){return u.sparseToDense(i,a,t,o)},{$sparseIndices:i,$sparseValues:a,$defaultValue:o})}}),zw=tt({gatherND_:function(r,e){var t=G(e,"indices","gatherND","int32"),n=G(r,"x","gatherND");return J.runKernelFunc(function(i){return i.gatherND(n,t)},{$x:n,$indices:t})}}),n5=tt({diag_:function(r){var e=G(r,"x","diag").flatten(),t=r.shape.concat(r.shape);return J.runKernelFunc(function(n){return n.diag(e)},{$x:e}).reshape(t)}}),Vw=tt({dropout_:function(r,e,t,n){var i=G(r,"x","dropout");if($(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),$(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return r instanceof Ge?i.clone():i;var a=function(l,h){if(h==null)return l.shape.slice();if(or(l.shape,h))return h;if(l.shape.length===h.length){for(var f=[],p=0;p<l.shape.length;p++)h[p]==null&&l.shape[p]!=null?f.push(l.shape[p]):f.push(h[p]);return f}return h}(i,t),o=1-e,u=sl(a,0,1,"float32",n).add(o).floor().div(o);return i.mul(u)}});function r5(r,e,t){for(var n=1-r%2,i=new Float32Array(r),a=0;a<r;++a){var o=2*Math.PI*a/(r+n-1);i[a]=e-t*Math.cos(o)}return Jr(i,"float32")}var iy=tt({hannWindow_:function(r){return r5(r,.5,.5)}}),Fw=tt({hammingWindow_:function(r){return r5(r,.54,.46)}}),ay=tt({frame_:function(r,e,t,n,i){n===void 0&&(n=!1),i===void 0&&(i=0);for(var a=0,o=[];a+e<=r.size;)o.push(bi(r,a,e)),a+=t;if(n)for(;a<r.size;){var u=a+e-r.size,l=Ir([bi(r,a,e-u),nh([u],i)]);o.push(l),a+=t}return o.length===0?_o([],[0,e]):Ir(o).as2D(o.length,e)}}),Bw=tt({stft_:function(r,e,t,n,i){var a;i===void 0&&(i=iy),n==null&&(a=e,n=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var o=ay(r,e,t),u=ne(o,i(e)),l=[],h=0;h<o.shape[0];h++)l.push(Hd(u.slice([h,0],[1,e]),n));return Ir(l)}}),i5=Object.freeze({hannWindow:iy,hammingWindow:Fw,frame:ay,stft:Bw}),xr,a5=function(r,e,t){return t===void 0&&(t=1),Ft(this,void 0,void 0,function(){var n,i,a,o,u,l,h,f,p,m,v,b,C,w;return Bt(this,function(E){switch(E.label){case 0:return n=G(r,"predictions","inTopK"),i=G(e,"targets","inTopK"),$(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank}),$(n.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+i.rank}),Me(n.shape.slice(0,n.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=n.shape[n.shape.length-1],$(t>0&&t<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+t}),[4,n.data()];case 1:return o=E.sent(),[4,i.data()];case 2:for(u=E.sent(),l=[o.length/a,a],f=l[1],p=id("bool",h=l[0]),m=0;m<h;m++){for(v=m*f,b=o.subarray(v,v+f),C=[],w=0;w<b.length;w++)C.push({value:b[w],index:w});for(C.sort(function(S,A){return A.value-S.value}),p[m]=0,w=0;w<t;w++)if(C[w].index===u[m]){p[m]=1;break}}return r!==n&&n.dispose(),e!==i&&i.dispose(),[2,Rn(p,i.shape,"bool")]}})})};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(xr||(xr={}));var vW=tt({absoluteDifference_:function(r,e,t,n){n===void 0&&(n=xr.SUM_BY_NONZERO_WEIGHTS);var i=G(r,"labels","absoluteDifference"),a=G(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=G(t,"weights","absoluteDifference")),Me(i.shape,a.shape,"Error in absoluteDifference: ");var u=i.sub(a).abs();return Fo(u,o,n)}}),Fo=tt({computeWeightedLoss_:function(r,e,t){t===void 0&&(t=xr.SUM_BY_NONZERO_WEIGHTS);var n=G(r,"losses","computeWeightedLoss"),i=null;e!=null&&(i=G(e,"weights","computeWeightedLoss"));var a=i==null?n:n.mul(i);if(t===xr.NONE)return a;if(t===xr.SUM)return a.sum();if(t===xr.MEAN){if(i==null)return a.mean();var o=n.size/i.size,u=a.sum().div(i.sum());return o>1?u.div(zt(o)):u}if(t===xr.SUM_BY_NONZERO_WEIGHTS){if(i==null)return a.sum().div(zt(n.size));var l=i.mul(Wa(n.shape)).notEqual(zt(0)).sum().toFloat();return a.sum().div(l)}throw Error("Unknown reduction: "+t)}}),yW=tt({cosineDistance_:function(r,e,t,n,i){i===void 0&&(i=xr.SUM_BY_NONZERO_WEIGHTS);var a=G(r,"labels","cosineDistance"),o=G(e,"predictions","cosineDistance"),u=null;n!=null&&(u=G(n,"weights","cosineDistance")),Me(a.shape,o.shape,"Error in cosineDistance: ");var l=zt(1).sub(a.mul(o).sum(t,!0));return Fo(l,u,i)}}),bW=tt({hingeLoss_:function(r,e,t,n){n===void 0&&(n=xr.SUM_BY_NONZERO_WEIGHTS);var i=G(r,"labels","hingeLoss"),a=G(e,"predictions","hingeLoss"),o=null;t!=null&&(o=G(t,"weights","hingeLoss")),Me(i.shape,a.shape,"Error in hingeLoss: ");var u=zt(1);i=zt(2).mul(i).sub(u);var l=u.sub(i.mul(a)).relu();return Fo(l,o,n)}}),xW=tt({huberLoss_:function(r,e,t,n,i){n===void 0&&(n=1),i===void 0&&(i=xr.SUM_BY_NONZERO_WEIGHTS);var a=G(r,"labels","huberLoss"),o=G(e,"predictions","huberLoss"),u=null;t!=null&&(u=G(t,"weights","huberLoss")),Me(a.shape,o.shape,"Error in huberLoss: ");var l=zt(n),h=o.sub(a).abs(),f=ih(h,l),p=h.sub(f),m=zt(.5).mul(f.square()).add(l.mul(p));return Fo(m,u,i)}}),wW=tt({logLoss_:function(r,e,t,n,i){n===void 0&&(n=1e-7),i===void 0&&(i=xr.SUM_BY_NONZERO_WEIGHTS);var a=G(r,"labels","logLoss"),o=G(e,"predictions","logLoss"),u=null;t!=null&&(u=G(t,"weights","logLoss")),Me(a.shape,o.shape,"Error in logLoss: ");var l=zt(1),h=zt(n),f=a.mul(o.add(h).log()).neg().sub(l.sub(a).mul(l.sub(o).add(h).log()));return Fo(f,u,i)}}),CW=tt({meanSquaredError_:function(r,e,t,n){n===void 0&&(n=xr.SUM_BY_NONZERO_WEIGHTS);var i=G(r,"labels","meanSquaredError"),a=G(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=G(t,"weights","meanSquaredError")),Me(i.shape,a.shape,"Error in meanSquaredError: ");var u=i.squaredDifference(a);return Fo(u,o,n)}}),EW=tt({sigmoidCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=xr.SUM_BY_NONZERO_WEIGHTS);var a=G(r,"multiClassLabels","sigmoidCrossEntropy"),o=G(e,"logits","sigmoidCrossEntropy"),u=null;if(t!=null&&(u=G(t,"weights","sigmoidCrossEntropy")),Me(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var l=zt(n),h=zt(1),f=zt(.5);a=a.mul(h.sub(l)).add(f.mul(l))}var p=function(m,v){var b=G(m,"labels","sigmoidCrossEntropyWithLogits"),C=G(v,"logits","sigmoidCrossEntropyWithLogits");Me(b.shape,C.shape,"Error in sigmoidCrossEntropyWithLogits: ");var w=C.relu(),E=C.mul(b),S=C.abs().neg().exp().log1p();return w.sub(E).add(S)}(a,o);return Fo(p,u,i)}}),_W=tt({softmaxCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=xr.SUM_BY_NONZERO_WEIGHTS);var a=G(r,"onehotLabels","softmaxCrossEntropy"),o=G(e,"logits","softmaxCrossEntropy"),u=null;if(t!=null&&(u=G(t,"weights","softmaxCrossEntropy")),Me(a.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var l=zt(n),h=zt(1),f=zt(a.shape[1]);a=a.mul(h.sub(l)).add(l.div(f))}var p=function(m,v,b){if(b===void 0&&(b=-1),b===-1&&(b=v.rank-1),b!==v.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+v.rank+" and dim was "+b);return rh(function(C,w,E){var S=w.logSumExp([b],!0),A=w.toFloat().sub(S);return E([C,A]),{value:A.mul(C).neg().sum([b]),gradFunc:function(k,O){var V=O[0],T=O[1],R=vi(k.shape,[b]);return[k.reshape(R).mul(V.toFloat().sub(T.exp())),k.reshape(R).mul(T.exp().sub(V.toFloat()))]}}})(m,v)}(a,o);return Fo(p,u,i)}}),o5=Object.freeze({get Reduction(){return xr},absoluteDifference:vW,computeWeightedLoss:Fo,cosineDistance:yW,hingeLoss:bW,huberLoss:xW,logLoss:wW,meanSquaredError:CW,sigmoidCrossEntropy:EW,softmaxCrossEntropy:_W});function $S(r,e){return e===void 0&&(e=!1),J.tidy(function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var t=r.shape[0],n=r.shape[1],i=Sv(t),a=r.clone(),o=_o([[1]],[1,1]),u=o.clone(),l=t>=n?n:t,h=function(p){var m,v=a,b=u,C=i;m=J.tidy(function(){var w=a.slice([p,p],[t-p,1]),E=w.norm(),S=a.slice([p,p],[1,1]),A=_o([[-1]]).where(S.greater(0),_o([[1]])),k=S.sub(A.mul(E)),O=w.div(k);u=O.shape[0]===1?o.clone():o.concat(O.slice([1,0],[O.shape[0]-1,O.shape[1]]),0);var V=A.matMul(k).div(E).neg(),T=a.slice([p,0],[t-p,n]),R=V.mul(u);if(p===0)a=T.sub(R.matMul(u.transpose().matMul(T)));else{var N=T.sub(R.matMul(u.transpose().matMul(T)));a=a.slice([0,0],[p,n]).concat(N,0)}var D=i.slice([0,p],[t,i.shape[1]-p]);if(p===0)i=D.sub(D.matMul(u).matMul(R.transpose()));else{var L=D.sub(D.matMul(u).matMul(R.transpose()));i=i.slice([0,0],[t,p]).concat(L,1)}return[u,a,i]}),u=m[0],a=m[1],i=m[2],de([v,b,C])},f=0;f<l;++f)h(f);return!e&&t>n&&(i=i.slice([0,0],[t,n]),a=a.slice([0,0],[n,n])),[i,a]})}var TW=tt({gramSchmidt_:function(r){var e;if(Array.isArray(r)){e=!1,$(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(l){$(r[l].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[l].shape[0]+" vs. "+t+")"})},i=1;i<r.length;++i)n(i)}else e=!0,r=To(r,r.shape[0],0).map(function(l){return Od(l,[0])});$(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var a=[],o=r,u=function(l){a.push(J.tidy(function(){var h=o[l];if(l>0)for(var f=0;f<l;++f){var p=ti(a[f].mulStrict(h)).mul(a[f]);h=h.sub(p)}return h.div(Ow(h,"euclidean"))}))};for(i=0;i<r.length;++i)u(i);return e?na(a,0):a}}),SW=tt({qr_:function(r,e){if(e===void 0&&(e=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return $S(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(o,u){return o*u}),n=Yu(r.reshape([t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),i=[],a=[];return n.forEach(function(o){var u=$S(o,e),l=u[0],h=u[1];i.push(l),a.push(h)}),[na(i,0).reshape(r.shape),na(a,0).reshape(r.shape)]}}),jw=Object.freeze({gramSchmidt:TW,qr:SW});function s5(r,e,t,n,i){n==null&&(n=.5),i==null&&(i=Number.NEGATIVE_INFINITY);var a=r.shape[0];return t=Math.min(t,a),$(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),$(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),$(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),$(e.rank===1,function(){return"scores must be a 1D tensor"}),$(e.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:i}}var AW=tt({resizeBilinear_:function(r,e,t){t===void 0&&(t=!1);var n=G(r,"images","resizeBilinear");$(n.rank===3||n.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."}),$(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=n,a=!1;n.rank===3&&(a=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e[0],u=e[1],l=J.runKernelFunc(function(h,f){return f([i]),h.resizeBilinear(i,o,u,t)},{batchImages:i},function(h,f){return{batchImages:function(){return J.runKernelFunc(function(p){return p.resizeBilinearBackprop(h,f[0],t)},{})}}});return a?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),RW=tt({resizeNearestNeighbor_:function(r,e,t){t===void 0&&(t=!1);var n=G(r,"images","resizeNearestNeighbor");$(n.rank===3||n.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."}),$(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),$(n.dtype==="float32"||n.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=n,a=!1;n.rank===3&&(a=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e[0],u=e[1],l=J.runKernelFunc(function(h,f){return f([i]),h.resizeNearestNeighbor(i,o,u,t)},{batchImages:i},function(h,f){return{batchImages:function(){return J.runKernelFunc(function(p){return p.resizeNearestNeighborBackprop(h,f[0],t)},{})}}});return a?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),NW=tt({nonMaxSuppression_:function(r,e,t,n,i){n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var a=G(r,"boxes","nonMaxSuppression"),o=G(e,"scores","nonMaxSuppression"),u=s5(a,o,t,n,i);return t=u.maxOutputSize,n=u.iouThreshold,i=u.scoreThreshold,J.runKernelFunc(function(l){return l.nonMaxSuppression(a,o,t,n,i)},{$boxes:a})}}),IW=function(r,e,t,n,i){return n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),Ft(this,void 0,void 0,function(){var a,o,u,l,h,f,p;return Bt(this,function(m){switch(m.label){case 0:return a=G(r,"boxes","nonMaxSuppressionAsync"),o=G(e,"scores","nonMaxSuppressionAsync"),u=s5(a,o,t,n,i),t=u.maxOutputSize,n=u.iouThreshold,i=u.scoreThreshold,[4,Promise.all([a.data(),o.data()])];case 1:return l=m.sent(),h=l[0],f=l[1],p=qx(h,f,t,n,i),a!==r&&a.dispose(),o!==e&&o.dispose(),[2,p]}})})},kW=tt({cropAndResize_:function(r,e,t,n,i,a){var o=G(r,"image","cropAndResize","float32"),u=G(e,"boxes","cropAndResize","float32"),l=G(t,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var h=u.shape[0];return $(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."}),$(u.rank===2&&u.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+h+",4] but had shape "+u.shape+"."}),$(l.rank===1&&l.shape[0]===h,function(){return"Error in cropAndResize: boxInd must be have size ["+h+"] but had shape "+u.shape+"."}),$(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),$(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),$(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),J.runKernelFunc(function(f,p){return f.cropAndResize(o,u,l,n,i,a)},{$image:o,$boxes:u})}}),Wu=Object.freeze({resizeBilinear:AW,resizeNearestNeighbor:RW,nonMaxSuppression:NW,nonMaxSuppressionAsync:IW,cropAndResize:kW}),Uw=function(r,e){return!(r>0)&&(e==="linear"||e==="relu")},Ww=function(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return r.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},Hw=function(r,e){var t=e,n=Bn(r.shape,e.shape);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},qw=function(r,e,t){if(e==="linear")return r;if(e==="relu")return Xs(r);if(e==="elu")return uh(r);if(e==="relu6")return kw(r);if(e==="prelu")return ty(r,t);throw new Error("Unknown fused activation "+e+".")},DW=tt({matMul_:function(r){var e,t=r.a,n=r.b,i=r.transposeA,a=i!==void 0&&i,o=r.transposeB,u=o!==void 0&&o,l=r.bias,h=r.activation,f=h===void 0?"linear":h,p=r.preluActivationWeights;if(Uw(J.state.gradientDepth,f)===!1){var m=Hv(t,n,a,u);return l!=null&&(m=xe(m,l)),qw(m,f,p)}var v=G(t,"a","fused matMul"),b=G(n,"b","fused matMul");e=Cn(v,b),v=e[0],b=e[1];var C=a?v.shape[v.rank-2]:v.shape[v.rank-1],w=u?b.shape[b.rank-1]:b.shape[b.rank-2],E=a?v.shape[v.rank-1]:v.shape[v.rank-2],S=u?b.shape[b.rank-2]:b.shape[b.rank-1],A=v.shape.slice(0,-2),k=b.shape.slice(0,-2),O=jt(A),V=jt(k);$(v.rank>=2&&b.rank>=2&&v.rank===b.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+v.rank+" and "+b.rank+"."}),$(or(A,k),function(){return"Error in fused matMul: outer dimensions ("+A+") and ("+k+") of Tensors with shapes "+v.shape+" and "+b.shape+" must match."}),$(C===w,function(){return"Error in fused matMul: inner shapes ("+C+") and ("+w+") of Tensors with shapes "+v.shape+" and "+b.shape+" and transposeA="+a+" and transposeB="+u+" must match."});var T,R,N=v.shape.slice(0,-2).concat([E,S]),D=a?v.as3D(O,C,E):v.as3D(O,E,C),L=u?b.as3D(V,S,w):b.as3D(V,w,S);l!=null&&Ee(N,(T=Cn(T=G(l,"bias","fused matMul"),v)[0]).shape),p!=null&&(R=G(p,"prelu weights","fused matMul"));var P={$a:D,$b:L};return l!=null&&(P.$bias=T),p!=null&&(P.$preluActivationWeights=R),J.runKernelFunc(function(B,Z){var rt=B.fusedBatchMatMul({a:D,b:L,transposeA:a,transposeB:u,bias:T,activation:f,preluActivationWeights:R});return Z([D,L,rt]),rt},P,function(B,Z){var rt=Z[0],q=Z[1],K=Z[2],Q=Ww(B,K,f),ut={};return l!=null&&(ut={$bias:function(){return Hw(T,Q)}}),Object.assign(a||u?!a&&u?{$a:function(){return Q.matMul(q,!1,!1)},$b:function(){return Q.matMul(rt,!0,!1)}}:a&&!u?{$a:function(){return q.matMul(Q,!1,!0)},$b:function(){return rt.matMul(Q,!1,!1)}}:{$a:function(){return q.matMul(Q,!0,!0)},$b:function(){return Q.matMul(rt,!0,!0)}}:{$a:function(){return Q.matMul(q,!1,!0)},$b:function(){return rt.matMul(Q,!0,!1)}},ut)}).reshape(N)}}),OW=tt({conv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,i=r.pad,a=r.dataFormat,o=a===void 0?"NHWC":a,u=r.dilations,l=u===void 0?[1,1]:u,h=r.dimRoundingMode,f=r.bias,p=r.activation,m=p===void 0?"linear":p,v=r.preluActivationWeights;if(m=m||"linear",Uw(J.state.gradientDepth,m)===!1){var b=hl(e,t,n,i,o,l,h);return f!=null&&(b=xe(b,f)),qw(b,m,v)}var C=G(e,"x","conv2d"),w=G(t,"filter","conv2d"),E=C,S=!1;C.rank===3&&(S=!0,E=C.as4D(1,C.shape[0],C.shape[1],C.shape[2])),$(E.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+E.rank+"."}),$(w.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+w.rank+"."}),h!=null&&$(wn(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+h+" but got pad "+i+"."}),$(E.shape[3]===w.shape[2],function(){return"Error in conv2d: depth of input ("+E.shape[3]+") must match input depth for filter "+w.shape[2]+"."}),$(jr(n,l),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+l+"'"}),$(o==="NHWC",function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var A,k,O=Ks(E.shape,w.shape,n,l,i,h);f!=null&&(A=Cn(A=G(f,"bias","fused conv2d"),C)[0],Ee(O.outShape,A.shape)),v!=null&&(k=G(v,"prelu weights","fused conv2d"));var V={x:E,$filter:w};f!=null&&(V.$bias=A),v!=null&&(V.$preluActivationWeights=k);var T=J.runKernelFunc(function(R,N){var D=R.fusedConv2d({input:E,filter:w,convInfo:O,bias:A,activation:m,preluActivationWeights:k});return N([w,E,D]),D},V,function(R,N){var D=N,L=D[0],P=D[1],B=D[2],Z=Ww(R,B,m);$(Qu(l),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+l+"'"});var rt={};return f!=null&&(rt={$bias:function(){return Hw(A,Z)}}),Object.assign({x:function(){return zk(P.shape,Z,L,n,i)},$filter:function(){return Rw(P,Z,L.shape,n,i)}},rt)});return S?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}}),MW=tt({depthwiseConv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,i=r.pad,a=r.dataFormat,o=a===void 0?"NHWC":a,u=r.dilations,l=u===void 0?[1,1]:u,h=r.dimRoundingMode,f=r.bias,p=r.activation,m=p===void 0?"linear":p,v=r.preluActivationWeights;if(Uw(J.state.gradientDepth,m)===!1){var b=sh(e,t,n,i,o,l,h);return f!=null&&(b=xe(b,f)),qw(b,m,v)}var C=G(e,"x","depthwiseConv2d"),w=G(t,"filter","depthwiseConv2d"),E=C,S=!1;C.rank===3&&(S=!0,E=C.as4D(1,C.shape[0],C.shape[1],C.shape[2])),$(E.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+E.rank+"."}),$(w.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+w.rank+"."}),$(E.shape[3]===w.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+E.shape[3]+") must match the inChannels dimension in filter "+w.shape[2]+"."}),l==null&&(l=[1,1]),$(jr(n,l),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+l+"'"}),h!=null&&$(wn(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+h+" but got pad "+i+"."});var A,k,O=Ks(E.shape,w.shape,n,l,i,h,!0);f!=null&&(A=Cn(A=G(f,"bias","fused conv2d"),C)[0],Ee(O.outShape,A.shape)),v!=null&&(k=G(v,"prelu weights","fused depthwiseConv2d"));var V={x:E,$filter:w};f!=null&&(V.$bias=A),v!=null&&(V.$preluActivationWeights=k);var T=J.runKernelFunc(function(R,N){var D=R.fusedDepthwiseConv2D({input:E,filter:w,convInfo:O,bias:A,activation:m,preluActivationWeights:k});return N([E,w,D]),D},V,function(R,N){$(Qu(l),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+l+"'"});var D=N[0],L=N[1],P=N[2],B=Ww(R,P,m),Z={};return f!=null&&(Z={$bias:function(){return Hw(A,B)}}),Object.assign({x:function(){return Vk(D.shape,B,L,O)},$filter:function(){return Fk(D,B,L.shape,O)}},Z)});return S?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}}),zc=Object.freeze({matMul:DW,conv2d:OW,depthwiseConv2d:MW}),LW=Object.freeze({image:Wu,linalg:jw,losses:o5,spectral:e5,fused:zc,signal:i5,square:Yx,conv1d:jv,conv2d:hl,conv3d:Uv,depthwiseConv2d:sh,separableConv2d:Nw,conv2dTranspose:Wv,conv3dTranspose:Bk,op:tt,batchNormalization2d:mk,batchNormalization3d:gk,batchNormalization4d:vk,batchNormalization:yk,batchNorm:gw,batchNorm2d:vw,batchNorm3d:yw,batchNorm4d:bw,booleanMaskAsync:Mk,complex:Kn,real:Qr,imag:zi,concat:Ir,concat1d:Nx,concat2d:Ix,concat3d:kx,concat4d:Dx,split:To,matMul:Hv,dot:jk,outerProduct:Uk,reverse:Fa,reverse1d:Wk,reverse2d:Hk,reverse3d:qk,reverse4d:Gk,maxPool:qv,avgPool:Gv,pool:Xk,maxPool3d:$v,avgPool3d:Kv,slice:bi,slice1d:Bd,slice2d:Xv,slice3d:jd,slice4d:Lc,abs:Bs,acos:Qx,acosh:Zx,asin:Jx,asinh:tw,atan:ew,atanh:nw,ceil:rw,clipByValue:Ur,cos:iw,cosh:aw,erf:ow,exp:sw,expm1:uw,floor:Dv,log:Oo,log1p:lw,logSigmoid:sk,neg:ll,reciprocal:cw,round:hw,rsqrt:Ov,sigmoid:Mv,sign:fw,isNaN:uk,isInf:lk,isFinite:ck,sin:dw,sinh:pw,softplus:Pd,sqrt:zd,step:hk,tan:mw,tanh:Lv,all:Yv,any:pd,argMax:md,argMin:Iw,logSumExp:Qk,max:js,mean:Nn,min:Qv,moments:Ud,sum:ti,prod:Zv,equal:cl,equalStrict:Rk,greater:ah,greaterEqual:Fd,greaterEqualStrict:Nk,greaterStrict:Ik,less:Tw,lessEqual:Sw,lessEqualStrict:kk,lessStrict:Dk,notEqual:Mc,notEqualStrict:Ok,add:xe,addN:ww,addStrict:xk,atan2:Cw,div:kr,divStrict:wk,floorDiv:Fv,maximum:Ha,maximumStrict:Ck,minimum:ih,minimumStrict:Ek,mod:Ew,modStrict:_k,mul:ne,mulStrict:Bv,pow:Oc,powStrict:Tk,squaredDifference:_w,squaredDifferenceStrict:Sk,sub:sr,subStrict:Ak,elu:uh,leakyRelu:Jv,prelu:ty,relu:Xs,relu6:kw,selu:ey,logicalAnd:Vo,logicalNot:xw,logicalOr:zv,logicalXor:bk,where:Mo,whereAsync:Vv,buffer:ie,print:fI,batchToSpaceND:_v,cast:Tv,clone:dI,cumsum:pI,depthToSpace:Mx,expandDims:fi,eye:Sv,multinomial:Lx,oneHot:kc,pad:$s,pad1d:mI,pad2d:gI,pad3d:vI,pad4d:yI,rand:bI,randomNormal:Px,randomGamma:xI,randomUniform:sl,reshape:Dd,spaceToBatchND:Av,squeeze:Od,stack:na,tile:Ns,truncatedNormal:Md,unstack:Yu,setdiff1dAsync:zx,fill:nh,linspace:Rx,ones:Wa,range:Cv,scalar:zt,tensor:Rn,tensor1d:Jr,tensor2d:_o,tensor3d:Sx,tensor4d:vs,tensor5d:cI,tensor6d:hI,variable:Ax,zeros:Ue,onesLike:yi,zerosLike:Te,transpose:fn,softmax:ul,logSoftmax:Iv,localResponseNormalization:Dw,norm:Ow,gather:oh,unsortedSegmentSum:Aw,basicLSTMCell:Zk,multiRNNCell:Jk,movingAverage:t5,stridedSlice:Mw,topk:Lw,scatterND:Pw,fft:Wd,ifft:Pc,rfft:Hd,irfft:ny,sparseToDense:ry,gatherND:zw,diag:n5,dropout:Vw,hannWindow:iy,hammingWindow:Fw,frame:ay,stft:Bw,inTopKAsync:a5});function Tt(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&$(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function H1(r,e,t,n){if(t==="linear")return r.linear(e);if(t==="relu")return r.relu(e);if(t==="elu")return r.elu(e);if(t==="relu6")return r.relu6(e);if(t==="prelu")return r.prelu(e,n);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var PW=function(r){function e(){var t=r.call(this)||this;if(t.blockSize=48,t.firstUse=!0,gt().get("IS_BROWSER")){var n=typeof OffscreenCanvas<"u"?new OffscreenCanvas(300,150):typeof document<"u"?document.createElement("canvas"):null;n!==null&&(t.fromPixels2DContext=n.getContext("2d"))}return t.data=new Bx(t,J),t}return aa(e,r),e.prototype.write=function(t,n,i){this.firstUse&&(this.firstUse=!1,gt().get("IS_NODE")&&Xb(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================
`));var a={};return this.data.set(a,{values:t,dtype:i}),a},e.prototype.move=function(t,n,i,a){this.data.set(t,{values:n,dtype:a})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.fromPixels=function(t,n){if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var i,a,o=t.data instanceof Uint8Array,u=typeof ImageData<"u"&&t instanceof ImageData,l=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement,h=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,f=l?[t.videoWidth,t.videoHeight]:[t.width,t.height],p=f[0],m=f[1];if(gt().get("IS_NODE")&&t.getContext==null)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(t.getContext!=null)i=t.getContext("2d").getImageData(0,0,p,m).data;else if(u||o)i=t.data;else{if(!h&&!l)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);if(this.fromPixels2DContext==null)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=p,this.fromPixels2DContext.canvas.height=m,this.fromPixels2DContext.drawImage(t,0,0,p,m),i=this.fromPixels2DContext.getImageData(0,0,p,m).data}if(n===4)a=new Int32Array(i);else{var v=p*m;a=new Int32Array(v*n);for(var b=0;b<v;b++)for(var C=0;C<n;++C)a[b*n+C]=i[4*b+C]}return Sx(a,[m,p,n],"int32")},e.prototype.read=function(t){return Ft(this,void 0,void 0,function(){return Bt(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),i=n.dtype,a=n.complexTensors;return i==="complex64"?Zb(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId),i=n;if(t.dtype==="string")try{i=n.map(function(a){return od(a)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ie(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,n,i){var a=this.write(t,n,i);return J.makeTensorFromDataId(a,n,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var n=this.data.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return Ft(this,void 0,void 0,function(){var n;return Bt(this,function(i){return n=Yi(),t(),[2,{kernelMs:Yi()-n}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,n){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:J.keep(t.clone()),imag:J.keep(n.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,i){if(Tt(t,"slice"),Vx(t.shape,n,i)){var a=Fx(n,t.strides),o=jt(i);return Rn(this.readSync(t.dataId).subarray(a,a+o),i,t.dtype)}for(var u=ie(i,t.dtype),l=this.bufferSync(t),h=0;h<u.size;++h){var f=u.indexToLoc(h).map(function(p,m){return p+n[m]});u.values[h]=l.get.apply(l,f)}return u.toTensor()},e.prototype.stridedSlice=function(t,n,i,a){Tt(t,"stridedSlice");var o=Rv(n,i,a);if(o.some(function(v){return v===0}))return Rn([],o);for(var u=ie(o,t.dtype),l=this.bufferSync(t),h=0;h<u.size;h++){for(var f=u.indexToLoc(h),p=new Array(f.length),m=0;m<p.length;m++)p[m]=f[m]*a[m]+n[m];u.set.apply(u,[l.get.apply(l,p)].concat(f))}return u.toTensor()},e.prototype.diag=function(t){for(var n=this.readSync(t.dataId),i=ie([t.size,t.size],t.dtype),a=i.values,o=0;o<n.length;o++)a[o*t.size+o]=n[o];return i.toTensor()},e.prototype.unstack=function(t,n){for(var i=t.shape[n],a=new Array(t.rank-1),o=0,u=0;u<t.rank;u++)u!==n&&(a[o++]=t.shape[u]);var l=new Array(t.rank).fill(0),h=t.shape.slice();h[n]=1;var f=new Array(i);for(u=0;u<f.length;u++)l[n]=u,f[u]=this.slice(t,l,h).reshape(a);return f},e.prototype.reverse=function(t,n){Tt(t,"reverse");for(var i=ie(t.shape,t.dtype),a=this.bufferSync(t),o=function(l){var h=i.indexToLoc(l),f=h.slice();n.forEach(function(p){return f[p]=t.shape[p]-1-f[p]}),i.set.apply(i,[a.get.apply(a,f)].concat(h))},u=0;u<i.size;u++)o(u);return i.toTensor()},e.prototype.concat=function(t,n){var i=this;if(t[0].dtype==="complex64"){var a=t.map(function(v){return Qr(v)}),o=t.map(function(v){return zi(v)});return Kn(this.concat(a,n),this.concat(o,n))}var u=t.map(function(v){var b=jt(v.shape.slice(n));return v.as2D(-1,b)}),l=Xu(u.map(function(v){return v.shape}),1),h=ie(l,t[0].dtype).values;if(u[0].shape[0]===1){var f=0;u.forEach(function(v){h.set(i.readSync(v.dataId),f),f+=v.size})}else{var p=0;u.forEach(function(v){for(var b=i.readSync(v.dataId),C=0,w=0;w<v.shape[0];++w)for(var E=w*l[1]+p,S=0;S<v.shape[1];++S)h[E+S]=b[C++];p+=v.shape[1]})}var m=Xu(t.map(function(v){return v.shape}),n);return Rn(h,m,t[0].dtype)},e.prototype.neg=function(t){return Tt(t,"neg"),this.multiply(zt(-1),t)},e.prototype.add=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,a,o,u){return{real:i+o,imag:a+u}}):this.broadcastedBinaryOp(t,n,Pn(t.dtype,n.dtype),function(i,a){return i+a})},e.prototype.addN=function(t){var n=this;Tt(t,"addN");for(var i=t.map(function(f){return n.readSync(f.dataId)}),a=ie(t[0].shape,t[0].dtype),o=a.values,u=0;u<t.length;u++)for(var l=i[u],h=0;h<o.length;h++)o[h]+=l[h];return a.toTensor()},e.prototype.subtract=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,a,o,u){return{real:i-o,imag:a-u}}):this.broadcastedBinaryOp(t,n,Pn(t.dtype,n.dtype),function(i,a){return i-a})},e.prototype.pow=function(t,n){return Tt([t,n],"pow"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.pow(i,a)})},e.prototype.batchMatMul=function(t,n,i,a){Tt([t,n],"matMul");for(var o=i?t.shape[1]:t.shape[2],u=i?t.shape[2]:t.shape[1],l=a?n.shape[1]:n.shape[2],h=t.shape[0],f=this.readSync(t.dataId),p=this.readSync(n.dataId),m=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],v=m[0],b=m[1],C=m[2],w=a?[1,n.strides[1],n.strides[0]]:[n.strides[1],1,n.strides[0]],E=w[0],S=w[1],A=w[2],k=u*l,O=ie([h,u,l],t.dtype),V=O.values,T=this.blockSize,R=0;R<h;R++)for(var N=0;N<u;N+=T)for(var D=0;D<l;D+=T)for(var L=0;L<o;L+=T)for(var P=Math.min(N+T,u),B=Math.min(D+T,l),Z=Math.min(L+T,o),rt=N;rt<P;rt++)for(var q=D;q<B;q++){for(var K=0,Q=L;Q<Z;Q++)K+=f[R*v+rt*b+Q*C]*p[Q*E+q*S+R*A];V[R*k+(rt*l+q)]+=K}return O.toTensor()},e.prototype.fusedBatchMatMul=function(t){var n=t.a,i=t.b,a=t.transposeA,o=t.transposeB,u=t.bias,l=t.activation,h=t.preluActivationWeights,f=this.batchMatMul(n,i,a,o);return u&&(f=this.add(f,u)),l&&(f=H1(this,f,l,h)),f},e.prototype.multiply=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,a,o,u){return{real:i*o-a*u,imag:i*u+a*o}}):this.broadcastedBinaryOp(t,n,Pn(t.dtype,n.dtype),function(i,a){return i*a})},e.prototype.realDivide=function(t,n){return Tt([t,n],"realDivide"),this.broadcastedBinaryOp(t,n,"float32",function(i,a){return i/a})},e.prototype.floorDiv=function(t,n){return Tt([t,n],"floorDiv"),this.broadcastedBinaryOp(t,n,"int32",function(i,a){return Math.floor(i/a)})},e.prototype.sum=function(t,n){Tt(t,"sum"),Yr("sum",n,t.rank);for(var i=gr(t.shape,n),a=i[0],o=i[1],u=Ue(a,Pn(t.dtype,"int32")),l=jt(o),h=this.readSync(u.dataId),f=this.readSync(t.dataId),p=0;p<h.length;++p){for(var m=p*l,v=0,b=0;b<l;++b)v+=f[m+b];h[p]=v}return u},e.prototype.prod=function(t,n){Tt(t,"sum");for(var i=gr(t.shape,n),a=i[0],o=i[1],u=Ue(a,Pn(t.dtype,"int32")),l=jt(o),h=this.readSync(u.dataId),f=this.readSync(t.dataId),p=0;p<h.length;++p){for(var m=p*l,v=1,b=0;b<l;++b)v*=f[m+b];h[p]=v}return u},e.prototype.unsortedSegmentSum=function(t,n,i){Tt(t,"unsortedSegmentSum");for(var a=[],o=t.rank-n.rank,u=0;u<o;++u)n=n.expandDims(u+1);for(u=0;u<i;++u){var l=zt(u,"int32"),h=cl(l,n).asType("float32").mul(t).sum(0);a.push(h)}return na(a)},e.prototype.argMin=function(t,n){Tt(t,"argMin");var i=[n];Yr("argMin",i,t.rank);for(var a=gr(t.shape,i),o=a[0],u=a[1],l=Ue(o,"int32"),h=jt(u),f=this.readSync(l.dataId),p=this.readSync(t.dataId),m=0;m<f.length;++m){for(var v=m*h,b=p[v],C=0,w=0;w<h;++w){var E=p[v+w];E<b&&(b=E,C=w)}f[m]=C}return l},e.prototype.argMax=function(t,n){Tt(t,"argMax");var i=[n];Yr("argMax",i,t.rank);for(var a=gr(t.shape,i),o=a[0],u=a[1],l=Ue(o,"int32"),h=jt(u),f=this.readSync(l.dataId),p=this.readSync(t.dataId),m=0;m<f.length;++m){for(var v=m*h,b=p[v],C=0,w=0;w<h;++w){var E=p[v+w];E>b&&(b=E,C=w)}f[m]=C}return l},e.prototype.cumsum=function(t,n,i,a){if(Tt(t,"cumsum"),n!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+n);for(var o=Pn(t.dtype,"int32"),u=Ue(t.shape,o),l=this.readSync(u.dataId),h=this.readSync(t.dataId),f=t.shape[t.rank-1],p=a?function(w,E){return w+f-E-1}:function(w,E){return w+E},m=0;m<h.length;m+=f)for(var v=0;v<f;v++){var b=p(m,v);if(v===0)l[b]=i?0:h[b];else{var C=p(m,v-1);l[b]=i?h[C]+l[C]:h[b]+l[C]}}return u},e.prototype.equal=function(t,n){return Tt([t,n],"equal"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i===a?1:0})},e.prototype.notEqual=function(t,n){return Tt([t,n],"notEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i!==a?1:0})},e.prototype.less=function(t,n){return Tt([t,n],"less"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i<a?1:0})},e.prototype.lessEqual=function(t,n){return Tt([t,n],"lessEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i<=a?1:0})},e.prototype.greater=function(t,n){return Tt([t,n],"greater"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i>a?1:0})},e.prototype.greaterEqual=function(t,n){return Tt([t,n],"greaterEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i>=a?1:0})},e.prototype.logicalNot=function(t){Tt(t,"logicalNot");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)i[a]=n[a]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,n){return Tt([t,n],"logicalAnd"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i&&a})},e.prototype.logicalOr=function(t,n){return Tt([t,n],"logicalOr"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i||a})},e.prototype.select=function(t,n,i){Tt([t,n,i],"select");for(var a=this.readSync(t.dataId),o=this.readSync(n.dataId),u=this.readSync(i.dataId),l=Ue(n.shape,Pn(n.dtype,i.dtype)),h=this.readSync(l.dataId),f=0,p=t.rank===0||t.rank>1||n.rank===1?1:jt(n.shape.slice(1)),m=0;m<a.length;m++)for(var v=0;v<p;v++)a[m]===1?h[f++]=o[m]:h[f++]=u[m];return l},e.prototype.where=function(t){Tt([t],"where");var n=this.readSync(t.dataId);return Gx(t.shape,n)},e.prototype.topk=function(t,n,i){return Tt(t,"topk"),kI(this.readSync(t.dataId),t.shape,t.dtype,n)},e.prototype.min=function(t,n){Tt(t,"min"),Yr("min",n,t.rank);for(var i=gr(t.shape,n),a=i[0],o=i[1],u=Ue(a,t.dtype),l=jt(o),h=this.readSync(u.dataId),f=this.readSync(t.dataId),p=0;p<h.length;++p){for(var m=p*l,v=f[m],b=0;b<l;++b){var C=f[m+b];C<v&&(v=C)}h[p]=v}return u},e.prototype.minimum=function(t,n){return Tt([t,n],"minimum"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.min(i,a)})},e.prototype.mod=function(t,n){return Tt([t,n],"mod"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){var o=i%a;return i<0&&a<0||i>=0&&a>=0?o:(o+a)%a})},e.prototype.max=function(t,n){Tt(t,"max"),Yr("max",n,t.rank);for(var i=gr(t.shape,n),a=i[0],o=i[1],u=Ue(a,t.dtype),l=jt(o),h=this.readSync(u.dataId),f=this.readSync(t.dataId),p=0;p<h.length;++p){for(var m=p*l,v=f[m],b=0;b<l;++b){var C=f[m+b];C>v&&(v=C)}h[p]=v}return u},e.prototype.maximum=function(t,n){return Tt([t,n],"maximum"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.max(i,a)})},e.prototype.all=function(t,n){Tt(t,"all"),Yr("all",n,t.rank);for(var i=gr(t.shape,n),a=i[0],o=i[1],u=Ue(a,t.dtype),l=jt(o),h=this.readSync(u.dataId),f=this.readSync(t.dataId),p=0;p<h.length;++p){for(var m=p*l,v=f[m],b=0;b<l;++b){var C=f[m+b];v=v&&C}h[p]=v}return u},e.prototype.any=function(t,n){Tt(t,"any"),Yr("any",n,t.rank);for(var i=gr(t.shape,n),a=i[0],o=i[1],u=Ue(a,t.dtype),l=jt(o),h=this.readSync(u.dataId),f=this.readSync(t.dataId),p=0;p<h.length;++p){for(var m=p*l,v=f[m],b=0;b<l;++b){var C=f[m+b];v=v||C}h[p]=v}return u},e.prototype.squaredDifference=function(t,n){return Tt([t,n],"squaredDifference"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){var o=i-a;return o*o})},e.prototype.ceil=function(t){Tt(t,"ceil");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.ceil(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){Tt(t,"floor");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.floor(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){Tt(t,"x");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)n[a]<0?i[a]=-1:n[a]>0?i[a]=1:i[a]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){Tt(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)Number.isNaN(n[a])&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){Tt(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)Math.abs(n[a])===1/0&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){Tt(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)Number.isFinite(n[a])&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){Tt(t,"round");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var o=Math.floor(n[a]);n[a]-o<.5?i[a]=Math.floor(n[a]):n[a]-o>.5?i[a]=Math.ceil(n[a]):i[a]=o%2==0?o:o+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){Tt(t,"exp");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.exp(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){Tt(t,"expm1");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.expm1(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){Tt(t,"log");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var o=n[a];i[a]=Math.log(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){Tt(t,"log1p");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var o=n[a];i[a]=Math.log1p(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){Tt(t,"sqrt");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var o=n[a];i[a]=Math.sqrt(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){Tt(t,"rsqrt");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var o=n[a];i[a]=1/Math.sqrt(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){Tt(t,"reciprocal");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=1/n[a];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Tt(t,"relu");for(var n=Ue(t.shape,t.dtype),i=this.readSync(n.dataId),a=this.readSync(t.dataId),o=0;o<a.length;++o)i[o]=Math.max(0,a[o]);return n},e.prototype.relu6=function(t){Tt(t,"relu");for(var n=Ue(t.shape,t.dtype),i=this.readSync(n.dataId),a=this.readSync(t.dataId),o=0;o<a.length;++o)i[o]=Math.min(Math.max(0,a[o]),6);return n},e.prototype.prelu=function(t,n){return Tt([t,n],"prelu"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return i<0?a*i:i})},e.prototype.elu=function(t){Tt(t,"elu");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var o=i[a];n[a]=o>=0?o:Math.exp(o)-1}return this.makeOutput(n,t.shape,"float32")},e.prototype.eluDer=function(t,n){Tt([t,n],"eluDer");for(var i=new Float32Array(n.size),a=this.readSync(n.dataId),o=this.readSync(t.dataId),u=0;u<a.length;++u){var l=a[u];i[u]=l>=1?o[u]:o[u]*(l+1)}return this.makeOutput(i,n.shape,"float32")},e.prototype.selu=function(t){Tt(t,"selu");for(var n=Kx,i=Xx,a=new Float32Array(t.size),o=this.readSync(t.dataId),u=0;u<o.length;++u){var l=o[u];a[u]=l>=0?i*l:n*(Math.exp(l)-1)}return this.makeOutput(a,t.shape,"float32")},e.prototype.clip=function(t,n,i){Tt(t,"clip");for(var a=new Float32Array(t.size),o=this.readSync(t.dataId),u=0;u<o.length;++u){var l=o[u];a[u]=l>i?i:l<n?n:l}return this.makeOutput(a,t.shape,"float32")},e.prototype.abs=function(t){for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.abs(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<t.size;++a){var o=i[2*a],u=i[2*a+1];n[a]=Math.hypot(o,u)}return this.makeOutput(n,t.shape,"float32")},e.prototype.int=function(t){Tt(t,"int");for(var n=new Int32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=i[a];return this.makeOutput(n,t.shape,"int32")},e.prototype.sigmoid=function(t){Tt(t,"sigmoid");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=1/(1+Math.exp(-i[a]));return this.makeOutput(n,t.shape,"float32")},e.prototype.softplus=function(t){Tt(t,"softplus");for(var n=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var u=a[o]>-n,l=a[o]<n,h=Math.exp(a[o]),f=void 0;f=l?h:u?a[o]:Math.log(1+h),i[o]=f}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){Tt(t,"sin");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.sin(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cos=function(t){Tt(t,"cos");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.cos(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tan=function(t){Tt(t,"tan");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.tan(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asin=function(t){Tt(t,"asin");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.asin(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acos=function(t){Tt(t,"acos");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.acos(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan=function(t){Tt(t,"atan");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.atan(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan2=function(t,n){return Tt([t,n],"atan2"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.atan2(i,a)})},e.prototype.sinh=function(t){Tt(t,"sinh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.sinh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cosh=function(t){Tt(t,"cosh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.cosh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tanh=function(t){Tt(t,"tanh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=CN(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asinh=function(t){Tt(t,"asinh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.asinh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acosh=function(t){Tt(t,"acosh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.acosh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atanh=function(t){Tt(t,"atanh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.atanh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.erf=function(t){Tt(t,"erf");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var o=Math.sign(i[a]),u=Math.abs(i[a]),l=1/(1+.3275911*u);n[a]=o*(1-((((1.061405429*l-1.453152027)*l+1.421413741)*l-.284496736)*l+.254829592)*l*Math.exp(-u*u))}return this.makeOutput(n,t.shape,"float32")},e.prototype.step=function(t,n){n===void 0&&(n=0),Tt(t,"step");for(var i=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var u=a[o];isNaN(u)?i[o]=NaN:i[o]=u>0?1:n}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var n=t.input,i=t.filter,a=t.convInfo,o=t.bias,u=t.activation,l=t.preluActivationWeights,h=this.conv2d(n,i,a);return o&&(h=this.add(h,o)),u&&(h=H1(this,h,u,l)),h},e.prototype.conv2d=function(t,n,i){Tt([t,n],"conv2d");for(var a=i.filterHeight,o=i.filterWidth,u=i.dilationHeight,l=i.dilationWidth,h=i.padInfo.left,f=i.padInfo.top,p=i.dataFormat==="channelsLast",m=ie(i.outShape,t.dtype),v=t.strides[0],b=p?t.strides[1]:t.strides[2],C=p?t.strides[2]:1,w=p?1:t.strides[1],E=m.strides[0],S=p?m.strides[1]:m.strides[2],A=p?m.strides[2]:1,k=p?1:m.strides[1],O=this.readSync(t.dataId),V=this.readSync(n.dataId),T=m.values,R=0;R<i.batchSize;++R)for(var N=R*v,D=R*E,L=0;L<i.outHeight;++L)for(var P=D+L*S,B=L*i.strideHeight-f,Z=0;Z<a;Z++){var rt=B+Z*u;if(!(rt<0||rt>=i.inHeight))for(var q=Z*n.strides[0],K=N+rt*b,Q=0;Q<i.outWidth;++Q)for(var ut=P+Q*A,W=Q*i.strideWidth-h,et=0;et<o;et++){var dt=W+et*l;if(!(dt<0||dt>=i.inWidth))for(var lt=K+dt*C,St=q+et*n.strides[1],Nt=0;Nt<i.inChannels;++Nt){for(var Rt=O[lt+Nt*w],Ut=0;Ut<i.outChannels;++Ut)T[ut+Ut*k]+=Rt*V[St+Ut];St+=i.outChannels}}}return m.toTensor()},e.prototype.conv3d=function(t,n,i){for(var a=i.filterDepth,o=i.filterHeight,u=i.filterWidth,l=i.dilationDepth,h=i.dilationHeight,f=i.dilationWidth,p=i.padInfo.front,m=i.padInfo.left,v=i.padInfo.top,b=ie(i.outShape,t.dtype),C=this.readSync(t.dataId),w=this.readSync(n.dataId),E=b.values,S=0;S<i.batchSize;++S)for(var A=S*t.strides[0],k=S*b.strides[0],O=0;O<i.outDepth;++O)for(var V=k+O*b.strides[1],T=O*i.strideDepth-p,R=0;R<a;R++){var N=T+R*l;if(!(N<0||N>=i.inDepth))for(var D=R*n.strides[0],L=A+N*t.strides[1],P=0;P<i.outHeight;++P)for(var B=V+P*b.strides[2],Z=P*i.strideHeight-v,rt=0;rt<o;rt++){var q=Z+rt*h;if(!(q<0||q>=i.inHeight))for(var K=D+rt*n.strides[1],Q=L+q*t.strides[2],ut=0;ut<i.outWidth;++ut)for(var W=B+ut*i.outChannels,et=ut*i.strideWidth-m,dt=0;dt<u;dt++){var lt=et+dt*f;if(!(lt<0||lt>=i.inWidth))for(var St=K+dt*n.strides[2],Nt=Q+lt*i.inChannels,Rt=St,Ut=0;Ut<i.inChannels;++Ut){for(var Pt=C[Nt+Ut],Xt=0;Xt<i.outChannels;++Xt)E[W+Xt]+=Pt*w[Rt+Xt];Rt+=i.outChannels}}}}return b.toTensor()},e.prototype.conv2dDerInput=function(t,n,i){Tt([t,n],"conv2dDerInput");for(var a=ie(i.inShape,"float32"),o=a.values,u=this.readSync(t.dataId),l=this.readSync(n.dataId),h=n.strides,f=h[0],p=h[1],m=h[2],v=i.batchSize,b=i.filterHeight,C=i.filterWidth,w=i.inChannels,E=i.inHeight,S=i.inWidth,A=i.outChannels,k=i.outHeight,O=i.outWidth,V=i.strideHeight,T=i.strideWidth,R=i.dataFormat,N=b-1-i.padInfo.top,D=C-1-i.padInfo.left,L=R==="channelsLast",P=a.strides[0],B=L?a.strides[1]:a.strides[2],Z=L?a.strides[2]:1,rt=L?1:a.strides[1],q=t.strides[0],K=L?t.strides[1]:t.strides[2],Q=L?t.strides[2]:1,ut=L?1:t.strides[1],W=0;W<v;++W)for(var et=0;et<w;++et)for(var dt=0;dt<E;++dt)for(var lt=dt-N,St=Math.max(0,Math.ceil(lt/V)),Nt=Math.min(k,(b+lt)/V),Rt=0;Rt<S;++Rt){for(var Ut=Rt-D,Pt=Math.max(0,Math.ceil(Ut/T)),Xt=Math.min(O,(C+Ut)/T),Le=0,Zt=St;Zt<Nt;++Zt)for(var ye=Zt*V-lt,se=Pt;se<Xt;++se)for(var Jt=q*W+K*Zt+Q*se,ze=f*(b-1-ye)+p*(C-1-(se*T-Ut))+m*et,Ae=0;Ae<A;++Ae)Le+=u[Jt+ut*Ae]*l[ze+Ae];o[P*W+B*dt+Z*Rt+rt*et]=Le}return a.toTensor()},e.prototype.conv3dDerInput=function(t,n,i){for(var a=ie(i.inShape,"float32"),o=a.values,u=a.strides,l=u[0],h=u[1],f=u[2],p=u[3],m=this.readSync(t.dataId),v=t.strides,b=v[0],C=v[1],w=v[2],E=v[3],S=this.readSync(n.dataId),A=n.strides,k=A[0],O=A[1],V=A[2],T=A[3],R=i.batchSize,N=i.filterDepth,D=i.filterHeight,L=i.filterWidth,P=i.inChannels,B=i.inDepth,Z=i.inHeight,rt=i.inWidth,q=i.outChannels,K=i.outDepth,Q=i.outHeight,ut=i.outWidth,W=i.strideDepth,et=i.strideHeight,dt=i.strideWidth,lt=N-1-i.padInfo.front,St=D-1-i.padInfo.top,Nt=L-1-i.padInfo.left,Rt=0;Rt<R;++Rt)for(var Ut=0;Ut<P;++Ut)for(var Pt=0;Pt<B;++Pt)for(var Xt=Pt-lt,Le=Math.max(0,Math.ceil(Xt/W)),Zt=Math.min(K,(N+Xt)/W),ye=0;ye<Z;++ye)for(var se=ye-St,Jt=Math.max(0,Math.ceil(se/et)),ze=Math.min(Q,(D+se)/et),Ae=0;Ae<rt;++Ae){for(var Ke=Ae-Nt,Dr=Math.max(0,Math.ceil(Ke/dt)),En=Math.min(ut,(L+Ke)/dt),In=0,un=Le;un<Zt;++un)for(var Er=un*W-Xt,re=Jt;re<ze;++re)for(var Un=re*et-se,ln=Dr;ln<En;++ln)for(var fe=b*Rt+C*un+w*re+E*ln,le=k*(N-1-Er)+O*(D-1-Un)+V*(L-1-(ln*dt-Ke))+T*Ut,dn=0;dn<q;++dn)In+=m[fe+dn]*S[le+dn];o[l*Rt+h*Pt+f*ye+p*Ae+Ut]=In}return a.toTensor()},e.prototype.conv2dDerFilter=function(t,n,i){Tt([t,n],"conv2dDerFilter");for(var a=i.strideHeight,o=i.strideWidth,u=i.filterHeight,l=i.filterWidth,h=i.dataFormat==="channelsLast",f=ie(i.filterShape,"float32"),p=i.padInfo.left,m=i.padInfo.top,v=this.bufferSync(t),b=this.bufferSync(n),C=0;C<u;++C)for(var w=Math.max(0,Math.ceil((m-C)/a)),E=Math.min(i.outHeight,(i.inHeight+m-C)/a),S=0;S<l;++S)for(var A=Math.max(0,Math.ceil((p-S)/o)),k=Math.min(i.outWidth,(i.inWidth+p-S)/o),O=0;O<i.inChannels;++O)for(var V=0;V<i.outChannels;++V){for(var T=0,R=0;R<i.batchSize;++R)for(var N=w;N<E;++N)for(var D=C+N*a-m,L=A;L<k;++L){var P=S+L*o-p;T+=h?v.get(R,D,P,O)*b.get(R,N,L,V):v.get(R,O,D,P)*b.get(R,V,N,L)}f.set(T,C,S,O,V)}return f.toTensor()},e.prototype.conv3dDerFilter=function(t,n,i){for(var a=i.strideDepth,o=i.strideHeight,u=i.strideWidth,l=i.filterDepth,h=i.filterHeight,f=i.filterWidth,p=ie(i.filterShape,"float32"),m=p.values,v=p.strides,b=v[0],C=v[1],w=v[2],E=v[3],S=this.readSync(n.dataId),A=n.strides,k=A[0],O=A[1],V=A[2],T=A[3],R=this.readSync(t.dataId),N=t.strides,D=N[0],L=N[1],P=N[2],B=N[3],Z=i.padInfo.front,rt=i.padInfo.left,q=i.padInfo.top,K=0;K<l;++K)for(var Q=Math.max(0,Math.ceil((Z-K)/a)),ut=Math.min(i.outDepth,(i.inDepth+Z-K)/a),W=K*b,et=0;et<h;++et)for(var dt=Math.max(0,Math.ceil((q-et)/o)),lt=Math.min(i.outHeight,(i.inHeight+q-et)/o),St=et*C+W,Nt=0;Nt<f;++Nt)for(var Rt=Math.max(0,Math.ceil((rt-Nt)/u)),Ut=Math.min(i.outWidth,(i.inWidth+rt-Nt)/u),Pt=Nt*w+St,Xt=0;Xt<i.inChannels;++Xt)for(var Le=Xt*E+Pt,Zt=0;Zt<i.outChannels;++Zt){for(var ye=0,se=0;se<i.batchSize;++se)for(var Jt=se*D,ze=se*k,Ae=Q;Ae<ut;++Ae)for(var Ke=(K+Ae*a-Z)*L+Jt,Dr=Ae*O+ze,En=dt;En<lt;++En)for(var In=(et+En*o-q)*P+Ke,un=En*V+Dr,Er=Rt;Er<Ut;++Er){var re=Er*T+un;ye+=R[(Nt+Er*u-rt)*B+In+Xt]*S[re+Zt]}m[Le+Zt]=ye}return p.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var n=t.input,i=t.filter,a=t.convInfo,o=t.bias,u=t.activation,l=t.preluActivationWeights,h=this.depthwiseConv2D(n,i,a);return o&&(h=this.add(h,o)),u&&(h=H1(this,h,u,l)),h},e.prototype.depthwiseConv2D=function(t,n,i){Tt([t,n],"depthwiseConv2D");for(var a=i.filterHeight,o=i.filterWidth,u=i.dilationHeight,l=i.dilationWidth,h=i.padInfo.left,f=i.padInfo.top,p=i.outChannels/i.inChannels,m=ie(i.outShape,t.dtype),v=this.readSync(t.dataId),b=this.readSync(n.dataId),C=m.values,w=0;w<i.batchSize;++w)for(var E=w*t.strides[0],S=w*m.strides[0],A=0;A<i.outHeight;++A)for(var k=S+A*m.strides[1],O=A*i.strideHeight-h,V=0;V<a;++V){var T=O+V*u;if(!(T<0||T>=i.inHeight))for(var R=V*n.strides[0],N=E+T*t.strides[1],D=0;D<i.outWidth;++D)for(var L=k+D*m.strides[2],P=D*i.strideWidth-f,B=0;B<o;++B){var Z=P+B*l;if(!(Z<0||Z>=i.inWidth))for(var rt=R+B*n.strides[1],q=N+Z*i.inChannels,K=L,Q=rt,ut=0;ut<i.inChannels;++ut){for(var W=v[q+ut],et=0;et<p;++et)C[K+et]+=W*b[Q+et];K+=p,Q+=p}}}return m.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,n,i){Tt([t,n],"depthwiseConv2DDerInput");for(var a=ie(i.inShape,"float32"),o=a.values,u=a.strides,l=u[0],h=u[1],f=u[2],p=this.readSync(t.dataId),m=t.strides,v=m[0],b=m[1],C=m[2],w=this.readSync(n.dataId),E=n.strides,S=E[0],A=E[1],k=E[2],O=i.batchSize,V=i.filterHeight,T=i.filterWidth,R=i.inChannels,N=i.inHeight,D=i.inWidth,L=i.outChannels,P=i.outHeight,B=i.outWidth,Z=i.strideHeight,rt=i.strideWidth,q=V-1-i.padInfo.top,K=T-1-i.padInfo.left,Q=L/R,ut=0;ut<O;++ut)for(var W=0;W<R;++W)for(var et=0;et<N;++et)for(var dt=et-q,lt=Math.max(0,Math.ceil(dt/Z)),St=Math.min(P,(V+dt)/Z),Nt=0;Nt<D;++Nt){for(var Rt=Nt-K,Ut=Math.max(0,Math.ceil(Rt/rt)),Pt=Math.min(B,(T+Rt)/rt),Xt=0,Le=lt;Le<St;++Le)for(var Zt=Le*Z-dt,ye=Ut;ye<Pt;++ye)for(var se=v*ut+b*Le+C*ye,Jt=S*(V-1-Zt)+A*(T-1-(ye*rt-Rt))+k*W,ze=0;ze<Q;++ze)Xt+=p[se+(W*Q+ze)]*w[Jt+ze];o[l*ut+h*et+f*Nt+W]=Xt}return a.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,n,i){Tt([t,n],"depthwiseConv2DDerFilter");for(var a=i.strideHeight,o=i.strideWidth,u=i.filterHeight,l=i.filterWidth,h=ie(i.filterShape,"float32"),f=i.padInfo.left,p=i.padInfo.top,m=i.outChannels/i.inChannels,v=this.bufferSync(t),b=this.bufferSync(n),C=0;C<u;++C)for(var w=Math.max(0,Math.ceil((p-C)/a)),E=Math.min(i.outHeight,(i.inHeight+p-C)/a),S=0;S<l;++S)for(var A=Math.max(0,Math.ceil((f-S)/o)),k=Math.min(i.outWidth,(i.inWidth+f-S)/o),O=0;O<i.outChannels;++O){for(var V=Math.trunc(O/m),T=O%m,R=0,N=0;N<i.batchSize;++N)for(var D=w;D<E;++D)for(var L=C+D*a-p,P=A;P<k;++P){var B=S+P*o-f;R+=v.get(N,L,B,V)*b.get(N,D,P,O)}h.set(R,C,S,V,T)}return h.toTensor()},e.prototype.tile=function(t,n){return Tt(t,"tile"),II(this.bufferSync(t),n)},e.prototype.pad=function(t,n,i){Tt(t,"pad");var a=n.map(function(m,v){return m[0]+t.shape[v]+m[1]}),o=n.map(function(m){return m[0]}),u=this.bufferSync(t),l=ie(a,t.dtype);i!==0&&l.values.fill(i);for(var h=0;h<t.size;h++){var f=u.indexToLoc(h),p=f.map(function(m,v){return m+o[v]});l.set.apply(l,[u.get.apply(u,f)].concat(p))}return l.toTensor()},e.prototype.transpose=function(t,n){Tt(t,"transpose");for(var i=new Array(t.rank),a=0;a<i.length;a++)i[a]=t.shape[n[a]];var o=this.readSync(t.dataId),u=ie(i,t.dtype),l=this.bufferSync(t);for(a=0;a<t.size;++a){for(var h=l.indexToLoc(a),f=new Array(h.length),p=0;p<f.length;p++)f[p]=h[n[p]];var m=u.locToIndex(f);u.values[m]=o[a]}return u.toTensor()},e.prototype.gather=function(t,n,i){Tt([t,n],"gather");var a=t.shape.slice(),o=this.readSync(n.dataId);a[i]=o.length;for(var u=ie(a,t.dtype),l=this.bufferSync(t),h=0;h<u.size;++h){var f=u.indexToLoc(h),p=f.slice();p[i]=o[f[i]];var m=l.locToIndex(p);u.values[h]=l.values[m]}return u.toTensor()},e.prototype.batchToSpaceND=function(t,n,i){Tt([t],"batchToSpaceND");var a=n.reduce(function(p,m){return p*m}),o=kg(t.shape,n,a),u=Dg(o.length,n.length),l=Og(t.shape,n,a),h=wI(i,n.length),f=CI(l,i,n.length);return t.reshape(o).transpose(u).reshape(l).slice(h,f)},e.prototype.spaceToBatchND=function(t,n,i){Tt([t],"spaceToBatchND");var a=n.reduce(function(m,v){return m*v}),o=[[0,0]];o.push.apply(o,i);for(var u=1+n.length;u<t.shape.length;++u)o.push([0,0]);var l=t.pad(o),h=kg(l.shape,n,a,!1),f=Dg(h.length,n.length,!1),p=Og(l.shape,n,a,!1);return l.reshape(h).transpose(f).reshape(p)},e.prototype.pool=function(t,n,i){Tt(t,"pool");for(var a=n.strideHeight,o=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,h=n.effectiveFilterHeight,f=n.effectiveFilterWidth,p=n.padInfo.top,m=n.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(t.dataId),C=ie(n.outShape,t.dtype),w=C.values,E=n.outShape[1]*n.outShape[2]*n.outShape[3],S=n.outShape[2]*n.outShape[3],A=n.outShape[3],k=0;k<n.batchSize;++k)for(var O=k*E,V=k*t.strides[0],T=0;T<n.inChannels;++T)for(var R=0;R<n.outHeight;++R)for(var N=R*a-p,D=Math.max(0,N),L=Math.min(n.inHeight,h+N),P=O+R*S,B=0;B<n.outWidth;++B){for(var Z=B*o-m,rt=Math.max(0,Z),q=Math.min(n.inWidth,f+Z),K=v,Q=0,ut=0,W=D;W<L;W+=u){for(var et=V+W*t.strides[1],dt=rt;dt<q;dt+=l){var lt=b[et+dt*t.strides[2]+T];i==="max"&&lt>K?K=lt:i==="avg"&&(Q+=lt,ut++)}if(isNaN(K))break}w[P+B*A+T]=i==="avg"?Q/ut:K}return C.toTensor()},e.prototype.maxPool=function(t,n){return this.pool(t,n,"max")},e.prototype.maxPoolPositions=function(t,n){for(var i=ie(n.outShape,"int32"),a=n.strideHeight,o=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,h=n.effectiveFilterHeight,f=n.effectiveFilterWidth,p=n.padInfo.top,m=n.padInfo.left,v=this.bufferSync(t),b=0;b<n.batchSize;++b)for(var C=0;C<n.inChannels;++C)for(var w=0;w<n.outHeight;++w){for(var E=w*a-p,S=E;S<0;)S+=u;for(var A=Math.min(n.inHeight,h+E),k=0;k<n.outWidth;++k){for(var O=k*o-m,V=O;V<0;)V+=l;for(var T=Math.min(n.inWidth,f+O),R=Number.NEGATIVE_INFINITY,N=-1,D=S;D<A;D+=u)for(var L=D-E,P=V;P<T;P+=l){var B=P-O,Z=v.get(b,D,P,C);Z>R&&(R=Z,N=L*f+B)}i.set(N,b,w,k,C)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(t,n,i,a){Tt([n,i],"maxPoolBackprop");for(var o=this.maxPoolPositions(n,a),u=a.strideHeight,l=a.strideWidth,h=a.dilationHeight,f=a.dilationWidth,p=a.effectiveFilterHeight,m=a.effectiveFilterWidth,v=m-1-a.padInfo.left,b=p-1-a.padInfo.top,C=ie(n.shape,"float32"),w=this.bufferSync(o),E=this.bufferSync(t),S=0;S<a.batchSize;++S)for(var A=0;A<a.inChannels;++A)for(var k=0;k<a.inHeight;++k)for(var O=0;O<a.inWidth;++O){for(var V=k-b,T=O-v,R=0,N=0;N<p;N+=h){var D=(V+N)/u;if(!(D<0||D>=a.outHeight||Math.floor(D)!==D))for(var L=0;L<m;L+=f){var P=(T+L)/l;if(!(P<0||P>=a.outWidth||Math.floor(P)!==P)){var B=p*m-1-w.get(S,D,P,A)===N*m+L?1:0;B!==0&&(R+=E.get(S,D,P,A)*B)}}}C.set(R,S,k,O,A)}return C.toTensor()},e.prototype.avgPoolBackprop=function(t,n,i){Tt([t,n],"avgPoolBackprop");for(var a=i.strideHeight,o=i.strideWidth,u=i.filterHeight,l=i.filterWidth,h=i.dilationHeight,f=i.dilationWidth,p=i.effectiveFilterHeight,m=i.effectiveFilterWidth,v=m-1-i.padInfo.left,b=p-1-i.padInfo.top,C=ie(n.shape,"float32"),w=1/(u*l),E=this.bufferSync(t),S=0;S<i.batchSize;++S)for(var A=0;A<i.inChannels;++A)for(var k=0;k<i.inHeight;++k)for(var O=0;O<i.inWidth;++O){for(var V=k-b,T=O-v,R=0,N=0;N<p;N+=h){var D=(V+N)/a;if(!(D<0||D>=i.outHeight||Math.floor(D)!==D))for(var L=0;L<m;L+=f){var P=(T+L)/o;P<0||P>=i.outWidth||Math.floor(P)!==P||(R+=E.get(S,D,P,A))}}C.set(R*w,S,k,O,A)}return C.toTensor()},e.prototype.pool3d=function(t,n,i){Tt(t,"pool3d");for(var a=n.strideDepth,o=n.strideHeight,u=n.strideWidth,l=n.dilationDepth,h=n.dilationHeight,f=n.dilationWidth,p=n.effectiveFilterDepth,m=n.effectiveFilterHeight,v=n.effectiveFilterWidth,b=n.padInfo.front,C=n.padInfo.top,w=n.padInfo.left,E=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,S=this.readSync(t.dataId),A=ie(n.outShape,t.dtype),k=A.values,O=n.outShape[1]*n.outShape[2]*n.outShape[3]*n.outShape[4],V=n.outShape[2]*n.outShape[3]*n.outShape[4],T=n.outShape[3]*n.outShape[4],R=n.outShape[4],N=0;N<n.batchSize;++N)for(var D=N*O,L=N*t.strides[0],P=0;P<n.inChannels;++P)for(var B=0;B<n.outDepth;++B){for(var Z=B*a-b,rt=Z;rt<0;)rt+=l;for(var q=Math.min(n.inDepth,p+Z),K=D+B*V,Q=0;Q<n.outHeight;++Q){for(var ut=Q*o-C,W=ut;W<0;)W+=h;for(var et=Math.min(n.inHeight,m+ut),dt=K+Q*T,lt=0;lt<n.outWidth;++lt){for(var St=lt*u-w,Nt=St;Nt<0;)Nt+=f;for(var Rt=Math.min(n.inWidth,v+St),Ut=dt+lt*R,Pt=E,Xt=0,Le=0,Zt=rt;Zt<q;Zt+=l){for(var ye=L+Zt*t.strides[1],se=W;se<et;se+=h){for(var Jt=ye+se*t.strides[2],ze=Nt;ze<Rt;ze+=f){var Ae=S[Jt+ze*t.strides[3]+P];if(i==="max"&&Ae>Pt?Pt=Ae:i==="avg"&&(Xt+=Ae,Le++),isNaN(Pt))break}if(isNaN(Pt))break}if(isNaN(Pt))break}k[Ut+P]=i==="avg"?Xt/Le:Pt}}}return A.toTensor()},e.prototype.avgPool3d=function(t,n){return Tt(t,"avgPool3d"),this.pool3d(t,n,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,n,i){Tt([t,n],"avgPool3dBackprop");for(var a=i.strideDepth,o=i.strideHeight,u=i.strideWidth,l=i.filterDepth,h=i.filterHeight,f=i.filterWidth,p=i.dilationDepth,m=i.dilationHeight,v=i.dilationWidth,b=i.effectiveFilterDepth,C=i.effectiveFilterHeight,w=i.effectiveFilterWidth,E=b-1-i.padInfo.front,S=w-1-i.padInfo.left,A=C-1-i.padInfo.top,k=ie(n.shape,"float32"),O=1/(l*h*f),V=this.bufferSync(t),T=0;T<i.batchSize;++T)for(var R=0;R<i.inChannels;++R)for(var N=0;N<i.inDepth;++N)for(var D=0;D<i.inHeight;++D)for(var L=0;L<i.inWidth;++L){for(var P=N-E,B=D-A,Z=L-S,rt=0,q=0;q<b;q+=p){var K=(P+q)/a;if(!(K<0||K>=i.outDepth||Math.floor(K)!==K))for(var Q=0;Q<C;Q+=m){var ut=(B+Q)/o;if(!(ut<0||ut>=i.outHeight||Math.floor(ut)!==ut))for(var W=0;W<w;W+=v){var et=(Z+W)/u;et<0||et>=i.outWidth||Math.floor(et)!==et||(rt+=V.get(T,K,ut,et,R))}}}k.set(rt*O,T,N,D,L,R)}return k.toTensor()},e.prototype.maxPool3d=function(t,n){return Tt(t,"maxPool3d"),this.pool3d(t,n,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,n){for(var i=ie(n.outShape,"int32"),a=n.strideDepth,o=n.strideHeight,u=n.strideWidth,l=n.dilationDepth,h=n.dilationHeight,f=n.dilationWidth,p=n.effectiveFilterDepth,m=n.effectiveFilterHeight,v=n.effectiveFilterWidth,b=n.padInfo.front,C=n.padInfo.top,w=n.padInfo.left,E=this.bufferSync(t),S=0;S<n.batchSize;++S)for(var A=0;A<n.inChannels;++A)for(var k=0;k<n.outDepth;++k){for(var O=k*a-b,V=O;V<0;)V+=l;for(var T=Math.min(n.inDepth,p+O),R=0;R<n.outHeight;++R){for(var N=R*o-C,D=N;D<0;)D+=h;for(var L=Math.min(n.inHeight,m+N),P=0;P<n.outWidth;++P){for(var B=P*u-w,Z=B;Z<0;)Z+=f;for(var rt=Math.min(n.inWidth,v+B),q=Number.NEGATIVE_INFINITY,K=-1,Q=V;Q<T;Q+=l)for(var ut=Q-O,W=D;W<L;W+=h)for(var et=W-N,dt=Z;dt<rt;dt+=f){var lt=dt-B,St=E.get(S,Q,W,dt,A);St>=q&&(q=St,K=ut*m*v+et*m+lt)}i.set(K,S,k,R,P,A)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,n,i,a){Tt([n,i],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(n,a),u=a.strideDepth,l=a.strideHeight,h=a.strideWidth,f=a.dilationDepth,p=a.dilationHeight,m=a.dilationWidth,v=a.effectiveFilterDepth,b=a.effectiveFilterHeight,C=a.effectiveFilterWidth,w=v-1-a.padInfo.front,E=C-1-a.padInfo.left,S=b-1-a.padInfo.top,A=ie(n.shape,"float32"),k=this.bufferSync(o),O=this.bufferSync(t),V=0;V<a.batchSize;++V)for(var T=0;T<a.inChannels;++T)for(var R=0;R<a.inDepth;++R)for(var N=0;N<a.inHeight;++N)for(var D=0;D<a.inWidth;++D){for(var L=R-w,P=N-S,B=D-E,Z=0,rt=0;rt<v;rt+=f){var q=(L+rt)/u;if(!(q<0||q>=a.outDepth||Math.floor(q)!==q))for(var K=0;K<b;K+=p){var Q=(P+K)/l;if(!(Q<0||Q>=a.outHeight||Math.floor(Q)!==Q))for(var ut=0;ut<C;ut+=m){var W=(B+ut)/h;if(!(W<0||W>=a.outWidth||Math.floor(W)!==W)){var et=v*b*C-1-k.get(V,q,Q,W,T)===rt*b*C+K*C+ut?1:0;et!==0&&(Z+=O.get(V,q,Q,W,T)*et)}}}}A.set(Z,V,R,N,D,T)}return A.toTensor()},e.prototype.cast=function(t,n){return Wx(t,n,this)},e.prototype.reshape=function(t,n){return Pg(t,n)},e.prototype.avgPool=function(t,n){return Tt(t,"avgPool"),this.pool(t,n,"avg").toFloat()},e.prototype.resizeBilinear=function(t,n,i,a){Tt(t,"resizeBilinear");for(var o=t.shape,u=o[0],l=o[1],h=o[2],f=o[3],p=this.readSync(t.dataId),m=new Float32Array(jt([u,n,i,f])),v=[a&&n>1?l-1:l,a&&i>1?h-1:h],b=[a&&n>1?n-1:n,a&&i>1?i-1:i],C=0,w=v[0]/b[0],E=v[1]/b[1],S=0;S<u;S++)for(var A=0;A<n;A++)for(var k=w*A,O=Math.floor(k),V=k-O,T=Math.min(l-1,Math.ceil(k)),R=S*t.strides[0]+O*t.strides[1],N=S*t.strides[0]+T*t.strides[1],D=0;D<i;D++)for(var L=E*D,P=Math.floor(L),B=L-P,Z=Math.min(h-1,Math.ceil(L)),rt=R+P*t.strides[2],q=N+P*t.strides[2],K=R+ +Z*t.strides[2],Q=N+Z*t.strides[2],ut=0;ut<f;ut++){var W=p[rt+ut],et=p[q+ut],dt=W+(p[K+ut]-W)*B,lt=dt+(et+(p[Q+ut]-et)*B-dt)*V;m[C++]=lt}return Rn(m,[u,n,i,f])},e.prototype.resizeBilinearBackprop=function(t,n,i){Tt([t,n],"resizeBilinearBackprop");for(var a=n.shape,o=a[0],u=a[1],l=a[2],h=a[3],f=t.shape,p=f[1],m=f[2],v=new Float32Array(o*u*l*h),b=[i&&p>1?u-1:u,i&&m>1?l-1:l],C=[i&&p>1?p-1:p,i&&m>1?m-1:m],w=b[0]/C[0],E=b[1]/C[1],S=this.readSync(t.dataId),A=0,k=0;k<o;k++)for(var O=k*n.strides[0],V=0;V<p;V++)for(var T=V*w,R=Math.floor(T),N=Math.min(Math.ceil(T),u-1),D=O+R*n.strides[1],L=O+N*n.strides[1],P=T-R,B=1-P,Z=0;Z<m;Z++)for(var rt=Z*E,q=Math.floor(rt),K=Math.min(Math.ceil(rt),l-1),Q=rt-q,ut=1-Q,W=D+q*n.strides[2],et=D+K*n.strides[2],dt=L+q*n.strides[2],lt=L+K*n.strides[2],St=B*ut,Nt=B*Q,Rt=P*ut,Ut=P*Q,Pt=0;Pt<h;Pt++){var Xt=S[A++];v[W+Pt]+=Xt*St,v[et+Pt]+=Xt*Nt,v[dt+Pt]+=Xt*Rt,v[lt+Pt]+=Xt*Ut}return vs(v,[o,l,u,h],n.dtype)},e.prototype.resizeNearestNeighbor=function(t,n,i,a){Tt(t,"resizeNearestNeighbor");for(var o=t.shape,u=o[0],l=o[1],h=o[2],f=o[3],p=this.readSync(t.dataId),m=new Float32Array(u*n*i*f),v=[a&&n>1?l-1:l,a&&i>1?h-1:h],b=[a&&n>1?n-1:n,a&&i>1?i-1:i],C=v[0]/b[0],w=v[1]/b[1],E=0,S=0;S<u;S++)for(var A=S*t.strides[0],k=0;k<n;k++)for(var O=C*k,V=A+Math.min(l-1,a?Math.round(O):Math.floor(O))*t.strides[1],T=0;T<i;T++)for(var R=w*T,N=V+Math.min(h-1,a?Math.round(R):Math.floor(R))*t.strides[2],D=0;D<f;D++){var L=p[N+D];m[E++]=L}return Rn(m,[u,n,i,f],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,n,i){Tt([t,n],"resizeNearestNeighborBackprop");for(var a=n.shape,o=a[0],u=a[1],l=a[2],h=a[3],f=t.shape,p=f[1],m=f[2],v=new Float32Array(o*u*l*h),b=this.readSync(t.dataId),C=[i&&p>1?u-1:u,i&&m>1?l-1:l],w=[i&&p>1?p-1:p,i&&m>1?m-1:m],E=C[0]/w[0],S=C[1]/w[1],A=1/E,k=1/S,O=2*Math.ceil(A)+2,V=2*Math.ceil(k)+2,T=0;T<o;T++)for(var R=T*n.strides[0],N=0;N<u;N++)for(var D=R+N*n.strides[1],L=Math.floor(N*A),P=Math.floor(L-O/2),B=0;B<l;B++)for(var Z=D+B*n.strides[2],rt=Math.floor(B*k),q=Math.floor(rt-V/2),K=0;K<h;K++){for(var Q=0,ut=0;ut<O;ut++){var W=ut+P;if(!(W<0||W>=p)){var et=R+W*t.strides[1],dt=W*E;if(N===Math.min(u-1,i?Math.round(dt):Math.floor(dt)))for(var lt=0;lt<V;lt++){var St=lt+q;if(!(St<0||St>=m)){var Nt=et+St*t.strides[2],Rt=St*S;B===Math.min(l-1,i?Math.round(Rt):Math.floor(Rt))&&(Q+=b[Nt+K])}}}}v[Z+K]=Q}return vs(v,n.shape,n.dtype)},e.prototype.batchNormalization=function(t,n,i,a,o,u){Tt([t,n,i,o,u],"batchNorm");for(var l=this.readSync(t.dataId),h=this.readSync(n.dataId),f=this.readSync(i.dataId),p=o?this.readSync(o.dataId):new Float32Array([1]),m=u?this.readSync(u.dataId):new Float32Array([0]),v=new Float32Array(l.length),b=m.length,C=p.length,w=f.length,E=h.length,S=0,A=0,k=0,O=0,V=0;V<l.length;++V)v[V]=m[S++]+(l[V]-h[A++])*p[k++]/Math.sqrt(f[O++]+a),S>=b&&(S=0),A>=E&&(A=0),k>=C&&(k=0),O>=w&&(O=0);return vs(v,t.shape)},e.prototype.localResponseNormalization4D=function(t,n,i,a,o){Tt(t,"localResponseNormalization4D");var u=t.shape[3],l=u-1,h=this.readSync(t.dataId),f=t.size,p=new Float32Array(f);function m(w){for(var E=w%u,S=w-E+Math.max(0,E-n),A=w-E+Math.min(E+n,l),k=0;S<=A;S++){var O=h[S];k+=O*O}return k}for(var v=0;v<f;v++){var b=m(v),C=h[v]*Math.pow(i+a*b,-o);p[v]=C}return vs(p,t.shape)},e.prototype.LRNGrad=function(t,n,i,a,o,u,l){Tt(t,"LRNGrad");for(var h=t.shape[3],f=this.readSync(t.dataId),p=this.readSync(n.dataId),m=this.readSync(i.dataId),v=new Float32Array(t.size),b=t.size,C=0;C<b;C++){for(var w=C%h,E=C-w+Math.max(0,w-a),S=C-w+Math.min(h,w+a+1),A=0,k=E;k<S;k++)A+=Math.pow(p[k],2);for(A=u*A+o,k=E;k<S;k++){var O=-2*u*l*p[k]*m[C]/A;C===k&&(O+=Math.pow(A,-l)),O*=f[C],v[k]+=O}}return vs(v,t.shape)},e.prototype.multinomial=function(t,n,i,a){Tt(t,"multinomial");for(var o=n?t:ul(t),u=o.shape[0],l=o.shape[1],h=Ue([u,i],"int32"),f=this.readSync(h.dataId),p=this.readSync(o.dataId),m=0;m<u;++m){var v=m*l,b=new Float32Array(l-1);b[0]=p[v];for(var C=1;C<b.length;++C)b[C]=b[C-1]+p[v+C];for(var w=Ev(a.toString()),E=m*i,S=0;S<i;++S){var A=w();f[E+S]=b.length;for(var k=0;k<b.length;k++)if(A<b[k]){f[E+S]=k;break}}}return h},e.prototype.oneHot=function(t,n,i,a){Tt(t,"oneHot");var o=new Float32Array(t.size*n);o.fill(a);for(var u=this.readSync(t.dataId),l=0;l<t.size;++l)u[l]>=0&&u[l]<n&&(o[l*n+u[l]]=i);return _o(o,[t.size,n],"int32")},e.prototype.nonMaxSuppression=function(t,n,i,a,o){return Tt(t,"nonMaxSuppression"),qx(this.readSync(t.dataId),this.readSync(n.dataId),i,a,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,n){for(var i=t.shape[0],a=t.shape[1],o=ie(t.shape,"float32"),u=ie(t.shape,"float32"),l=Qr(t).as2D(i,a),h=zi(t).as2D(i,a),f=0;f<i;f++)for(var p=l.slice([f,0],[1,a]),m=h.slice([f,0],[1,a]),v=Kn(p,m),b=this.readSync(this.fftImpl(v,n).dataId),C=0;C<a;C++){var w=AS(b,C);o.values[f*a+C]=w.real,u.values[f*a+C]=w.imag}return Kn(o.toTensor(),u.toTensor()).as2D(i,a)},e.prototype.fftImpl=function(t,n){var i=t.as1D(),a=i.size;if(this.isExponentOf2(a)){var o=this.fftRadix2(i,a,n).as2D(t.shape[0],t.shape[1]);return n&&(o=Kn(Qr(o).div(zt(a)),zi(o).div(zt(a)))),o}var u=this.readSync(t.dataId),l=function(h){for(var f=new Float32Array(h.length/2),p=new Float32Array(h.length/2),m=0;m<h.length;m+=2)f[m/2]=h[m],p[m/2]=h[m+1];return{real:f,imag:p}}(this.fourierTransformByMatmul(u,a,n));return Kn(l.real,l.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,n,i){if(n===1)return t;var a=this.readSync(t.dataId),o=n/2,u=function(E){for(var S=Math.ceil(E.length/4),A=new Float32Array(S),k=new Float32Array(S),O=0;O<E.length;O+=4)A[Math.floor(O/4)]=E[O],k[Math.floor(O/4)]=E[O+1];return{real:A,imag:k}}(a),l=Kn(u.real,u.imag).as1D(),h=function(E){for(var S=Math.floor(E.length/4),A=new Float32Array(S),k=new Float32Array(S),O=2;O<E.length;O+=4)A[Math.floor(O/4)]=E[O],k[Math.floor(O/4)]=E[O+1];return{real:A,imag:k}}(a),f=Kn(h.real,h.imag).as1D();l=this.fftRadix2(l,o,i),f=this.fftRadix2(f,o,i);var p=function(E,S){for(var A=new Float32Array(E/2),k=new Float32Array(E/2),O=0;O<Math.ceil(E/2);O++){var V=(S?2:-2)*Math.PI*(O/E);A[O]=Math.cos(V),k[O]=Math.sin(V)}return{real:A,imag:k}}(n,i),m=Kn(p.real,p.imag).mul(f),v=l.add(m),b=l.sub(m),C=Qr(v).concat(Qr(b)),w=zi(v).concat(zi(b));return Kn(C,w).as1D()},e.prototype.fourierTransformByMatmul=function(t,n,i){for(var a=new Float32Array(2*n),o=0;o<n;o++){for(var u=0,l=0,h=0;h<n;h++){var f=Pj(o*h,n,i),p=AS(t,h);u+=p.real*f.real-p.imag*f.imag,l+=p.real*f.imag+p.imag*f.real}i&&(u/=n,l/=n),Lj(a,u,l,o)}return a},e.prototype.depthToSpace=function(t,n,i){$(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),$(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});for(var a=t.shape[0],o=t.shape[1],u=t.shape[2],l=t.shape[3],h=o*n,f=u*n,p=l/(n*n),m=this.readSync(t.dataId),v=new Float32Array(a*h*f*p),b=0,C=0;C<a;++C)for(var w=0;w<h;++w)for(var E=Math.floor(w/n),S=w%n,A=0;A<f;++A)for(var k=Math.floor(A/n),O=(S*n+A%n)*p,V=0;V<p;++V){var T=V+O+l*(k+u*(E+o*C));v[b++]=m[T]}return vs(v,[a,h,f,p])},e.prototype.broadcastedBinaryOp=function(t,n,i,a){var o=Ee(t.shape,n.shape),u=ie(o,i),l=this.readSync(t.dataId),h=this.readSync(n.dataId),f=Vu(t.shape,o),p=Vu(n.shape,o),m=u.values;if(f.length+p.length===0)for(var v=0;v<m.length;++v)m[v]=a(l[v%l.length],h[v%h.length]);else{var b=this.bufferSync(t),C=this.bufferSync(n),w=function(E){var S=u.indexToLoc(E),A=S.slice(-t.rank);f.forEach(function(T){return A[T]=0});var k=b.locToIndex(A),O=S.slice(-n.rank);p.forEach(function(T){return O[T]=0});var V=C.locToIndex(O);m[E]=a(l[k],h[V])};for(v=0;v<m.length;++v)w(v)}return u.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,n,i){var a=Ee(t.shape,n.shape),o=ie(a,"float32"),u=ie(a,"float32"),l=this.readSync(t.dataId),h=this.readSync(n.dataId),f=Vu(t.shape,a),p=Vu(n.shape,a),m=o.values,v=u.values;if(f.length+p.length===0)for(var b=0;b<m.length;b++){var C=b%l.length,w=b%h.length,E=i(l[2*C],l[2*C+1],h[2*w],h[2*w+1]);m[b]=E.real,v[b]=E.imag}else{var S=this.bufferSync(this.data.get(t.dataId).complexTensors.real),A=this.bufferSync(this.data.get(n.dataId).complexTensors.real),k=function(O){var V=o.indexToLoc(O),T=V.slice(-t.rank);f.forEach(function(P){return T[P]=0});var R=S.locToIndex(T),N=V.slice(-n.rank);p.forEach(function(P){return N[P]=0});var D=A.locToIndex(N),L=i(l[2*R],l[2*R+1],h[2*D],h[2*D+1]);m[O]=L.real,v[O]=L.imag};for(b=0;b<m.length;b++)k(b)}return this.complex(o.toTensor(),u.toTensor())},e.prototype.split=function(t,n,i){return NI(t,n,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,n,i,a,o,u){for(var l=t.shape,h=l[0],f=l[1],p=l[2],m=l[3],v=n.shape[0],b=a[0],C=a[1],w=ie([v,b,C,m],t.dtype),E=this.readSync(n.dataId),S=this.readSync(i.dataId),A=this.readSync(t.dataId),k=t.strides,O=w.strides,V=0;V<v;V++){var T=4*V,R=E[T],N=E[T+1],D=E[T+2],L=E[T+3],P=S[V];if(!(P>=h))for(var B=b>1?(D-R)*(f-1)/(b-1):0,Z=C>1?(L-N)*(p-1)/(C-1):0,rt=0;rt<b;rt++){var q=b>1?R*(f-1)+rt*B:.5*(R+D)*(f-1);if(q<0||q>f-1)for(var K=0;K<C;K++)for(var Q=0;Q<m;Q++){var ut=Q+K*O[2]+rt*O[1]+V*O[0];w.values[ut]=u}else if(o==="bilinear"){var W=Math.floor(q),et=Math.ceil(q),dt=q-W;for(K=0;K<C;K++)if((Zt=C>1?N*(p-1)+K*Z:.5*(N+L)*(p-1))<0||Zt>p-1)for(Q=0;Q<m;Q++)ut=Q+K*O[2]+rt*O[1]+V*O[0],w.values[ut]=u;else{var lt=Math.floor(Zt),St=Math.ceil(Zt),Nt=Zt-lt;for(Q=0;Q<m;Q++){var Rt=A[ut=Q+lt*k[2]+W*k[1]+P*k[0]],Ut=A[ut=Q+St*k[2]+W*k[1]+P*k[0]],Pt=A[ut=Q+lt*k[2]+et*k[1]+P*k[0]],Xt=Rt+(Ut-Rt)*Nt,Le=Pt+(A[ut=Q+St*k[2]+et*k[1]+P*k[0]]-Pt)*Nt;ut=Q+K*O[2]+rt*O[1]+V*O[0],w.values[ut]=Xt+(Le-Xt)*dt}}}else for(K=0;K<C;++K){var Zt;if((Zt=C>1?N*(p-1)+K*Z:.5*(N+L)*(p-1))<0||Zt>p-1)for(Q=0;Q<m;Q++)ut=Q+K*O[2]+rt*O[1]+V*O[0],w.values[ut]=u;else{var ye=Math.round(Zt),se=Math.round(q);for(Q=0;Q<m;Q++){var Jt=Q+ye*k[2]+se*k[1]+P*k[0],ze=Q+K*O[2]+rt*O[1]+V*O[0];w.values[ze]=A[Jt]}}}}}return w.toTensor()},e.prototype.sparseToDense=function(t,n,i,a){var o=Mg(0,t,i),u=o.sliceRank,l=o.numUpdates,h=o.sliceSize,f=o.strides,p=o.outputSize;return this.scatter(t,n,i,p,h,l,u,f,a,!1)},e.prototype.gatherND=function(t,n){var i=n.shape,a=i[i.length-1],o=EI(t,n),u=o[0],l=o[1],h=o[2],f=o[3];if(l===0)return Rn([],u,t.dtype);for(var p=new Ic([l,h],t.dtype),m=this.readSync(n.dataId),v=this.readSync(t.dataId),b=0;b<l;b++){for(var C=[],w=0,E=0;E<a;E++){var S=m[b*a+E];w+=S*f[E],C.push(S)}if(w<0||w>=t.size/h)throw new Error("Invalid indices: "+C+" does not index into "+t.shape);for(var A=0;A<h;A++)p.values[b*h+A]=v[w*h+A]}return p.toTensor().reshape(u)},e.prototype.scatterND=function(t,n,i){var a=Mg(0,t,i),o=a.sliceRank,u=a.numUpdates,l=a.sliceSize,h=a.strides,f=a.outputSize,p=zt(0);return this.scatter(t,n,i,f,l,u,o,h,p,!0)},e.prototype.fill=function(t,n,i){var a=ad(i=i||th(n),jt(t));return a.fill(n),J.makeTensor(a,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var n=ad(t.dtype,jt(t.shape));return this.makeOutput(n,t.shape,t.dtype)},e.prototype.linspace=function(t,n,i){return Hx(t,n,i)},e.prototype.scatter=function(t,n,i,a,o,u,l,h,f,p){var m=[a/o,o],v=this.readSync(t.dataId),b=this.readSync(n.dataId);if(a===0)return Rn([],i,n.dtype);var C=new Ic(m,n.dtype);C.values.fill(this.readSync(f.dataId)[0]);for(var w=0;w<u;w++){for(var E=[],S=0,A=0;A<l;A++){var k=v[w*l+A];E.push(k),S+=k*h[A]}if(S<0||S>=a/o)throw new Error("Invalid indices: "+E+" does not index into "+i);for(var O=0;O<o;O++)p?C.values[S*o+O]+=b[w*o+O]:C.values[S*o+O]=n.rank===0?b[0]:b[w*o+O]}return C.toTensor().reshape(i)},e}(jx);J.registerBackend("cpu",function(){return new PW},1),Pb({kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,i=t;Tt(n,"square");for(var a=i.data.get(n.dataId).values,o=new Float32Array(a.length),u=0;u<a.length;++u){var l=a[u];o[u]=l*l}return{dataId:i.write(o,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}}),Pb({kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,i=t,a=new he(n.shape,"return x * x;");return i.runWebGLProgram(a,[n],n.dtype)}});var zW=function(){function r(){}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r}();gt().get("IS_BROWSER")&&gt().setPlatform("browser",new zW);var q1,VW=function(){return require("node-fetch")},FW=function(){function r(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return gt().global.fetch!=null?gt().global.fetch(e,t):(q1==null&&(q1=VW()),q1(e,t))},r.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r}();gt().get("IS_NODE")&&gt().setPlatform("node",new FW);var Jb={float32:4,int32:4,uint16:2,uint8:1,bool:1},zg=4;function u5(r,e){for(var t={},n=0,i=function(u){var l=u.name,h=u.dtype,f=u.shape,p=jt(f),m=void 0;if("quantization"in u){var v=u.quantization;if(v.dtype!=="uint8"&&v.dtype!=="uint16")throw new Error("Weight "+u.name+" has unknown quantization dtype "+v.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var b=Jb[v.dtype],C=r.slice(n,n+p*b),w=v.dtype==="uint8"?new Uint8Array(C):new Uint16Array(C);if(h==="float32")m=Float32Array.from(w,function(V){return V*v.scale+v.min});else{if(h!=="int32")throw new Error("Unsupported dtype in weight '"+l+"': "+h);m=Int32Array.from(w,function(V){return Math.round(V*v.scale+v.min)})}n+=p*b}else if(h==="string"){var E=jt(u.shape);m=[];for(var S=0;S<E;S++){var A=new Uint32Array(r.slice(n,n+zg))[0];n+=zg;var k=new Uint8Array(r.slice(n,n+A));m.push(k),n+=A}}else{var O=Jb[h];if(C=r.slice(n,n+p*O),h==="float32")m=new Float32Array(C);else if(h==="int32")m=new Int32Array(C);else{if(h!=="bool")throw new Error("Unsupported dtype in weight '"+l+"': "+h);m=new Uint8Array(C)}n+=p*O}t[l]=Rn(m,f,h)},a=0,o=e;a<o.length;a++)i(o[a]);return t}function BW(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var e=0,t=[];r.forEach(function(a){if(e+=a.byteLength,t.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)});var n=new Uint8Array(e),i=0;return t.forEach(function(a){n.set(new Uint8Array(a.buffer),i),i+=a.byteLength}),n.buffer}var t2=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function KS(r){return t2?Buffer.byteLength(r):new Blob([r]).size}function Gw(r){var e=0;r.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),n=0;return r.forEach(function(i){t.set(new Uint8Array(i),n),n+=i.byteLength}),t.buffer}function XS(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var e=r.split("/");return e[e.length-1]}function qd(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:KS(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:KS(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var mi=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var i=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(a){var o=a(e,n);o!==null&&i.push(o)}),i},r}(),bc="://",Is=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){$(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(bc)&&(e=e.slice(0,e.indexOf(bc))),$(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();$(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),n.managers[e]=t},r.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r}();function rg(r){if(r.indexOf(bc)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Is.getSchemes().join(","));return{scheme:r.split(bc)[0],path:r.split(bc)[1]}}function YS(r,e,t){return t===void 0&&(t=!1),Ft(this,void 0,void 0,function(){var n,i,a,o,u,l,h,f,p;return Bt(this,function(m){switch(m.label){case 0:return $(r!==e,function(){return"Old path and new path are the same: '"+r+"'"}),$((n=mi.getLoadHandlers(r)).length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),$(n.length<2,function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+r+"."}),i=n[0],$((a=mi.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),$(a.length<2,function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+e+"."}),o=a[0],u=rg(r).scheme,l=rg(r).path,h=u===rg(r).scheme,[4,i.load()];case 1:return f=m.sent(),t&&h?[4,Is.getManager(u).removeModel(l)]:[3,3];case 2:m.sent(),m.label=3;case 3:return[4,o.save(f)];case 4:return p=m.sent(),!t||h?[3,6]:[4,Is.getManager(u).removeModel(l)];case 5:m.sent(),m.label=6;case 6:return[2,p.modelArtifactsInfo]}})})}var Bu="models_store",ws="model_info_store";function l5(){if(!gt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function e2(r){var e=r.result;e.createObjectStore(Bu,{keyPath:"modelPath"}),e.createObjectStore(ws,{keyPath:"modelPath"})}var xc=function(){function r(e){if(this.indexedDB=l5(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return Ft(this,void 0,void 0,function(){return Bt(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return Ft(this,void 0,void 0,function(){return Bt(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(i,a){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return e2(o)},o.onsuccess=function(){var u=o.result;if(t==null){var l=u.transaction(Bu,"readonly"),h=l.objectStore(Bu).get(n.modelPath);h.onsuccess=function(){if(h.result==null)return u.close(),a(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));i(h.result.modelArtifacts)},h.onerror=function(C){return u.close(),a(h.error)},l.oncomplete=function(){return u.close()}}else{var f,p=qd(t),m=u.transaction(ws,"readwrite"),v=m.objectStore(ws),b=v.put({modelPath:n.modelPath,modelArtifactsInfo:p});b.onsuccess=function(){var C=(f=u.transaction(Bu,"readwrite")).objectStore(Bu).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:p});C.onsuccess=function(){return i({modelArtifactsInfo:p})},C.onerror=function(w){var E=(v=m.objectStore(ws)).delete(n.modelPath);E.onsuccess=function(){return u.close(),a(C.error)},E.onerror=function(S){return u.close(),a(C.error)}}},b.onerror=function(C){return u.close(),a(b.error)},m.oncomplete=function(){f==null?u.close():f.oncomplete=function(){return u.close()}}}},o.onerror=function(u){return a(o.error)}})},r.URL_SCHEME="indexeddb://",r}(),QS=function(r){return gt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(xc.URL_SCHEME)?(e=r.slice(xc.URL_SCHEME.length),new xc(e)):null;var e};mi.registerSaveRouter(QS),mi.registerLoadRouter(QS);var jW=function(){function r(){this.indexedDB=l5()}return r.prototype.listModels=function(){return Ft(this,void 0,void 0,function(){var e=this;return Bt(this,function(t){return[2,new Promise(function(n,i){var a=e.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return e2(a)},a.onsuccess=function(){var o=a.result,u=o.transaction(ws,"readonly"),l=u.objectStore(ws).getAll();l.onsuccess=function(){for(var h={},f=0,p=l.result;f<p.length;f++){var m=p[f];h[m.modelPath]=m.modelArtifactsInfo}n(h)},l.onerror=function(h){return o.close(),i(l.error)},u.oncomplete=function(){return o.close()}},a.onerror=function(o){return i(a.error)}})]})})},r.prototype.removeModel=function(e){return Ft(this,void 0,void 0,function(){var t=this;return Bt(this,function(n){var i;return e=(i=e).startsWith(xc.URL_SCHEME)?i.slice(xc.URL_SCHEME.length):i,[2,new Promise(function(a,o){var u=t.indexedDB.open("tensorflowjs",1);u.onupgradeneeded=function(){return e2(u)},u.onsuccess=function(){var l,h=u.result,f=h.transaction(ws,"readwrite"),p=f.objectStore(ws),m=p.get(e);m.onsuccess=function(){if(m.result==null)return h.close(),o(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var v=p.delete(e),b=function(){var C=(l=h.transaction(Bu,"readwrite")).objectStore(Bu).delete(e);C.onsuccess=function(){return a(m.result.modelArtifactsInfo)},C.onerror=function(w){return o(m.error)}};v.onsuccess=b,v.onerror=function(C){return b(),h.close(),o(m.error)}},m.onerror=function(v){return h.close(),o(m.error)},f.oncomplete=function(){l==null?h.close():l.oncomplete=function(){return h.close()}}},u.onerror=function(l){return o(u.error)}})]})})},r}();if(gt().getBool("IS_BROWSER"))try{Is.registerManager(xc.URL_SCHEME,new jW)}catch{}var wo="/",pc="tensorflowjs_models",c5="info",UW="model_topology",WW="weight_specs",HW="weight_data",qW="model_metadata";function h5(r){return{info:[pc,r,c5].join(wo),topology:[pc,r,UW].join(wo),weightSpecs:[pc,r,WW].join(wo),weightData:[pc,r,HW].join(wo),modelMetadata:[pc,r,qW].join(wo)}}function GW(r){var e=r.split(wo);if(e.length<3)throw new Error("Invalid key format: "+r);return e.slice(1,e.length-1).join(wo)}var wc=function(){function r(e){if(!gt().getBool("IS_BROWSER")||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=h5(this.modelPath)}return r.prototype.save=function(e){return Ft(this,void 0,void 0,function(){var t,n,i;return Bt(this,function(a){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),i=qd(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,(o=e.weightData,t2?Buffer.from(o).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(o))))),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}var o;return[2]})})},r.prototype.load=function(){return Ft(this,void 0,void 0,function(){var e,t,n,i,a,o,u;return Bt(this,function(l){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(n=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(a=this.LS.getItem(this.keys.modelMetadata))!=null&&(o=JSON.parse(a),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy),(u=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(h){if(t2){var f=Buffer.from(h,"base64");return f.buffer.slice(f.byteOffset,f.byteOffset+f.byteLength)}for(var p=atob(h),m=new Uint8Array(p.length),v=0;v<p.length;++v)m.set([p.charCodeAt(v)],v);return m.buffer}(u),[2,t]})})},r.URL_SCHEME="localstorage://",r}(),ZS=function(r){return gt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(wc.URL_SCHEME)?(e=r.slice(wc.URL_SCHEME.length),new wc(e)):null;var e};mi.registerSaveRouter(ZS),mi.registerLoadRouter(ZS);var $W=function(){function r(){$(gt().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),$(window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return Ft(this,void 0,void 0,function(){var e,t,n,i,a,o;return Bt(this,function(u){for(e={},t=pc+wo,n=wo+c5,i=0;i<this.LS.length;++i)(a=this.LS.key(i)).startsWith(t)&&a.endsWith(n)&&(o=GW(a),e[o]=JSON.parse(this.LS.getItem(a)));return[2,e]})})},r.prototype.removeModel=function(e){return Ft(this,void 0,void 0,function(){var t,n;return Bt(this,function(i){var a;if(e=(a=e).startsWith(wc.URL_SCHEME)?a.slice(wc.URL_SCHEME.length):a,t=h5(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},r}();if(gt().getBool("IS_BROWSER"))try{Is.registerManager(wc.URL_SCHEME,new $W)}catch{}var KW="model",XW=".json",YW=".weights.bin";function JS(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var G1=function(){function r(e){if(!gt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),e!=null&&e.length!==0||(e=KW),this.modelTopologyFileName=e+XW,this.weightDataFileName=e+YW}return r.prototype.save=function(e){return Ft(this,void 0,void 0,function(){var t,n,i,a,o,u;return Bt(this,function(l){switch(l.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},a=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(o=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=a,[4,JS(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return l.sent(),e.weightData==null?[3,4]:((u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=t,[4,JS(function(){return u.dispatchEvent(new MouseEvent("click"))})]);case 3:l.sent(),l.label=4;case 4:return[2,{modelArtifactsInfo:qd(e)}]}})})},r.URL_SCHEME="downloads://",r}(),QW=function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return r.prototype.load=function(){return Ft(this,void 0,void 0,function(){var e,t,n=this;return Bt(this,function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(a,o){var u=new FileReader;u.onload=function(l){var h=JSON.parse(l.target.result),f=h.modelTopology;if(f!=null){t.length===0&&a({modelTopology:f});var p=h.weightsManifest;if(p!=null){var m;try{m=n.checkManifestAndWeightFiles(p,t)}catch(w){return void o(w)}var v=[],b=[],C=[];p.forEach(function(w){w.paths.forEach(function(E){b.push(E),C.push(null)}),v.push.apply(v,w.weights)}),p.forEach(function(w){w.paths.forEach(function(E){var S=new FileReader;S.onload=function(A){var k=A.target.result,O=b.indexOf(E);C[O]=k,C.indexOf(null)===-1&&a({modelTopology:f,weightSpecs:v,weightData:Gw(C)})},S.onerror=function(A){return o("Failed to weights data from file of path '"+E+"'.")},S.readAsArrayBuffer(m[E])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},u.onerror=function(l){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},u.readAsText(e)})]})})},r.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],i=t.map(function(l){return XS(l.name)}),a={},o=0,u=e;o<u.length;o++)u[o].paths.forEach(function(l){var h=XS(l);if(n.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+h+"'");if(n.push(h),i.indexOf(h)===-1)throw new Error("Weight file with basename '"+h+"' is not provided.");a[l]=t[i.indexOf(h)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return a},r}();function t4(r,e,t,n){(function(a){$(a!=null&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"})})(r),function(a,o){$(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a}),$(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+o}),$(o>=a,function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+o})}(t=t??0,n=n??1);var i=0;return Promise.all(r.map(function(a){return a.then(function(o){var u=t+ ++i/r.length*(n-t);return e(u),o}),a}))}function f5(r,e){return Ft(this,void 0,void 0,function(){var t,n,i,a,o,u,l,h,f;return Bt(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?gt().platform.fetch:e.fetchFunc,n=r.map(function(m){return t(m,e.requestInit,{isBinary:!0})}),i=0,a=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return o=p.sent(),[3,4];case 2:return[4,t4(n,e.onProgress,i,a)];case 3:o=p.sent(),p.label=4;case 4:return u=o.map(function(m){return m.arrayBuffer()}),l=.5,h=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return f=p.sent(),[3,8];case 6:return[4,t4(u,e.onProgress,l,h)];case 7:f=p.sent(),p.label=8;case 8:return[2,f]}})})}function e4(r){var e=this;return function(t,n,i){return n===void 0&&(n=""),Ft(e,void 0,void 0,function(){var a,o,u,l,h,f,p,m,v,b;return Bt(this,function(C){switch(C.label){case 0:if(a=t.map(function(){return!1}),o={},u=i!=null?i.map(function(){return!1}):[],l=[],t.forEach(function(w,E){var S=0;w.weights.forEach(function(A){var k="quantization"in A?A.quantization.dtype:A.dtype,O=Jb[k]*jt(A.shape),V=function(){a[E]=!0,o[E]==null&&(o[E]=[]),o[E].push({manifestEntry:A,groupOffset:S,sizeBytes:O})};i!=null?i.forEach(function(T,R){T===A.name&&(V(),u[R]=!0)}):V(),l.push(A.name),S+=O})}),!u.every(function(w){return w}))throw h=i.filter(function(w,E){return!u[E]}),new Error("Could not find weights in manifest with names: "+h.join(", ")+`. 
Manifest JSON has weights with names: `+l.join(", ")+".");return f=a.reduce(function(w,E,S){return E&&w.push(S),w},[]),p=[],f.forEach(function(w){t[w].paths.forEach(function(E){var S=n+(n.endsWith("/")?"":"/")+E;p.push(S)})}),[4,r(p)];case 1:return m=C.sent(),v={},b=0,f.forEach(function(w){for(var E=t[w].paths.length,S=0,A=0;A<E;A++)S+=m[b+A].byteLength;for(var k=new ArrayBuffer(S),O=new Uint8Array(k),V=0,T=0;T<E;T++){var R=new Uint8Array(m[b+T]);O.set(R,V),V+=R.byteLength}o[w].forEach(function(N){var D=u5(k.slice(N.groupOffset,N.groupOffset+N.sizeBytes),[N.manifestEntry]);for(var L in D)v[L]=D[L]}),b+=E}),[2,v]}})})}}mi.registerSaveRouter(function(r){return gt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(G1.URL_SCHEME)?(e=r.slice(G1.URL_SCHEME.length),e===void 0&&(e="model"),new G1(e)):null;var e});var d5=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?($(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=gt().platform.fetch,$(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&$(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return Ft(this,void 0,void 0,function(){var t,n,i,a;return Bt(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((a=o.sent()).ok)return[2,{modelArtifactsInfo:qd(e),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}})})},r.prototype.load=function(){return Ft(this,void 0,void 0,function(){var e,t,n,i,a,o,u,l;return Bt(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,e.json()];case 3:return t=h.sent(),[3,5];case 4:throw h.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(i=t.modelTopology,a=t.weightsManifest,i==null&&a==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return a==null?[3,7]:[4,this.loadWeights(a)];case 6:l=h.sent(),o=l[0],u=l[1],h.label=7;case 7:return[2,{modelTopology:i,weightSpecs:o,weightData:u}]}})})},r.prototype.loadWeights=function(e){return Ft(this,void 0,void 0,function(){var t,n,i,a,o,u,l,h,f,p,m;return Bt(this,function(v){switch(v.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(b){var C=b.lastIndexOf("/"),w=b.lastIndexOf("?"),E=b.substring(0,C),S=w>C?b.substring(w):"";return[E+"/",S]}(t),i=n[0],a=n[1],o=this.weightPathPrefix||i,u=[],l=0,h=e;l<h.length;l++)f=h[l],u.push.apply(u,f.weights);return p=[],e.forEach(function(b){b.paths.forEach(function(C){p.push(o+C+a)})}),[4,f5(p,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return m=v.sent(),[2,[u,Gw(m)]]}})})},r.URL_SCHEME_REGEX=/^https?:\/\//,r}();function n2(r){return r.match(d5.URL_SCHEME_REGEX)!=null}var n4=function(r,e){return typeof fetch>"u"?null:(Array.isArray(r)?r.every(function(t){return n2(t)}):n2(r))?r2(r,{onProgress:e}):null};function r2(r,e){return new d5(r,e)}mi.registerSaveRouter(n4),mi.registerLoadRouter(n4);var $1=function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return Ft(this,void 0,void 0,function(){return Bt(this,function(e){return[2,this.modelArtifacts]})})},r}(),ZW=function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return Ft(this,void 0,void 0,function(){return Bt(this,function(t){return[2,this.saveHandler(e)]})})},r}(),gi=Object.freeze({browserFiles:function(r){return new QW(r)},browserHTTPRequest:function(r,e){return r2(r,e)},concatenateArrayBuffers:Gw,decodeWeights:u5,encodeWeights:function(r,e){return Ft(this,void 0,void 0,function(){var t,n,i,a,o,u=this;return Bt(this,function(l){switch(l.label){case 0:for(t=[],n=[],i=Array.isArray(r)?r.map(function(h){return h.name}):Object.keys(r),a=function(h){var f=i[h],p=Array.isArray(r)?r[h].tensor:r[f];if(p.dtype!=="float32"&&p.dtype!=="int32"&&p.dtype!=="bool"&&p.dtype!=="string")throw new Error("Unsupported dtype in weight '"+f+"': "+p.dtype);var m={name:f,shape:p.shape,dtype:p.dtype};if(p.dtype==="string"){var v=new Promise(function(b){return Ft(u,void 0,void 0,function(){var C,w,E,S,A,k,O;return Bt(this,function(V){switch(V.label){case 0:return[4,p.bytes()];case 1:for(C=V.sent(),w=C.reduce(function(T,R){return T+R.length},0)+zg*C.length,E=new Uint8Array(w),S=0,A=0;A<C.length;A++)k=C[A],O=new Uint8Array(new Uint32Array([k.length]).buffer),E.set(O,S),S+=zg,E.set(k,S),S+=k.length;return b(E),[2]}})})});n.push(v)}else n.push(p.data());e!=null&&(m.group=e),t.push(m)},o=0;o<i.length;++o)a(o);return[4,Promise.all(n)];case 1:return[2,{data:BW(l.sent()),specs:t}]}})})},fromMemory:function(r,e,t,n){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new $1(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new $1({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new $1({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n}))},getLoadHandlers:function(r,e){return mi.getLoadHandlers(r,e)},getModelArtifactsInfoForJSON:qd,getSaveHandlers:function(r){return mi.getSaveHandlers(r)},http:r2,isHTTPScheme:n2,loadWeights:function(r,e,t,n){return e===void 0&&(e=""),Ft(this,void 0,void 0,function(){return Bt(this,function(i){return[2,e4(function(a){return f5(a,{requestInit:n})})(r,e,t)]})})},registerLoadRouter:function(r){return mi.registerLoadRouter(r)},registerSaveRouter:function(r){return mi.registerSaveRouter(r)},weightsLoaderFactory:e4,withSaveHandler:function(r){return new ZW(r)},copyModel:function(r,e){return Ft(this,void 0,void 0,function(){return Bt(this,function(t){return[2,YS(r,e,!1)]})})},listModels:function(){return Ft(this,void 0,void 0,function(){var r,e,t,n,i,a,o;return Bt(this,function(u){switch(u.label){case 0:r=Is.getSchemes(),e={},t=0,n=r,u.label=1;case 1:return t<n.length?(i=n[t],[4,Is.getManager(i).listModels()]):[3,4];case 2:for(o in a=u.sent())e[i+bc+o]=a[o];u.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(r,e){return Ft(this,void 0,void 0,function(){return Bt(this,function(t){return[2,YS(r,e,!0)]})})},removeModel:function(r){return Ft(this,void 0,void 0,function(){var e;return Bt(this,function(t){return e=rg(r),[2,Is.getManager(e.scheme).removeModel(e.path)]})})}}),JW=tt({confusionMatrix_:function(r,e,t){var n=G(r,"labels","confusionMatrix"),i=G(e,"predictions","confusionMatrix");$(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),$(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),$(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),$(n.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),$(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var a=kc(n.asType("int32"),t),o=kc(i.asType("int32"),t);return a.transpose().matMul(o).asType("int32")}}),tH=Object.freeze({confusionMatrix:JW}),eH=tt({fromPixels_:function(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");var t=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(t&&t&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");return J.fromPixels(r,e)}}),p5=Object.freeze({toPixels:function(r,e){return Ft(this,void 0,void 0,function(){var t,n,i,a,o,u,l,h,f,p,m,v,b,C,w,E,S,A,k,O,V,T,R;return Bt(this,function(N){switch(N.label){case 0:if(t=G(r,"img","toPixels"),r instanceof Ge||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(n=t.shape.slice(0,2),i=n[0],a=n[1],(o=t.rank===2?1:t.shape[2])>4||o===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,t.data()];case 1:return u=N.sent(),l=t.min(),h=t.max(),[4,Promise.all([l.data(),h.data()])];case 2:if(f=N.sent(),p=f[0],m=f[1],v=p[0],b=m[0],l.dispose(),h.dispose(),t.dtype==="float32"){if(v<0||b>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+v+" - "+b+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(v<0||b>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+v+" - "+b+"].")}for(C=t.dtype==="float32"?255:1,w=new Uint8ClampedArray(a*i*4),E=0;E<i*a;++E)S=void 0,A=void 0,k=void 0,O=void 0,o===1?(S=u[E]*C,A=u[E]*C,k=u[E]*C,O=255):o===3?(S=u[3*E]*C,A=u[3*E+1]*C,k=u[3*E+2]*C,O=255):o===4&&(S=u[4*E]*C,A=u[4*E+1]*C,k=u[4*E+2]*C,O=u[4*E+3]*C),w[0+(V=4*E)]=Math.round(S),w[V+1]=Math.round(A),w[V+2]=Math.round(k),w[V+3]=Math.round(O);return e!=null&&(e.width=a,e.height=i,T=e.getContext("2d"),R=new ImageData(w,a,i),T.putImageData(R,0,0)),t!==r&&t.dispose(),[2,w]}})})},fromPixels:eH}),m5=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}(),g5=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r}();function Ys(r){$(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),$(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),$(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),g5.register(r)}var At=Object.freeze({Serializable:m5,SerializationMap:g5,registerClass:Ys}),nH=.001,v5=.1;function K1(){return J.backend.floatPrecision()===32?nH:v5}function X1(r,e,t){var n=!0;if((yr(r)||yr(e))&&(n=!1),yr(r)&&yr(e)&&(n=!0),n){var i=r.constructor.name,a=e.constructor.name;if(i!==a)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+a)}if(Array.isArray(r)&&Array.isArray(e)){var o=Va(r),u=Va(e);if(!or(o,u))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+u+"]")}var l=yr(r)?r:Do(r),h=yr(e)?e:Do(e);if(l.length!==h.length)throw new Error("Arrays have different lengths actual: "+l.length+" vs expected: "+h.length+`.
Actual:   `+l+`.
Expected: `+h+".");for(var f=0;f<h.length;++f){var p=l[f],m=h[f];if(!t(p,m))throw new Error("Arrays differ: actual["+f+"] = "+p+", expected["+f+"] = "+m+`.
Actual:   `+l+`.
Expected: `+h+".")}}function Y1(r,e,t){return!isFinite(r)&&!isFinite(e)||!(isNaN(r)||isNaN(e)||Math.abs(r-e)>t)}var rH=Object.freeze({TEST_EPSILON_FLOAT16:v5,expectArraysClose:function(r,e,t){return t==null&&(t=K1()),X1(r,e,function(n,i){return Y1(n,i,t)})},testEpsilon:K1,expectPromiseToFail:function(r,e){r().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(r,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return xs(r)||xs(r[0])||xs(e)||xs(e[0])?X1(r,t,function(n,i){return n==i}):X1(r,e,function(n,i){return Y1(n,i,0)})},expectNumbersClose:function(r,e,t){if(t==null&&(t=K1()),!Y1(r,e,t))throw new Error("Numbers differ: actual === "+r+", expected === "+e)},expectValuesInRange:function(r,e,t){for(var n=0;n<r.length;n++)if(r[n]<e||r[n]>t)throw new Error("Value out of range:"+r[n]+" low: "+e+", high: "+t)},expectArrayBuffersEqual:function(r,e){expect(new Float32Array(r)).toEqual(new Float32Array(e))}}),y5="1.3.1",iH=Object.freeze({gpgpu_util:RU,webgl_util:ij,forceHalfFloat:function(){gt().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:ok,setWebGLContext:LN,GPGPUContext:JI}),Bo=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return aa(e,r),e.prototype.minimize=function(t,n,i){n===void 0&&(n=!1);var a=this.computeGradients(t,i),o=a.value,u=a.grads;if(i!=null){var l=i.map(function(h){return{name:h.name,tensor:u[h.name]}});this.applyGradients(l)}else this.applyGradients(u);return de(u),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return RI(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&de(this.iterations_)},e.prototype.saveIterations=function(){return Ft(this,void 0,void 0,function(){return Bt(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:zt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ft(this,void 0,void 0,function(){return Bt(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ft(this,void 0,void 0,function(){return Bt(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return Ft(this,void 0,void 0,function(){var n;return Bt(this,function(i){switch(i.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e}(m5);Object.defineProperty(Bo,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var $w=function(r){function e(t,n,i){i===void 0&&(i=null);var a=r.call(this)||this;return a.learningRate=t,a.rho=n,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],i==null&&(a.epsilon=J.backend.epsilon()),a}return aa(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var o=J.registeredVariables[i];n.accumulatedGrads[a]==null&&(n.accumulatedGrads[a]={originalName:i+"/accum_grad",variable:ft(function(){return Te(o).variable(!1)})}),n.accumulatedUpdates[a]==null&&(n.accumulatedUpdates[a]={originalName:i+"/accum_var",variable:ft(function(){return Te(o).variable(!1)})});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var l=n.accumulatedGrads[a].variable,h=n.accumulatedUpdates[a].variable;ft(function(){var f=l.mul(n.rho).add(u.square().mul(1-n.rho)),p=h.add(n.epsilon).sqrt().div(l.add(n.epsilon).sqrt()).mul(u),m=h.mul(n.rho).add(p.square().mul(1-n.rho));l.assign(f),h.assign(m);var v=p.mul(-n.learningRate).add(o);o.assign(v)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(de(this.accumulatedGrads.map(function(t){return t.variable})),de(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ft(this,void 0,void 0,function(){var t;return Bt(this,function(n){switch(n.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Ft(this,void 0,void 0,function(){var n;return Bt(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,this.accumulatedGrads=t.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e.className="Adadelta",e}(Bo);Ys($w);var Kw=function(r){function e(t,n){n===void 0&&(n=.1);var i=r.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=n,i.accumulatedGrads=[],i}return aa(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var o=J.registeredVariables[i];n.accumulatedGrads[a]==null&&(n.accumulatedGrads[a]={originalName:i+"/accumulator",variable:ft(function(){return nh(o.shape,n.initialAccumulatorValue).variable(!1)})});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var l=n.accumulatedGrads[a].variable;ft(function(){var h=l.add(u.square());l.assign(h);var f=u.div(h.add(J.backend.epsilon()).sqrt()).mul(-n.learningRate).add(o);o.assign(f)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&de(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ft(this,void 0,void 0,function(){return Bt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ft(this,void 0,void 0,function(){return Bt(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e.className="Adagrad",e}(Bo);Ys(Kw);var Xw=function(r){function e(t,n,i,a){a===void 0&&(a=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=i,o.epsilon=a,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],ft(function(){o.accBeta1=zt(n).variable(),o.accBeta2=zt(i).variable()}),a==null&&(o.epsilon=J.backend.epsilon()),o}return aa(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t);ft(function(){var a=sr(1,n.accBeta1),o=sr(1,n.accBeta2);i.forEach(function(u,l){var h=J.registeredVariables[u];n.accumulatedFirstMoment[l]==null&&(n.accumulatedFirstMoment[l]={originalName:u+"/m",variable:ft(function(){return Te(h).variable(!1)})}),n.accumulatedSecondMoment[l]==null&&(n.accumulatedSecondMoment[l]={originalName:u+"/v",variable:ft(function(){return Te(h).variable(!1)})});var f=Array.isArray(t)?t[l].tensor:t[u];if(f!=null){var p=n.accumulatedFirstMoment[l].variable,m=n.accumulatedSecondMoment[l].variable,v=p.mul(n.beta1).add(f.mul(1-n.beta1)),b=m.mul(n.beta2).add(f.square().mul(1-n.beta2)),C=v.div(a),w=b.div(o);p.assign(v),m.assign(b);var E=C.div(w.sqrt().add(n.epsilon)).mul(-n.learningRate).add(h);h.assign(E)}}),n.accBeta1.assign(n.accBeta1.mul(n.beta1)),n.accBeta2.assign(n.accBeta2.mul(n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&de(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&de(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ft(this,void 0,void 0,function(){var t;return Bt(this,function(n){switch(n.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Ft(this,void 0,void 0,function(){var n,i=this;return Bt(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),ft(function(){i.accBeta1.assign(Oc(i.beta1,i.iterations_+1)),i.accBeta2.assign(Oc(i.beta2,i.iterations_+1))}),n=t.length/2,this.accumulatedFirstMoment=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(n,2*n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e.className="Adam",e}(Bo);Ys(Xw);var Yw=function(r){function e(t,n,i,a,o){a===void 0&&(a=null),o===void 0&&(o=0);var u=r.call(this)||this;return u.learningRate=t,u.beta1=n,u.beta2=i,u.epsilon=a,u.decay=o,u.accumulatedFirstMoment=[],u.accumulatedWeightedInfNorm=[],ft(function(){u.iteration=zt(0).variable(),u.accBeta1=zt(n).variable()}),a==null&&(u.epsilon=J.backend.epsilon()),u}return aa(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t);ft(function(){var a=sr(1,n.accBeta1),o=kr(-n.learningRate,n.iteration.mul(n.decay).add(1));i.forEach(function(u,l){var h=J.registeredVariables[u];n.accumulatedFirstMoment[l]==null&&(n.accumulatedFirstMoment[l]={originalName:u+"/m",variable:Te(h).variable(!1)}),n.accumulatedWeightedInfNorm[l]==null&&(n.accumulatedWeightedInfNorm[l]={originalName:u+"/v",variable:Te(h).variable(!1)});var f=Array.isArray(t)?t[l].tensor:t[u];if(f!=null){var p=n.accumulatedFirstMoment[l].variable,m=n.accumulatedWeightedInfNorm[l].variable,v=p.mul(n.beta1).add(f.mul(1-n.beta1)),b=m.mul(n.beta2),C=f.abs(),w=b.maximum(C);p.assign(v),m.assign(w);var E=o.div(a).mul(v.div(w.add(n.epsilon))).add(h);h.assign(E)}}),n.iteration.assign(n.iteration.add(1)),n.accBeta1.assign(n.accBeta1.mul(n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&de(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&de(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ft(this,void 0,void 0,function(){return Bt(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ft(this,void 0,void 0,function(){return Bt(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e.className="Adamax",e}(Bo);Ys(Yw);var oy=function(r){function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return aa(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var o=Array.isArray(t)?t[a].tensor:t[i];if(o!=null){var u=J.registeredVariables[i];ft(function(){var l=n.c.mul(o).add(u);u.assign(l)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=za(zt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ft(this,void 0,void 0,function(){return Bt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ft(this,void 0,void 0,function(){return Bt(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=n.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e.className="SGD",e}(Bo);Ys(oy);var Qw=function(r){function e(t,n,i){i===void 0&&(i=!1);var a=r.call(this,t)||this;return a.learningRate=t,a.momentum=n,a.useNesterov=i,a.accumulations=[],a.m=zt(a.momentum),a}return aa(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var o=J.registeredVariables[i];n.accumulations[a]==null&&(n.accumulations[a]={originalName:i+"/momentum",variable:ft(function(){return Te(o).variable(!1)})});var u=n.accumulations[a].variable,l=Array.isArray(t)?t[a].tensor:t[i];l!=null&&ft(function(){var h,f=n.m.mul(u).add(l);h=n.useNesterov?n.c.mul(l.add(f.mul(n.m))).add(o):n.c.mul(f).add(o),u.assign(f),o.assign(h)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&de(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ft(this,void 0,void 0,function(){return Bt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ft(this,void 0,void 0,function(){return Bt(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e.className="Momentum",e}(oy);Ys(Qw);var Zw=function(r){function e(t,n,i,a,o){n===void 0&&(n=.9),i===void 0&&(i=0),a===void 0&&(a=null),o===void 0&&(o=!1);var u=r.call(this)||this;return u.learningRate=t,u.decay=n,u.momentum=i,u.epsilon=a,u.accumulatedMeanSquares=[],u.accumulatedMoments=[],u.accumulatedMeanGrads=[],u.centered=o,a==null&&(u.epsilon=J.backend.epsilon()),u}return aa(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var o=J.registeredVariables[i];n.accumulatedMeanSquares[a]==null&&(n.accumulatedMeanSquares[a]={originalName:i+"/rms",variable:ft(function(){return Te(o).variable(!1)})}),n.accumulatedMoments[a]==null&&(n.accumulatedMoments[a]={originalName:i+"/momentum",variable:ft(function(){return Te(o).variable(!1)})}),n.accumulatedMeanGrads[a]==null&&n.centered&&(n.accumulatedMeanGrads[a]={originalName:i+"/mg",variable:ft(function(){return Te(o).variable(!1)})});var u=Array.isArray(t)?t[a].tensor:t[i];if(u!=null){var l=n.accumulatedMeanSquares[a].variable,h=n.accumulatedMoments[a].variable;ft(function(){var f=l.mul(n.decay).add(u.square().mul(1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[a].variable,m=p.mul(n.decay).add(u.mul(1-n.decay)),v=h.mul(n.momentum).add(u.mul(n.learningRate).div(f.sub(m.square().add(n.epsilon)).sqrt()));l.assign(f),p.assign(m),h.assign(v);var b=o.sub(v);o.assign(b)}else{var C=l.mul(n.decay).add(u.square().mul(1-n.decay));v=h.mul(n.momentum).add(u.mul(n.learningRate).div(C.add(n.epsilon).sqrt())),l.assign(C),h.assign(v),b=o.sub(v),o.assign(b)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&de(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&de(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&de(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ft(this,void 0,void 0,function(){var t;return Bt(this,function(n){switch(n.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Ft(this,void 0,void 0,function(){var n;return Bt(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e.className="RMSProp",e}(Bo);Ys(Zw);var Ru=function(){function r(){}return r.sgd=function(e){return new oy(e)},r.momentum=function(e,t,n){return n===void 0&&(n=!1),new Qw(e,t,n)},r.rmsprop=function(e,t,n,i,a){return t===void 0&&(t=.9),n===void 0&&(n=0),i===void 0&&(i=null),a===void 0&&(a=!1),new Zw(e,t,n,i,a)},r.adam=function(e,t,n,i){return e===void 0&&(e=.001),t===void 0&&(t=.9),n===void 0&&(n=.999),i===void 0&&(i=null),new Xw(e,t,n,i)},r.adadelta=function(e,t,n){return e===void 0&&(e=.001),t===void 0&&(t=.95),n===void 0&&(n=null),new $w(e,t,n)},r.adamax=function(e,t,n,i,a){return e===void 0&&(e=.002),t===void 0&&(t=.9),n===void 0&&(n=.999),i===void 0&&(i=null),a===void 0&&(a=0),new Yw(e,t,n,i,a)},r.adagrad=function(e,t){return t===void 0&&(t=.1),new Kw(e,t)},r}(),Ou={sgd:Ru.sgd,momentum:Ru.momentum,adadelta:Ru.adadelta,adagrad:Ru.adagrad,rmsprop:Ru.rmsprop,adamax:Ru.adamax,adam:Ru.adam},aH=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()};function ig(){return new Promise(function(r){return aH(function(){return r()})})}vt=LW;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var b5=function(r,e){return(b5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(r,e)};function xt(r,e){function t(){this.constructor=r}b5(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Q1,Mf=function(){return(Mf=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i]);return r}).apply(this,arguments)};function ee(r,e,t,n){return new(t||(t=Promise))(function(i,a){function o(h){try{l(n.next(h))}catch(f){a(f)}}function u(h){try{l(n.throw(h))}catch(f){a(f)}}function l(h){h.done?i(h.value):new t(function(f){f(h.value)}).then(o,u)}l((n=n.apply(r,[])).next())})}function Kt(r,e){var t,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(l){return function(h){return function(f){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(i=2&f[0]?n.return:f[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,f[1])).done)return i;switch(n=0,i&&(f=[2&f[0],i.value]),f[0]){case 0:case 1:i=f;break;case 4:return o.label++,{value:f[1],done:!1};case 5:o.label++,n=f[1],f=[0];continue;case 7:f=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(f[0]===6||f[0]===2)){o=0;continue}if(f[0]===3&&(!i||f[1]>i[0]&&f[1]<i[3])){o.label=f[1];break}if(f[0]===6&&o.label<i[1]){o.label=i[1],i=f;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(f);break}i[2]&&o.ops.pop(),o.trys.pop();continue}f=e.call(r,o)}catch(p){f=[6,p],n=0}finally{t=i=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([l,h])}}}function Vn(){return Q1==null&&(Q1=sI().epsilon()),Q1}function ra(){return"channelsLast"}var Mu=function(r){function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return xt(e,r),e}(Error),Ia=function(r){function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return xt(e,r),e}(Error),it=function(r){function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return xt(e,r),e}(Error),pe=function(r){function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return xt(e,r),e}(Error),oH=function(r){function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return xt(e,r),e}(Error);(function(r){function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return xt(e,r),e})(Error);function Zu(r,e){if(Array.isArray(r)){for(var t=[],n=0;n<e;n++)t=t.concat(r);return t}return(t=new Array(e)).fill(r),t}function Ra(r,e){if(!r)throw new oH(e)}function r4(r,e){for(var t=0,n=0,i=r;n<i.length;n++)i[n]===e&&t++;return t}function Vr(r){return r.length===1?r[0]:r}function nn(r){return Array.isArray(r)?r:[r]}function xo(r){var e=r.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function Pu(r){return r.length<=1||r.indexOf("_")===-1?r:r.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}var Pi={};function Jw(r){if(r==null)return null;var e={};return e.className=r.getClassName(),e.config=r.getConfig(),e}function i2(r){if(r!=null&&typeof r=="object")if(Array.isArray(r))r.forEach(function(a){return i2(a)});else for(var e=0,t=Object.keys(r);e<t.length;e++){var n=t[e],i=r[n];i!=null&&typeof i=="object"&&(Array.isArray(i)||i.type!=="ndarray"||typeof i.value!="number"?i2(i):r[n]=i.value)}}function Gd(r,e,t,n,i){var a,o,u;if(e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n="object"),i===void 0&&(i=!1),typeof r=="string"){var l=r,h=void 0;if(l in t)h=t[l];else if(l in Pi)h=Pi[l];else if((h=e[l])==null)throw new it("Unknown "+n+": "+r+`. This may be due to one of the following reasons:
1. The `+n+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+n+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return h}var f=r;if(f.className==null||f.config==null)throw new it(n+": Improper config format: "+JSON.stringify(f)+`.
'className' and 'config' must set.`);var p=f.className,m=void 0,v=void 0;if(p in t?(m=(a=t[p])[0],v=a[1]):p in Pi?(m=(o=Pi.className)[0],v=o[1]):p in e&&(m=(u=e[p])[0],v=u[1]),m==null)throw new it("Unknown "+n+": "+p+`. This may be due to one of the following reasons:
1. The `+n+` is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom `+n+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(v!=null){for(var b={},C=0,w=Object.keys(Pi);C<w.length;C++)b[V=w[C]]=Pi[V];for(var E=0,S=Object.keys(t);E<S.length;E++)b[V=S[E]]=t[V];f.config.customObjects=b;for(var A=Mf({},Pi),k=0,O=Object.keys(t);k<O.length;k++){var V=O[k];Pi[V]=t[V]}i2(f.config);var T=v(m,f.config,t,i);return Pi=Mf({},A),T}A=Mf({},Pi);for(var R=0,N=Object.keys(t);R<N.length;R++)V=N[R],Pi[V]=t[V];return T=new m(f.config),Pi=Mf({},A),T}function sH(r,e){return r<e?-1:r>e?1:0}function Lm(r,e){return-1*sH(r,e)}function ks(r){if(r==null)return r;for(var e=[],t=0,n=r;t<n.length;t++){var i=n[t];e.indexOf(i)===-1&&e.push(i)}return e}function uH(r){if(r==null)throw new it("Invalid value in obj: "+JSON.stringify(r));for(var e in r)if(r.hasOwnProperty(e))return!1;return!0}function lh(r,e,t){if(t!=null&&r.indexOf(t)<0)throw new it(t+" is not a valid "+e+".  Valid values are "+r+" or null/undefined.")}function tC(r,e,t,n){return n===void 0&&(n=1/0),Ra(t>=0),Ra(n>=t),Array.isArray(r)&&r.length>=t&&r.length<=n&&r.every(function(i){return typeof i===e})}function Wr(r,e){Array.isArray(r)?(Ht.assert(r.length>0,function(){return e+" is unexpectedly an empty array."}),r.forEach(function(t,n){return Wr(t,"element "+(n+1)+" of "+e)})):Ht.assert(Number.isInteger(r)&&r>0,function(){return"Expected "+e+" to be a positive integer, but got "+x5(r)+"."})}function x5(r){return r===null?"null":Array.isArray(r)?"["+r.map(function(e){return x5(e)}).join(",")+"]":typeof r=="string"?'"'+r+'"':""+r}function lH(r,e){var t,n=Ht.now();return function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var o=Ht.now();return o-n<e?t:(n=o,t=r.apply(void 0,i))}}function w5(r){return r==="relu"?"relu":r==="linear"?"linear":r==="elu"?"elu":null}function eC(r,e){return ft(function(){return zd(ti(Bv(r,r),e,!0))})}var $d=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.getConfig=function(){return{}},e}(At.Serializable),C5=function(r){function e(t){var n=r.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return xt(e,r),e.prototype.apply=function(t){var n=this;return ft(function(){var i=eC(t,n.axis),a=Ur(i,0,n.maxValue);return ne(t,kr(a,xe(Vn(),i)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e.className="MaxNorm",e}($d);At.registerClass(C5);var E5=function(r){function e(t){var n=r.call(this)||this;return n.defaultAxis=0,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return xt(e,r),e.prototype.apply=function(t){var n=this;return ft(function(){return kr(t,xe(Vn(),eC(t,n.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e.className="UnitNorm",e}($d);At.registerClass(E5);var _5=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t){return Xs(t)},e.className="NonNeg",e}($d);At.registerClass(_5);var T5=function(r){function e(t){var n=r.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=t.minValue!=null?t.minValue:n.defaultMinValue,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.rate=t.rate!=null?t.rate:n.defaultRate,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return xt(e,r),e.prototype.apply=function(t){var n=this;return ft(function(){var i=eC(t,n.axis),a=xe(ne(n.rate,Ur(i,n.minValue,n.maxValue)),ne(1-n.rate,i));return ne(t,kr(a,xe(Vn(),i)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e.className="MinMaxNorm",e}($d);At.registerClass(T5);var i4={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function $e(r){return Jw(r)}function a4(r,e){return e===void 0&&(e={}),Gd(r,At.SerializationMap.getMap().classNameMap,e,"constraint")}function Fn(r){return r==null?null:typeof r=="string"?a4({className:r in i4?i4[r]:r,config:{}}):r instanceof $d?r:a4(r)}function cH(r){return new C5(r)}function hH(r){return new E5(r)}function fH(){return new _5}function dH(r){return new T5(r)}var pH=Object.freeze({maxNorm:cH,unitNorm:hH,nonNeg:fH,minMaxNorm:dH}),mH=["channelsFirst","channelsLast"],gH=["valid","same","causal"],vH=["max","avg"],yH=["sum","mul","concat","ave"],oc=new Map;function jn(r){lh(mH,"DataFormat",r)}function Vi(r){lh(gH,"PaddingMode",r)}function S5(r){lh(vH,"PoolMode",r)}var Hf=[],o4="/";function Hu(r,e){Hf.push(r);try{var t=e();return Hf.pop(),t}catch(n){throw Hf.pop(),n}}function bH(){return Hf.length===0?"":Hf.join(o4)+o4}function A5(r){if(!N5(r))throw new Error("Not a valid tensor name: '"+r+"'");return bH()+r}function R5(r){if(!N5(r))throw new Error("Not a valid tensor name: '"+r+"'");oc.has(r)||oc.set(r,0);var e=oc.get(r);if(oc.set(r,oc.get(r)+1),e>0){var t=r+"_"+e;return oc.set(t,1),t}return r}var xH=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function N5(r){return!!r.match(xH)}function wH(r){return r===parseInt(r.toString(),10)}function Ds(r,e,t){e==null&&(e=0),t==null&&(t=r.length);for(var n=1,i=e;i<t;++i)n*=r[i];return n}function I5(r){return r=Array.isArray(r)?new Float32Array(r):r,Jr(r)}function Vc(r){return Qv(I5(r)).dataSync()[0]}function Us(r){return js(I5(r)).dataSync()[0]}function ia(r,e){if(e<r)throw new it("end ("+e+") < begin ("+r+") is forbidden.");for(var t=[],n=r;n<e;++n)t.push(n);return t}function Kd(r,e){return r.asType(e)}function Xd(r,e){e===void 0&&(e=-1);var t=r.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),r.reshape(t)}function CH(r,e){return ft(function(){if(r.shape.length!==2)throw new it("repeat() expects a rank-2 tensor, but received a rank-"+r.shape.length+" tensor.");return a2(Xd(r,1),[1,e,1])})}function EH(r){var e=[Ds(r.shape)];return r.reshape(e)}function _H(r){if(r.rank<=1)throw new it("batchFlatten requires a minimum rank of 2. Got rank: "+r.rank+".");var e=[r.shape[0],Ds(r.shape,1)];return r.reshape(e)}function qu(r,e,t){return ft(function(){switch(r.rank){case 1:return Bd(r,e,t);case 2:return Xv(r,[e,0],[t,r.shape[1]]);case 3:return jd(r,[e,0,0],[t,r.shape[1],r.shape[2]]);case 4:return Lc(r,[e,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3]]);case 5:return bi(r,[e,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4]]);case 6:return bi(r,[e,0,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4],r.shape[5]]);default:throw new it("sliceAlongFirstAxis() received an unsupported tensor rank: "+r.rank)}})}function Z1(r,e,t){return ft(function(){switch(r.rank){case 1:return Bd(r,e,t);case 2:return Xv(r,[0,e],[r.shape[0],t]);case 3:return jd(r,[0,0,e],[r.shape[0],r.shape[1],t]);case 4:return Lc(r,[0,0,0,e],[r.shape[0],r.shape[1],r.shape[2],t]);default:throw new it("sliceAlongLastAxis() received an unsupported tensor rank: "+r.rank)}})}function Pm(r,e,t,n){return ft(function(){switch(r.rank){case 1:return Bd(r,e,t);case 2:switch(n){case 1:return qu(r,e,t);case 2:return Z1(r,e,t);default:throw new it("The axis is not within the rank of the tensor "+n)}case 3:switch(n){case 1:return qu(r,e,t);case 2:return jd(r,[0,e,0],[r.shape[0],t,r.shape[2]]);case 3:return Z1(r,e,t);default:throw new it("The axis is not within the rank of the tensor "+n)}case 4:switch(n){case 1:return qu(r,e,t);case 2:return Lc(r,[0,e,0,0],[r.shape[0],t,r.shape[2],r.shape[3]]);case 3:return Lc(r,[0,0,e,0],[r.shape[0],r.shape[1],t,r.shape[3]]);case 4:return Z1(r,e,t);default:throw new it("The axis is not within the rank of the tensor "+n)}default:throw new it("sliceAlongLastAxis() received an unsupported tensor rank: "+r.rank)}})}function k5(r,e){var t;return e===void 0&&(e=-1),e<0&&(e=(t=r[0].rank)!==0?t:0),e===r[0].rank&&(e=-1),Ir(r,e)}function s4(r,e){switch(r.rank){case 1:return Nx([r,e]);case 2:return Ix([r,e],0);case 3:return kx([r,e],0);case 4:return Dx([r,e],0);default:throw new it("concatAlongFirstAxis() received an unsupported tensor rank: "+r.rank)}}function a2(r,e){if(Array.isArray(e)||(e=[e]),r.rank!==e.length)throw new it("The length of input n ("+e.length+") does not match the number of dimensions in input x ("+r.rank+")");return Ns(r,e)}function sy(r,e,t,n,i){return e===void 0&&(e=0),t===void 0&&(t=1),Px(r,e,t,n,i)}function So(r,e,t,n){if(r.rank<2||e.rank<2)throw new pe("dot requires both inputs to be rank >= 2 but got x shape = "+r.shape+" and y shape = "+e.shape);if(e.rank>=3&&r.shape.slice(-1)[0]!==(f=e.shape.slice(-2)[0]))throw new pe("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+r.shape+" and  y shape = "+e.shape);if(r.rank===2&&e.rank===2){var i=!1,a=!1;return zc.matMul({a:r,b:e,transposeA:i,transposeB:a,bias:n?o2(r.rank,n,ra()):null,activation:t})}var o=r.shape.slice(),u=o.pop();r=r.reshape([-1,u]);var l=e.shape.slice(),h=l.pop(),f=l.pop(),p=l.concat([h]),m=Array.from({length:e.rank},function(b,C){return C===0?e.rank-2:C<=e.rank-2?C-1:C});e=e.transpose(m).reshape([f,-1]);var v=o.concat(p);return i=!1,a=!1,zc.matMul({a:r,b:e,transposeA:i,transposeB:a,bias:n?o2(r.rank,n,ra()):null,activation:t}).reshape(v)}function D5(r,e,t){return ft(function(){return e=Array.isArray(e)?Jr(e,"int32"):e.toInt(),oh(r,e,t)})}function Yd(r){return Bv(r,r)}function o2(r,e,t){var n=e.shape;if(e.rank!==1&&e.rank!==r)throw new it("Unexpected bias dimensions: "+e.rank+"; expected it to be 1 or "+r);if(r===5){if(t==="channelsFirst")return n.length===1?e.reshape([1,n[0],1,1,1]):e.reshape([1,n[3],n[0],n[1],n[2]]);if(t==="channelsLast")return n.length===1?e.reshape([1,1,1,1,n[0]]):e.reshape([1].concat(n))}else if(r===4){if(t==="channelsFirst")return n.length===1?e.reshape([1,n[0],1,1]):e.reshape([1,n[2],n[0],n[1]]);if(t==="channelsLast")return n.length===1?e.reshape([1,1,1,n[0]]):e.reshape([1].concat(n))}else if(r===3){if(t==="channelsFirst")return n.length===1?e.reshape([1,n[0],1]):e.reshape([1,n[1],n[0]]);if(t==="channelsLast")return n.length===1?e.reshape([1,1,n[0]]):e.reshape([1].concat(n))}else if(r<3)return e;throw new it("Unsupported input rank by biasAdd: "+e.rank)}function jo(r,e,t){return ft(function(){return t==null&&(t=ra()),jn(t),r.add(o2(r.rank,e,t))})}function TH(r,e){if(e===void 0&&(e=1),e!==1)throw new pe("Support for alpha values other than 1 ("+e+") is not implemented yet.");return uh(r)}function SH(r){return ft(function(){return kr(r,Bs(r).add(1))})}function O5(r,e,t,n){return ft(function(){return Vw(r,e,t,n)})}function AH(r){return ft(function(){var e=xe(.5,ne(.2,r));return Ur(e,0,1)})}function Fc(r,e,t){return t===void 0&&(t=!1),t?r():e()}var RH=["fanIn","fanOut","fanAvg"],NH=["normal","uniform","truncatedNormal"];function IH(r){lh(RH,"FanMode",r)}function kH(r){lh(NH,"Distribution",r)}var la=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(At.Serializable),M5=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t,n){return Ue(t,n)},e.className="Zeros",e}(la);At.registerClass(M5);var nC=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t,n){return Wa(t,n)},e.className="Ones",e}(la);At.registerClass(nC);var L5=function(r){function e(t){var n=r.call(this)||this;if(typeof t!="object")throw new it("Expected argument of type ConstantConfig but got "+t);if(t.value===void 0)throw new it("config must have value set but got "+t);return n.value=t.value,n}return xt(e,r),e.prototype.apply=function(t,n){var i=this;return ft(function(){return ne(zt(i.value),Wa(t,n))})},e.prototype.getConfig=function(){return{value:this.value}},e.className="Constant",e}(la);At.registerClass(L5);var P5=function(r){function e(t){var n=r.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return xt(e,r),e.prototype.apply=function(t,n){return sl(t,this.minval,this.maxval,n)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e.className="RandomUniform",e}(la);At.registerClass(P5);var z5=function(r){function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return xt(e,r),e.prototype.apply=function(t,n){if((n=n||"float32")!=="float32"&&n!=="int32")throw new pe("randomNormal does not support dType "+n+".");return sy(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="RandomNormal",e}(la);At.registerClass(z5);var V5=function(r){function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return xt(e,r),e.prototype.apply=function(t,n){if((n=n||"float32")!=="float32"&&n!=="int32")throw new pe("truncatedNormal does not support dType "+n+".");return Md(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="TruncatedNormal",e}(la);At.registerClass(V5);var F5=function(r){function e(t){var n=r.call(this)||this;return n.gain=t.gain!=null?t.gain:1,n}return xt(e,r),e.prototype.apply=function(t,n){var i=this;return ft(function(){if(t.length!==2||t[0]!==t[1])throw new it("Identity matrix initializer can only be used for 2D square matrices.");return ne(i.gain,Sv(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e.className="Identity",e}(la);function DH(r,e){var t,n;if(e===void 0&&(e="channelsLast"),jn(e),r.length===2)t=r[0],n=r[1];else if([3,4,5].indexOf(r.length)!==-1)if(e==="channelsFirst"){var i=Ds(r,2);t=r[1]*i,n=r[0]*i}else e==="channelsLast"&&(i=Ds(r,0,r.length-2),t=r[r.length-2]*i,n=r[r.length-1]*i);else{var a=Ds(r);t=Math.sqrt(a),n=Math.sqrt(a)}return[t,n]}At.registerClass(F5);var ei=function(r){function e(t){var n=r.call(this)||this;if(t.scale<0)throw new it("scale must be a positive float. Got: "+t.scale);return n.scale=t.scale==null?1:t.scale,n.mode=t.mode==null?"fanIn":t.mode,IH(n.mode),n.distribution=t.distribution==null?"normal":t.distribution,kH(n.distribution),n.seed=t.seed,n}return xt(e,r),e.prototype.apply=function(t,n){var i=DH(t),a=i[0],o=i[1],u=this.scale;if(this.mode==="fanIn"?u/=Math.max(1,a):this.mode==="fanOut"?u/=Math.max(1,o):u/=Math.max(1,(a+o)/2),this.distribution==="normal"){var l=Math.sqrt(u);if((n=n||"float32")!=="float32"&&n!=="int32")throw new pe(this.getClassName()+" does not support dType "+n+".");return Md(t,0,l,n,this.seed)}var h=Math.sqrt(3*u);return sl(t,-h,h,n)},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e.className="VarianceScaling",e}(la);At.registerClass(ei);var rC=function(r){function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})||this}return xt(e,r),e.prototype.getClassName=function(){return ei.className},e.className="GlorotUniform",e}(ei);At.registerClass(rC);var iC=function(r){function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})||this}return xt(e,r),e.prototype.getClassName=function(){return ei.className},e.className="GlorotNormal",e}(ei);At.registerClass(iC);var aC=function(r){function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return xt(e,r),e.prototype.getClassName=function(){return ei.className},e.className="HeNormal",e}(ei);At.registerClass(aC);var oC=function(r){function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return xt(e,r),e.prototype.getClassName=function(){return ei.className},e.className="HeUniform",e}(ei);At.registerClass(oC);var sC=function(r){function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return xt(e,r),e.prototype.getClassName=function(){return ei.className},e.className="LeCunNormal",e}(ei);At.registerClass(sC);var uC=function(r){function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return xt(e,r),e.prototype.getClassName=function(){return ei.className},e.className="LeCunNormal",e}(ei);At.registerClass(uC);var B5=function(r){function e(t){var n=r.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=t.gain==null?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,n.seed!=null)throw new pe("Random seed is not implemented for Orthogonal Initializer yet.");return n}return xt(e,r),e.prototype.apply=function(t,n){var i=this;return ft(function(){if(t.length!==2)throw new pe("The Orthogonal Initializer does not support non-2D shapes yet.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+t[0]*t[1]+") elements: Slowness may result.");var a=sy(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32"),o=jw.gramSchmidt(a);return t[0]>t[1]&&(o=o.transpose()),ne(i.gain,o)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e.className="Orthogonal",e}(la);At.registerClass(B5);var u4={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function l4(r,e){return e===void 0&&(e={}),Gd(r,At.SerializationMap.getMap().classNameMap,e,"initializer")}function Pe(r){return Jw(r)}function on(r){if(typeof r=="string"){var e=r in u4?u4[r]:r;if(e==="GlorotNormal")return new iC;if(e==="GlorotUniform")return new rC;if(e==="HeNormal")return new aC;if(e==="HeUniform")return new oC;if(e==="LeCunNormal")return new sC;if(e==="LeCunUniform")return new uC;var t={};return t.className=e,t.config={},l4(t)}return r instanceof la?r:l4(r)}function OH(){return new M5}function MH(){return new nC}function LH(r){return new L5(r)}function PH(r){return new P5(r)}function zH(r){return new z5(r)}function VH(r){return new V5(r)}function FH(r){return new F5(r)}function BH(r){return new ei(r)}function jH(r){return new rC(r)}function UH(r){return new iC(r)}function WH(r){return new aC(r)}function HH(r){return new oC(r)}function qH(r){return new sC(r)}function GH(r){return new uC(r)}function $H(r){return new B5(r)}var KH=Object.freeze({zeros:OH,ones:MH,constant:LH,randomUniform:PH,randomNormal:zH,truncatedNormal:VH,identity:FH,varianceScaling:BH,glorotUniform:jH,glorotNormal:UH,heNormal:WH,heUniform:HH,leCunNormal:qH,leCunUniform:GH,orthogonal:$H}),XH=0;function j5(){return XH++}var zm={};function uy(r){return r===void 0&&(r=""),r in zm||(zm[r]=0),zm[r]+=1,r+zm[r].toString()}function s2(r){return Array.isArray(r)&&Array.isArray(r[0])}function Vg(r){return r.length===0?[]:Array.isArray(r[0])?r:[r]}function ue(r){var e;if(Array.isArray(r)){if(r.length!==1)throw new it("Expected Tensor length to be 1; got "+r.length);e=r[0]}else e=r;return e}function tn(r){if(Array.isArray(r)&&Array.isArray(r[0])){if(r.length===1)return(r=r)[0];throw new it("Expected exactly 1 Shape; got "+r.length)}return r}function Fg(r){for(var e=0,t=0,n=r;t<n.length;t++){var i=n[t];i.shape.length===0?e+=1:e+=i.shape.reduce(function(a,o){return a*o})}return e}var c4="Variable",U5=function(){function r(e,t,n,i,a){t===void 0&&(t="float32"),n===void 0&&(n=c4),i===void 0&&(i=!0),a===void 0&&(a=null),this.dtype=t??"float32",this.shape=e.shape,this.id=j5(),n=n??c4,this.originalName=A5(n),this.name=R5(this.originalName),this.trainable_=i,this.constraint=a,this.val=Ax(e,this.trainable_,this.name,this.dtype)}return r.prototype.read=function(){return this.assertNotDisposed(),this.val},r.prototype.write=function(e){return this.assertNotDisposed(),YH(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},r.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},r.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(r.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!0,configurable:!0}),r}();function YH(r,e){if(r.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(r.shape)+" vs. "+JSON.stringify(e.shape))}function u2(r){return r.map(function(e){return e.read()})}function lC(r){r.forEach(function(e){e[0].write(e[1])})}var ar=function(){return function(r){this.dtype=r.dtype,this.shape=r.shape,r.shape!=null?this.ndim=r.shape.length:this.ndim=r.ndim,this.maxNDim=r.maxNDim,this.minNDim=r.minNDim,this.axes=r.axes||{}}}(),Ji=function(){return function(r,e,t,n,i,a,o){this.dtype=r,this.shape=e,this.sourceLayer=t,this.inputs=n,this.callArgs=i,this.outputTensorIndex=o,this.id=j5(),a!=null&&(this.originalName=A5(a),this.name=R5(this.originalName)),this.rank=e.length}}(),QH=0,ly=function(){function r(e,t){this.callArgs=t,this.id=QH++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(var n=0,i=e.inboundLayers;n<i.length;n++){var a=i[n];a!=null&&a.outboundNodes.push(this)}e.outboundLayer.inboundNodes.push(this)}return r.prototype.getConfig=function(){for(var e=[],t=0,n=this.inboundLayers;t<n.length;t++){var i=n[t];i!=null?e.push(i.name):e.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},r}(),ZH=0,Se=function(r){function e(t){var n=r.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=ZH++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var i=t.name;if(!i){var a=n.getClassName();i=xo(a)+"_"+uy(a)}if(n.name=i,n.trainable_=t.trainable==null||t.trainable,t.inputShape!=null||t.batchInputShape!=null){var o=void 0;if(t.batchInputShape!=null)o=t.batchInputShape;else if(t.inputShape!=null){var u=null;t.batchSize!=null&&(u=t.batchSize),o=[u].concat(t.inputShape)}n.batchInputShape=o;var l=t.dtype;l==null&&(l=t.inputDType),l==null&&(l="float32"),n.dtype=l}return t.weights!=null?n.initialWeights=t.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return xt(e,r),e.nodeKey=function(t,n){return t.name+"_ib-"+n.toString()},e.prototype.getNodeAtIndex=function(t,n){if(this.inboundNodes.length===0)throw new Ia("The layer has never been called and thus has no defined "+n+".");if(this.inboundNodes.length<=t)throw new it("Asked to get "+n+" at node "+t+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return Vr(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return Vr(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new Mu("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new Mu("Layer "+this.name+" is not connected, no input to return.");return Vr(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new Mu("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new Mu("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return Vr(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(n){return n.trainable=t}),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){if(t=nn(t),this.inputSpec!=null&&this.inputSpec.length!==0){var n=nn(this.inputSpec);if(t.length!==n.length)throw new it("Layer "+this.name+" expects "+n.length+" inputs, but it received "+t.length+" input tensors. Input received: "+t);for(var i=0;i<t.length;i++){var a=t[i],o=n[i];if(o!=null){var u=a.rank;if(o.ndim!=null&&u!==o.ndim)throw new it("Input "+i+" is incompatible with layer "+this.name+": expected ndim="+o.ndim+", found ndim="+u);if(o.maxNDim!=null&&u>o.maxNDim)throw new it("Input "+i+" is incompatible with layer "+this.name+": expected max_ndim="+o.maxNDim+", found ndim="+u);if(o.minNDim!=null&&u<o.minNDim)throw new it("Input "+i+" is incompatible with layer "+this.name+": expected min_ndim="+o.minNDim+", found ndim="+u+".");if(o.dtype!=null&&a.dtype!==o.dtype)throw new it("Input "+i+" is incompatible with layer "+this.name+" : expected dtype="+o.dtype+", found dtype="+a.dtype+".");if(o.axes){var l=a.shape;for(var h in o.axes){var f=Number(h),p=o.axes[h],m=f>=0?l[f]:l[l.length+f];if(p!=null&&[p,null].indexOf(m)===-1)throw new it("Input "+i+" is incompatible with layer "+this.name+": expected axis "+f+" of input shape to have value "+p+" but got shape "+l+".")}}if(o.shape!=null)for(var v=0;v<o.shape.length;++v){var b=o.shape[v],C=a.shape[v];if(b!=null&&C!=null&&b!==C)throw new it("Input "+i+" is incompatible with layer "+this.name+": expected shape="+o.shape+", found shape="+a.shape+".")}}}}},e.prototype.call=function(t,n){return t},e.prototype.invokeCallHook=function(t,n){this._callHook!=null&&this._callHook(t,n)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,n){var i=this;n=n||{},this.assertNotDisposed();for(var a=nn(t),o=!0,u=0,l=a;u<l.length;u++)if(!(l[u]instanceof Ji)){o=!1;break}for(var h=!0,f=0,p=a;f<p.length;f++)if(p[f]instanceof Ji){h=!1;break}if(o===h)throw new it("Arguments to apply() must be all SymbolicTensors or all Tensors");return Hu(this.name,function(){if(!i.built){i.assertInputCompatibility(t);for(var m=[],v=0,b=nn(t);v<b.length;v++){var C=b[v];m.push(C.shape)}i.build(Vr(m)),i.built=!0,i.initialWeights&&i.setWeights(i.initialWeights),i._refCount===null&&h&&(i._refCount=1)}if(i.assertInputCompatibility(t),h){for(var w=[],E=0,S=nn(V=i.call(t,n));E<S.length;E++){var A=S[E];a.indexOf(A)!==-1&&(A=A.clone()),w.push(A)}if(V=Vr(w),i.activityRegularizer!=null)throw new pe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return V}var k=JH(t),O=i.computeOutputShape(k),V=void 0,T=tq(t);if(i.warnOnIncompatibleInputShape(Array.isArray(t)?k[0]:k),V=O!=null&&O.length>0&&Array.isArray(O[0])?O.map(function(R,N){return new Ji(T,R,i,nn(t),n,i.name,N)}):new Ji(T,O,i,nn(t),n,i.name),i.addInboundNode(t,V,null,null,k,O,n),i._refCount++,i.activityRegularizer!=null)throw new pe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return V})},e.prototype.warnOnIncompatibleInputShape=function(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(t)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var n=!1;this.batchInputShape.forEach(function(i,a){i!=null&&t[a]!=null&&t[a]!==i&&(n=!0)}),n&&console.warn("The shape of the input tensor ("+JSON.stringify(t)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Mu("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var t=[],n=0,i=this.inboundNodes;n<i.length;n++){var a=i[n],o=JSON.stringify(a.outputShapes);t.indexOf(o)===-1&&t.push(o)}if(t.length===1){var u=this.inboundNodes[0].outputShapes;return Array.isArray(u)&&Array.isArray(u[0])&&u.length===1?u[0]:u}throw new Mu("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new Ia("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return Fg(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return t===void 0&&(t=!1),u2(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var n=this;ft(function(){var i=n.weights;if(i.length!==t.length)throw new it('You called setWeights(weights) on layer "'+n.name+'" with a weight list of length '+t.length+", but the layer was expecting "+i.length+" weights. Provided weights: "+t+"...");if(i.length!==0){for(var a=[],o=u2(i),u=0;u<o.length;++u){var l=o[u],h=i[u],f=t[u];if(!Ht.arraysEqual(l.shape,f.shape))throw new it("Layer weight shape "+l.shape+" not compatible with provided weight shape "+f.shape);a.push([h,f])}lC(a)}})},e.prototype.addWeight=function(t,n,i,a,o,u,l){if(this._addedWeightNames.indexOf(t)!==-1)throw new it("Duplicate weight name "+t+" for layer "+this.name);this._addedWeightNames.push(t),i==null&&(i="float32"),this.fastWeightInitDuringBuild&&(a=on("zeros"));var h=a.apply(n,i),f=new U5(h,i,t,u,l);return h.dispose(),o!=null&&this.addLoss(function(){return o.apply(f.read())}),u==null&&(u=!0),u?this._trainableWeights.push(f):this._nonTrainableWeights.push(f),f},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var n;t==null||Array.isArray(t)&&t.length===0||(t=nn(t),this._losses!==void 0&&this._losses!==null&&(n=this.losses).push.apply(n,t))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,n){var i=this;if(!this.supportsMasking){if(n!=null){if(!Array.isArray(n))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");n.forEach(function(a){if(a!=null)throw new TypeError("Layer "+i.name+" does not support masking, but was passed an inputMask.")})}return null}return n},e.prototype.addInboundNode=function(t,n,i,a,o,u,l){l===void 0&&(l=null);var h=nn(t);n=nn(n),i=nn(i),a=nn(a),o=Vg(o),u=Vg(u);for(var f=[],p=[],m=[],v=0,b=h;v<b.length;v++){var C=b[v];f.push(C.sourceLayer),p.push(C.nodeIndex),m.push(C.tensorIndex)}new ly({outboundLayer:this,inboundLayers:f,nodeIndices:p,tensorIndices:m,inputTensors:h,outputTensors:n,inputMasks:i,outputMasks:a,inputShapes:o,outputShapes:u},l);for(var w=0;w<n.length;w++)n[w].sourceLayer=this,n[w].nodeIndex=this.inboundNodes.length-1,n[w].tensorIndex=w},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var t=0;return--this._refCount==0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(At.Serializable);function JH(r){for(var e=[],t=0,n=r=nn(r);t<n.length;t++){var i=n[t];e.push(i.shape)}return Vr(e)}function tq(r){return"float32"}function W5(r,e,t){if((e==null||t!=null&&t>0)&&(e=r.sourceLayer,t=r.nodeIndex),e.inboundNodes.length===0)return[r];var n=e.inboundNodes[t];if(n.inboundLayers.length===0)return n.inputTensors;for(var i=[],a=0;a<n.inboundLayers.length;a++)for(var o=0,u=W5(n.inputTensors[a],n.inboundLayers[a],n.nodeIndices[a]);o<u.length;o++){var l=u[o];i.indexOf(l)===-1&&i.push(l)}return i}var h4,Qd=function(r){function e(t){var n=r.call(this,{dtype:t.dtype,name:t.name!=null?t.name:uy("input").toString()})||this;if(t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new it("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var i=t.batchInputShape;if(i==null){if(t.inputShape==null)throw new it("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");i=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new it("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var a=t.dtype||"float32";n.batchInputShape=i,n.dtype=a,n.inputSpec=[{shape:i}];var o=new Ji(n.dtype,n.batchInputShape,n,[],{},n.name);return o.nodeIndex=0,o.tensorIndex=0,new ly({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[i],outputShapes:[i]}),n}return xt(e,r),e.prototype.apply=function(t,n){throw new it("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e.className="InputLayer",e}(Se);function H5(r){if(r.batchShape==null&&r.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(r.batchShape!=null&&r.shape!=null)throw new it("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=r.batchShape;r.shape!=null&&e==null&&(e=[null].concat(r.shape));var t=r.dtype;return t==null&&(t="float32"),new Qd({batchInputShape:e,name:r.name,dtype:t,sparse:r.sparse}).inboundNodes[0].outputTensors[0]}function gs(r){return ee(this,void 0,void 0,function(){var e,t,n,i,a,o,u,l;return Kt(this,function(h){switch(h.label){case 0:if(r==null)return[2];for(i in e=[],t=[],n=[],r)typeof(a=r[i])!="number"&&(o=a,e.push(o.data()),t.push(i),n.push(o));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(u=h.sent(),l=0;l<u.length;++l)r[t[l]]=u[l][0];de(n),h.label=2;case 2:return[2]}})})}function q5(r){if(r!=null)for(var e in r){var t=r[e];typeof t!="number"&&t.dispose()}}At.registerClass(Qd),function(r){r[r.SILENT=0]="SILENT",r[r.VERBOSE=1]="VERBOSE"}(h4||(h4={}));var eq=125,Bc=function(){function r(){this.validationData=null}return r.prototype.setParams=function(e){this.params=e},r.prototype.onEpochBegin=function(e,t){return ee(this,void 0,void 0,function(){return Kt(this,function(n){return[2]})})},r.prototype.onEpochEnd=function(e,t){return ee(this,void 0,void 0,function(){return Kt(this,function(n){return[2]})})},r.prototype.onBatchBegin=function(e,t){return ee(this,void 0,void 0,function(){return Kt(this,function(n){return[2]})})},r.prototype.onBatchEnd=function(e,t){return ee(this,void 0,void 0,function(){return Kt(this,function(n){return[2]})})},r.prototype.onTrainBegin=function(e){return ee(this,void 0,void 0,function(){return Kt(this,function(t){return[2]})})},r.prototype.onTrainEnd=function(e){return ee(this,void 0,void 0,function(){return Kt(this,function(t){return[2]})})},r.prototype.setModel=function(e){},r}(),G5=function(){function r(e,t){t===void 0&&(t=10),e==null&&(e=[]),this.callbacks=e,this.queueLength=t}return r.prototype.append=function(e){this.callbacks.push(e)},r.prototype.setParams=function(e){for(var t=0,n=this.callbacks;t<n.length;t++)n[t].setParams(e)},r.prototype.setModel=function(e){for(var t=0,n=this.callbacks;t<n.length;t++)n[t].setModel(e)},r.prototype.onEpochBegin=function(e,t){return ee(this,void 0,void 0,function(){var n,i;return Kt(this,function(a){switch(a.label){case 0:t==null&&(t={}),n=0,i=this.callbacks,a.label=1;case 1:return n<i.length?[4,i[n].onEpochBegin(e,t)]:[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.onEpochEnd=function(e,t){return ee(this,void 0,void 0,function(){var n,i;return Kt(this,function(a){switch(a.label){case 0:t==null&&(t={}),n=0,i=this.callbacks,a.label=1;case 1:return n<i.length?[4,i[n].onEpochEnd(e,t)]:[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.onBatchBegin=function(e,t){return ee(this,void 0,void 0,function(){var n,i;return Kt(this,function(a){switch(a.label){case 0:t==null&&(t={}),n=0,i=this.callbacks,a.label=1;case 1:return n<i.length?[4,i[n].onBatchBegin(e,t)]:[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.onBatchEnd=function(e,t){return ee(this,void 0,void 0,function(){var n,i;return Kt(this,function(a){switch(a.label){case 0:t==null&&(t={}),n=0,i=this.callbacks,a.label=1;case 1:return n<i.length?[4,i[n].onBatchEnd(e,t)]:[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.onTrainBegin=function(e){return ee(this,void 0,void 0,function(){var t,n;return Kt(this,function(i){switch(i.label){case 0:e==null&&(e={}),t=0,n=this.callbacks,i.label=1;case 1:return t<n.length?[4,n[t].onTrainBegin(e)]:[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},r.prototype.onTrainEnd=function(e){return ee(this,void 0,void 0,function(){var t,n;return Kt(this,function(i){switch(i.label){case 0:e==null&&(e={}),t=0,n=this.callbacks,i.label=1;case 1:return t<n.length?[4,n[t].onTrainEnd(e)]:[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},r}(),nq=function(r){function e(){return r.call(this)||this}return xt(e,r),e.prototype.onEpochBegin=function(t){return ee(this,void 0,void 0,function(){return Kt(this,function(n){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,n){return ee(this,void 0,void 0,function(){var i,a,o,u,l=this;return Kt(this,function(h){for(u in n==null&&(n={}),i=n.size==null?0:n.size,this.seen+=i,a=function(f){var p=n[f];if(typeof p=="number")o.totals.hasOwnProperty(f)||(o.totals[f]=0),o.totals[f]=o.totals[f]+p*i;else{var m=void 0;f in o.totals?m=o.totals[f]:o.totals[f]=0;var v=ft(function(){return xe(l.totals[f],ne(p,i))});o.totals[f]=v,m!=null&&m.dispose()}},o=this,n)a(u);return[2]})})},e.prototype.onEpochEnd=function(t,n){return ee(this,void 0,void 0,function(){var i,a,o,u,l,h=this;return Kt(this,function(f){if(n!=null)for(i=function(p){if(a.totals[p]==null)return"continue";typeof a.totals[p]=="number"?n[p]=a.totals[p]/a.seen:ft(function(){var m=ne(kr(1,h.seen),h.totals[p]);n[p]=m,h.totals[p].dispose(),za(n[p])})},a=this,o=0,u=this.params.metrics;o<u.length;o++)l=u[o],i(l);return[2]})})},e}(Bc),$5=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.onTrainBegin=function(t){return ee(this,void 0,void 0,function(){return Kt(this,function(n){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,n){return ee(this,void 0,void 0,function(){var i;return Kt(this,function(a){for(i in n==null&&(n={}),this.epoch.push(t),n)this.history[i]==null&&(this.history[i]=[]),this.history[i].push(n[i]);return[2]})})},e.prototype.syncData=function(){return ee(this,void 0,void 0,function(){var t,n,i,a,o,u,l,h,f;return Kt(this,function(p){switch(p.label){case 0:for(a in t=[],n=[],i=[],this.history)for(o=this.history[a],u=0;u<o.length;++u)typeof o[u]!="number"&&(l=o[u],t.push(l.data()),n.push(a),i.push(u));return[4,Promise.all(t)];case 1:for(h=p.sent(),f=0;f<h.length;++f)this.history[n[f]][i[f]].dispose(),this.history[n[f]][i[f]]=h[f][0];return[2]}})})},e}(Bc),K5=function(r){function e(t,n){var i=r.call(this)||this;if(i.currentEpoch=0,i.yieldEvery=n||"auto",i.yieldEvery==="auto"&&(i.yieldEvery=eq),i.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return Ht.isNumber(i.yieldEvery)&&(i.maybeWait=lH(i.maybeWait.bind(i),i.yieldEvery)),i.trainBegin=t.onTrainBegin,i.trainEnd=t.onTrainEnd,i.epochBegin=t.onEpochBegin,i.epochEnd=t.onEpochEnd,i.batchBegin=t.onBatchBegin,i.batchEnd=t.onBatchEnd,i.yield=t.onYield,i}return xt(e,r),e.prototype.maybeWait=function(t,n,i){return ee(this,void 0,void 0,function(){var a;return Kt(this,function(o){switch(o.label){case 0:return a=[],this.yield==null?[3,2]:[4,gs(i)];case 1:o.sent(),a.push(this.yield(t,n,i)),o.label=2;case 2:return a.push(ig()),[4,Promise.all(a)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,n){return ee(this,void 0,void 0,function(){return Kt(this,function(i){switch(i.label){case 0:return this.currentEpoch=t,this.epochBegin==null?[3,3]:[4,gs(n)];case 1:return i.sent(),[4,this.epochBegin(t,n)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,n){return ee(this,void 0,void 0,function(){var i;return Kt(this,function(a){switch(a.label){case 0:return i=[],this.epochEnd==null?[3,2]:[4,gs(n)];case 1:a.sent(),i.push(this.epochEnd(t,n)),a.label=2;case 2:return this.yieldEvery==="epoch"&&i.push(ig()),[4,Promise.all(i)];case 3:return a.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,n){return ee(this,void 0,void 0,function(){return Kt(this,function(i){switch(i.label){case 0:return this.batchBegin==null?[3,3]:[4,gs(n)];case 1:return i.sent(),[4,this.batchBegin(t,n)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,n){return ee(this,void 0,void 0,function(){var i;return Kt(this,function(a){switch(a.label){case 0:return i=[],this.batchEnd==null?[3,2]:[4,gs(n)];case 1:a.sent(),i.push(this.batchEnd(t,n)),a.label=2;case 2:return this.yieldEvery==="batch"?i.push(ig()):Ht.isNumber(this.yieldEvery)&&i.push(this.maybeWait(this.currentEpoch,t,n)),[4,Promise.all(i)];case 3:return a.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return ee(this,void 0,void 0,function(){return Kt(this,function(n){switch(n.label){case 0:return this.trainBegin==null?[3,3]:[4,gs(t)];case 1:return n.sent(),[4,this.trainBegin(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return ee(this,void 0,void 0,function(){return Kt(this,function(n){switch(n.label){case 0:return this.trainEnd==null?[3,3]:[4,gs(t)];case 1:return n.sent(),[4,this.trainEnd(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e}(Bc);function X5(r,e){return r==null&&(r={}),r instanceof Bc?[r]:Array.isArray(r)&&r[0]instanceof Bc?r:nn(r).map(function(t){return new K5(t,e)})}var Y5=function(){function r(){}return r.registerCallbackConstructor=function(e,t){Ht.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, but got "+e}),r.checkForDuplicate(t),r.constructors[e]==null&&(r.constructors[e]=[]),r.constructors[e].push(t)},r.checkForDuplicate=function(e){for(var t in r.constructors)r.constructors[+t].forEach(function(n){if(n===e)throw new it("Duplicate callback constructor.")})},r.clear=function(){r.constructors={}},r.createCallbacks=function(e){var t=[];for(var n in r.constructors){var i=+n;e>=i&&t.push.apply(t,r.constructors[i])}return t.map(function(a){return new a})},r.constructors={},r}();function Q5(r,e,t,n,i,a,o,u,l){var h=new $5,f=[new nq].concat(Y5.createCallbacks(e));r!=null&&f.push.apply(f,r),f.push(h);var p=new G5(f);return p.setParams({epochs:t,initialEpoch:n,samples:i,steps:a,batchSize:o,verbose:e,doValidation:u,metrics:l}),{callbackList:p,history:h}}function ta(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=!1),Gd(r,At.SerializationMap.getMap().classNameMap,e,"layer",t)}function Bg(r,e){return ft(function(){r.dtype!=="float32"&&(r=r.asType("float32"));var t=ti(Yd(r),e,!0),n=nh(t.shape,Vn()),i=zd(Ha(t,n));return kr(r,i)})}function fl(r,e){return ft(function(){return Nn(Yd(sr(e,r)),-1)})}function cy(r,e){return ft(function(){return Nn(Bs(sr(e,r)),-1)})}function ch(r,e){return ft(function(){var t=sr(r,e),n=Ur(Bs(r),Vn(),Number.MAX_VALUE),i=Bs(kr(t,n));return ne(100,Nn(i,-1))})}function rq(r,e){return ft(function(){var t=Ur(e,Vn(),Number.MAX_VALUE),n=Oo(xe(1,t)),i=Ur(r,Vn(),Number.MAX_VALUE),a=Oo(xe(1,i));return Nn(Yd(sr(n,a)),-1)})}function iq(r,e){return ft(function(){var t=Ha(0,sr(1,ne(r,e)));return Nn(Yd(t),-1)})}function aq(r,e){return ft(function(){var t=Ha(0,sr(1,ne(r,e)));return Nn(t,-1)})}function oq(r,e){return ft(function(){var t=ti(ne(r,e),-1),n=js(ne(sr(1,r),e),-1);return Ha(0,xe(1,sr(n,t)))})}function sq(r,e){return ft(function(){var t=Math.log(2),n=sr(e,r),i=sr(xe(n,Pd(ne(-2,n))),t);return Nn(i,-1)})}function gd(r,e,t){return t===void 0&&(t=!1),ft(function(){if(t)e=ul(e);else{var n=ti(e,e.shape.length-1,!0);e=kr(e,n)}return e=Ur(e,Vn(),1-Vn()),ll(ti(ne(r.toFloat(),Oo(e)),e.shape.length-1))})}function jg(r,e){return ft(function(){var t=Dv(EH(r)).toInt(),n=(e=Ur(e,Vn(),1-Vn())).shape;return gd(kc(t,n[n.length-1]).reshape(n),e,!1)})}function uq(r,e){if(!Ht.arraysEqual(r.shape,e.shape))throw new it("logits and labels must have the same shape, but got shapes "+JSON.stringify(r.shape)+" and "+JSON.stringify(e.shape));return ft(function(){var t=e.relu(),n=e.abs().neg();return t.sub(e.mul(r)).add(n.exp().log1p())})}function hy(r,e){return ft(function(){var t;return t=Ur(e,Vn(),1-Vn()),t=Oo(kr(t,sr(1,t))),Nn(uq(r,t),-1)})}function lq(r,e){return ft(function(){var t=Ur(r,Vn(),1),n=Ur(e,Vn(),1);return ti(ne(r,Oo(kr(t,n))),-1)})}function cq(r,e){return ft(function(){var t=Oo(xe(Vn(),e));return Nn(sr(e,ne(r,t)),-1)})}function cC(r,e){return ft(function(){var t=Bg(r,-1),n=Bg(e,-1),i=ne(t,n);return ll(ti(i,-1))})}var Ug={meanSquaredError:fl,meanAbsoluteError:cy,meanAbsolutePercentageError:ch,meanSquaredLogarithmicError:rq,squaredHinge:iq,hinge:aq,categoricalHinge:oq,logcosh:sq,categoricalCrossentropy:gd,sparseCategoricalCrossentropy:jg,binaryCrossentropy:hy,kullbackLeiblerDivergence:lq,poisson:cq,cosineProximity:cC};function J1(r){if(typeof r=="string"){if(r in Ug)return Ug[r];var e="Unknown loss "+r;throw r.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss "+r+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new it(e)}return r}function hC(r,e){return ft(function(){var t=ne(.5,yi(e)),n=Kd(ah(e,t),r.dtype);return Nn(cl(r,n),-1)})}function fC(r,e){return ft(function(){return Kd(cl(md(r,-1),md(e,-1)),"float32")})}function Z5(r,e){return ft(function(){return Vo(r.equal(1),e.equal(1)).sum().cast("float32")})}function hq(r,e){return ft(function(){return Vo(r.equal(1),e.equal(0)).sum().cast("float32")})}function fq(r,e){return ft(function(){return Vo(r.equal(0),e.equal(1)).sum().cast("float32")})}function J5(r,e){return ft(function(){var t=Z5(r,e),n=fq(r,e),i=t.add(n);return Mo(ah(i,0),t.div(i),0).cast("float32")})}function dq(r,e){return ft(function(){var t=Z5(r,e),n=hq(r,e),i=t.add(n);return Mo(ah(i,0),t.div(i),0).cast("float32")})}function tD(r,e){return hy(r,e)}function eD(r,e){return r.rank===e.rank&&(r=r.squeeze([r.rank-1])),(e=e.argMax(-1)).dtype!==r.dtype&&(e=e.asType(r.dtype)),cl(r,e).asType("float32")}var pq=fl,mq=fl,gq=cy,vq=cy,yq=ch,bq=ch,dC=gd,xq=cC,nD=jg,Wg={binaryAccuracy:hC,categoricalAccuracy:fC,precision:J5,categoricalCrossentropy:dC,sparseCategoricalCrossentropy:nD,mse:pq,MSE:mq,mae:gq,MAE:vq,mape:yq,MAPE:bq,cosine:xq};function wq(r){if(typeof r=="string"&&r in Wg)return Wg[r];if(typeof r!="string"&&r!=null)return r;throw new it("Unknown metric "+r)}function Vm(r){if(Ra(r!==null,"Unknown LossOrMetricFn "+r),typeof r=="string")return r;for(var e=void 0,t=0,n=Object.keys(Ug);t<n.length;t++){var i=n[t];if(Ug[i]===r){e=i;break}}if(e!==void 0)return e;for(var a=0,o=Object.keys(Wg);a<o.length;a++)if(i=o[a],Wg[i]===r){e=i;break}return e!==void 0?e:r.name}function Cq(r){var e={Adagrad:function(){return Ou.adagrad(.01)},Adadelta:function(){return Ou.adadelta(1,.95,Vn())},Adam:function(){return Ou.adam(.001,.9,.999,Vn())},Adamax:function(){return Ou.adamax(.002,.9,.999,Vn(),0)},RMSProp:function(){return Ou.rmsprop(.001,.9,0,Vn())},SGD:function(){return Ou.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,r in e)return e[r]();throw new it("Unknown Optimizer "+r)}var f4=1048576;function d4(r,e,t){if(t===void 0&&(t=!1),r==null||typeof r!="object"||Object.getPrototypeOf(r)!==Object.prototype||!l2(r))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){var n=JSON.stringify(r);n.length>f4&&console.warn('User-defined metadata of model "'+e+'" is too large in size (length='+n.length+" when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+f4+".")}}function l2(r){if(r===null)return!0;if(typeof r=="object"){if(Object.getPrototypeOf(r)===Object.prototype){for(var e=0,t=Object.keys(r);e<t.length;e++){var n=t[e];if(typeof n!="string"||!l2(r[n]))return!1}return!0}if(Array.isArray(r)){for(var i=0,a=r;i<a.length;i++)if(!l2(a[i]))return!1;return!0}return!1}var o=typeof r;return o==="string"||o==="number"||o==="boolean"}function Eq(r,e,t,n){n===void 0&&(n=console.log);var i,a=Tq(r),o=["Layer (type)","Output shape","Param #"];if(a?(e=e||65,t=t||[.45,.85,1]):(e=e||98,t=t||[.33,.55,.67,1]),t[t.length-1]<=1&&(t=t.map(function(m){return Math.floor(e*m)})),!a)for(var u in o.push("Receives inputs"),i=[],r.nodesByDepth)i.push.apply(i,r.nodesByDepth[u]);n("_".repeat(e)),Hg(o,t,n),n("=".repeat(e));for(var l=r.layers,h=0;h<l.length;++h)a?Sq(l[h],t,n):Aq(l[h],t,i,n),n((h===l.length-1?"=":"_").repeat(e));r.checkTrainableWeightsConsistency();var f=_q(r),p=Fg(r.nonTrainableWeights);n("Total params: "+(f+p)),n("Trainable params: "+f),n("Non-trainable params: "+p),n("_".repeat(e))}function _q(r){return r.collectedTrainableWeights!=null?Fg(r.collectedTrainableWeights):Fg(r.trainableWeights)}function Tq(r){var e=!0,t=[],n=[];for(var i in r.nodesByDepth)t.push(r.nodesByDepth[i]);for(var a=0,o=t;a<o.length;a++){var u=o[a];if(u.length>1||u.length===1&&u[0].inboundLayers.length>1){e=!1;break}n.push.apply(n,u)}if(e)for(var l=0,h=r.layers;l<h.length;l++){for(var f=!1,p=0,m=h[l].inboundNodes;p<m.length;p++){var v=m[p];if(n.indexOf(v)!==-1){if(f){e=!1;break}f=!0}}if(!e)break}return e}function Hg(r,e,t){t===void 0&&(t=console.log);for(var n="",i=0;i<r.length;++i)i>0&&(n=n.slice(0,n.length-1)+" "),n=(n+=r[i]).slice(0,e[i]),n+=" ".repeat(e[i]-n.length);t(n)}function Sq(r,e,t){var n;try{n=JSON.stringify(r.outputShape)}catch{n="multiple"}Hg([r.name+" ("+r.getClassName()+")",n,r.countParams().toString()],e,t)}function Aq(r,e,t,n){var i;try{i=JSON.stringify(r.outputShape)}catch{i="multiple"}for(var a=[],o=0,u=r.inboundNodes;o<u.length;o++){var l=u[o];if(!(t!=null&&t.length>0&&t.indexOf(l)===-1))for(var h=0;h<l.inboundLayers.length;++h){var f=l.inboundLayers[h].name,p=l.nodeIndices[h],m=l.tensorIndices[h];a.push(f+"["+p+"]["+m+"]")}}var v=r.name,b=r.getClassName(),C=a.length===0?"":a[0];for(Hg([v+" ("+b+")",i,r.countParams().toString(),C],e,n),h=1;h<a.length;++h)Hg(["","","",a[h]],e,n)}function rD(r,e,t){return(r==="inboundNodes"||r==="outputLayers"||r==="inputLayers")&&e===0&&typeof t=="string"}function vd(r,e){if(r===null)return null;if(typeof r=="string")return Pu(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var t=[],n=r.length,i=0;i<n;++i){var a=r[i];rD(e,i,a)?t.push(a):t.push(vd(a,e))}return t}for(var o={},u=0,l=Object.keys(r);u<l.length;u++){var h=l[u],f=r[h];if(h==="name"&&typeof f=="string")o[h]=f;else{var p=Pu(h);o[p]=vd(f,p)}}return o}function c2(r,e){if(r==null)return null;if(typeof r=="string")return xo(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var t=[],n=r.length,i=0;i<n;++i){var a=r[i];rD(e,i,a)?t.push(a):t.push(c2(a,e))}return t}for(var o={},u=0,l=Object.keys(r);u<l.length;u++){var h=l[u],f=r[h],p=xo(h);o[p]=h!=="name"&&h!=="className"||typeof f!="string"?c2(f,h):f}return o}var fy="1.3.1";function Rq(r,e){if(r.dtype==null||r.dtype===e.dtype)return e;try{return Tv(e,r.dtype)}catch{throw new it("The dtype of the feed ("+e.dtype+") can not be cast to the dtype of the key '"+r.name+"' ("+r.dtype+").")}}var mc=function(){function r(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof r)for(var t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(var n=0,i=e;n<i.length;n++){var a=i[n];this.add(a.key,a.value)}}}return r.prototype.add=function(e,t,n){if(this.id2Value[e.id]!=null)throw new it("Duplicate key: name="+e.name+", id="+e.id);return this.id2Value[e.id]=Rq(e,t),this.name2Id[e.name]=e.id,n!=null&&(this.id2Mask[e.id]=n),this},r.prototype.addFeed=function(e){this.add(e.key,e.value)},r.prototype.hasKey=function(e){return this.id2Value[e.id]!=null},r.prototype.names=function(){return Object.keys(this.name2Id)},r.prototype.getValue=function(e){if(e instanceof Ji){if(this.id2Value[e.id]==null)throw new it("Nonexistent key: "+e.name);return this.id2Value[e.id]}var t=this.name2Id[e];if(t==null)throw new it("Feed dict has no SymbolicTensor name: "+e);return this.id2Value[t]},r.prototype.getMask=function(e){if(e instanceof Ji){if(this.id2Value[e.id]==null)throw new it("Nonexistent key: "+e.name);return this.id2Mask[e.id]}var t=this.name2Id[e];if(t==null)throw new it("Feed dict has no SymbolicTensor name: "+e);return this.id2Mask[t]},r.prototype.disposeMasks=function(){this.id2Mask!=null&&de(this.id2Mask)},r}(),tb={},p4={};function Lf(r,e,t,n){for(var i=t!=null&&t.training,a=Array.isArray(r),o=a?r:[r],u=o.map(function(W){return W.name}),l=[],h=e.names(),f=0,p=u;f<p.length;f++){var m=p[f];h.indexOf(m)!==-1?l.push(e.getValue(m)):l.push(null)}var v,b,C=u.join(",")+"|"+e.names().join(",");if(tb[C]==null){var w=Nq(o,e);v=w.sorted,b=w.recipientCounts,tb[C]=v,p4[C]=b}v=tb[C],b={},i||Object.assign(b,p4[C]);for(var E=new mc(e),S=0;S<v.length;++S){var A=v[S],k=A.sourceLayer;if(!(k instanceof Qd)){for(var O=[],V=[],T=[],R=!1,N=0,D=A.inputs;N<D.length;N++){var L=D[N],P=E.getValue(L),B=E.getMask(L);O.push(P),V.push(B),B!=null&&(R=!0),i||(b[L.name]--,b[L.name]!==0||e.hasKey(L)||u.indexOf(L.name)!==-1||P.isDisposed||L.sourceLayer.stateful===!0||T.push(P))}R&&((t=t||{}).mask=V[0]);var Z=nn(k.apply(O,t)),rt=null;k.supportsMasking&&(rt=k.computeMask(O,V));for(var q=kq(A),K=Array.isArray(q)?q:[q],Q=0;Q<K.length;++Q){E.hasKey(K[Q])||E.add(K[Q],Z[Q],Array.isArray(rt)?rt[0]:rt);var ut=u.indexOf(K[Q].name);ut!==-1&&(l[ut]=Z[Q])}i||de(T)}}return E.disposeMasks(),a?l:l[0]}function Nq(r,e){Ht.assert(r!=null&&r.length>0,function(){return"Expected at least one fetch, got none"});var t=[],n={};if(r.length===1){var i=m4(r[0],e);t=i.sorted,n=i.recipientMap}else for(var a=new Set,o=0,u=r;o<u.length;o++){for(var l=m4(u[o],e),h=l.sorted,f=l.recipientMap,p=0,m=h;p<m.length;p++){var v=m[p];a.has(v.name)||(t.push(v),a.add(v.name))}var b=function(w){n[w]==null&&(n[w]=new Set),f[w].forEach(function(E){return n[w].add(E)})};for(var C in f)b(C)}return{sorted:t,recipientCounts:Iq(n)}}function Iq(r){var e={};for(var t in r)e[t]=r[t].size;return e}function m4(r,e){for(var t=new Set,n=[],i={},a=0,o=e.names();a<o.length;a++){var u=o[a];t.add(u)}var l=[],h=[];for(l.push(r);l.length>0;){var f=l[l.length-1];if(t.has(f.name))l.pop();else{var p=h[h.length-1]===l.length-1;if(f.inputs.length===0||p)l.pop(),n.push(f),t.add(f.name),p&&h.pop();else{h.push(l.length-1);for(var m=0,v=f.inputs;m<v.length;m++){var b=v[m];i[b.name]==null&&(i[b.name]=new Set),i[b.name].add(f.name),t.has(b.name)||l.push(b)}}}}return{sorted:n,recipientMap:i}}function kq(r){var e;if(r.sourceLayer.inboundNodes.length===1)e=r.sourceLayer.output;else{for(var t=null,n=0;n<r.sourceLayer.inboundNodes.length;++n)for(var i=0,a=r.sourceLayer.inboundNodes[n].outputTensors;i<a.length;i++)if(a[i].id===r.id){t=n;break}e=r.sourceLayer.getOutputAt(t)}return e}var Dq=function(r){function e(t){var n=r.call(this,{})||this;if(n.containerNodes=new Set,n.name=t.name,n.name==null){var i=n.getClassName().toLowerCase();n.name=uy(i)}if(n.supportsMasking=!1,n.trainable_=!0,Array.isArray(t.inputs)?n.inputs=t.inputs.slice():n.inputs=[t.inputs],Array.isArray(t.outputs)?n.outputs=t.outputs.slice():n.outputs=[t.outputs],ks(n.inputs).length!==n.inputs.length)throw new it("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+n.inputs.map(function(re){return re.name}));ks(n.outputs).length!==n.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+n.outputs.map(function(re){return re.name})),n.inputLayers=[],n.inputLayersNodeIndices=[],n.inputLayersTensorIndices=[],n.outputLayers=[],n.outputLayersNodeIndices=[],n.outputLayersTensorIndices=[],n.layers=[],n.internalContainerRefs=[];for(var a=0,o=n.outputs;a<o.length;a++){var u=(D=o[a]).sourceLayer,l=D.nodeIndex,h=D.tensorIndex;n.outputLayers.push(u),n.outputLayersNodeIndices.push(l),n.outputLayersTensorIndices.push(h)}for(var f=0,p=n.inputs;f<p.length;f++)u=(D=p[f]).sourceLayer,l=D.nodeIndex,h=D.tensorIndex,Ra(l===0,"input layer has >1 nodes"),Ra(h===0,"input layer has >1 tensors"),n.inputLayers.push(u),n.inputLayersNodeIndices.push(l),n.inputLayersTensorIndices.push(h);n.inputNames=[],n.outputNames=[],n.feedInputShapes=[],n.feedInputNames=[],n.feedOutputNames=[];for(var m=0;m<n.inputLayers.length;m++){if(!((u=n.inputLayers[m])instanceof Qd))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+t.inputs+". Input "+m+" (0-based) originates from layer type "+u.getClassName()+".");n.inputNames.push(u.name),n.feedInputShapes.push(u.batchInputShape),n.feedInputNames.push(u.name)}for(var v=0,b=n.outputLayers;v<b.length;v++)u=b[v],n.outputNames.push(u.name);n.internalInputShapes=n.inputs.map(function(re){return re.shape}),n.internalOutputShapes=n.outputs.map(function(re){return re.shape});for(var C={},w={},E={},S={},A={},k=[],O=function(re,Un,ln,fe,le,dn){fe!=null&&le!=null&&dn!=null||(fe=re.sourceLayer,le=re.nodeIndex,dn=re.tensorIndex);var Re=fe.inboundNodes[le];if(ln.indexOf(Re)!==-1)throw new Ia("The tensor "+re.name+' at layer "'+fe.name+'" is part of a cycle.');if(Un.indexOf(Re)===-1){n.containerNodes.add(e.nodeKey(fe,le)),fe.id in A||(A[fe.id]=Object.keys(A).length),ln.indexOf(Re)===-1&&ln.push(Re);for(var Ei=Re.inboundLayers.length,Hr=0;Hr<Ei;Hr++){var Fi=Re.inputTensors[Hr],Bi=Re.inboundLayers[Hr],ji=Re.nodeIndices[Hr],lr=Re.tensorIndices[Hr];O(Fi,Un,ln,Bi,ji,lr)}for(Un.push(Re);ln.indexOf(Re)>=0;)ln.splice(ln.indexOf(Re),1);k.push(Re)}},V=[],T=[],R=0,N=n.outputs;R<N.length;R++){var D=N[R];O(D,V,T)}for(var L=0,P=k.slice().reverse();L<P.length;L++){w[(Jt=P[L]).id]=Jt,Jt.id in C||(C[Jt.id]=0);var B=C[Jt.id],Z=E[Jt.outboundLayer.id]==null?0:E[Jt.outboundLayer.id];for(B=Math.max(B,Z),E[Jt.outboundLayer.id]=B,S[Jt.outboundLayer.id]=Jt.outboundLayer,C[Jt.id]=B,m=0;m<Jt.inboundLayers.length;m++){var rt=Jt.inboundLayers[m],q=(l=Jt.nodeIndices[m],rt.inboundNodes[l]),K=C[q.id]==null?0:C[q.id];C[q.id]=Math.max(B+1,K),w[q.id]=q}}var Q={};for(var ut in C)(B=C[ut])in Q||(Q[B]=[]),Q[B].push(w[ut]);var W={};for(var et in E)(B=E[et])in W||(W[B]=[]),W[B].push(S[et]);var dt=Object.keys(W).map(function(re){return parseInt(re,10)}).sort(Lm);n.layers=[];for(var lt=0,St=dt;lt<St.length;lt++){var Nt=W[B=St[lt]];Nt.sort(function(re,Un){var ln=A[re.id],fe=A[Un.id];return ln<fe?-1:ln>fe?1:0});for(var Rt=0,Ut=Nt;Rt<Ut.length;Rt++)(u=Ut[Rt])instanceof e&&n.internalContainerRefs.push(u),n.layers.push(u)}n.layersByDepth=W,dt=Object.keys(Q).map(function(re){return parseInt(re,10)}).sort(Lm);for(var Pt=n.inputs.slice(),Xt=[],Le=0,Zt=dt;Le<Zt.length;Le++)for(var ye=0,se=Q[B=Zt[Le]];ye<se.length;ye++){var Jt;if((u=(Jt=se[ye]).outboundLayer)!=null){for(var ze=0,Ae=Jt.inputTensors;ze<Ae.length;ze++)if(D=Ae[ze],Pt.indexOf(D)===-1)throw new Ia("Graph disconnected: cannot obtain value for tensor "+D+' at layer "'+u.name+'". The following previous layers were accessed without issue: '+Xt);for(var Ke=0,Dr=Jt.outputTensors;Ke<Dr.length;Ke++)D=Dr[Ke],Pt.push(D);Xt.push(u.name)}}n.nodesByDepth=Q;for(var En=n.layers.map(function(re){return re.name}),In=function(re){var Un=En.filter(function(ln){return ln===re}).length;if(Un!==1)throw new Ia('The name "'+re+'" is used '+Un+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(En))},un=0,Er=En;un<Er.length;un++)In(Er[un]);return n.outboundNodes=[],n.inboundNodes=[],new ly({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:n.inputs,outputTensors:n.outputs,inputMasks:n.inputs.map(function(re){return null}),outputMasks:n.outputs.map(function(re){return null}),inputShapes:n.inputs.map(function(re){return re.shape}),outputShapes:n.outputs.map(function(re){return re.shape})}),n.built=!0,n._refCount=1,n}return xt(e,r),e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){this.assertNotDisposed();var t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount==0){for(var n=0,i=this.layers;n<i.length;n++){var a=i[n];t.numDisposedVariables+=a.dispose().numDisposedVariables}for(var o=0,u=this.internalContainerRefs;o<u.length;o++){var l=u[o];t.numDisposedVariables+=l.dispose().numDisposedVariables}}return t.refCountAfterDispose=this._refCount,t},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(n){n._trainableWeights.forEach(function(i){return i.trainable=t})}),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new it("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var t=[],n=0,i=this.layers;n<i.length;n++){var a=i[n];t=t.concat(a.trainableWeights)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],n=0,i=this.layers;n<i.length;n++){var a=i[n];t.push.apply(t,a.nonTrainableWeights)}if(!this.trainable){for(var o=[],u=0,l=this.layers;u<l.length;u++)a=l[u],o.push.apply(o,a.trainableWeights);return o.concat(t)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.loadWeights=function(t,n){n===void 0&&(n=!0);for(var i={},a=0,o=0,u=this.layers;o<u.length;o++)for(var l=0,h=u[o].weights;l<h.length;l++){var f=h[l];if(i[f.originalName]!=null)throw new it("Duplicate weight name: "+f.originalName);i[f.originalName]=f,a++}var p=[];for(var m in t){if(i[m]!=null)p.push([i[m],t[m]]);else if(n)throw new it("Provided weight data has no target variable: "+m);delete i[m]}if(n){var v=[];for(var b in i)v.push(b);if(v.length>0)throw new it(v.length+" of "+a+" weights are not set: "+v)}lC(p)},e.prototype.updatedConfig=function(){var t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion="tfjs-layers "+fy,n.backend="TensorFlow.js",n},e.prototype.toJSON=function(t,n){n===void 0&&(n=!0);var i=c2(this.updatedConfig());return n?JSON.stringify(i):i},e.prototype.call=function(t,n){var i=this;return ft(function(){t=nn(t);for(var a=new mc,o=0;o<i.inputs.length;++o)a.add(i.inputs[o],t[o]);return Lf(i.outputs,a,n)})},e.prototype.computeMask=function(t,n){var i=this;return ft(function(){var a;return t=nn(t),a=n==null?Zu(null,t.length):nn(n),i.runInternalGraph(t,a)[1]})},e.prototype.computeOutputShape=function(t){var n=Vg(t);if(n.length!==this.inputLayers.length)throw new it("Invalid inputShape argument "+t+": model has "+this.inputLayers.length+" tensor inputs.");for(var i={},a=0;a<n.length;a++){var o=this.inputLayers[a],u=n[a];i[N=o.name+"_0_0"]=u}var l=Object.keys(this.nodesByDepth).map(function(L){return parseInt(L,10)}).sort(Lm);if(l.length>1)for(var h=0,f=l;h<f.length;h++)for(var p=f[h],m=0,v=this.nodesByDepth[p];m<v.length;m++){var b=v[m];if(o=b.outboundLayer,this.inputLayers.map(function(L){return L.id}).indexOf(o.id)===-1){for(var C=[],w=0;w<b.inboundLayers.length;w++){var E=b.inboundLayers[w],S=b.nodeIndices[w],A=b.tensorIndices[w],k=i[N=E.name+"_"+S+"_"+A];C.push(k)}var O=Vg(o.computeOutputShape(Vr(C))),V=o.inboundNodes.indexOf(b);for(w=0;w<O.length;w++)i[N=o.name+"_"+V+"_"+w]=O[w]}}var T=[],R=[];for(a=0;a<this.outputLayers.length;a++){o=this.outputLayers[a],V=this.outputLayersNodeIndices[a],A=this.outputLayersTensorIndices[a];var N=o.name+"_"+V+"_"+A;R.push(N)}for(a=0;a<R.length;a++){var D=R[a];Ra(D in i),T.push(i[D])}return Vr(T)},e.prototype.runInternalGraph=function(t,n){n==null&&(n=Zu(null,t.length));for(var i={},a=0;a<this.inputs.length;++a){var o=this.inputs[a],u=t[a],l=n[a];i[o.id]=[u,l]}for(var h=0,f=Object.keys(this.nodesByDepth).map(function(W){return parseInt(W,10)}).sort(Lm);h<f.length;h++)for(var p=f[h],m=0,v=this.nodesByDepth[p];m<v.length;m++){for(var b=v[m],C=b.outboundLayer,w=b.inputTensors,E=b.outputTensors,S=new Array,A=0,k=w;A<k.length;A++)(o=k[A]).id in i&&S.push(i[o.id]);if(S.length===w.length){var O={},V=void 0,T=void 0,R=void 0,N=void 0;if(b.callArgs!=null&&(O=b.callArgs),S.length===1){var D=S[0],L=D[0],P=D[1];O.mask==null&&(O.mask=P),R=nn(C.call(L,O)),N=nn(C.computeMask(L,P)),V=[L],T=[P]}else V=S.map(function(W){return W[0]}),T=S.map(function(W){return W[1]}),O.mask==null&&(O.mask=T),R=nn(C.call(V,O)),N=nn(C.computeMask(V,T));if(C.activityRegularizer)throw new pe("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(a=0;a<E.length;++a)o=E[a],u=R[a],l=N[a],i[o.id]=[u,l]}}for(var B=[],Z=[],rt=[],q=0,K=this.outputs;q<K.length;q++){Ra((o=K[q]).id in i,"Could not compute output "+o.name+" : "+o.id);var Q=i[o.id],ut=Q[0];l=Q[1],rt.push(ut.shape),B.push(ut),Z.push(l)}return[B,Z,rt]},e.prototype.buildNodeConversionMap=function(t){for(var n,i={},a=0,o=this.layers;a<o.length;a++){var u=o[a];n=u instanceof e?1:0;for(var l=0;l<u.inboundNodes.length;l++){var h=e.nodeKey(u,l);this.containerNodes.has(h)&&(i[h]=n,n+=1)}}return i},e.prototype.getLayer=function(t,n){if(n!=null){if(this.layers.length<=n)throw new it("Was asked to retrieve layer at index "+n+", but model only has "+this.layers.length+" layer(s).");return this.layers[n]}if(t==null)throw new it("Provide either a layer name or layer index");for(var i=0,a=this.layers;i<a.length;i++){var o=a[i];if(o.name===t)return o}throw new it("No such layer: "+t)},e.prototype.calculateLosses=function(){var t=this;return ft(function(){for(var n=[],i=0,a=t.layers;i<a.length;i++)for(var o=a[i],u=0;u<o.inboundNodes.length;++u){var l=e.nodeKey(o,u);t.containerNodes.has(l)&&n.push.apply(n,o.calculateLosses())}return n})},e.prototype.getConfig=function(){for(var t={name:this.name},n=this.buildNodeConversionMap(this.layers),i=[],a=0,o=this.layers;a<o.length;a++){for(var u=(O=o[a]).getClassName(),l=O.getConfig(),h=[],f=0;f<O.inboundNodes.length;f++){var p=O.inboundNodes[f],m=e.nodeKey(O,f),v={};if(this.containerNodes.has(m)){if(p.callArgs)try{JSON.stringify(p.callArgs),v=p.callArgs}catch{console.warn("Layer "+O.name+" was passed non-serializable keyword arguments: "+p.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),v={}}if(p.inboundLayers.length>0){for(var b=[],C=0;C<p.inboundLayers.length;C++){var w=p.inboundLayers[C],E=p.nodeIndices[C],S=p.tensorIndices[C];(T=n[e.nodeKey(w,E)])==null&&(T=0),b.push([w.name,T,S,v])}h.push(b)}}}var A={};A.name=O.name,A.className=u,A.config=l,A.inboundNodes=h,i.push(A)}t.layers=i;var k=[];for(C=0;C<this.inputLayers.length;C++){var O=this.inputLayers[C];E=this.inputLayersNodeIndices[C],m=e.nodeKey(O,E),this.containerNodes.has(m)&&((T=n[m])!==null&&T!==void 0||(T=0),S=this.inputLayersTensorIndices[C],k.push([O.name,T,S]))}t.inputLayers=k;var V=[];for(C=0;C<this.outputLayers.length;C++)if(O=this.outputLayers[C],E=this.outputLayersNodeIndices[C],m=e.nodeKey(O,E),this.containerNodes.has(m)){var T;(T=n[m])!==null&&T!==void 0||(T=0),S=this.outputLayersTensorIndices[C],V.push([O.name,T,S])}return t.outputLayers=V,t},e.fromConfig=function(t,n,i,a){a===void 0&&(a=!1);var o={},u={};function l(q,K){q.name in u?u[q.name].push(K):u[q.name]=[K]}function h(q,K){for(var Q,ut=[],W=0,et=K;W<et.length;W++){var dt=et[W],lt=dt[0],St=dt[1],Nt=dt[2];if(Q=dt[3]==null?{}:dt[3],!(lt in o))return void l(q,K);var Rt=o[lt];if(Rt.inboundNodes.length<=St)return void l(q,K);var Ut=Rt.inboundNodes[St];ut.push(Ut.outputTensors[Nt])}ut.length>0&&q.apply(Vr(ut),Q)}function f(q){var K=q.name,Q=ta(q,n.customObjects!=null?n.customObjects:{});Q.setFastWeightInitDuringBuild(a),o[K]=Q,q.inboundNodes.forEach(function(ut){if(!(ut instanceof Array))throw new it("Corrupted configuration, expected array for nodeData: "+ut);l(Q,ut)})}for(var p=n.name,m=n.layers,v=0,b=m;v<b.length;v++)f(E=b[v]);for(;!uH(u);)for(var C=0,w=m;C<w.length;C++){var E=w[C];if((rt=o[E.name]).name in u){var S=u[rt.name];delete u[rt.name];for(var A=0,k=S;A<k.length;A++)h(rt,k[A])}}for(var O=[],V=[],T=0,R=n.inputLayers;T<R.length;T++){var N=(E=R[T])[0],D=E[1],L=E[2];Ra(N in o);var P=(rt=o[N]).inboundNodes[D].outputTensors;O.push(P[L])}for(var B=0,Z=n.outputLayers;B<Z.length;B++){N=(E=Z[B])[0],D=E[1],L=E[2],Ra(N in o);var rt;P=(rt=o[N]).inboundNodes[D].outputTensors,V.push(P[L])}return new t({inputs:O,outputs:V,name:p})},Object.defineProperty(e.prototype,"stateful",{get:function(){if(this._stateful)throw new it("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var t=0,n=this.layers;t<n.length;t++)if(n[t].stateful)return!0;return!1},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){var t=this;ft(function(){t.layers.forEach(function(n){n.stateful&&n.resetStates()})})},e}(Se);function Oq(r,e,t){var n=e.length;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(a){return null});if(n===1)return Array.isArray(r)&&r.length===1?r:typeof r=="object"&&e[0]in r?[r[e[0]]]:[r];if(Array.isArray(r)){if(r.length!==n)throw new Error("Provided "+t+" is an array of "+r.length+" element(s), but the model has "+n+" outputs. Make sure a set of weights is provided for each model output.");return r}if(typeof r=="object"&&Object.keys(r).length>0&&typeof r[Object.keys(r)[0]]=="object"){var i=[];return e.forEach(function(a){a in r?i.push(r[a]):i.push(null)}),i}throw new Error("The model has multiple ("+n+") outputs, so "+t+" must be either an array with "+n+" elements or an object with "+e+" keys. Provided "+t+" not understood: "+JSON.stringify(r))}function iD(r,e){return Oq(r,e,"classWeight")}function aD(r,e,t,n){return ee(this,void 0,void 0,function(){var i,a,o,u,l;return Kt(this,function(h){switch(h.label){case 0:return t==null?[3,2]:(i=ft(function(){if(r.shape.length===1)return r.clone();if(r.shape.length===2){if(r.shape[1]>1)return r.argMax(1);if(r.shape[1]===1)return r.reshape([r.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+r.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+r.rank+") during handling of class weights. The rank is expected to be 1 or 2.")}),u=(o=Array).from,[4,i.data()]);case 1:return a=u.apply(o,[h.sent()]),de(i),l=[],a.forEach(function(f){if(t[f]==null)throw new Error("classWeight must contain all classes in the training data. The class "+f+" exists in the data but not in classWeight");l.push(t[f])}),[2,Jr(l,"float32")];case 2:return[2,null]}})})}function Mq(r,e){return ne(r,e)}var Lq=32;function oD(r,e){var t,n,i=e;t=i.xs,n=i.ys,Ht.assert(t!=null&&n!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+e});var a=g4("input",r.inputNames,t),o=g4("output",r.outputNames,n),u=a[0].shape[0];Ht.assert(a.length===r.inputs.length,function(){return"LayersModel has "+r.inputs.length+" inputs, but the dataset provides "+a.length+" inputs.  (Expected input keys: "+JSON.stringify(r.inputNames)+")"}),Ht.assert(o.length===r.outputs.length,function(){return"LayersModel has "+r.outputs.length+" outputs, but the dataset provides "+o.length+" outputs.  (Expected output keys: "+JSON.stringify(r.outputNames)+")"});var l=function(m){Ht.assert(a[m].shape[0]===u,function(){return"Batch size mismatch: input "+r.inputNames[m]+" has "+a[m].shape[0]+"; expected  "+u+" based on input "+r.inputNames[0]+"."})};for(var h in a)l(h);var f=function(m){Ht.assert(o[m].shape[0]===u,function(){return"Batch size mismatch: output "+r.outputNames[m]+" has "+o[m].shape[0]+"; expected  "+u+" based on input "+r.inputNames[0]+"."})};for(var p in o)f(p);return{xs:a,ys:o}}function g4(r,e,t){if(t instanceof Ge)return[t];if(Array.isArray(t))return Ht.assert(t.length===e.length,function(){return"Received an array of "+t.length+" Tensors, but expected "+e.length+" to match the "+r+" keys "+e+"."}),t;for(var n=[],i=0,a=e;i<a.length;i++){var o=a[i];if(t[o]==null)throw new it("The feature data generated by the dataset lacks the required "+r+" key '"+o+"'.");n.push(t[o])}return n}function Pq(r){if(r.length===3)throw new pe("Validation with sample weights is not implemented yet.");return{xs:r[0],ys:r[1]}}function zq(r,e,t){return ee(this,void 0,void 0,function(){var n,i,a,o,u,l,h,f,p,m,v,b,C,w,E,S,A,k,O,V,T,R,N,D,L,P,B,Z,rt,q,K,Q,ut,W;return Kt(this,function(et){switch(et.label){case 0:if(n=t.batchesPerEpoch!=null,Ht.assert(r.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),Ht.assert(t!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),Ht.assert(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+t.epochs}),Ht.assert(!n||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+t.batchesPerEpoch}),Ht.assert(t.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,et.label=1;case 1:return et.trys.push([1,,26,27]),i=t.validationData!=null,a=void 0,o=void 0,i&&(v4(t.validationData)?Ht.assert(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+t.validationBatches}):(u=Pq(t.validationData),a=u.xs,o=u.ys)),l=r.makeTrainFunction(),h=r.getDedupedMetricsNames(),f=void 0,f=i?h.slice().concat(h.map(function(dt){return"val_"+dt})):h.slice(),p=X5(t.callbacks,t.yieldEvery),m=t.verbose==null?1:t.verbose,v=Q5(p,m,t.epochs,null,null,Vq(e,t),null,i,f),b=v.callbackList,C=v.history,b.setModel(r),r.history=C,[4,b.onTrainBegin()];case 2:return et.sent(),r.stopTraining_=!1,w=t.initialEpoch==null?0:t.initialEpoch,[4,e.iterator()];case 3:E=et.sent(),et.label=4;case 4:return w<t.epochs?(S={},[4,b.onEpochBegin(w)]):[3,23];case 5:return et.sent(),A=0,k=0,n?[3,7]:[4,e.iterator()];case 6:E=et.sent(),et.label=7;case 7:return!n||A<t.batchesPerEpoch?[4,E.next()]:[3,21];case 8:return O=et.sent(),n&&O.done?(console.warn("You provided `batchesPerEpoch` as "+t.batchesPerEpoch+", but your dataset iterator ran out of data after "+A+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+t.batchesPerEpoch*t.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):O.value==null?[3,15]:(V=oD(r,O.value),T=V.xs,R=V.ys,(N={}).batch=k,N.size=T[0].shape[0],[4,b.onBatchBegin(k,N)]);case 9:if(et.sent(),D=[],t.classWeight==null)return[3,13];L=iD(t.classWeight,r.outputNames),W=0,et.label=10;case 10:return W<L.length?(B=(P=D).push,[4,aD(R[W],null,L[W])]):[3,13];case 11:B.apply(P,[et.sent()]),et.label=12;case 12:return++W,[3,10];case 13:for(Z=T.concat(R).concat(D),rt=l(Z),de(Z),W=0;W<h.length;++W)q=h[W],K=rt[W],N[q]=K,za(K);return[4,b.onBatchEnd(k,N)];case 14:et.sent(),q5(N),k++,A++,et.label=15;case 15:return(n?A>=t.batchesPerEpoch:O.done)?i?(Q=void 0,v4(t.validationData)?(ut=nn,[4,r.evaluateDataset(t.validationData,{batches:t.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return Q=ut.apply(void 0,[et.sent()]),[3,18];case 17:Q=nn(r.evaluate(a,o,{batchSize:t.validationBatchSize==null?Lq:t.validationBatchSize,verbose:0})),et.label=18;case 18:for(W=0;W<r.metricsNames.length;++W)S["val_"+r.metricsNames[W]]=Q[W];et.label=19;case 19:return[3,21];case 20:return r.stopTraining_?[3,21]:[3,7];case 21:return[4,b.onEpochEnd(w,S)];case 22:return et.sent(),w++,r.stopTraining_?[3,23]:[3,4];case 23:return[4,b.onTrainEnd()];case 24:return et.sent(),[4,r.history.syncData()];case 25:return et.sent(),[2,r.history];case 26:return r.isTraining=!1,[7];case 27:return[2]}})})}function Vq(r,e){var t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(r.size)&&(t=r.size),t}function v4(r){return typeof r.iterator=="function"}function Fq(r){return typeof r.next=="function"}function Bq(r,e,t){return ee(this,void 0,void 0,function(){var n,i,a,o,u,l,h,f,p,m;return Kt(this,function(v){switch(v.label){case 0:if(n=(t=t||{}).batches!=null,i=r.testFunction,a=[],t.verbose>0)throw new pe("Verbose mode is not implemented yet.");return Ht.assert(!n||t.batches>0&&Number.isInteger(t.batches),function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(t.batches)}),Fq(e)?(u=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:u=v.sent(),v.label=3;case 3:o=u,l=0,h=0,f=function(){var b;return Kt(this,function(C){switch(C.label){case 0:return[4,o.next()];case 1:return b=C.sent(),a=ft(function(){if(b.value){var w=oD(r,b.value),E=w.xs,S=w.ys,A=E.concat(S),k=ft(function(){return i(A)});if(de(A),h===0)for(var O=0;O<k.length;++O)a.push(zt(0));var V=A[0].shape[0],T=function(R){var N=k[R],D=a[R];a[R]=ft(function(){return xe(a[R],ne(V,N))}),h>0&&de(D)};for(O=0;O<k.length;++O)T(O);de(k),l+=V,++h}return a}),b.done?(n&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+t.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},v.label=4;case 4:return!n||h<t.batches?[5,f()]:[3,6];case 5:return v.sent()==="break"?[3,6]:[3,4];case 6:for(p=0;p<a.length;++p)m=a[p],a[p]=kr(a[p],l),de(m);return[2,Vr(a)]}})})}function h2(r){Ht.assert(r>0&&Number.isInteger(r),function(){return"batchSize is required to be a positive integer, but got "+r})}function Pf(r,e,t){return r==null?[null]:Array.isArray(r)?r.map(function(n){return qu(n,e,t-e)}):qu(r,e,t-e)}function pC(r,e){return ft(function(){return r==null?null:Array.isArray(r)?r.map(function(t){return pC(t,e)}):D5(r,e.dtype==="int32"?e:e.toInt())})}function f2(r,e){for(var t=[],n=0,i=null;n<r;)(i=n+e)>=r&&(i=r),t.push([n,i]),n=i;return t}function jq(r,e,t,n,i,a,o,u,l,h,f,p,m,v,b){return ee(this,void 0,void 0,function(){var C,w,E,S,A,k,O,V;return Kt(this,function(T){switch(T.label){case 0:return i==null&&(i=32),a==null&&(a=1),f==null&&(f=!0),m==null&&(m=0),C=!1,l!=null&&h!=null&&(C=!0),b!=null,(w=r.checkNumSamples(t,i,v,"steps_per_epoch"))!=null&&(E=ia(0,w)),o==null&&(o=1),S=Q5(u,o,a,m,w,v,i,C,p),A=S.callbackList,k=S.history,A.setModel(r),r.history=k,[4,A.onTrainBegin()];case 1:T.sent(),r.stopTraining_=!1,O=function(R){var N,D,L,P,B;return Kt(this,function(Z){switch(Z.label){case 0:return[4,A.onEpochBegin(R)];case 1:if(Z.sent(),N={},v==null)return[3,2];case 2:if(f==="batch")throw new pe("batch shuffling is not implemneted yet");f&&Ht.shuffle(E),D=Jr(E),L=f2(w,i),P=function(rt){var q;return Kt(this,function(K){switch(K.label){case 0:return q={},[4,A.onBatchBegin(rt,q)];case 1:return K.sent(),ft(function(){var Q=L[rt][0],ut=L[rt][1],W=qu(D,Q,ut-Q);q.batch=rt,q.size=ut-Q;for(var et=pC(t,W),dt=e(et),lt=0;lt<n.length;++lt){var St=n[lt],Nt=dt[lt];q[St]=Nt,za(Nt)}if(rt===L.length-1&&C){var Rt=r.testLoop(l,h,i);for(lt=0;lt<n.length;++lt)St=n[lt],Nt=Rt[lt],za(Nt),N["val_"+St]=Nt}}),[4,A.onBatchEnd(rt,q)];case 2:return K.sent(),q5(q),r.stopTraining_?[2,"break"]:[2]}})},B=0,Z.label=3;case 3:return B<L.length?[5,P(B)]:[3,6];case 4:if(Z.sent()==="break")return[3,6];Z.label=5;case 5:return++B,[3,3];case 6:D.dispose(),Z.label=7;case 7:return[4,A.onEpochEnd(R,N)];case 8:return Z.sent(),r.stopTraining_?[2,"break"]:[2]}})},V=m,T.label=2;case 2:return V<a?[5,O(V)]:[3,5];case 3:if(T.sent()==="break")return[3,5];T.label=4;case 4:return++V,[3,2];case 5:return[4,A.onTrainEnd()];case 6:return T.sent(),[4,r.history.syncData()];case 7:return T.sent(),[2,r.history]}})})}function Uq(r,e,t,n){return n===void 0&&(n={}),ee(this,void 0,void 0,function(){var i,a,o,u,l,h,f,p,m,v,b,C,w,E,S,A,k,O,V,T,R,N;return Kt(this,function(D){switch(D.label){case 0:if(r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,D.label=1;case 1:return D.trys.push([1,,7,8]),h2(p=n.batchSize==null?32:n.batchSize),m=!1,[4,r.standardizeUserData(e,t,n.sampleWeight,n.classWeight,m,p)];case 2:if(v=D.sent(),i=v[0],a=v[1],f=v[2],b=!1,C=void 0,!(n.validationData!=null&&n.validationData.length>0))return[3,4];if(b=!0,n.validationData.length!==2)throw n.validationData.length===3?new pe("validationData including sample weights is not supported yet."):new it("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+n.validationData+" is invalid.");return o=n.validationData[0],u=n.validationData[1],w=!0,[4,r.standardizeUserData(o,u,null,null,w,p)];case 3:return E=D.sent(),l=E[0],h=E[1],C=l.concat(h),[3,5];case 4:n.validationSplit!=null&&n.validationSplit>0&&n.validationSplit<1?(b=!0,S=Math.floor(i[0].shape[0]*(1-n.validationSplit)),A=i[0].shape[0],l=Pf(i,S,A),i=Pf(i,0,S),h=Pf(a,S,A),a=Pf(a,0,S),C=l.concat(h)):n.validationSteps!=null&&(b=!0),D.label=5;case 5:return k=i.concat(a).concat(f),r.checkTrainableWeightsConsistency(),O=r.makeTrainFunction(),V=r.getDedupedMetricsNames(),T=void 0,R=void 0,b?(r.makeTestFunction(),T=r.testFunction,R=V.slice().concat(V.map(function(L){return"val_"+L}))):(T=null,C=[],R=V.slice()),N=X5(n.callbacks,n.yieldEvery),[4,jq(r,O,k,V,p,n.epochs,n.verbose,N,T,C,n.shuffle,R,n.initialEpoch,null,null)];case 6:return[2,D.sent()];case 7:return r.isTraining=!1,ju(i,e),ju(a,t),ju(l,o),ju(h,u),f!=null&&de(f),[7];case 8:return[2]}})})}function sD(r){var e=[];r instanceof Ge&&(r=[r]);for(var t=0;t<r.length;++t){var n=r[t];if(n.rank===1)e.push(Xd(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function ju(r,e){if(r!=null){var t=[];if(e instanceof Ge)t.push(e.id);else if(Array.isArray(e))e.forEach(function(l){return t.push(l.id)});else if(e!=null)for(var n in e){var i=e[n];t.push(i.id)}var a=[];if(r instanceof Ge)t.indexOf(r.id)===-1&&a.push(r);else if(Array.isArray(r))r.forEach(function(l){t.indexOf(l.id)===-1&&a.push(l)});else if(r!=null)for(var o in r){var u=r[o];t.indexOf(u.id)===-1&&a.push(u)}a.forEach(function(l){l.isDisposed||l.dispose()})}}function Wq(r){return r instanceof Ge}function d2(r){return Array.isArray(r)}function y4(r){return!Wq(r)&&!d2(r)}function b4(r,e,t,n,i){if(i===void 0&&(i=""),e==null||e.length===0){if(r!=null){var a=!1;if(d2(r)&&r.length>0)a=!0;else if(y4(r)){for(var o in r)if(r.hasOwnProperty(o)){a=!0;break}}else a=!0;if(a)throw new it("Error when checking model "+i+" expected no data, but got "+r)}return[]}if(r==null)return e.map(function(w){return null});var u;if(y4(r)){r=r,u=[];for(var l=0,h=e;l<h.length;l++){var f=h[l];if(r[f]==null)throw new it('No data provided for "'+f+'". Need data for each key in: '+e);u.push(r[f])}}else if(d2(r)){if((r=r).length!==e.length)throw new it("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+e.length+" Tensor(s), but instead got the following list of Tensor(s): "+r);u=r}else{if(r=r,e.length>1)throw new it("The model "+i+" expects "+e.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+r.shape);u=[r]}if(u=sD(u),t!=null){for(var p=0;p<e.length;++p)if(t[p]!=null){var m=u[p];if(m.shape.length!==t[p].length)throw new it("Error when checking "+i+": expected "+e[p]+" to have "+t[p].length+" dimension(s). but got array with shape "+m.shape);for(var v=0;v<t[p].length;++v)if(v!==0||n){var b=m.shape[v],C=t[p][v];if(C!=null&&C>=0&&b!==C)throw new it("Error when checking "+i+": expected "+e[p]+" to have shape ["+t[p]+"], but got array with shape ["+m.shape+"].")}}}return u}function Hq(r,e,t){var n=ks(r.map(function(a){return a.shape[0]}));n.sort();var i=ks(e.map(function(a){return a.shape[0]}));if(i.sort(),n.length>1)throw new it("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(r.map(function(a){return a.shape})));if(i.length>1)throw new it("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(function(a){return a.shape})));if(n.length>0&&i.length>0&&!Ht.arraysEqual(n,i))throw new it("Input Tensors should have the same number of samples as target Tensors. Found "+n[0]+" input sample(s) and "+i[0]+" target sample(s).")}function qq(r,e,t){for(var n=[fl,hy,gd],i=0;i<r.length;++i){var a=r[i],o=e[i],u=t[i];if(o!=null){if(o===gd&&a.shape[a.shape.length-1]===1)throw new it("You are passing a target array of shape "+a.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(n.indexOf(o)!==-1)for(var l=a.shape.slice(1),h=u.slice(1),f=0;f<l.length;++f){var p=l[f],m=h[f];if(m!=null&&p!==m)throw new it("A target Tensor with shape "+a.shape+" was passed for an output of shape "+u+", while using a loss function that expects targets to have the same shape as the output.")}}}}function x4(r,e,t,n,i){var a;if(n===void 0&&(n=!0),i===void 0&&(i=""),Array.isArray(r)){if(r.length!==e.length)throw new it("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+e.length+" Tensor(s), but instead got "+r.length+" Tensors(s).");a=r}else{if(e.length>1)throw new it("The model expects "+e.length+" "+i+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(r.shape)+".");a=[r]}if(t!=null){for(var o=0;o<e.length;++o)if(t[o]!=null){var u=a[o];if(u.shape.length!==t[o].length)throw new it("Error when checking "+i+": expected "+e[o]+" to have "+t[o].length+" dimension(s), but got array with shape "+JSON.stringify(u.shape));for(var l=0;l<t[o].length;++l)if(l!==0||n){var h=u.shape[l],f=t[o][l];if(f!=null&&f!==h)throw new it("Error when checking "+i+": expected "+e[o]+" to have shape "+JSON.stringify(t[o])+" but got array with shape "+JSON.stringify(u.shape)+".")}}}}function Gq(r,e){if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(l){return[]});var t;if(typeof r=="string"||typeof r=="function")t=[r];else{if(!Array.isArray(r)&&typeof r!="object")throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+r);t=r}if(Array.isArray(t))return e.map(function(l){return t});for(var n=[],i=0,a=e;i<a.length;i++){var o=a[i],u=t.hasOwnProperty(o)?t[o]:[];Array.isArray(u)||(u=[u]),n.push(u)}return n}var $q="layers-model",Gu=function(r){function e(t){var n=r.call(this,t)||this;return n.isTraining=!1,n}return xt(e,r),e.prototype.summary=function(t,n,i){if(i===void 0&&(i=console.log),!this.built)throw new it("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Eq(this,t,n,i)},e.prototype.compile=function(t){var n=this;if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=Cq(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof Bo))throw new it("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var i=[];if(Array.isArray(t.loss)||typeof t.loss=="string"||typeof t.loss=="function")if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new it("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+t.loss+".");var a=t.loss;i=a.map(function(w){return J1(w)})}else{var o=J1(t.loss);this.outputs.forEach(function(w){i.push(o)})}else{for(var u in t.loss=t.loss,t.loss)if(this.outputNames.indexOf(u)===-1)throw new it('Unknown entry in loss dictionary: "'+u+'". Only expected the following keys: '+this.outputNames);for(var l=0,h=this.outputNames;l<h.length;l++){var f=h[l];t.loss[f]==null&&console.warn('Output "'+f+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+f+" during training"),i.push(J1(t.loss[f]))}}this.lossFunctions=i,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var p=0;p<this.outputs.length;++p){var m=this.internalOutputShapes[p],v=this.outputNames[p];this.feedOutputNames.push(v),this.feedOutputShapes.push(m),this.feedLossFns.push(this.lossFunctions[p])}var b=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Hu("loss",function(){for(var w=0;w<n.outputs.length;++w)if(b.indexOf(w)===-1){var E=n.lossFunctions[w];n.outputs.length>1&&(n.metricsTensors.push([E,w]),n.metricsNames.push(n.outputNames[w]+"_loss"))}});var C=Gq(t.metrics,this.outputNames);Hu("metric",function(){for(var w=function(S){if(b.indexOf(S)!==-1)return"continue";(function(A){for(var k,O,V,T=function(D){if(typeof D=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(D)!==-1){var L=n.internalOutputShapes[S];L[L.length-1]===1||n.lossFunctions[S]===hy?["accuracy","acc"].indexOf(D)!==-1?O=hC:["crossentropy","ce"].indexOf(D)!==-1&&(O=tD):n.lossFunctions[S]===jg?["accuracy","acc"].indexOf(D)!==-1?O=eD:["crossentropy","ce"].indexOf(D)!==-1&&(O=nD):["accuracy","acc"].indexOf(D)!==-1?O=fC:["crossentropy","ce"].indexOf(D)!==-1&&(O=dC);var P=void 0;["accuracy","acc"].indexOf(D)!==-1?P="acc":["crossentropy","ce"].indexOf(D)!==-1&&(P="ce"),V=O,k=""+P}else{var B=wq(D);V=B,k=""+Vm(D)}var Z;Hu(k,function(){Z=V}),function(rt,q,K){n.outputNames.length>1&&(q=n.outputNames[rt]+"_"+q),n.metricsNames.push(q),n.metricsTensors.push([K,rt])}(S,k,Z)},R=0,N=A;R<N.length;R++)T(N[R])})(C[S])},E=0;E<n.outputs.length;++E)w(E)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,n,i){i===void 0&&(i={});var a=i.batchSize==null?32:i.batchSize;h2(a);var o=this.standardizeUserDataXY(t,n,!0,a);try{var u=o[0].concat(o[1]);this.makeTestFunction();var l=this.testFunction;return Vr(this.testLoop(l,u,a,i.verbose,i.steps))}finally{ju(o[0],t),ju(o[1],n)}},e.prototype.evaluateDataset=function(t,n){return ee(this,void 0,void 0,function(){return Kt(this,function(i){return this.makeTestFunction(),[2,Bq(this,t,n)]})})},e.prototype.checkNumSamples=function(t,n,i,a){var o;if(a===void 0&&(a="steps"),i!=null){if(o=null,n!=null)throw new it("If "+a+" is set, batchSize must be null or undefined.Got batchSize = "+n)}else{if(t==null)throw new it("Either the input data should have a defined shape, or "+a+" shoud be specified.");o=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return o},e.prototype.execute=function(t,n){if(Array.isArray(n)&&n.length===0)throw new it("`outputs` is an empty Array, which is not allowed.");var i=Array.isArray(n),a=i?n:[n],o=this.retrieveSymbolicTensors(a),u=new mc;if(t instanceof Ge&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new it("The number of inputs provided ("+t.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var l=0;l<this.inputs.length;++l)u.add(this.inputs[l],t[l])}else for(var h=0,f=this.inputs;h<f.length;h++){var p=f[h],m=t[p.name];if(m==null)throw new it("No value is provided for the model's input "+p.name);u.add(p,m)}var v=Lf(o,u);return i?v:v[0]},e.prototype.retrieveSymbolicTensors=function(t){for(var n=Zu(null,t.length),i=t.length,a=0,o=this.layers;a<o.length;a++){for(var u=o[a],l=Array.isArray(u.output)?u.output:[u.output],h=l.map(function(v){return v.name}),f=0;f<t.length;++f){var p=h.indexOf(t[f]);if(p!==-1&&(n[f]=l[p],i--),i===0)break}if(i===0)break}if(i>0){var m=[];throw n.forEach(function(v,b){v==null&&m.push(t[b])}),new it("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(m))}return n},e.prototype.predictLoop=function(t,n,i){var a=this;return n===void 0&&(n=32),i===void 0&&(i=!1),ft(function(){var o=a.checkNumSamples(t);if(i)throw new pe("Verbose predictLoop() is not implemented yet.");for(var u=f2(o,n),l=a.outputs.map(function(p){return[]}),h=function(p){ft(function(){var m=u[p][0],v=u[p][1],b=Pf(t,m,v),C=[];if(Array.isArray(b))for(var w=0;w<b.length;++w)C.push({key:a.inputs[w],value:b[w]});else C.push({key:a.inputs[0],value:b});var E=new mc(C);return Lf(a.outputs,E)}).forEach(function(m,v){return l[v].push(m)})},f=0;f<u.length;++f)h(f);return Vr(l.map(function(p){return Ir(p,0)}))})},e.prototype.predict=function(t,n){n===void 0&&(n={});var i=sD(t);x4(i,this.inputNames,this.feedInputShapes,!1);try{var a=n.batchSize==null?32:n.batchSize;return h2(a),this.predictLoop(i,a)}finally{ju(i,t)}},e.prototype.predictOnBatch=function(t){x4(t,this.inputNames,this.feedInputShapes,!0);var n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)},e.prototype.standardizeUserDataXY=function(t,n,i,a){if(this.optimizer_==null)throw new Ia("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],u=0;u<this.feedOutputShapes.length;++u){var l=this.feedOutputShapes[u];this.feedLossFns[u]===jg?o.push(l.slice(0,l.length-1).concat([1])):o.push(l)}if(Hq(t=b4(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=b4(n,this.feedOutputNames,o,!1,"target")),qq(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&a!=null&&a>0&&t[0].shape[0]%a!=0)throw new it("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+a+". Found: "+t[0].shape[0]+" sample(s).");return[t,n]},e.prototype.standardizeUserData=function(t,n,i,a,o,u){return o===void 0&&(o=!0),ee(this,void 0,void 0,function(){var l,h,f,p,m,v,b,C;return Kt(this,function(w){switch(w.label){case 0:if(l=this.standardizeUserDataXY(t,n,o,u),h=l[0],f=l[1],i!=null)throw new Error("sample weight is not supported yet.");if(p=null,a==null)return[3,4];m=iD(a,this.outputNames),p=[],v=0,w.label=1;case 1:return v<m.length?(C=(b=p).push,[4,aD(f[v],null,m[v])]):[3,4];case 2:C.apply(b,[w.sent()]),w.label=3;case 3:return++v,[3,1];case 4:return[2,[h,f,p]]}})})},e.prototype.testLoop=function(t,n,i,a,o){var u=this;return a===void 0&&(a=0),ft(function(){var l=u.checkNumSamples(n,i,o,"steps"),h=[];if(a>0)throw new pe("Verbose mode is not implemented yet.");if(o!=null)throw new pe("steps mode in testLoop() is not implemented yet");for(var f=f2(l,i),p=Jr(ia(0,l)),m=0;m<f.length;++m){var v=f[m][0],b=f[m][1],C=qu(p,v,b-v),w=pC(n,C),E=t(w);if(m===0)for(var S=0;S<E.length;++S)h.push(zt(0));for(S=0;S<E.length;++S){var A=E[S];h[S]=xe(h[S],ne(b-v,A))}}for(S=0;S<h.length;++S)h[S]=kr(h[S],l);return h})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,n=[],i=0;i<t.length;++i){var a=t[i],o=a;r4(t,a)>1&&(o+="_"+r4(t.slice(0,i),a)),n.push(o)}return n},e.prototype.makeTrainFunction=function(){var t=this;return function(n){var i=[],a=n.slice(0,t.inputs.length),o=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),u=n.slice(t.inputs.length+t.outputs.length,t.inputs.length+2*t.outputs.length),l=[],h=t.collectedTrainableWeights.map(function(f){return f.read()});return[t.optimizer_.minimize(function(){for(var f=[],p=0;p<t.inputs.length;++p)f.push({key:t.inputs[p],value:a[p]});var m,v=new mc(f),b=Lf(t.outputs,v,{training:!0});for(p=0;p<t.lossFunctions.length;++p){var C=(0,t.lossFunctions[p])(o[p],b[p]);u[p]!=null&&(C=Mq(C,u[p]));var w=Nn(C);i.push(w),m=p===0?C:xe(m,C)}for(p=0;p<t.metricsTensors.length;++p){var E=void 0;if(t.outputs.length>1&&p<t.outputs.length)E=i[p];else{var S=t.metricsTensors[p][0],A=t.metricsTensors[p][1];E=Nn(S(o[A],b[A]))}za(E),l.push(E)}return m=Nn(m),t.calculateLosses().forEach(function(k){m=xe(m,k)}),m},!0,h)].concat(l)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(n){return ft(function(){for(var i,a=[],o=n.slice(0,t.inputs.length),u=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),l=[],h=0;h<t.inputs.length;++h)l.push({key:t.inputs[h],value:o[h]});var f=new mc(l),p=Lf(t.outputs,f);for(h=0;h<t.lossFunctions.length;++h){var m=t.lossFunctions[h],v=Nn(m(u[h],p[h]));i=h===0?v:xe(i,v),a.push(i)}for(h=0;h<t.metricsTensors.length;++h){var b=t.metricsTensors[h][0],C=t.metricsTensors[h][1],w=Nn(b(u[C],p[C]));a.push(w)}return a})}},e.prototype.fit=function(t,n,i){return i===void 0&&(i={}),ee(this,void 0,void 0,function(){return Kt(this,function(a){return[2,Uq(this,t,n,i)]})})},e.prototype.fitDataset=function(t,n){return ee(this,void 0,void 0,function(){return Kt(this,function(i){return[2,zq(this,t,n)]})})},e.prototype.trainOnBatch=function(t,n){return ee(this,void 0,void 0,function(){var i,a,o,u,l,h,f,p,m;return Kt(this,function(v){switch(v.label){case 0:return[4,this.standardizeUserData(t,n)];case 1:i=v.sent(),a=i[0],o=i[1],u=this.makeTrainFunction(),l=u(a.concat(o)),h=[],f=0,p=l,v.label=2;case 2:return f<p.length?[4,p[f].data()]:[3,5];case 3:m=v.sent(),h.push(m[0]),v.label=4;case 4:return f++,[3,2];case 5:return de(l),[2,Vr(h)]}})})},e.prototype.getNamedWeights=function(t){for(var n=[],i=t!=null&&t.trainableOnly,a=i?this.trainableWeights:this.weights,o=this.getWeights(i),u=0;u<a.length;++u)i&&!a[u].trainable||n.push({name:a[u].originalName,tensor:o[u]});return n},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var t=r.prototype.dispose.call(this);if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var n=Kb().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-Kb().numTensors}return t},e.prototype.getLossIdentifiers=function(){var t;if(typeof this.loss=="string")t=xo(this.loss);else if(Array.isArray(this.loss)){for(var n=0,i=this.loss;n<i.length;n++)if(typeof i[n]!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(function(f){return xo(f)})}else{var a=Object.keys(this.loss);t={};for(var o=this.loss,u=0,l=a;u<l.length;u++){var h=l[u];if(typeof o[h]!="string")throw new Error("Serialization of non-string loss is not supported.");t[h]=xo(o[h])}}return t},e.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[xo(Vm(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(i){return xo(Vm(i))});var t={};for(var n in this.metrics)t[n]=xo(Vm(this.metrics[n]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var n,i,a=ta(vd(t.optimizer_config));if(typeof t.loss=="string")n=Pu(t.loss);else if(Array.isArray(t.loss))n=t.loss.map(function(u){return Pu(u)});else if(t.loss!=null)for(var o in n={},t.loss)n[o]=Pu(t.loss[o]);if(Array.isArray(t.metrics))i=t.metrics.map(function(u){return Pu(u)});else if(t.metrics!=null)for(var o in i={},t.metrics)i[o]=Pu(t.metrics[o]);this.compile({loss:n,metrics:i,optimizer:a})},e.prototype.save=function(t,n){return ee(this,void 0,void 0,function(){var i,a,o,u,l,h,f,p,m,v,b,C,w,E;return Kt(this,function(S){switch(S.label){case 0:if(typeof t=="string"){if((i=gi.getSaveHandlers(t)).length===0)throw new it("Cannot find any save handlers for URL '"+t+"'");if(i.length>1)throw new it("Found more than one ("+i.length+") save handlers for URL '"+t+"'");t=i[0]}if(t.save==null)throw new it("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,gi.encodeWeights(this.getNamedWeights(n))];case 1:return a=S.sent(),o=!1,u=null,l=this.toJSON(u,o),h={modelTopology:l,format:$q,generatedBy:"TensorFlow.js tfjs-layers v"+fy,convertedBy:null},n!=null&&n.includeOptimizer&&this.optimizer!=null?(h.trainingConfig=this.getTrainingConfig(),f="optimizer",C=(b=gi).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,C.apply(b,[S.sent(),f])];case 3:p=S.sent(),m=p.data,v=p.specs,(E=a.specs).push.apply(E,v),a.data=gi.concatenateArrayBuffers([a.data,m]),S.label=4;case 4:return this.userDefinedMetadata!=null&&(w=!0,d4(this.userDefinedMetadata,this.name,w),h.userDefinedMetadata=this.userDefinedMetadata),h.weightData=a.data,h.weightSpecs=a.specs,[2,t.save(h)]}})})},e.prototype.setUserDefinedMetadata=function(t){d4(t,this.name),this.userDefinedMetadata=t},e.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},e.className="Model",e}(Dq);function Kq(r,e){return ee(this,void 0,void 0,function(){var t,n,i,a,o,u,l,h;return Kt(this,function(f){switch(f.label){case 0:return"modelTopology"in r||(r={modelTopology:r}),(t=(r=r).modelTopology).model_config!=null&&(t=t.model_config),n=vd(t),i=ta(n,e),r.weightsManifest==null?[3,2]:[4,gi.loadWeights(r.weightsManifest,r.pathPrefix,i.weights.map(function(p){return p.originalName}))];case 1:for(a=f.sent(),o={},u=0,l=i.weights;u<l.length;u++)h=l[u],o[h.originalName]=a[h.originalName];i.loadWeights(o),de(a),f.label=2;case 2:return[2,i]}})})}function Xq(r,e){return ee(this,void 0,void 0,function(){var t;return Kt(this,function(n){if(e==null&&(e={}),typeof r=="string"){if((t=gi.getLoadHandlers(r,e.onProgress)).length===0)t.push(gi.browserHTTPRequest(r,e));else if(t.length>1)throw new it("Found more than one ("+t.length+") load handlers for URL '"+r+"'");r=t[0]}return[2,Yq(r,void 0,e)]})})}function Yq(r,e,t){return ee(this,void 0,void 0,function(){var n,i,a,o,u,l,h,f,p;return Kt(this,function(m){switch(m.label){case 0:if(t==null&&(t={}),r.load==null)throw new it("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,r.load()];case 1:if(n=m.sent(),(i=n.modelTopology).model_config!=null&&(i=i.model_config),a=t.strict==null||t.strict,o=n.weightData!=null&&n.weightSpecs!=null&&a,u=ta(vd(i),e,o),(l=n.trainingConfig)!=null&&u.loadTrainingConfig(l),n.userDefinedMetadata!=null&&u.setUserDefinedMetadata(n.userDefinedMetadata),n.weightData==null)return[3,4];if(n.weightSpecs==null)throw new it("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return h=Qq(n.weightData,n.weightSpecs),f=h.modelWeights,p=h.optimizerWeights,u.loadWeights(f,a),u.optimizer!=null&&p.length>0?[4,u.optimizer.setWeights(p)]:[3,3];case 2:m.sent(),m.label=3;case 3:de(f),de(p.map(function(v){return v.tensor})),m.label=4;case 4:return[2,u]}})})}function Qq(r,e){var t=gi.decodeWeights(r,e),n={},i=[];return e.forEach(function(a){a.group==="optimizer"?i.push({name:a.name,tensor:t[a.name]}):n[a.name]=t[a.name]}),{modelWeights:n,optimizerWeights:i}}At.registerClass(Gu);var mC=function(r){function e(t){var n=r.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},n.trainable=!0,n.built=!1,n.name=t.name!=null?t.name:uy("sequential_"),t.layers!=null)for(var i=0,a=t.layers;i<a.length;i++){var o=a[i];n.add(o)}return n}return xt(e,r),e.prototype.checkShape=function(t){if(t.inboundNodes[0].outputTensors[0].shape.some(function(n){return n<0}))throw new it("Negative dimension size caused by adding layer "+t.name+" with input shape ["+t.inboundNodes[0].inputTensors[0].shape+"]")},e.prototype.add=function(t){var n,i=t instanceof e||t instanceof Gu;if(i){if((n=t).outputs.length!==1)throw new it("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(n.inputs.length!==1)throw new it("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new it("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=H5({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(a)}if(i)this.outputs=n.outputs,this.inputs=n.inputs;else{if(t.inboundNodes.length!==1)throw new it("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+t.name+" which has "+t.inboundNodes.length+" pre-existing inbound connections.");if(t.inboundNodes[0].outputTensors.length!==1)throw new it("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=W5(this.outputs[0])}this.inboundNodes=[],new ly({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Zu(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(u){return u.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,n){return this.model==null&&this.build(),this.model.call(t,n)},e.prototype.build=function(t){if(tn(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Gu({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),r.prototype.countParams.call(this)},e.prototype.summary=function(t,n,i){i===void 0&&(i=console.log),this.built||this.build(),r.prototype.summary.call(this,t,n,i)},e.prototype.setWeights=function(t){this.model==null&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,n,i){if(i===void 0&&(i={}),!this.built)throw new Ia("The model needs to be compiled before being used.");return this.model.evaluate(t,n,i)},e.prototype.evaluateDataset=function(t,n){return ee(this,void 0,void 0,function(){return Kt(this,function(i){if(!this.built)throw new Ia("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,n)]})})},e.prototype.predict=function(t,n){return n===void 0&&(n={}),this.model==null&&this.build(),this.model.predict(t,n)},e.prototype.predictOnBatch=function(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!0,configurable:!0}),e.prototype.fit=function(t,n,i){return i===void 0&&(i={}),ee(this,void 0,void 0,function(){return Kt(this,function(a){if(!this.built)throw new Ia("The model needs to be compiled before being used.");return[2,this.model.fit(t,n,i)]})})},e.prototype.fitDataset=function(t,n){return ee(this,void 0,void 0,function(){return Kt(this,function(i){if(!this.built)throw new Ia("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,n)]})})},e.prototype.trainOnBatch=function(t,n){return ee(this,void 0,void 0,function(){return Kt(this,function(i){return[2,this.model.trainOnBatch(t,n)]})})},e.fromConfig=function(t,n,i,a){var o;a===void 0&&(a=!1);var u={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new it("Legacy serialization format not supported yet.");o=n}else Ht.assert(n.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),o=n.layers,delete n.layers,u=n;var l=new t(u);if(!(l instanceof e))throw new pe("Sequential.fromConfig called on non-Sequential input: "+l);for(var h=0,f=o;h<f.length;h++){var p=ta(f[h],void 0,a);a&&p.setFastWeightInitDuringBuild(!0),l.add(p)}return l},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(this.model==null)throw new it("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(this.model==null)throw new it("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){for(var t=[],n=0,i=this.layers;n<i.length;n++){var a=i[n],o={};o.className=a.getClassName(),o.config=a.getConfig(),t.push(o)}return{name:this.name,layers:t}},e.className="Sequential",e}(Gu);function Zq(r){return new Gu(r)}function Jq(r){return new mC(r)}function tG(r,e){return e==null&&(e={}),Xq(r,e)}function uD(r){return H5(r)}function eG(r,e){Y5.registerCallbackConstructor(r,e)}At.registerClass(mC);var Ci=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.getConfig=function(){return{}},e}(At.Serializable),nG=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t,n){return n===void 0&&(n=1),TH(t,n)},e.className="elu",e}(Ci);At.registerClass(nG);var rG=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t){return ey(t)},e.className="selu",e}(Ci);At.registerClass(rG);var iG=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t){return Xs(t)},e.className="relu",e}(Ci);At.registerClass(iG);var aG=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t){return ft(function(){return ih(6,Xs(t))})},e.className="relu6",e}(Ci);At.registerClass(aG);var oG=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t){return t},e.className="linear",e}(Ci);At.registerClass(oG);var sG=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t){return Mv(t)},e.className="sigmoid",e}(Ci);At.registerClass(sG);var uG=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t){return AH(t)},e.className="hardSigmoid",e}(Ci);At.registerClass(uG);var lG=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t){return Pd(t)},e.className="softplus",e}(Ci);At.registerClass(lG);var cG=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t){return SH(t)},e.className="softsign",e}(Ci);At.registerClass(cG);var hG=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t){return Lv(t)},e.className="tanh",e}(Ci);At.registerClass(hG);var lD=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t,n){return n===void 0&&(n=-1),ul(t,n)},e.className="softmax",e}(Ci);At.registerClass(lD);var fG=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.apply=function(t,n){return n===void 0&&(n=-1),Iv(t,n)},e.className="logSoftmax",e}(Ci);function xi(r){return r.getClassName()}function eb(r,e){return e===void 0&&(e={}),Gd(r,At.SerializationMap.getMap().classNameMap,e,"activation")}function Ws(r){var e;return r==null?eb(e={className:"linear",config:{}}):typeof r=="string"?((e={}).className=r,e.config={},eb(e)):r instanceof Ci?r:eb(r)}function gC(r){if(r!=null&&typeof r!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+r)}At.registerClass(fG);var cD=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e}(At.Serializable),dy=function(r){function e(t){var n=r.call(this)||this;return gC(t),n.l1=t==null||t.l1==null?.01:t.l1,n.l2=t==null||t.l2==null?.01:t.l2,n.hasL1=n.l1!==0,n.hasL2=n.l2!==0,n}return xt(e,r),e.prototype.apply=function(t){var n=this;return ft(function(){var i=Ue([1]);return n.hasL1&&(i=xe(i,ti(ne(n.l1,Bs(t))))),n.hasL2&&(i=xe(i,ti(ne(n.l2,Yd(t))))),i.asScalar()})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,n){return new t({l1:n.l1,l2:n.l2})},e.className="L1L2",e}(cD);function dG(r){return gC(r),new dy({l1:r!=null?r.l1:null,l2:0})}function pG(r){return gC(r),new dy({l2:r!=null?r.l2:null,l1:0})}At.registerClass(dy);var w4={l1l2:"L1L2"};function me(r){return Jw(r)}function C4(r,e){return e===void 0&&(e={}),Gd(r,At.SerializationMap.getMap().classNameMap,e,"regularizer")}function sn(r){return r==null?null:typeof r=="string"?C4({className:r in w4?w4[r]:r,config:{}}):r instanceof cD?r:C4(r)}var hD=function(r){function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null&&(n.maxValue=t.maxValue),n}return xt(e,r),e.prototype.call=function(t,n){t=ue(t);var i=Xs(t);return this.maxValue!=null&&(i=Ur(i,0,this.maxValue)),i},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={maxValue:this.maxValue},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="ReLU",e}(Se);At.registerClass(hD);var fD=function(r){function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_ALPHA=.3,t==null&&(t={}),n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return xt(e,r),e.prototype.call=function(t,n){var i=ue(t);return Jv(i,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="LeakyReLU",e}(Se);At.registerClass(fD);var dD=function(r){function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),n.supportsMasking=!0,n.alphaInitializer=on(t.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=sn(t.alphaRegularizer),n.alphaConstraint=Fn(t.alphaConstraint),t.sharedAxes==null)n.sharedAxes=null;else if(Array.isArray(t.sharedAxes))n.sharedAxes=t.sharedAxes;else{if(typeof t.sharedAxes!="number")throw new it("Expected sharedAxes to be a number or an array of numbers, but got "+t.sharedAxes);n.sharedAxes=[t.sharedAxes]}return n}return xt(e,r),e.prototype.build=function(t){var n=(t=tn(t)).slice(1);if(this.sharedAxes!=null)for(var i=0,a=this.sharedAxes;i<a.length;i++)n[(u=a[i])-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var o={};if(this.sharedAxes!=null)for(var u=1;u<t.length;++u)o[u]=t[u];this.inputSpec=[new ar({ndim:t.length,axes:o})],this.built=!0},e.prototype.call=function(t,n){return t=ue(t),ty(t,this.alpha.read())},e.prototype.getConfig=function(){var t={alphaInitializer:Pe(this.alphaInitializer),alphaRegularizer:me(this.alphaRegularizer),alphaConstraint:$e(this.alphaConstraint),sharedAxes:this.sharedAxes},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="PReLU",e}(Se);At.registerClass(dD);var pD=function(r){function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==n.DEFAULT_ALPHA)throw new pe("Non-default alpha value ("+t.alpha+") is not supported by the ELU layer yet.");return n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return xt(e,r),e.prototype.call=function(t,n){var i=ue(t);return uh(i)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="ELU",e}(Se);At.registerClass(pD);var mD=function(r){function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_THETA=1,t==null&&(t={}),n.theta=t.theta==null?n.DEFAULT_THETA:t.theta,n}return xt(e,r),e.prototype.call=function(t,n){var i=ue(t);return i.mul(Kd(i.greater(this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={theta:this.theta},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="ThresholdedReLU",e}(Se);At.registerClass(mD);var gD=function(r){function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_AXIS=1,t==null&&(t={}),n.softmax=new lD().apply,n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n}return xt(e,r),e.prototype.call=function(t,n){var i=ue(t);return this.softmax(i,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="Softmax",e}(Se);function nb(r,e,t){if(typeof r=="number")return Zu(r,e);if(r.length!==e)throw new it("The "+t+" argument must be an integer or tuple of "+e+" integers. Received: "+r.length+" elements.");for(var n=0;n<e;++n){var i=r[n];if(!wH(i))throw new it("The "+t+" argument must be an integer or tuple of "+e+" integers. Received: "+JSON.stringify(r)+" including a non-integer number "+i)}return r}function Ao(r,e,t,n,i){return i===void 0&&(i=1),r==null?r:(a=t==="same"?r:r-(e+(e-1)*(i-1))+1,Math.floor((a+n-1)/n));var a}function Fm(r,e,t,n){if(r==null)return null;if(n==="valid")r=r*e+Us([t-e,0]);else{if(n!=="same")throw new it("Unsupport padding mode: "+n+".");r*=e}return r}function vC(r,e){return ft(function(){return jn(e),e==="channelsFirst"?fn(r,[0,2,3,1]):r})}function vD(r,e){return ft(function(){return jn(e),e==="channelsFirst"?fn(r,[0,2,3,4,1]):r})}function mG(r,e,t,n,i,a,o){return n===void 0&&(n=1),i===void 0&&(i="valid"),o===void 0&&(o=1),ft(function(){if(a==null&&(a=ra()),jn(a),r.shape.length!==3)throw new it("The input of a conv1dWithBias operation should be 3, but is "+r.shape.length+" instead.");if(e.shape.length!==3)throw new it("The kernel for a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead");if(t!=null&&t.shape.length!==1)throw new it("The bias for a conv1dWithBias operation should be 1, but is "+e.shape.length+" instead");if(a==="channelsFirst"&&(r=fn(r,[0,2,1])),i==="causal")throw new pe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var u=jv(r,e,n,i==="same"?"same":"valid","NWC",o);return t!=null&&(u=jo(u,t)),u})}function E4(r,e,t,n,i,a,o,u){return n===void 0&&(n=[1,1]),i===void 0&&(i="valid"),u===void 0&&(u=null),ft(function(){if(a==null&&(a=ra()),jn(a),r.rank!==3&&r.rank!==4)throw new it("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received "+r.rank+".");if(e.rank!==3&&e.rank!==4)throw new it("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received "+r.rank+".");var l=vC(r,a);if(i==="causal")throw new pe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=zc.conv2d({x:l,filter:e,strides:n,pad:i==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:u}),a==="channelsFirst"&&(l=fn(l,[0,3,1,2])),l})}function gG(r,e,t,n,i,a,o){return n===void 0&&(n=[1,1,1]),i===void 0&&(i="valid"),ft(function(){if(a==null&&(a=ra()),jn(a),r.rank!==4&&r.rank!==5)throw new it("conv3dWithBias expects input to be of rank 4 or 5, but received "+r.rank+".");if(e.rank!==4&&e.rank!==5)throw new it("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+r.rank+".");var u=vD(r,a);if(i==="causal")throw new pe("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return u=Uv(u,e,n,i==="same"?"same":"valid","NDHWC",o),t!=null&&(u=jo(u,t)),a==="channelsFirst"&&(u=fn(u,[0,4,1,2,3])),u})}At.registerClass(gD);var yD=function(r){function e(t,n){var i=r.call(this,n)||this;if(i.bias=null,i.DEFAULT_KERNEL_INITIALIZER="glorotNormal",i.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(n),i.rank=t,Wr(i.rank,"rank"),i.rank!==1&&i.rank!==2&&i.rank!==3)throw new pe("Convolution layer for rank other than 1, 2, or 3 ("+i.rank+") is not implemented yet.");if(i.kernelSize=nb(n.kernelSize,t,"kernelSize"),i.strides=nb(n.strides==null?1:n.strides,t,"strides"),i.padding=n.padding==null?"valid":n.padding,Vi(i.padding),i.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,jn(i.dataFormat),i.activation=Ws(n.activation),i.useBias=n.useBias==null||n.useBias,i.biasInitializer=on(n.biasInitializer||i.DEFAULT_BIAS_INITIALIZER),i.biasConstraint=Fn(n.biasConstraint),i.biasRegularizer=sn(n.biasRegularizer),i.activityRegularizer=sn(n.activityRegularizer),i.dilationRate=nb(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),i.rank===1&&Array.isArray(i.dilationRate)&&i.dilationRate.length!==1)throw new it("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(i.dilationRate));if(i.rank===2){if(typeof i.dilationRate=="number")i.dilationRate=[i.dilationRate,i.dilationRate];else if(i.dilationRate.length!==2)throw new it("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(i.dilationRate))}else if(i.rank===3){if(typeof i.dilationRate=="number")i.dilationRate=[i.dilationRate,i.dilationRate,i.dilationRate];else if(i.dilationRate.length!==3)throw new it("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(i.dilationRate))}return i}return xt(e,r),e.verifyArgs=function(t){if(Ra("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!tC(t.kernelSize,"number",1,3))throw new it("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(t.kernelSize)+".")},e.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:xi(this.activation),useBias:this.useBias,biasInitializer:Pe(this.biasInitializer),biasRegularizer:me(this.biasRegularizer),activityRegularizer:me(this.activityRegularizer),biasConstraint:$e(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Se),py=function(r){function e(t,n){var i=r.call(this,t,n)||this;return i.kernel=null,e.verifyArgs(n),i.filters=n.filters,Wr(i.filters,"filters"),i.kernelInitializer=on(n.kernelInitializer||i.DEFAULT_KERNEL_INITIALIZER),i.kernelConstraint=Fn(n.kernelConstraint),i.kernelRegularizer=sn(n.kernelRegularizer),i}return xt(e,r),e.prototype.build=function(t){var n;t=tn(t);var i=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[i]==null)throw new it("The channel dimension of the input should be defined. Found "+t[i]);var a=t[i],o=this.kernelSize.concat([a,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[i]=a,n)}],this.built=!0},e.prototype.call=function(t,n){var i=this;return ft(function(){var a;t=ue(t);var o=i.bias==null?null:i.bias.read(),u=w5(i.activation.getClassName());if(u!=null&&i.rank===2)a=E4(t,i.kernel.read(),o,i.strides,i.padding,i.dataFormat,i.dilationRate,u);else{if(i.rank===1)a=mG(t,i.kernel.read(),o,i.strides[0],i.padding,i.dataFormat,i.dilationRate[0]);else if(i.rank===2)a=E4(t,i.kernel.read(),o,i.strides,i.padding,i.dataFormat,i.dilationRate);else{if(i.rank!==3)throw new pe("convolutions greater than 3D are not implemented yet.");a=gG(t,i.kernel.read(),o,i.strides,i.padding,i.dataFormat,i.dilationRate)}i.activation!=null&&(a=i.activation.apply(a))}return a})},e.prototype.computeOutputShape=function(t){t=tn(t);for(var n=[],i=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2),a=0;a<i.length;++a){var o=Ao(i[a],this.kernelSize[a],this.padding,this.strides[a],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[a]);n.push(o)}var u=[t[0]];return this.dataFormat==="channelsLast"?(u=u.concat(n)).push(this.filters):(u.push(this.filters),u=u.concat(n)),u},e.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:Pe(this.kernelInitializer),kernelRegularizer:me(this.kernelRegularizer),kernelConstraint:$e(this.kernelConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.verifyArgs=function(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new it("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(t.filters))},e}(yD),yC=function(r){function e(t){var n=r.call(this,2,t)||this;return e.verifyArgs(t),n}return xt(e,r),e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!tC(t.kernelSize,"number",1,2))throw new it("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv2D",e}(py);At.registerClass(yC);var bD=function(r){function e(t){var n=r.call(this,3,t)||this;return e.verifyArgs(t),n}return xt(e,r),e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&(!Array.isArray(t.kernelSize)||t.kernelSize.length!==1&&t.kernelSize.length!==3))throw new it("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv3D",e}(py);At.registerClass(bD);var xD=function(r){function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new ar({ndim:4})],n.padding!=="same"&&n.padding!=="valid")throw new it("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return xt(e,r),e.prototype.build=function(t){var n;if((t=tn(t)).length!==4)throw new it("Input should have rank 4; Received input shape: "+JSON.stringify(t));var i=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[i]==null)throw new it("The channel dimension of the inputs should be defined. Found `None`.");var a=t[i],o=this.kernelSize.concat([this.filters,a]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ar({ndim:4,axes:(n={},n[i]=a,n)})],this.built=!0},e.prototype.call=function(t,n){var i=this;return ft(function(){var a=ue(t);if(a.shape.length!==4)throw new it("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+a.shape.length);var o,u,l=a.shape,h=l[0];i.dataFormat==="channelsFirst"?(o=2,u=3):(o=1,u=2);var f=l[o],p=l[u],m=i.kernelSize[0],v=i.kernelSize[1],b=i.strides[0],C=i.strides[1],w=[h,Fm(f,b,m,i.padding),Fm(p,C,v,i.padding),i.filters];i.dataFormat!=="channelsLast"&&(a=fn(a,[0,2,3,1]));var E=Wv(a,i.kernel.read(),w,i.strides,i.padding);return i.dataFormat!=="channelsLast"&&(E=fn(E,[0,3,1,2])),i.bias!=null&&(E=jo(E,i.bias.read(),i.dataFormat)),i.activation!=null&&(E=i.activation.apply(E)),E})},e.prototype.computeOutputShape=function(t){var n,i,a,o=(t=tn(t)).slice();this.dataFormat==="channelsFirst"?(n=1,i=2,a=3):(n=3,i=1,a=2);var u=this.kernelSize[0],l=this.kernelSize[1],h=this.strides[0],f=this.strides[1];return o[n]=this.filters,o[i]=Fm(o[i],h,u,this.padding),o[a]=Fm(o[a],f,l,this.padding),o},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e.className="Conv2DTranspose",e}(yC);At.registerClass(xD);var vG=function(r){function e(t,n){var i=r.call(this,t,n)||this;if(i.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",i.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",i.depthwiseKernel=null,i.pointwiseKernel=null,n.filters==null)throw new it("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new it("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new it("SeparableConv"+i.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return i.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,i.depthwiseInitializer=on(n.depthwiseInitializer||i.DEFAULT_DEPTHWISE_INITIALIZER),i.depthwiseRegularizer=sn(n.depthwiseRegularizer),i.depthwiseConstraint=Fn(n.depthwiseConstraint),i.pointwiseInitializer=on(n.depthwiseInitializer||i.DEFAULT_POINTWISE_INITIALIZER),i.pointwiseRegularizer=sn(n.pointwiseRegularizer),i.pointwiseConstraint=Fn(n.pointwiseConstraint),i}return xt(e,r),e.prototype.build=function(t){var n;if((t=tn(t)).length<this.rank+2)throw new it("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(t));var i=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[i]==null||t[i]<0)throw new it("The channel dimension of the inputs should be defined, but found "+JSON.stringify(t[i]));for(var a=t[i],o=this.kernelSize.concat([a,this.depthMultiplier]),u=[],l=0;l<this.rank;++l)u.push(1);u.push(a*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",u,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new ar({ndim:this.rank+2,axes:(n={},n[i]=a,n)})],this.built=!0},e.prototype.call=function(t,n){var i=this;return ft(function(){var a;if(t=ue(t),i.rank===1)throw new pe("1D separable convolution is not implemented yet.");return i.rank===2&&(i.dataFormat==="channelsFirst"&&(t=fn(t,[0,2,3,1])),a=Nw(t,i.depthwiseKernel.read(),i.pointwiseKernel.read(),i.strides,i.padding,i.dilationRate,"NHWC")),i.useBias&&(a=jo(a,i.bias.read(),i.dataFormat)),i.activation!=null&&(a=i.activation.apply(a)),i.dataFormat==="channelsFirst"&&(a=fn(a,[0,3,1,2])),a})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=Pe(this.depthwiseInitializer),t.pointwiseInitializer=Pe(this.pointwiseInitializer),t.depthwiseRegularizer=me(this.depthwiseRegularizer),t.pointwiseRegularizer=me(this.pointwiseRegularizer),t.depthwiseConstraint=$e(this.depthwiseConstraint),t.pointwiseConstraint=$e(this.pointwiseConstraint),t},e.className="SeparableConv",e}(py),wD=function(r){function e(t){return r.call(this,2,t)||this}return xt(e,r),e.className="SeparableConv2D",e}(vG);At.registerClass(wD);var CD=function(r){function e(t){var n=r.call(this,1,t)||this;return e.verifyArgs(t),n.inputSpec=[{ndim:3}],n}return xt(e,r),e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!tC(t.kernelSize,"number",1,1))throw new it("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv1D",e}(py);At.registerClass(CD);var ED=function(r){function e(t){var n=r.call(this,t)||this;return typeof t.cropping=="number"?n.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?n.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:n.cropping=t.cropping,n.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return xt(e,r),e.prototype.computeOutputShape=function(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,n){var i=this;return ft(function(){return t=ue(t),i.dataFormat==="channelsLast"?Pm(Pm(t,i.cropping[0][0],t.shape[1]-i.cropping[0][0]-i.cropping[0][1],2),i.cropping[1][0],t.shape[2]-i.cropping[1][1]-i.cropping[1][0],3):Pm(Pm(t,i.cropping[0][0],t.shape[2]-i.cropping[0][0]-i.cropping[0][1],3),i.cropping[1][0],t.shape[3]-i.cropping[1][1]-i.cropping[1][0],4)})},e.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="Cropping2D",e}(Se);At.registerClass(ED);var _D=function(r){function e(t){var n=r.call(this,t)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=t.size==null?n.DEFAULT_SIZE:t.size,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,n}return xt(e,r),e.prototype.computeOutputShape=function(t){if(this.dataFormat==="channelsFirst"){var n=t[2]==null?null:this.size[0]*t[2],i=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,i]}return n=t[1]==null?null:this.size[0]*t[1],i=t[2]==null?null:this.size[1]*t[2],[t[0],n,i,t[3]]},e.prototype.call=function(t,n){var i=this;return ft(function(){var a=ue(t),o=a.shape;if(i.dataFormat==="channelsFirst"){a=fn(a,[0,2,3,1]);var u=i.size[0]*o[2],l=i.size[1]*o[3],h=a.resizeNearestNeighbor([u,l]);return fn(h,[0,3,1,2])}return u=i.size[0]*o[1],l=i.size[1]*o[2],a.resizeNearestNeighbor([u,l])})},e.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="UpSampling2D",e}(Se);function yG(r,e,t,n,i,a){return t===void 0&&(t=[1,1]),n===void 0&&(n="valid"),ft(function(){i==null&&(i=ra()),jn(i);var o=vC(r,i);if(r.rank!==4)throw new it("Input for depthwiseConv2d is required to be 4-D, but is instead "+r.rank+"-D");if(e.rank!==4)throw new it("depthwiseKernel is required to be 4-D, but is instead "+e.rank+"-D");return o=sh(o,e,t,n==="same"?"same":"valid","NHWC",a),i==="channelsFirst"&&(o=fn(o,[0,3,1,2])),o})}At.registerClass(_D);var TD=function(r){function e(t){var n=r.call(this,2,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,n.depthwiseInitializer=on(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=Fn(t.depthwiseConstraint),n.depthwiseRegularizer=sn(t.depthwiseRegularizer),n}return xt(e,r),e.prototype.build=function(t){if((t=tn(t)).length<4)throw new it("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(t)+".");var n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new it("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+t[n]+").");var i=t[n],a=[this.kernelSize[0],this.kernelSize[1],i,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",a,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[i*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var i=this;return ft(function(){var a=yG(t=ue(t),i.depthwiseKernel.read(),i.strides,i.padding,i.dataFormat,null);return i.useBias&&(a=jo(a,i.bias.read(),i.dataFormat)),i.activation!=null&&(a=i.activation.apply(a)),a})},e.prototype.computeOutputShape=function(t){t=tn(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],i=this.dataFormat==="channelsFirst"?t[3]:t[2],a=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=Ao(n,this.kernelSize[0],this.padding,this.strides[0]),u=Ao(i,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],a,o,u]:[t[0],o,u,a]},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=Pe(this.depthwiseInitializer),t.depthwiseRegularizer=me(this.depthwiseRegularizer),t.depthwiseConstraint=$e(this.depthwiseRegularizer),t},e.className="DepthwiseConv2D",e}(yD);At.registerClass(TD);var SD=function(r){function e(t){var n=r.call(this,t)||this;return n.rate=Math.max(Math.min(t.rate,1),0),n.noiseShape=t.noiseShape,n.seed=t.seed,n.supportsMasking=!0,n}return xt(e,r),e.prototype.getNoiseShape=function(t){if(this.noiseShape==null)return this.noiseShape;for(var n=t.shape,i=[],a=0;a<this.noiseShape.length;++a)i.push(this.noiseShape[a]==null?n[a]:this.noiseShape[a]);return i},e.prototype.call=function(t,n){var i=this;return ft(function(){i.invokeCallHook(t,n);var a=ue(t);if(0<i.rate&&i.rate<1){var o=n.training!=null&&n.training,u=i.getNoiseShape(a);return Fc(function(){return O5(a,i.rate,u,i.seed)},function(){return a},o)}return t})},e.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.dispose=function(){return r.prototype.dispose.call(this)},e.className="Dropout",e}(Se);At.registerClass(SD);var AD=function(r){function e(t){var n=r.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){var i=null;t.batchSize!=null&&(i=t.batchSize),n.batchInputShape=[i,t.inputDim]}return n.units=t.units,Wr(n.units,"units"),n.activation=Ws(t.activation),t.useBias!=null&&(n.useBias=t.useBias),n.kernelInitializer=on(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=on(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=Fn(t.kernelConstraint),n.biasConstraint=Fn(t.biasConstraint),n.kernelRegularizer=sn(t.kernelRegularizer),n.biasRegularizer=sn(t.biasRegularizer),n.activityRegularizer=sn(t.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return xt(e,r),e.prototype.build=function(t){var n,i=(t=tn(t))[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[i,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(n={},n[-1]=i,n)}],this.built=!0},e.prototype.computeOutputShape=function(t){var n=(t=tn(t)).slice();return n[n.length-1]=this.units,n},e.prototype.call=function(t,n){var i=this;return ft(function(){i.invokeCallHook(t,n);var a,o=ue(t),u=w5(i.activation.getClassName());return u!=null?a=So(o,i.kernel.read(),u,i.bias?i.bias.read():null):(a=So(o,i.kernel.read()),i.bias!=null&&(a=jo(a,i.bias.read())),i.activation!=null&&(a=i.activation.apply(a))),a})},e.prototype.getConfig=function(){var t={units:this.units,activation:xi(this.activation),useBias:this.useBias,kernelInitializer:Pe(this.kernelInitializer),biasInitializer:Pe(this.biasInitializer),kernelRegularizer:me(this.kernelRegularizer),biasRegularizer:me(this.biasRegularizer),activityRegularizer:me(this.activityRegularizer),kernelConstraint:$e(this.kernelConstraint),biasConstraint:$e(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="Dense",e}(Se);At.registerClass(AD);var RD=function(r){function e(t){var n=r.call(this,t||{})||this;return n.inputSpec=[{minNDim:3}],n}return xt(e,r),e.prototype.computeOutputShape=function(t){for(var n=0,i=(t=tn(t)).slice(1);n<i.length;n++)if(i[n]==null)throw new it('The shape of the input to "Flatten" is not fully defined (got '+t.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[t[0],Ds(t,1)]},e.prototype.call=function(t,n){var i=this;return ft(function(){return i.invokeCallHook(t,n),_H(ue(t))})},e.className="Flatten",e}(Se);At.registerClass(RD);var ND=function(r){function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.activation=Ws(t.activation),n}return xt(e,r),e.prototype.call=function(t,n){var i=this;return ft(function(){i.invokeCallHook(t,n);var a=ue(t);return i.activation.apply(a)})},e.prototype.getConfig=function(){var t={activation:xi(this.activation)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="Activation",e}(Se);At.registerClass(ND);var ID=function(r){function e(t){var n=r.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return xt(e,r),e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,n){var i=this;return ft(function(){return CH(t=ue(t),i.n)})},e.prototype.getConfig=function(){var t={n:this.n},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="RepeatVector",e}(Se);At.registerClass(ID);var kD=function(r){function e(t){var n=r.call(this,t)||this;n.targetShape=t.targetShape;for(var i=0;i<n.targetShape.length;++i)n.isUnknown(n.targetShape[i])&&(n.targetShape[i]=null);return n}return xt(e,r),e.prototype.isUnknown=function(t){return t<0||t==null},e.prototype.fixUnknownDimension=function(t,n){for(var i="Total size of new array must be unchanged.",a=n.slice(),o=1,u=null,l=0;l<a.length;++l){var h=a[l];if(this.isUnknown(h)){if(u!==null)throw new it("Can only specifiy one unknown dimension.");u=l}else o*=h}var f=Ds(t);if(u!==null){if(o===0||f%o!=0)throw new it(i);a[u]=f/o}else if(f!==o)throw new it(i);return a},e.prototype.computeOutputShape=function(t){for(var n=!1,i=0;i<t.length;++i)if(this.isUnknown(t[i])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,n){var i=this;return ft(function(){i.invokeCallHook(t,n);var a=ue(t),o=a.shape,u=o.slice(0,1).concat(i.fixUnknownDimension(o.slice(1),i.targetShape));return a.reshape(u)})},e.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="Reshape",e}(Se);At.registerClass(kD);var DD=function(r){function e(t){var n=r.call(this,t)||this;if(t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+t.dims+" instead.");var i=ia(1,t.dims.length+1);if(!Ht.arraysEqual(t.dims.slice().sort(),i))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=t.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new ar({ndim:n.dims.length+1})],n}return xt(e,r),e.prototype.computeOutputShape=function(t){var n=(t=tn(t)).slice();return this.dims.forEach(function(i,a){n[a+1]=t[i]}),n},e.prototype.call=function(t,n){return fn(ue(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var t={dims:this.dims},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="Permute",e}(Se);At.registerClass(DD);var OD=function(r){function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,n.maskValue=t!=null?t.maskValue==null?0:t.maskValue:0,n}return xt(e,r),e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,t),n},e.prototype.computeMask=function(t,n){var i=ue(t);return pd(Mc(i,this.maskValue),-1)},e.prototype.call=function(t,n){var i=this;return ft(function(){i.invokeCallHook(t,n);var a=ue(t),o=pd(Mc(a,i.maskValue),-1,!0);return a.mul(o.asType(a.dtype))})},e.className="Masking",e}(Se);At.registerClass(OD);var MD=function(r){function e(t){var n=r.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){var i=null;t.batchSize!=null&&(i=t.batchSize),t.inputLength==null?n.batchInputShape=[i,null]:n.batchInputShape=[i].concat(nn(t.inputLength))}return n.inputDim=t.inputDim,Wr(n.inputDim,"inputDim"),n.outputDim=t.outputDim,Wr(n.outputDim,"outputDim"),n.embeddingsInitializer=on(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=sn(t.embeddingsRegularizer),n.activityRegularizer=sn(t.activityRegularizer),n.embeddingsConstraint=Fn(t.embeddingsConstraint),n.maskZero=t.maskZero,n.supportsMasking=t.maskZero,n.inputLength=t.inputLength,n}return xt(e,r),e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,n){var i=this;return ft(function(){return i.maskZero?(t=ue(t),Mc(t,Te(t))):null})},e.prototype.computeOutputShape=function(t){if(t=tn(t),this.inputLength==null)return t.concat([this.outputDim]);var n=nn(this.inputLength);if(n.length!==t.length-1)throw new it('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);for(var i=0,a=0;a<n.length;++a){var o=n[a],u=t[a+1];if(o!=null&&u!=null&&o!==u)throw new it('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);o==null&&(n[i]=u),i++}return[t[0]].concat(n,[this.outputDim])},e.prototype.call=function(t,n){var i=this;return ft(function(){i.invokeCallHook(t,n);var a=ue(t);return a.dtype!=="int32"&&(a=Kd(a,"int32")),D5(i.embeddings.read(),a.as1D()).reshape(tn(i.computeOutputShape(a.shape)))})},e.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Pe(this.embeddingsInitializer),embeddingsRegularizer:me(this.embeddingsRegularizer),activityRegularizer:me(this.activityRegularizer),embeddingsConstraint:$e(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="Embedding",e}(Se);At.registerClass(MD);var dl=function(r){function e(t){var n=r.call(this,t||{})||this;return n.supportsMasking=!0,n}return xt(e,r),e.prototype.mergeFunction=function(t){throw new pe},e.prototype.computeElementwiseOpOutputShape=function(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;for(var i=t.slice(0,t.length-n.length),a=0;a<n.length;++a){var o=t[t.length-n.length+a],u=n[a];if(o==null||u==null||o<0||u<0)i.push(null);else if(o===1)i.push(u);else if(u===1)i.push(o);else{if(o!==u)throw new it("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));i.push(o)}}return i},e.prototype.build=function(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[tn(t)]),(t=t).length<2)throw new it("A merge layer should be called on an Array of at least 2 inputs. Got "+t.length+" input(s).");for(var n=[],i=0,a=t;i<a.length;i++)(l=a[i])!=null&&l[0]!==null&&n.push(l[0]);if((n=ks(n)).length>1)throw new it("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(t)+".");for(var o=t[0]==null?null:t[0].slice(1),u=1;u<t.length;++u){var l=t[u]==null?null:t[u].slice(1);o=this.computeElementwiseOpOutputShape(o,l)}var h=t.map(function(f){return f.length});t.indexOf(null)===-1&&ks(h).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,n){var i=this;return ft(function(){if(t=t,i.reshapeRequired){var a=[],o=t.map(function(R){return R.rank});if(o.indexOf(null)===-1){for(var u=Us(o),l=0,h=t;l<h.length;l++){for(var f=(C=h[l]).rank,p=0;p<u-f;++p)C=Xd(C,1);a.push(C)}return i.mergeFunction(a)}for(var m=!1,v=0,b=t;v<b.length;v++){var C;if((f=(C=b[v]).rank)==null){var w=C.shape,E=w[0],S=w.slice(1).concat([E]),A=C.reshape([E].concat(Ds(w.slice(1))));A=(A=fn(A,[1,0])).reshape(S),a.push(A),m=!0}else if(f>1){var k=ia(1,f).concat([0]);a.push(fn(C,k)),m=!0}else a.push(C)}var O=i.mergeFunction(a),V=O.rank;if(m)if(V==null){var T=O.shape;S=[E=T[T.length-1]].concat(T.slice(0,T.length-1)),O=fn(O.reshape([-1,E]),[1,0]).reshape(S)}else V>1&&(k=[V-1].concat(ia(0,V-1)),O=fn(O,k));return O}return i.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var n;n=(t=t)[0]==null?null:t[0].slice(1);for(var i=1;i<t.length;++i){var a=t[i]==null?null:t[i].slice(1);n=this.computeElementwiseOpOutputShape(n,a)}for(var o=[],u=0,l=t;u<l.length;u++)(a=l[u])!=null&&a[0]!==null&&o.push(a[0]);return n=(o=ks(o)).length===1?o.concat(n):[null].concat(n)},e.prototype.computeMask=function(t,n){return ft(function(){if(n==null)return null;if(!Array.isArray(n))throw new it("`mask` should be an Array");if(!Array.isArray(t))throw new it("`inputs` should be an Array");if(n.length!==t.length)throw new it("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+t.length+" vs "+n.length+")");if(n.every(function(o){return o==null}))return null;for(var i=(n=n.map(function(o){return o==null?o:fi(o,0)}))[0],a=1;a<n.length-1;++a)i=Vo(i,n[a]);return i})},e}(Se),LD=function(r){function e(t){return r.call(this,t)||this}return xt(e,r),e.prototype.mergeFunction=function(t){return ft(function(){for(var n=t[0].clone(),i=1;i<t.length;++i)n=xe(n,t[i]);return n})},e.className="Add",e}(dl);At.registerClass(LD);var PD=function(r){function e(t){return r.call(this,t)||this}return xt(e,r),e.prototype.mergeFunction=function(t){return ft(function(){for(var n=t[0].clone(),i=1;i<t.length;++i)n=ne(n,t[i]);return n})},e.className="Multiply",e}(dl);At.registerClass(PD);var zD=function(r){function e(t){return r.call(this,t)||this}return xt(e,r),e.prototype.mergeFunction=function(t){return ft(function(){for(var n=t[0].clone(),i=1;i<t.length;++i)n=xe(n,t[i]);return ne(1/t.length,n)})},e.className="Average",e}(dl);At.registerClass(zD);var VD=function(r){function e(t){return r.call(this,t)||this}return xt(e,r),e.prototype.mergeFunction=function(t){return ft(function(){for(var n=t[0],i=1;i<t.length;++i)n=Ha(n,t[i]);return n})},e.className="Maximum",e}(dl);At.registerClass(VD);var FD=function(r){function e(t){return r.call(this,t)||this}return xt(e,r),e.prototype.mergeFunction=function(t){return ft(function(){for(var n=t[0],i=1;i<t.length;++i)n=ih(n,t[i]);return n})},e.className="Minimum",e}(dl);At.registerClass(FD);var BD=function(r){function e(t){var n=r.call(this,t)||this;return n.DEFAULT_AXIS=-1,t==null&&(t={}),n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return xt(e,r),e.prototype.build=function(t){if(!Array.isArray(t)||!Array.isArray(t[0])||t.length===1)throw new it("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var n=!0,i=0,a=t=t;i<a.length;i++)if((m=a[i])!=null){n=!1;break}if(!n){for(var o=[],u=0;u<t.length;++u){var l=t[u].slice();l.splice(this.axis,1);for(var h=!1,f=0,p=o;f<p.length;f++){var m=p[f];if(Ht.arraysEqual(m,l)){h=!0;break}}h||o.push(l)}if(o.length>1)throw new it("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var n=this;return ft(function(){return k5(t,n.axis)})},e.prototype.computeOutputShape=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new it("A `Concatenate` layer should be called on a list of inputs.");for(var n=t,i=n[0].slice(),a=this.axis<0?i.length+this.axis:this.axis,o=0,u=n.slice(1);o<u.length;o++){var l=u[o];if(i[a]==null||l[a]==null){i[a]=null;break}i[a]+=l[a]}return i},e.prototype.computeMask=function(t,n){var i=this;if(n==null)return null;if(!Array.isArray(n))throw new it("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new it("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new it("Mismatch in the length of mask ("+n.length+") and the legnth of inputs ("+t.length+")");return ft(function(){var a=!0;if(n.forEach(function(h){h==null||(a=!1)}),a)return null;for(var o=[],u=0;u<t.length;++u)n[u]==null?o.push(yi(t[u]).asType("bool")):n[u].rank<t[u].rank?o.push(fi(n[u],-1)):o.push(n[u]);var l=Ir(o,i.axis);return Yv(l,-1,!1)})},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="Concatenate",e}(dl);function Tf(r,e){for(;r<0;)r+=e;return r}function bG(r,e,t){if(r.shape.length>3||e.shape.length>3)throw new pe("batchDot is not implemented for tensors of 4D or higher rank yet");if(Ht.assert(r.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, but got "+r.shape.length}),Ht.assert(r.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, but got "+e.shape.length}),typeof t=="number"&&(t=[t,t]),r.dtype==="complex64"||e.dtype==="complex64")throw new pe("batchDot is not implemented for complex64-type Tensors yet.");var n=r.shape.length,i=e.shape.length;t==null&&(t=[n-1,i-2]);var a=t;return ft(function(){var o,u;if(n>i){o=n-i;for(var l=[],h=0;h<o;++h)l.push(1);e=e.reshape(e.shape.concat(l))}else if(i>n){for(o=i-n,l=[],h=0;h<o;++h)l.push(1);r=r.reshape(r.shape.concat(l))}else o=0;if(r.shape.length===2&&e.shape.length===2)u=a[0]===a[1]?r.mulStrict(e).sum(a[0]):r.transpose([1,0]).mulStrict(e).sum(a[1]);else{var f=a[0]!==r.shape.length-1,p=a[1]===e.shape.length-1;u=r.matMul(e,f,p)}if(o>0){var m=void 0,v=[];for(h=m=n>i?n+i-3:n-1;h<m+o;++h)v.push(h);u=u.squeeze(v)}return u.shape.length===1&&(u=u.expandDims(1)),u})}At.registerClass(BD);var jD=function(r){function e(t){var n=r.call(this,t)||this;return n.axes=t.axes,n.normalize=t.normalize!=null&&t.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return xt(e,r),e.prototype.build=function(t){Ht.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0],i=t[1];if(n.length>3||i.length>3)throw new pe("Dot layer does not support tensors of 4D or higher rank yet.");var a=this.interpretAxes(n,i);if(n[a[0]]!==i[a[1]])throw new it("Dimension incompatibility: "+n[a[0]]+" !== "+i[a[1]])},e.prototype.mergeFunction=function(t){if(t.length!==2)throw new it("A `Dot` layer must be called on exactly 2 inputs, but received "+t.length+" input(s).");var n,i=t[0],a=t[1];return n=Array.isArray(this.axes)?this.axes.map(function(o,u){return Tf(o,t[u].shape.length)}):[Tf(this.axes,i.shape.length),Tf(this.axes,a.shape.length)],this.normalize&&(i=Bg(i,n[0]),a=Bg(a,n[1])),bG(i,a,n)},e.prototype.interpretAxes=function(t,n){return Array.isArray(this.axes)?this.axes:[Tf(this.axes,t.length),Tf(this.axes,n.length)]},e.prototype.computeOutputShape=function(t){Ht.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0].slice(),i=t[1].slice();if(n.length>3||i.length>3)throw new pe("Dot layer does not support tensors of 4D or higher rank yet.");var a=this.interpretAxes(n,i);n.splice(a[0],1),i.splice(a[1],1),i.splice(0,1);var o=n.concat(i);return o.length===1&&o.push(1),o},e.prototype.computeMask=function(t,n){return null},e.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="Dot",e}(dl);At.registerClass(jD);var UD=function(r){function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.stddev=t.stddev,n}return xt(e,r),e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,t),n},e.prototype.call=function(t,n){var i=this;return ft(function(){i.invokeCallHook(t,n);var a=ue(t);return Fc(function(){return sy(a.shape,0,i.stddev).add(a)},function(){return a},n.training||!1)})},e.className="GaussianNoise",e}(Se);At.registerClass(UD);var WD=function(r){function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n}return xt(e,r),e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var i=this;return ft(function(){i.invokeCallHook(t,n);var a=ue(t);return i.rate>0&&i.rate<1?Fc(function(){var o=Math.sqrt(i.rate/(1-i.rate));return a.mul(sy(a.shape,1,o))},function(){return a},n.training||!1):a})},e.className="GaussianDropout",e}(Se);At.registerClass(WD);var HD=function(r){function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n.noiseShape=t.noiseShape,n}return xt(e,r),e.prototype._getNoiseShape=function(t){return this.noiseShape||ue(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var i=this;return ft(function(){if(i.rate<1&&i.rate>0){var a=i._getNoiseShape(t);return Fc(function(){var o=ue(t),u=-1.7580993408473766,l=Fd(sl(a),i.rate);l=Kd(l,"float32");var h=Math.pow((1-i.rate)*(1+i.rate*Math.pow(u,2)),-.5),f=-h*u*i.rate;return o.mul(l).add(l.add(-1).mul(u)).mul(h).add(f)},function(){return ue(t)},n.training||!1)}return t})},e.className="AlphaDropout",e}(Se);function yd(r,e,t,n,i,a){var o;if(a===void 0&&(a=.001),r.rank===2)o=vw(r,e,t,n,i,a);else if(r.rank===3)o=yw(r,e,t,n,i,a);else{if(r.rank!==4)throw new pe("batchNormalization is not implemented for array of rank "+r.rank+" yet");o=bw(r,e,t,n,i,a)}return o}function xG(r,e,t,n,i){return i===void 0&&(i=.001),ft(function(){var a=Ud(r,n),o=a.mean,u=a.variance;return[yd(r,o,u,t,e,i),o,u]})}function wG(r,e,t,n,i){return i===void 0&&(i=.001),ft(function(){for(var a=Ud(r,n),o=a.mean,u=a.variance,l=[],h=0,f=ia(0,r.rank);h<f.length;h++){var p=f[h];n.indexOf(p)!==-1?l.push(1):l.push(r.shape[p])}var m=o.reshape(l),v=u.reshape(l),b=e==null?null:e.reshape(l),C=t==null?null:t.reshape(l);return[yd(r,m,v,C,b,i),o,u]})}function CG(r,e,t,n,i){return i===void 0&&(i=.001),Ht.arraysEqual(n.slice().sort(),ia(0,r.rank-1))?xG(r,e,t,n,i):wG(r,e,t,n,i)}At.registerClass(HD);var qD=function(r){function e(t){var n=this;return t==null&&(t={}),(n=r.call(this,t)||this).supportsMasking=!0,n.axis=t.axis==null?-1:t.axis,n.momentum=t.momentum==null?.99:t.momentum,n.epsilon=t.epsilon==null?.001:t.epsilon,n.center=t.center==null||t.center,n.scale=t.scale==null||t.scale,n.betaInitializer=on(t.betaInitializer||"zeros"),n.gammaInitializer=on(t.gammaInitializer||"ones"),n.movingMeanInitializer=on(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=on(t.movingVarianceInitializer||"ones"),n.betaConstraint=Fn(t.betaConstraint),n.gammaConstraint=Fn(t.gammaConstraint),n.betaRegularizer=sn(t.betaRegularizer),n.gammaRegularizer=sn(t.gammaRegularizer),n}return xt(e,r),e.prototype.build=function(t){var n;t=tn(t);var i=this.axis>=0?this.axis:this.axis+t.length,a=t[i];if(a==null)throw new it("Axis "+i+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(t)+".");this.inputSpec=[new ar({ndim:t.length,axes:(n={},n[i]=a,n)})];var o=[a];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,n){var i=this;return ft(function(){var a=n.training!=null&&n.training,o=ue(t),u=o.shape,l=u.length,h=ia(0,l),f=i.axis>=0?i.axis:i.axis+l;h.splice(f,1);var p=Zu(1,l);p[f]=u[f];var m=h.slice();m.sort();var v=!Ht.arraysEqual(m,ia(0,l).slice(0,l-1));if(!a)return function(){if(v){var A=i.movingMean.read().reshape(p),k=i.movingVariance.read().reshape(p),O=i.center?i.beta.read().reshape(p):null,V=i.scale?i.gamma.read().reshape(p):null;return yd(o,A,k,O,V,i.epsilon)}return yd(o,i.movingMean.read(),i.movingVariance.read(),i.beta==null?null:i.beta.read(),i.gamma==null?null:i.gamma.read(),i.epsilon)}();var b=CG(o,i.gamma.read(),i.beta.read(),h,i.epsilon),C=b[0],w=b[1],E=b[2],S=function(A,k,O){ft(function(){var V=1-O,T=A.read(),R=T.sub(k).mul(V);A.write(T.sub(R))})};return S(i.movingMean,w,i.momentum),S(i.movingVariance,E,i.momentum),C})},e.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Pe(this.betaInitializer),gammaInitializer:Pe(this.gammaInitializer),movingMeanInitializer:Pe(this.movingMeanInitializer),movingVarianceInitializer:Pe(this.movingVarianceInitializer),betaRegularizer:me(this.betaRegularizer),gammaRegularizer:me(this.gammaRegularizer),betaConstraint:$e(this.betaConstraint),gammaConstraint:$e(this.gammaConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="BatchNormalization",e}(Se);At.registerClass(qD);var GD=function(r){function e(t){var n=this;if(t==null&&(t={}),(n=r.call(this,t)||this).axis=t.axis==null?-1:t.axis,typeof n.axis=="number"){if(!Number.isInteger(n.axis))throw new Error("Expected axis to be an integer, but received "+n.axis)}else{if(!Array.isArray(n.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(n.axis));for(var i=0,a=n.axis;i<a.length;i++){var o=a[i];if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(n.axis))}}return n.epsilon=t.epsilon==null?.001:t.epsilon,n.center=t.center==null||t.center,n.scale=t.scale==null||t.scale,n.betaInitializer=on(t.betaInitializer||"zeros"),n.gammaInitializer=on(t.gammaInitializer||"ones"),n.betaRegularizer=sn(t.betaRegularizer),n.gammaRegularizer=sn(t.gammaRegularizer),n.supportsMasking=!0,n}return xt(e,r),e.prototype.build=function(t){var n=(t=tn(t)).length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=n);for(var a=0,o=this.axis;a<o.length;a++){var u=o[a];if(u<0||u>=n)throw new Error("Invalid axis: "+u)}if(this.axis.length!==ks(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var l=this.axis.map(function(h){return t[h]});this.scale?this.gamma=this.addWeight("gamma",l,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",l,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0},e.prototype.call=function(t,n){var i=this,a=ue(t),o=a.shape,u=o.length;return ft(function(){for(var l=Ud(a,i.axis,!0),h=l.mean,f=l.variance,p=Zu(1,u),m=0,v=i.axis;m<v.length;m++){var b=v[m];p[b]=o[b]}for(var C=function(O){return O!=null&&O.shape.length!==u&&i.axis!==[u-1]?O.reshape(p):O},w=C(i.gamma.read()),E=C(i.beta.read()),S=[],A=[],k=0;k<u;++k)i.axis.indexOf(k)!==-1?(S.push(o[k]),A.push(1)):(S.push(1),A.push(o[k]));return h=h.tile(S),f=f.tile(S),w=w.tile(A),E=E.tile(A),yd(a,h,f,E,w,i.epsilon)})},e.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Pe(this.betaInitializer),gammaInitializer:Pe(this.gammaInitializer),betaRegularizer:me(this.betaRegularizer),gammaRegularizer:me(this.gammaRegularizer)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="LayerNormalization",e}(Se);function EG(r,e,t){return ft(function(){if(r.rank!==4)throw new it("temporalPadding expects input tensor to be 4-D, but received a "+r.rank+"-D tensor.");if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new it("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=ra()),t!=="channelsLast"&&t!=="channelsFirst")throw new it("Unknown data format: "+t+". Supported data formats are 'channelsLast' and 'channelsFirst.");var n;return n=t==="channelsFirst"?[[0,0],[0,0],e[0],e[1]]:[[0,0],e[0],e[1],[0,0]],$s(r,n)})}At.registerClass(GD);var $D=function(r){function e(t){var n=this;if(t==null&&(t={}),(n=r.call(this,t)||this).dataFormat=t.dataFormat==null?ra():t.dataFormat,t.padding==null)n.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new it("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+t.padding.length+" array.");var i=void 0,a=void 0;if(typeof t.padding[0]=="number")i=[t.padding[0],t.padding[0]],a=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new it("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+t.padding[0].length+" array.");if(i=t.padding[0],t.padding[1].length!==2)throw new it("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+t.padding[1].length+" array.");a=t.padding[1]}n.padding=[i,a]}return n.inputSpec=[new ar({ndim:4})],n}return xt(e,r),e.prototype.computeOutputShape=function(t){var n,i;return t=tn(t),this.dataFormat==="channelsFirst"?(n=t[2]!=null&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,i=t[3]!=null&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],n,i]):(n=t[1]!=null&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,i=t[2]!=null&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],n,i,t[3]])},e.prototype.call=function(t,n){var i=this;return ft(function(){return EG(ue(t),i.padding,i.dataFormat)})},e.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="ZeroPadding2D",e}(Se);function my(r,e,t,n,i,a){return ft(function(){var o;jn(i),S5(a),Vi(n),t==null&&(t=[1,1]),n==null&&(n="valid"),i==null&&(i=ra()),a==null&&(a="max"),r=vC(r,i);var u=n==="same"?"same":"valid";return o=a==="max"?qv(r,e,t,u):Gv(r,e,t,u),i==="channelsFirst"&&(o=fn(o,[0,3,1,2])),o})}function KD(r,e,t,n,i,a){return ft(function(){var o;jn(i),S5(a),Vi(n),t==null&&(t=[1,1,1]),n==null&&(n="valid"),i==null&&(i=ra()),a==null&&(a="max"),r=vD(r,i);var u=n==="same"?"same":"valid";return o=a==="max"?$v(r,e,t,u):Kv(r,e,t,u),i==="channelsFirst"&&(o=fn(o,[0,4,1,2,3])),o})}At.registerClass($D);var XD=function(r){function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=2),n=r.call(this,t)||this,typeof t.poolSize=="number")n.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||t.poolSize.length!==1||typeof t.poolSize[0]!="number")throw new it("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.poolSize));n.poolSize=t.poolSize}if(Wr(n.poolSize,"poolSize"),t.strides==null)n.strides=n.poolSize;else if(typeof t.strides=="number")n.strides=[t.strides];else{if(!Array.isArray(t.strides)||t.strides.length!==1||typeof t.strides[0]!="number")throw new it("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.strides));n.strides=t.strides}return Wr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,Vi(n.padding),n.inputSpec=[new ar({ndim:3})],n}return xt(e,r),e.prototype.computeOutputShape=function(t){var n=Ao((t=tn(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]},e.prototype.call=function(t,n){var i=this;return ft(function(){i.invokeCallHook(t,n),t=Xd(ue(t),2);var a=i.poolingFunction(ue(t),[i.poolSize[0],1],[i.strides[0],1],i.padding,"channelsLast");return Od(a,[2])})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Se),YD=function(r){function e(t){return r.call(this,t)||this}return xt(e,r),e.prototype.poolingFunction=function(t,n,i,a,o){return jn(o),Vi(a),my(t,n,i,a,o,"max")},e.className="MaxPooling1D",e}(XD);At.registerClass(YD);var QD=function(r){function e(t){return r.call(this,t)||this}return xt(e,r),e.prototype.poolingFunction=function(t,n,i,a,o){return jn(o),Vi(a),my(t,n,i,a,o,"avg")},e.className="AveragePooling1D",e}(XD);At.registerClass(QD);var ZD=function(r){function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2]),(n=r.call(this,t)||this).poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new it("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+t.strides.length+".");n.strides=t.strides}else n.strides=[t.strides,t.strides];return Wr(n.poolSize,"poolSize"),Wr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,jn(n.dataFormat),Vi(n.padding),n.inputSpec=[new ar({ndim:4})],n}return xt(e,r),e.prototype.computeOutputShape=function(t){t=tn(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],i=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=Ao(n,this.poolSize[0],this.padding,this.strides[0]),i=Ao(i,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,i]:[t[0],n,i,t[3]]},e.prototype.call=function(t,n){var i=this;return ft(function(){return i.invokeCallHook(t,n),i.poolingFunction(ue(t),i.poolSize,i.strides,i.padding,i.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Se),JD=function(r){function e(t){return r.call(this,t)||this}return xt(e,r),e.prototype.poolingFunction=function(t,n,i,a,o){return jn(o),Vi(a),my(t,n,i,a,o,"max")},e.className="MaxPooling2D",e}(ZD);At.registerClass(JD);var t6=function(r){function e(t){return r.call(this,t)||this}return xt(e,r),e.prototype.poolingFunction=function(t,n,i,a,o){return jn(o),Vi(a),my(t,n,i,a,o,"avg")},e.className="AveragePooling2D",e}(ZD);At.registerClass(t6);var e6=function(r){function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2,2]),(n=r.call(this,t)||this).poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new it("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+t.strides.length+".");n.strides=t.strides}else n.strides=[t.strides,t.strides,t.strides];return Wr(n.poolSize,"poolSize"),Wr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,jn(n.dataFormat),Vi(n.padding),n.inputSpec=[new ar({ndim:5})],n}return xt(e,r),e.prototype.computeOutputShape=function(t){t=tn(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],i=this.dataFormat==="channelsFirst"?t[3]:t[2],a=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=Ao(n,this.poolSize[0],this.padding,this.strides[0]),i=Ao(i,this.poolSize[1],this.padding,this.strides[1]),a=Ao(a,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,i,a]:[t[0],n,i,a,t[4]]},e.prototype.call=function(t,n){var i=this;return ft(function(){return i.invokeCallHook(t,n),i.poolingFunction(ue(t),i.poolSize,i.strides,i.padding,i.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Se),n6=function(r){function e(t){return r.call(this,t)||this}return xt(e,r),e.prototype.poolingFunction=function(t,n,i,a,o){return jn(o),Vi(a),KD(t,n,i,a,o,"max")},e.className="MaxPooling3D",e}(e6);At.registerClass(n6);var r6=function(r){function e(t){return r.call(this,t)||this}return xt(e,r),e.prototype.poolingFunction=function(t,n,i,a,o){return jn(o),Vi(a),KD(t,n,i,a,o,"avg")},e.className="AveragePooling3D",e}(e6);At.registerClass(r6);var i6=function(r){function e(t){var n=r.call(this,t)||this;return n.inputSpec=[new ar({ndim:3})],n}return xt(e,r),e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,n){throw new pe},e}(Se),a6=function(r){function e(t){return r.call(this,t||{})||this}return xt(e,r),e.prototype.call=function(t,n){return ft(function(){var i=ue(t);return Nn(i,1)})},e.className="GlobalAveragePooling1D",e}(i6);At.registerClass(a6);var o6=function(r){function e(t){return r.call(this,t||{})||this}return xt(e,r),e.prototype.call=function(t,n){return ft(function(){var i=ue(t);return js(i,1)})},e.className="GlobalMaxPooling1D",e}(i6);At.registerClass(o6);var s6=function(r){function e(t){var n=r.call(this,t)||this;return n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,jn(n.dataFormat),n.inputSpec=[new ar({ndim:4})],n}return xt(e,r),e.prototype.computeOutputShape=function(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,n){throw new pe},e.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Se),u6=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.call=function(t,n){var i=this;return ft(function(){var a=ue(t);return i.dataFormat==="channelsLast"?Nn(a,[1,2]):Nn(a,[2,3])})},e.className="GlobalAveragePooling2D",e}(s6);At.registerClass(u6);var l6=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e.prototype.call=function(t,n){var i=this;return ft(function(){var a=ue(t);return i.dataFormat==="channelsLast"?js(a,[1,2]):js(a,[2,3])})},e.className="GlobalMaxPooling2D",e}(s6);function c6(r,e,t,n){if(Array.isArray(r)){if(e!=null||t!=null)throw new it("When inputs is an array, neither initialState or constants should be provided");n!=null&&(t=r.slice(r.length-n,r.length),r=r.slice(0,r.length-n)),r.length>1&&(e=r.slice(1,r.length)),r=r[0]}function i(a){return a==null||Array.isArray(a)?a:[a]}return{inputs:r,initialState:e=i(e),constants:t=i(t)}}function h6(r,e,t,n,i,a,o,u){return n===void 0&&(n=!1),o===void 0&&(o=!1),u===void 0&&(u=!1),ft(function(){var l=e.shape.length;if(l<3)throw new it("Input should be at least 3D, but is "+l+"D.");var h=[1,0].concat(ia(2,l));e=fn(e,h),a!=null,o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&((i=i.asType("bool").asType("float32")).rank===l-1&&(i=fi(i,-1)),i=fn(i,h)),n&&(e=Fa(e,0),i!=null&&(i=Fa(i,0)));var f,p,m=[],v=t,b=e.shape[0],C=Yu(e);i!=null&&(p=Yu(i));for(var w,E=function(A){var k=C[A],O=ft(function(){return r(k,v)});if(i==null)f=O[0],v=O[1];else{var V=ft(function(){var T=p[A],R=yi(T).sub(T);return{output:O[0].mul(T).addStrict(v[0].mul(R)),newStates:v.map(function(N,D){return O[1][D].mul(T).addStrict(N.mul(R))})}});f=V.output,v=V.newStates}u&&m.push(f)},S=0;S<b;++S)E(S);return u&&(w=na(m,1)),[f,w,v]})}At.registerClass(l6);var pl=function(r){function e(t){var n,i=r.call(this,t)||this;if(t.cell==null)throw new it("cell property is missing for the constructor of RNN.");if((n=Array.isArray(t.cell)?new CC({cells:t.cell}):t.cell).stateSize==null)throw new it("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return i.cell=n,i.returnSequences=t.returnSequences!=null&&t.returnSequences,i.returnState=t.returnState!=null&&t.returnState,i.goBackwards=t.goBackwards!=null&&t.goBackwards,i._stateful=t.stateful!=null&&t.stateful,i.unroll=t.unroll!=null&&t.unroll,i.supportsMasking=!0,i.inputSpec=[new ar({ndim:3})],i.stateSpec=null,i.states_=null,i.numConstants=null,i.keptStates=[],i}return xt(e,r),e.prototype.getStates=function(){return this.states_==null?ia(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(t){return null}):this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){s2(t)&&(t=t[0]),t=t;var n=this.cell.stateSize;Array.isArray(n)||(n=[n]);var i,a=n[0];if(i=this.returnSequences?[t[0],t[1],a]:[t[0],a],this.returnState){for(var o=[],u=0,l=n;u<l.length;u++){var h=l[u];o.push([t[0],h])}return[i].concat(o)}return i},e.prototype.computeMask=function(t,n){var i=this;return ft(function(){Array.isArray(n)&&(n=n[0]);var a=i.returnSequences?n:null;if(i.returnState){var o=i.states.map(function(u){return null});return[a].concat(o)}return a})},Object.defineProperty(e.prototype,"states",{get:function(){if(this.states_==null){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[],i=0;i<t;++i)n.push(null);return n}return this.states_},set:function(t){this.states_=t},enumerable:!0,configurable:!0}),e.prototype.build=function(t){if(this.numConstants!=null)throw new pe("Constants support is not implemented in RNN yet.");s2(t)&&(t=t[0]),t=t;var n=this.stateful?t[0]:null,i=t[t.length-1];this.inputSpec[0]=new ar({shape:[n,null,i]});var a,o=[t[0]].concat(t.slice(2));if(this.cell.build(o),a=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],this.stateSpec!=null){if(!Ht.arraysEqual(this.stateSpec.map(function(u){return u.shape[u.shape.length-1]}),a))throw new it("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=a.map(function(u){return new ar({shape:[null,u]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,n){var i=this;n===void 0&&(n=!1),ft(function(){if(!i.stateful)throw new Mu("Cannot call resetStates() on an RNN Layer that is not stateful.");var a=i.inputSpec[0].shape[0];if(a==null)throw new it("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(i.states_==null)Array.isArray(i.cell.stateSize)?i.states_=i.cell.stateSize.map(function(f){return Ue([a,f])}):i.states_=[Ue([a,i.cell.stateSize])];else if(t==null)de(i.states_),i.keptStates!=null&&(de(i.keptStates),i.keptStates=[]),Array.isArray(i.cell.stateSize)?i.states_=i.cell.stateSize.map(function(f){return Ue([a,f])}):i.states_[0]=Ue([a,i.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==i.states_.length)throw new it("Layer "+i.name+" expects "+i.states_.length+" state(s), but it received "+t.length+" state value(s). Input received: "+t);n===!0?i.keptStates.push(i.states_.slice()):de(i.states_);for(var o=0;o<i.states_.length;++o){var u=t[o],l=Array.isArray(i.cell.stateSize)?i.cell.stateSize[o]:i.cell.stateSize,h=[a,l];if(!Ht.arraysEqual(u.shape,h))throw new it("State "+o+" is incompatible with layer "+i.name+": expected shape="+h+", received shape="+u.shape);i.states_[o]=u}}i.states_=i.states_.map(function(f){return za(f.clone())})})},e.prototype.apply=function(t,n){var i=n==null?null:n.initialState,a=n==null?null:n.constants;n==null&&(n={});var o=c6(t,i,a,this.numConstants);t=o.inputs,i=o.initialState,a=o.constants;var u=[],l=[];if(i!=null){n.initialState=i,u=u.concat(i),this.stateSpec=[];for(var h=0,f=i;h<f.length;h++){var p=f[h];this.stateSpec.push(new ar({shape:p.shape}))}l=l.concat(this.stateSpec)}if(a!=null&&(n.constants=a,u=u.concat(a),this.numConstants=a.length),u[0]instanceof Ji){var m=[t].concat(u),v=this.inputSpec.concat(l),b=this.inputSpec;this.inputSpec=v;var C=r.prototype.apply.call(this,m,n);return this.inputSpec=b,C}return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var i=this;return ft(function(){var a=n==null?null:n.mask,o=n==null?null:n.training,u=n==null?null:n.initialState;t=ue(t),u==null&&(u=i.stateful?i.states_:i.getInitialState(t));var l=Array.isArray(i.cell.stateSize)?i.cell.stateSize.length:1;if(u.length!==l)throw new it("RNN Layer has "+l+" state(s) but was passed "+u.length+" initial state(s).");i.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var h={training:o},f=h6(function(C,w){var E=i.cell.call([C].concat(w),h);return[E[0],E.slice(1)]},t,u,i.goBackwards,a,null,i.unroll,i.returnSequences),p=f[0],m=f[1],v=f[2];i.stateful&&i.resetStates(v,o);var b=i.returnSequences?m:p;return i.returnState?[b].concat(v):b})},e.prototype.getInitialState=function(t){var n=this;return ft(function(){var i=Ue(t.shape);return i=Xd(i=ti(i,[1,2])),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(a){return a>1?a2(i,[1,a]):i}):n.cell.stateSize>1?[a2(i,[1,n.cell.stateSize])]:[i]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);var n=this.cell.getConfig();t.cell={className:this.cell.getClassName(),config:n};var i=r.prototype.getConfig.call(this);return Object.assign(t,i),t},e.fromConfig=function(t,n,i){i===void 0&&(i={});var a=ta(n.cell,i);return new t(Object.assign(n,{cell:a}))},e.className="RNN",e}(Se);At.registerClass(pl);var Zd=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return xt(e,r),e}(Se),bC=function(r){function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,Wr(n.units,"units"),n.activation=Ws(t.activation==null?n.DEFAULT_ACTIVATION:t.activation),n.useBias=t.useBias==null||t.useBias,n.kernelInitializer=on(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=on(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=on(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=sn(t.kernelRegularizer),n.recurrentRegularizer=sn(t.recurrentRegularizer),n.biasRegularizer=sn(t.biasRegularizer),n.kernelConstraint=Fn(t.kernelConstraint),n.recurrentConstraint=Fn(t.recurrentConstraint),n.biasConstraint=Fn(t.biasConstraint),n.dropout=Vc([1,Us([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=Vc([1,Us([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return xt(e,r),e.prototype.build=function(t){t=tn(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var i=this;return ft(function(){if((t=t).length!==2)throw new it("SimpleRNNCell expects 2 input Tensors, got "+t.length+".");var a=t[1];t=t[0];var o,u=n.training!=null&&n.training;0<i.dropout&&i.dropout<1&&i.dropoutMask==null&&(i.dropoutMask=jc(function(){return yi(t)},i.dropout,u)),0<i.recurrentDropout&&i.recurrentDropout<1&&i.recurrentDropoutMask==null&&(i.recurrentDropoutMask=jc(function(){return yi(a)},i.recurrentDropout,u));var l=i.dropoutMask,h=i.recurrentDropoutMask;o=So(l!=null?ne(t,l):t,i.kernel.read()),i.bias!=null&&(o=jo(o,i.bias.read())),h!=null&&(a=ne(a,h));var f=xe(o,So(a,i.recurrentKernel.read()));return i.activation!=null&&(f=i.activation.apply(f)),[f,f]})},e.prototype.getConfig=function(){var t={units:this.units,activation:xi(this.activation),useBias:this.useBias,kernelInitializer:Pe(this.kernelInitializer),recurrentInitializer:Pe(this.recurrentInitializer),biasInitializer:Pe(this.biasInitializer),kernelRegularizer:me(this.kernelRegularizer),recurrentRegularizer:me(this.recurrentRegularizer),biasRegularizer:me(this.biasRegularizer),activityRegularizer:me(this.activityRegularizer),kernelConstraint:$e(this.kernelConstraint),recurrentConstraint:$e(this.recurrentConstraint),biasConstraint:$e(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="SimpleRNNCell",e}(Zd);At.registerClass(bC);var f6=function(r){function e(t){return t.cell=new bC(t),r.call(this,t)||this}return xt(e,r),e.prototype.call=function(t,n){var i=this;return ft(function(){i.cell.dropoutMask!=null&&(de(i.cell.dropoutMask),i.cell.dropoutMask=null),i.cell.recurrentDropoutMask!=null&&(de(i.cell.recurrentDropoutMask),i.cell.recurrentDropoutMask=null);var a=n==null?null:n.mask,o=n==null?null:n.training,u=n==null?null:n.initialState;return r.prototype.call.call(i,t,{mask:a,training:o,initialState:u})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var t={units:this.units,activation:xi(this.activation),useBias:this.useBias,kernelInitializer:Pe(this.kernelInitializer),recurrentInitializer:Pe(this.recurrentInitializer),biasInitializer:Pe(this.biasInitializer),kernelRegularizer:me(this.kernelRegularizer),recurrentRegularizer:me(this.recurrentRegularizer),biasRegularizer:me(this.biasRegularizer),activityRegularizer:me(this.activityRegularizer),kernelConstraint:$e(this.kernelConstraint),recurrentConstraint:$e(this.recurrentConstraint),biasConstraint:$e(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=r.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},e.fromConfig=function(t,n){return new t(n)},e.className="SimpleRNN",e}(pl);At.registerClass(f6);var xC=function(r){function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,Wr(n.units,"units"),n.activation=Ws(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=Ws(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null||t.useBias,n.kernelInitializer=on(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=on(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=on(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=sn(t.kernelRegularizer),n.recurrentRegularizer=sn(t.recurrentRegularizer),n.biasRegularizer=sn(t.biasRegularizer),n.kernelConstraint=Fn(t.kernelConstraint),n.recurrentConstraint=Fn(t.recurrentConstraint),n.biasConstraint=Fn(t.biasConstraint),n.dropout=Vc([1,Us([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=Vc([1,Us([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return xt(e,r),e.prototype.build=function(t){var n=(t=tn(t))[t.length-1];this.kernel=this.addWeight("kernel",[n,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var i=this;return ft(function(){if((t=t).length!==2)throw new it("GRUCell expects 2 input Tensors (inputs, h, c), got "+t.length+".");var a=n.training!=null&&n.training,o=t[1];t=t[0],0<i.dropout&&i.dropout<1&&i.dropoutMask==null&&(i.dropoutMask=jc(function(){return yi(t)},i.dropout,a,3)),0<i.recurrentDropout&&i.recurrentDropout<1&&i.recurrentDropoutMask==null&&(i.recurrentDropoutMask=jc(function(){return yi(o)},i.recurrentDropout,a,3));var u,l,h,f=i.dropoutMask,p=i.recurrentDropoutMask;0<i.dropout&&i.dropout<1&&(t=ne(t,f[0]));var m=So(t,i.kernel.read());i.useBias&&(m=jo(m,i.bias.read())),0<i.recurrentDropout&&i.recurrentDropout<1&&(o=ne(o,p[0]));var v=i.recurrentKernel.read(),b=To(v,[2*i.units,i.units],v.rank-1),C=b[0],w=b[1],E=So(o,C),S=To(m,3,m.rank-1),A=S[0],k=S[1],O=S[2],V=To(E,2,E.rank-1),T=V[0],R=V[1];u=i.recurrentActivation.apply(xe(A,T)),l=i.recurrentActivation.apply(xe(k,R));var N=So(ne(l,o),w);h=i.activation.apply(xe(O,N));var D=xe(ne(u,o),ne(xe(1,ll(u)),h));return[D,D]})},e.prototype.getConfig=function(){var t={units:this.units,activation:xi(this.activation),recurrentActivation:xi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pe(this.kernelInitializer),recurrentInitializer:Pe(this.recurrentInitializer),biasInitializer:Pe(this.biasInitializer),kernelRegularizer:me(this.kernelRegularizer),recurrentRegularizer:me(this.recurrentRegularizer),biasRegularizer:me(this.biasRegularizer),activityRegularizer:me(this.activityRegularizer),kernelConstraint:$e(this.kernelConstraint),recurrentConstraint:$e(this.recurrentConstraint),biasConstraint:$e(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="GRUCell",e}(Zd);At.registerClass(xC);var d6=function(r){function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new xC(t),r.call(this,t)||this}return xt(e,r),e.prototype.call=function(t,n){var i=this;return ft(function(){i.cell.dropoutMask!=null&&(de(i.cell.dropoutMask),i.cell.dropoutMask=null),i.cell.recurrentDropoutMask!=null&&(de(i.cell.recurrentDropoutMask),i.cell.recurrentDropoutMask=null);var a=n==null?null:n.mask,o=n==null?null:n.training,u=n==null?null:n.initialState;return r.prototype.call.call(i,t,{mask:a,training:o,initialState:u})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var t={units:this.units,activation:xi(this.activation),recurrentActivation:xi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pe(this.kernelInitializer),recurrentInitializer:Pe(this.recurrentInitializer),biasInitializer:Pe(this.biasInitializer),kernelRegularizer:me(this.kernelRegularizer),recurrentRegularizer:me(this.recurrentRegularizer),biasRegularizer:me(this.biasRegularizer),activityRegularizer:me(this.activityRegularizer),kernelConstraint:$e(this.kernelConstraint),recurrentConstraint:$e(this.recurrentConstraint),biasConstraint:$e(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=r.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e.className="GRU",e}(pl);At.registerClass(d6);var wC=function(r){function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,Wr(n.units,"units"),n.activation=Ws(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=Ws(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null||t.useBias,n.kernelInitializer=on(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=on(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=on(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=sn(t.kernelRegularizer),n.recurrentRegularizer=sn(t.recurrentRegularizer),n.biasRegularizer=sn(t.biasRegularizer),n.kernelConstraint=Fn(t.kernelConstraint),n.recurrentConstraint=Fn(t.recurrentConstraint),n.biasConstraint=Fn(t.biasConstraint),n.dropout=Vc([1,Us([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=Vc([1,Us([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.implementation=t.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return xt(e,r),e.prototype.build=function(t){var n,i,a=(t=tn(t))[t.length-1];if(this.kernel=this.addWeight("kernel",[a,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,u=this.units;i=new((n=function(l){function h(){return l!==null&&l.apply(this,arguments)||this}return xt(h,l),h.prototype.apply=function(f,p){var m=o.apply([u]),v=new nC().apply([u]),b=o.apply([2*u]);return s4(s4(m,v),b)},h}(la)).className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,n){var i=this;return ft(function(){var a=n.training!=null&&n.training;if((t=t).length!==3)throw new it("LSTMCell expects 3 input Tensors (inputs, h, c), got "+t.length+".");var o=t[1],u=t[2];t=t[0],0<i.dropout&&i.dropout<1&&i.dropoutMask==null&&(i.dropoutMask=jc(function(){return yi(t)},i.dropout,a,4)),0<i.recurrentDropout&&i.recurrentDropout<1&&i.recurrentDropoutMask==null&&(i.recurrentDropoutMask=jc(function(){return yi(o)},i.recurrentDropout,a,4));var l,h,f,p,m=i.dropoutMask,v=i.recurrentDropoutMask;0<i.dropout&&i.dropout<1&&(t=ne(t,m[0]));var b=So(t,i.kernel.read());0<i.recurrentDropout&&i.recurrentDropout<1&&(o=ne(o,v[0])),b=xe(b,So(o,i.recurrentKernel.read())),i.useBias&&(b=jo(b,i.bias.read()));var C=To(b,4,b.rank-1),w=C[0],E=C[1],S=C[2],A=C[3];l=i.recurrentActivation.apply(w),h=i.recurrentActivation.apply(E),f=xe(ne(h,u),ne(l,i.activation.apply(S))),p=i.recurrentActivation.apply(A);var k=ne(p,i.activation.apply(f));return[k,k,f]})},e.prototype.getConfig=function(){var t={units:this.units,activation:xi(this.activation),recurrentActivation:xi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pe(this.kernelInitializer),recurrentInitializer:Pe(this.recurrentInitializer),biasInitializer:Pe(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:me(this.kernelRegularizer),recurrentRegularizer:me(this.recurrentRegularizer),biasRegularizer:me(this.biasRegularizer),activityRegularizer:me(this.activityRegularizer),kernelConstraint:$e(this.kernelConstraint),recurrentConstraint:$e(this.recurrentConstraint),biasConstraint:$e(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.className="LSTMCell",e}(Zd);At.registerClass(wC);var p6=function(r){function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new wC(t),r.call(this,t)||this}return xt(e,r),e.prototype.call=function(t,n){var i=this;return ft(function(){i.cell.dropoutMask!=null&&(de(i.cell.dropoutMask),i.cell.dropoutMask=null),i.cell.recurrentDropoutMask!=null&&(de(i.cell.recurrentDropoutMask),i.cell.recurrentDropoutMask=null);var a=n==null?null:n.mask,o=n==null?null:n.training,u=n==null?null:n.initialState;return r.prototype.call.call(i,t,{mask:a,training:o,initialState:u})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var t={units:this.units,activation:xi(this.activation),recurrentActivation:xi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pe(this.kernelInitializer),recurrentInitializer:Pe(this.recurrentInitializer),biasInitializer:Pe(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:me(this.kernelRegularizer),recurrentRegularizer:me(this.recurrentRegularizer),biasRegularizer:me(this.biasRegularizer),activityRegularizer:me(this.activityRegularizer),kernelConstraint:$e(this.kernelConstraint),recurrentConstraint:$e(this.recurrentConstraint),biasConstraint:$e(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=r.prototype.getConfig.call(this);return delete n.cell,Object.assign(t,n),t},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e.className="LSTM",e}(pl);At.registerClass(p6);var CC=function(r){function e(t){var n=r.call(this,t)||this;return n.cells=t.cells,n}return xt(e,r),Object.defineProperty(e.prototype,"stateSize",{get:function(){for(var t=[],n=0,i=this.cells.slice().reverse();n<i.length;n++){var a=i[n];Array.isArray(a.stateSize)?t.push.apply(t,a.stateSize):t.push(a.stateSize)}return t},enumerable:!0,configurable:!0}),e.prototype.call=function(t,n){var i=this;return ft(function(){for(var a=(t=t).slice(1),o=[],u=0,l=i.cells.slice().reverse();u<l.length;u++){var h=l[u];Array.isArray(h.stateSize)?o.push(a.splice(0,h.stateSize.length)):o.push(a.splice(0,1))}o.reverse();for(var f,p=[],m=0;m<i.cells.length;++m)h=i.cells[m],a=o[m],f=m===0?[t[0]].concat(a):[f[0]].concat(a),f=h.call(f,n),p.push(f.slice(1));a=[];for(var v=0,b=p.slice().reverse();v<b.length;v++){var C=b[v];a.push.apply(a,C)}return[f[0]].concat(a)})},e.prototype.build=function(t){var n;s2(t)&&(t=t[0]),t=t,this.cells.forEach(function(i,a){Hu("RNNCell_"+a,function(){i.build(t),n=Array.isArray(i.stateSize)?i.stateSize[0]:i.stateSize,t=[t[0],n]})}),this.built=!0},e.prototype.getConfig=function(){for(var t=[],n=0,i=this.cells;n<i.length;n++){var a=i[n];t.push({className:a.getClassName(),config:a.getConfig()})}var o={cells:t},u=r.prototype.getConfig.call(this);return Object.assign(o,u),o},e.fromConfig=function(t,n,i){i===void 0&&(i={});for(var a=[],o=0,u=n.cells;o<u.length;o++){var l=u[o];a.push(ta(l,i))}return new t({cells:a})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var t=[],n=0,i=this.cells;n<i.length;n++){var a=i[n];t.push.apply(t,a.trainableWeights)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],n=0,i=this.cells;n<i.length;n++){var a=i[n];t.push.apply(t,a.nonTrainableWeights)}if(!this.trainable){for(var o=[],u=0,l=this.cells;u<l.length;u++)a=l[u],o.push.apply(o,a.trainableWeights);return o.concat(t)}return t},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){for(var t=[],n=0,i=this.cells;n<i.length;n++){var a=i[n];t.push.apply(t,a.weights)}return u2(t)},e.prototype.setWeights=function(t){for(var n=[],i=0,a=this.cells;i<a.length;i++)for(var o=a[i],u=o.weights.length,l=t.splice(u),h=0;h<o.weights.length;++h)n.push([o.weights[h],l[h]]);lC(n)},e.className="StackedRNNCells",e}(Zd);function jc(r,e,t,n){function i(){return O5(r(),e)}if(t===void 0&&(t=null),n===void 0&&(n=1),n>1){for(var a=[],o=0;o<n;o++)a.push(Fc(i,r,t));return a.map(function(u){return za(u.clone())})}return za(Fc(i,r,t).clone())}At.registerClass(CC);var m6=function(r){function e(t){var n=r.call(this,t)||this;return n.layer=t.layer,n}return xt(e,r),e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.layer!=null&&this.layer.trainable},set:function(t){this.layer!=null&&(this.layer.trainable=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)},e.fromConfig=function(t,n,i){i===void 0&&(i={});var a=ta(n.layer,i);delete n.layer;var o={layer:a};return Object.assign(o,n),new t(o)},e}(Se),g6=function(r){function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n}return xt(e,r),e.prototype.build=function(t){if((t=tn(t)).length<3)throw new it("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(t));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),r.prototype.build.call(this,t)},e.prototype.computeOutputShape=function(t){var n=[(t=tn(t))[0]].concat(t.slice(2)),i=this.layer.computeOutputShape(n),a=t[1];return[i[0],a].concat(i.slice(1))},e.prototype.call=function(t,n){var i=this;return ft(function(){return h6(function(a,o){return[ue(i.layer.call(a,n)),[]]},t=ue(t),[],!1,null,null,!1,!0)[1]})},e.className="TimeDistributed",e}(m6);function _G(r){lh(yH,"BidirectionalMergeMode",r)}At.registerClass(g6);var TG="concat",v6=function(r){function e(t){var n=r.call(this,t)||this,i=t.layer.getConfig(),a={};a.className=t.layer.getClassName(),a.config=i,n.forwardLayer=ta(a),i.goBackwards=i.goBackwards!==!0;var o={};if(o.className=t.layer.getClassName(),o.config=i,n.backwardLayer=ta(o),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=t.mergeMode===void 0?TG:t.mergeMode,_G(n.mergeMode),t.weights)throw new pe("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n.numConstants=null,n}return xt(e,r),Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var n=t.length,i=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,i)),this.backwardLayer.setWeights(t.slice(i))},e.prototype.computeOutputShape=function(t){var n,i,a,o=this.forwardLayer.computeOutputShape(t);return Array.isArray(o)&&Array.isArray(o[0])||(o=[o]),o=o,this.returnState&&(a=o.slice(1)),n=o[0],n=n,this.mergeMode==="concat"?(n[n.length-1]*=2,i=[n]):i=this.mergeMode==null?[n,n.slice()]:[n],this.returnState?this.mergeMode==null?i.concat(a).concat(a.slice()):[n].concat(a).concat(a.slice()):Vr(i)},e.prototype.apply=function(t,n){var i=n==null?null:n.initialState,a=n==null?null:n.constants;n==null&&(n={});var o=c6(t,i,a,this.numConstants);if(t=o.inputs,i=o.initialState,a=o.constants,Array.isArray(t)&&(i=t.slice(1),t=t[0]),(i==null||i.length===0)&&a==null)return r.prototype.apply.call(this,t,n);var u=[],l=[];if(i!=null){var h=i.length;if(h%2>0)throw new it("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=i,u.push.apply(u,i);var f=i.map(function(S){return new ar({shape:S.shape})});this.forwardLayer.stateSpec=f.slice(0,h/2),this.backwardLayer.stateSpec=f.slice(h/2),l.push.apply(l,f)}if(a!=null)throw new pe("Support for constants in Bidirectional layers is not implemented yet.");for(var p=u[0]instanceof Ji,m=0,v=u;m<v.length;m++)if(v[m]instanceof Ji!==p)throw new it("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(p){var b=[t].concat(u),C=this.inputSpec.concat(l),w=this.inputSpec;this.inputSpec=C;var E=r.prototype.apply.call(this,b,n);return this.inputSpec=w,E}return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var i=this;return ft(function(){if(n.mask!=null)throw new pe("The support for masking is not implemented for Bidirectional layers yet.");var a,o,u,l,h=n.initialState;if(h==null)a=i.forwardLayer.call(t,n),o=i.backwardLayer.call(t,n);else{var f=h.slice(0,h.length/2),p=h.slice(h.length/2);a=i.forwardLayer.call(t,Object.assign(n,{initialState:f})),o=i.backwardLayer.call(t,Object.assign(n,{initialState:p}))}return i.returnState&&(Array.isArray(a)&&(u=a.slice(1).concat(o.slice(1))),a=a[0],o=o[0]),i.returnSequences&&(o=Fa(o,1)),i.mergeMode==="concat"?l=k5([a,o]):i.mergeMode==="sum"?l=xe(a,o):i.mergeMode==="ave"?l=ne(.5,xe(a,o)):i.mergeMode==="mul"?l=ne(a,o):i.mergeMode==null&&(l=[a,o]),i.returnState?i.mergeMode==null?l.concat(u):[l].concat(u):l})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var n=this;Hu(this.forwardLayer.name,function(){n.forwardLayer.build(t)}),Hu(this.backwardLayer.name,function(){n.backwardLayer.build(t)}),this.built=!0},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.fromConfig=function(t,n){var i=ta(n.layer);if(delete n.layer,n.numConstants!=null)throw new pe("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var a=n;return a.layer=i,new t(a)},e.className="Bidirectional",e}(m6);function SG(r){return new Qd(r)}function AG(r){return new pD(r)}function RG(r){return new hD(r)}function NG(r){return new fD(r)}function IG(r){return new dD(r)}function kG(r){return new gD(r)}function DG(r){return new mD(r)}function OG(r){return new CD(r)}function MG(r){return new yC(r)}function LG(r){return new xD(r)}function PG(r){return new bD(r)}function zG(r){return new wD(r)}function VG(r){return new ED(r)}function FG(r){return new _D(r)}function BG(r){return new TD(r)}function jG(r){return new ND(r)}function UG(r){return new AD(r)}function WG(r){return new SD(r)}function HG(r){return new RD(r)}function qG(r){return new ID(r)}function GG(r){return new kD(r)}function $G(r){return new DD(r)}function KG(r){return new MD(r)}function XG(r){return new LD(r)}function YG(r){return new zD(r)}function QG(r){return new BD(r)}function ZG(r){return new VD(r)}function JG(r){return new FD(r)}function t$(r){return new PD(r)}function e$(r){return new jD(r)}function n$(r){return new qD(r)}function r$(r){return new GD(r)}function i$(r){return new $D(r)}function EC(r){return new QD(r)}function a$(r){return EC(r)}function o$(r){return EC(r)}function _C(r){return new t6(r)}function s$(r){return _C(r)}function u$(r){return _C(r)}function TC(r){return new r6(r)}function l$(r){return TC(r)}function c$(r){return TC(r)}function h$(r){return new a6(r)}function f$(r){return new u6(r)}function y6(r){return new o6(r)}function b6(r){return new l6(r)}function x6(r){return new YD(r)}function w6(r){return new JD(r)}function d$(r){return new n6(r)}function p$(r){return new d6(r)}function m$(r){return new xC(r)}function g$(r){return new p6(r)}function v$(r){return new wC(r)}function y$(r){return new f6(r)}function b$(r){return new bC(r)}function x$(r){return new pl(r)}function w$(r){return new CC(r)}function C$(r){return new v6(r)}function E$(r){return new g6(r)}At.registerClass(v6);var _$=y6,T$=b6,S$=x6,A$=w6;function R$(r){return new UD(r)}function N$(r){return new WD(r)}function I$(r){return new HD(r)}function k$(r){return new OD(r)}var D$=Object.freeze({inputLayer:SG,elu:AG,reLU:RG,leakyReLU:NG,prelu:IG,softmax:kG,thresholdedReLU:DG,conv1d:OG,conv2d:MG,conv2dTranspose:LG,conv3d:PG,separableConv2d:zG,cropping2D:VG,upSampling2d:FG,depthwiseConv2d:BG,activation:jG,dense:UG,dropout:WG,flatten:HG,repeatVector:qG,reshape:GG,permute:$G,embedding:KG,add:XG,average:YG,concatenate:QG,maximum:ZG,minimum:JG,multiply:t$,dot:e$,batchNormalization:n$,layerNormalization:r$,zeroPadding2d:i$,averagePooling1d:EC,avgPool1d:a$,avgPooling1d:o$,averagePooling2d:_C,avgPool2d:s$,avgPooling2d:u$,averagePooling3d:TC,avgPool3d:l$,avgPooling3d:c$,globalAveragePooling1d:h$,globalAveragePooling2d:f$,globalMaxPooling1d:y6,globalMaxPooling2d:b6,maxPooling1d:x6,maxPooling2d:w6,maxPooling3d:d$,gru:p$,gruCell:m$,lstm:g$,lstmCell:v$,simpleRNN:y$,simpleRNNCell:b$,rnn:x$,stackedRNNCells:w$,bidirectional:C$,timeDistributed:E$,globalMaxPool1d:_$,globalMaxPool2d:T$,maxPool1d:S$,maxPool2d:A$,Layer:Se,RNN:pl,RNNCell:Zd,input:uD,gaussianNoise:R$,gaussianDropout:N$,alphaDropout:I$,masking:k$});function O$(r,e){return hC(r,e)}function M$(r,e){return tD(r,e)}function L$(r,e){return eD(r,e)}function P$(r,e){return fC(r,e)}function z$(r,e){return dC(r,e)}function V$(r,e){return J5(r,e)}function F$(r,e){return dq(r,e)}function B$(r,e){return cC(r,e)}function j$(r,e){return cy(r,e)}function U$(r,e){return ch(r,e)}function W$(r,e){return ch(r,e)}function H$(r,e){return ch(r,e)}function q$(r,e){return fl(r,e)}function G$(r,e){return fl(r,e)}function $$(r,e){return fl(r,e)}var K$=Object.freeze({binaryAccuracy:O$,binaryCrossentropy:M$,sparseCategoricalAccuracy:L$,categoricalAccuracy:P$,categoricalCrossentropy:z$,precision:V$,recall:F$,cosineProximity:B$,meanAbsoluteError:j$,meanAbsolutePercentageError:U$,MAPE:W$,mape:H$,meanSquaredError:q$,MSE:G$,mse:$$}),X$=Object.freeze({modelFromJSON:Kq});function Y$(r){return new dy(r)}function Q$(r){return dG(r)}function Z$(r){return pG(r)}var J$=Object.freeze({l1l2:Y$,l1:Q$,l2:Z$}),C6=function(r){function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.model=null,t}return xt(e,r),e.prototype.setModel=function(t){if(!(t instanceof Gu))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e}(Bc);function Bm(r,e){return r<e}function _4(r,e){return r>e}var E6=function(r){function e(t){var n=r.call(this)||this;if(t==null&&(t={}),t.restoreBestWeights)throw new pe("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=t.monitor||"val_loss",n.minDelta=Math.abs(t.minDelta||0),n.patience=t.patience||0,n.verbose=t.verbose||0,n.mode=t.mode||"auto",n.baseline=t.baseline,["auto","min","max"].indexOf(n.mode)===-1&&(console.warn("EarlyStopping mode '"+n.mode+"' is invalid. Falling back to mode 'auto'."),n.mode="auto"),n.mode==="min"?n.monitorFunc=Bm:n.mode==="max"||n.monitor.indexOf("acc")!==-1?n.monitorFunc=_4:n.monitorFunc=Bm,n.monitorFunc===Bm&&(n.minDelta*=-1),n}return xt(e,r),e.prototype.onTrainBegin=function(t){return ee(this,void 0,void 0,function(){return Kt(this,function(n){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===Bm?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,n){return ee(this,void 0,void 0,function(){var i;return Kt(this,function(a){switch(a.label){case 0:return[4,gs(n)];case 1:return a.sent(),(i=this.getMonitorValue(n))==null?[2]:(this.monitorFunc(i-this.minDelta,this.best)?(this.best=i,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return ee(this,void 0,void 0,function(){return Kt(this,function(n){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]})})},e.prototype.getMonitorValue=function(t){t==null&&(t={});var n=t[this.monitor];return n==null&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(t)),n},e}(C6);function tK(r){return new E6(r)}var eK={earlyStopping:tK};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var bo,T4,p2=function(){return(p2=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i]);return r}).apply(this,arguments)};function Ju(r,e,t,n){return new(t||(t=Promise))(function(i,a){function o(h){try{l(n.next(h))}catch(f){a(f)}}function u(h){try{l(n.throw(h))}catch(f){a(f)}}function l(h){h.done?i(h.value):new t(function(f){f(h.value)}).then(o,u)}l((n=n.apply(r,[])).next())})}function tl(r,e){var t,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(l){return function(h){return function(f){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(i=2&f[0]?n.return:f[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,f[1])).done)return i;switch(n=0,i&&(f=[2&f[0],i.value]),f[0]){case 0:case 1:i=f;break;case 4:return o.label++,{value:f[1],done:!1};case 5:o.label++,n=f[1],f=[0];continue;case 7:f=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(f[0]===6||f[0]===2)){o=0;continue}if(f[0]===3&&(!i||f[1]>i[0]&&f[1]<i[3])){o.label=f[1];break}if(f[0]===6&&o.label<i[1]){o.label=i[1],i=f;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(f);break}i[2]&&o.ops.pop(),o.trys.pop();continue}f=e.call(r,o)}catch(p){f=[6,p],n=0}finally{t=i=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([l,h])}}}(function(r){r[r.DT_INVALID=0]="DT_INVALID",r[r.DT_FLOAT=1]="DT_FLOAT",r[r.DT_DOUBLE=2]="DT_DOUBLE",r[r.DT_INT32=3]="DT_INT32",r[r.DT_UINT8=4]="DT_UINT8",r[r.DT_INT16=5]="DT_INT16",r[r.DT_INT8=6]="DT_INT8",r[r.DT_STRING=7]="DT_STRING",r[r.DT_COMPLEX64=8]="DT_COMPLEX64",r[r.DT_INT64=9]="DT_INT64",r[r.DT_BOOL=10]="DT_BOOL",r[r.DT_QINT8=11]="DT_QINT8",r[r.DT_QUINT8=12]="DT_QUINT8",r[r.DT_QINT32=13]="DT_QINT32",r[r.DT_BFLOAT16=14]="DT_BFLOAT16",r[r.DT_FLOAT_REF=101]="DT_FLOAT_REF",r[r.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",r[r.DT_INT32_REF=103]="DT_INT32_REF",r[r.DT_UINT8_REF=104]="DT_UINT8_REF",r[r.DT_INT16_REF=105]="DT_INT16_REF",r[r.DT_INT8_REF=106]="DT_INT8_REF",r[r.DT_STRING_REF=107]="DT_STRING_REF",r[r.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",r[r.DT_INT64_REF=109]="DT_INT64_REF",r[r.DT_BOOL_REF=110]="DT_BOOL_REF",r[r.DT_QINT8_REF=111]="DT_QINT8_REF",r[r.DT_QUINT8_REF=112]="DT_QUINT8_REF",r[r.DT_QINT32_REF=113]="DT_QINT32_REF",r[r.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"})(bo||(bo={})),function(r){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(r.CheckpointFormatVersion||(r.CheckpointFormatVersion={}))}(T4||(T4={}));var SC={};function nK(r,e){var t={tfOpName:r,category:"custom",inputs:[],attrs:[],customExecutor:e};SC[r]=t}function _6(r){return SC[r]}function rK(r){delete SC[r]}function U(r,e,t,n){var i=e.inputParams[r];if(i&&i.inputIndexStart!==void 0){var a=i.inputIndexStart,o=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?a+1:i.inputIndexEnd;if(i.type==="tensor")return Fr(e.inputNames[i.inputIndexStart],t,n);if(i.type==="tensors")return e.inputNames.slice(a,o).map(function(h){return Fr(h,t,n)});var u=Array.prototype.slice.call(Fr(e.inputNames.slice(a)[0],t,n).dataSync());return i.type==="number"?u[0]:u}var l=e.attrParams[r];return l&&l.value}function Fr(r,e,t){var n=qf(r),i=n[0],a=n[1],o=t.currentContextIds.find(function(u){return!!e[qg(i,u)]});return o!==void 0?e[qg(i,o)][a]:void 0}function iK(r,e,t){return e[qg(r,t.currentContextId)]}function ag(r,e){var t=qf(r),n=t[0],i=t[1];return[qg(n,e&&e.currentContextId),i]}function qg(r,e){return e?r+"-"+e:r}function qf(r){var e=r.lastIndexOf(":");return e===-1?[r,0]:[r.substring(0,e),Number(r.substring(e+1))]}function rb(r,e){for(var t=[],n=0;n<r.length;n+=e)t.push(r.slice(n,n+e));return t}var aK=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],oK=Object.freeze({json:aK}),sK=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],uK=Object.freeze({json:sK}),lK=[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}],cK=Object.freeze({json:lK}),hK=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}],fK=Object.freeze({json:hK}),dK=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],pK=Object.freeze({json:dK}),mK=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],gK=Object.freeze({json:mK}),vK=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}],yK=Object.freeze({json:vK}),bK=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],xK=Object.freeze({json:bK}),wK=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],CK=Object.freeze({json:wK}),EK=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],_K=Object.freeze({json:EK}),TK=[{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],SK=Object.freeze({json:TK}),AK=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],RK=Object.freeze({json:AK}),NK=[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}],IK=Object.freeze({json:NK}),kK=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],DK=Object.freeze({json:kK}),OK=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],MK=Object.freeze({json:OK}),LK=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}],PK=Object.freeze({json:LK}),zK=function(){function r(){var e=[oK,uK,cK,fK,pK,gK,yK,_K,CK,xK,SK,RK,IK,DK,MK,PK],t=[].concat.apply([],e.map(function(n){return n.json}));this.opMappers=t.reduce(function(n,i){return n[i.tfOpName]=i,n},{})}return Object.defineProperty(r,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),r.prototype.transformGraph=function(e){var t=this,n=[],i=[],a=e.node.reduce(function(h,f){return h[f.name]=t.mapNode(f),f.op==="Placeholder"&&n.push(h[f.name]),f.op==="Const"&&i.push(h[f.name]),h},{}),o=[],u=[],l=Object.keys(a);return l.forEach(function(h){var f=a[h];f.inputNames.forEach(function(p){var m=ag(p)[0];f.inputs.push(a[m]),a[m].children.push(f)}),f.inputs.length===0&&o.push(f)}),l.forEach(function(h){var f=a[h];f.children.length===0&&u.push(f)}),{nodes:a,inputs:o,outputs:u,weights:i,placeholders:n}},r.prototype.mapNode=function(e){var t=_6(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(i){return i.startsWith("^")?i.substr(1):i}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return t.inputs!=null&&(n.inputParams=t.inputs.reduce(function(i,a){return i[a.name]={type:a.type,inputIndexStart:a.start,inputIndexEnd:a.end},i},{})),t.attrs!=null&&(n.attrParams=t.attrs.reduce(function(i,a){var o=a.type,u=void 0;switch(a.type){case"string":(u=m2(e.attr,a.tfName,a.defaultValue))===void 0&&a.tfDeprecatedName&&(u=m2(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"string[]":(u=C2(e.attr,a.tfName,a.defaultValue))===void 0&&a.tfDeprecatedName&&(u=C2(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number":(u=v2(e.attr,a.tfName,a.defaultValue||0))===void 0&&a.tfDeprecatedName&&(u=v2(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number[]":(u=w2(e.attr,a.tfName,a.defaultValue))===void 0&&a.tfDeprecatedName&&(u=w2(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool":(u=g2(e.attr,a.tfName,a.defaultValue))===void 0&&a.tfDeprecatedName&&(u=g2(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool[]":(u=_2(e.attr,a.tfName,a.defaultValue))===void 0&&a.tfDeprecatedName&&(u=_2(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape":(u=x2(e.attr,a.tfName,a.defaultValue))===void 0&&a.tfDeprecatedName&&(u=x2(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape[]":(u=E2(e.attr,a.tfName,a.defaultValue))===void 0&&a.tfDeprecatedName&&(u=E2(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype":(u=y2(e.attr,a.tfName,a.defaultValue))===void 0&&a.tfDeprecatedName&&(u=y2(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype[]":(u=b2(e.attr,a.tfName,a.defaultValue))===void 0&&a.tfDeprecatedName&&(u=b2(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+a.type+" for op: "+e.op)}return i[a.name]={value:u,type:o},i},{})),n},r}();function VK(r){var e=gt().global;if(e.atob!==void 0)return e.atob(r);if(typeof Buffer<"u")return new Buffer(r,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function T6(r,e){var t=Array.isArray(r)?String.fromCharCode.apply(null,r):VK(r);return e?t:t.toLowerCase()}function m2(r,e,t,n){n===void 0&&(n=!1);var i=r[e];return i!=null?T6(i.s,n):t}function g2(r,e,t){var n=r[e];return n?n.b:t}function v2(r,e,t){var n=r[e]||{},i=n.i!=null?n.i:n.f!=null?n.f:t;return typeof i=="number"?i:parseInt(i,10)}function S6(r){switch(typeof r=="string"&&(r=bo[r]),r){case bo.DT_FLOAT:return"float32";case bo.DT_INT32:case bo.DT_INT64:return"int32";case bo.DT_BOOL:return"bool";case bo.DT_DOUBLE:return"float32";case bo.DT_STRING:return"string";default:return null}}function y2(r,e,t){var n=r[e];return n&&n.type?S6(n.type):t}function b2(r,e,t){var n=r[e];return n&&n.list&&n.list.type?n.list.type.map(function(i){return S6(i)}):t}function A6(r){if(!r.unknownRank)return r.dim!=null?r.dim.map(function(e){return typeof e.size=="number"?e.size:parseInt(e.size,10)}):[]}function x2(r,e,t){var n=r[e];return n&&n.shape?A6(n.shape):t}function w2(r,e,t){var n=r[e];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map(function(i){return typeof i=="number"?i:parseInt(i,10)}):t}function C2(r,e,t,n){n===void 0&&(n=!1);var i=r[e];return i&&i.list&&i.list.s?i.list.s.map(function(a){return T6(a,n)}):t}function E2(r,e,t){var n=r[e];return n&&n.list&&n.list.shape?n.list.shape.map(function(i){return A6(i)}):t}function _2(r,e,t){var n=r[e];return n&&n.list&&n.list.b?n.list.b:t}var FK=function(){function r(e,t,n){var i=this;this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(function(a){return i.getInput(a)}),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce(function(a,o){return a[o]=i.getAttr(o),a},{}))}return r.prototype.getInput=function(e){return Fr(e,this.tensorMap,this.context)},r.prototype.getAttr=function(e,t){var n=this.node.rawAttrs[e];if(n.tensor!=null)return Fr(e,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return v2(this.node.rawAttrs,e,t);if(n.s!=null)return m2(this.node.rawAttrs,e,t);if(n.b!=null)return g2(this.node.rawAttrs,e,t);if(n.shape!=null)return x2(this.node.rawAttrs,e,t);if(n.type!=null)return y2(this.node.rawAttrs,e,t);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return w2(this.node.rawAttrs,e,t);if(n.list.s!=null)return C2(this.node.rawAttrs,e,t);if(n.list.shape!=null)return E2(this.node.rawAttrs,e,t);if(n.list.b!=null)return _2(this.node.rawAttrs,e,t);if(n.list.type!=null)return b2(this.node.rawAttrs,e,t)}return t},r}(),BK=function(r,e,t){switch(r.op){case"BiasAdd":case"AddV2":case"Add":return[xe(U("a",r,e,t),U("b",r,e,t))];case"AddN":return[ww(U("tensors",r,e,t))];case"FloorMod":case"Mod":return[Ew(U("a",r,e,t),U("b",r,e,t))];case"Mul":return[ne(U("a",r,e,t),U("b",r,e,t))];case"RealDiv":case"Div":return[kr(U("a",r,e,t),U("b",r,e,t))];case"FloorDiv":return[Fv(U("a",r,e,t),U("b",r,e,t))];case"Sub":return[sr(U("a",r,e,t),U("b",r,e,t))];case"Minimum":return[ih(U("a",r,e,t),U("b",r,e,t))];case"Maximum":return[Ha(U("a",r,e,t),U("b",r,e,t))];case"Pow":return[Oc(U("a",r,e,t),U("b",r,e,t))];case"SquaredDifference":return[_w(U("a",r,e,t),U("b",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}},jK=function(r,e,t){switch(r.op){case"Abs":case"ComplexAbs":return[Bs(U("x",r,e,t))];case"Acos":return[Qx(U("x",r,e,t))];case"Acosh":return[Zx(U("x",r,e,t))];case"Asin":return[Jx(U("x",r,e,t))];case"Asinh":return[tw(U("x",r,e,t))];case"Atan":return[ew(U("x",r,e,t))];case"Atan2":return[Cw(U("x",r,e,t),U("y",r,e,t))];case"Atanh":return[nw(U("x",r,e,t))];case"Ceil":return[rw(U("x",r,e,t))];case"Complex":return[Kn(U("real",r,e,t),U("imag",r,e,t))];case"Cos":return[iw(U("x",r,e,t))];case"Cosh":return[aw(U("x",r,e,t))];case"Elu":return[uh(U("x",r,e,t))];case"Erf":return[ow(U("x",r,e,t))];case"Exp":return[sw(U("x",r,e,t))];case"Expm1":return[uw(U("x",r,e,t))];case"Floor":return[Dv(U("x",r,e,t))];case"Log":return[Oo(U("x",r,e,t))];case"Log1p":return[lw(U("x",r,e,t))];case"Imag":return[zi(U("x",r,e,t))];case"Neg":return[ll(U("x",r,e,t))];case"Reciprocal":return[cw(U("x",r,e,t))];case"Real":return[Qr(U("x",r,e,t))];case"Relu":return[Xs(U("x",r,e,t))];case"Round":return[hw(U("x",r,e,t))];case"Selu":return[ey(U("x",r,e,t))];case"Sigmoid":return[Mv(U("x",r,e,t))];case"Sin":return[dw(U("x",r,e,t))];case"Sign":return[fw(U("x",r,e,t))];case"Sinh":return[pw(U("x",r,e,t))];case"Softplus":return[Pd(U("x",r,e,t))];case"Sqrt":return[zd(U("x",r,e,t))];case"Square":return[Yx(U("x",r,e,t))];case"Tanh":return[Lv(U("x",r,e,t))];case"Tan":return[mw(U("x",r,e,t))];case"Relu6":case"ClipByValue":return[Ur(U("x",r,e,t),U("clipValueMin",r,e,t),U("clipValueMax",r,e,t))];case"Rsqrt":return[Ov(Fr(r.inputNames[0],e,t))];case"Prod":return[Zv(U("x",r,e,t),U("axes",r,e,t))];case"LeakyRelu":return[Jv(U("x",r,e,t),U("alpha",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}},UK=function(){function r(e,t,n,i,a,o,u){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=i,this.identicalElementShapes=a,this.dynamicSize=o,this.clearAfterRead=u,this.tensors=[],this.closed_=!1,this.id=r.nextId++}return Object.defineProperty(r.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),r.prototype.clearAndClose=function(){this.tensors.forEach(function(e){return e.tensor.dispose()}),this.tensors=[],this.closed_=!0},r.prototype.size=function(){return this.tensors.length},r.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||e>=this.tensors.length)throw new Error("Tried to read from index "+e+", but array size is: "+this.tensors.length);var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+e+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},r.prototype.readMany=function(e){var t=this;return e.map(function(n){return t.read(n)})},r.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index "+e+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+`,
          because the value dtype is `+t.dtype+", but TensorArray dtype is "+this.dtype+".");if(this.size()!==0||this.elementShape!=null&&this.elementShape.length!==0||(this.elementShape=t.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+e+"."),n&&n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been read.");if(n&&n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been written.");n.tensor=t,n.written=!0,this.tensors[e]=n},r.prototype.writeMany=function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+e.length+" is not the same as tensors size: "+t.length+".");e.forEach(function(i,a){return n.write(i,t[a])})},r.prototype.gather=function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+t);if(!e){e=[];for(var n=0;n<this.size();n++)e.push(n)}if(e.length===0)return Rn([],[0].concat(this.elementShape));var i=this.readMany(e);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,i[0].shape,"TensorArray shape mismatch: "),na(i,0)},r.prototype.concat=function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+e);if(this.size()===0)return Rn([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var i=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,i[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+i[0].shape+")"),Ir(i,0)},r.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+t.shape[0]);var n=Math.max.apply(Math,e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(e,Yu(t,0))},r.prototype.split=function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);var i=0,a=e.map(function(f){return i+=f});if(i!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `+i+", and tensor's shape is: "+t.shape);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+e.length+"), and the TensorArray is not marked as dynamically resizeable");var o=i===0?0:t.size/i,u=[];ft(function(){t=t.reshape([1,i,o]);for(var f=0;f<e.length;++f){var p=[0,f===0?0:a[f-1],0],m=[1,e[f],o];u[f]=bi(t,p,m).reshape(n.elementShape)}return u});for(var l=[],h=0;h<e.length;h++)l[h]=h;this.writeMany(l,u)},r.prototype.assertShapesMatchAllowUndefinedSize=function(e,t,n){n===void 0&&(n=""),Ht.assert(this.shapesEqualAllowUndefinedSize(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})},r.prototype.shapesEqualAllowUndefinedSize=function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==-1&&t[n]!==-1&&e[n]!==t[n])return!1;return!0},r.nextId=0,r}();function WK(r,e,t){return Ju(this,void 0,void 0,function(){var n,i,a,o,u,l,h,f,p,m,v,b,C,w,E,S,A,k,O,V,T,R,N,D,L,P,B,Z,rt,q,K,Q,ut,W,et;return tl(this,function(dt){switch(dt.label){case 0:switch(r.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[U("pred",r,e,t).clone()]];case 2:return n=U("pred",r,e,t),i=U("data",r,e,t),[4,n.data()];case 3:return[2,dt.sent()[0]?[void 0,i.clone()]:[i.clone(),void 0]];case 4:return[2,(a=r.inputNames.find(function(lt){return Fr(lt,e,t)!==void 0}))?[Fr(a,e,t).clone()]:void 0];case 5:return o=U("frameName",r,e,t),u=U("tensor",r,e,t),t.enterFrame(o),[2,[u.clone()]];case 6:return l=U("tensor",r,e,t),t.exitFrame(),[2,[l.clone()]];case 7:return h=U("tensor",r,e,t),t.nextIteration(),[2,[h.clone()]];case 8:return f=U("size",r,e,t),p=U("dtype",r,e,t),m=U("elementShape",r,e,t),v=U("dynamicSize",r,e,t),b=U("clearAfterRead",r,e,t),C=U("identicalElementShapes",r,e,t),w=U("name",r,e,t),E=new UK(w,p,f,m,C,v,b),t.addTensorArray(E),[2,[zt(E.id),zt(1)]];case 9:return S=U("tensorArrayId",r,e,t),A=U("index",r,e,t),k=U("tensor",r,e,t),t.getTensorArray(S).write(A,k),[2,[zt(1)]];case 10:return O=U("tensorArrayId",r,e,t),V=U("index",r,e,t),[2,[t.getTensorArray(O).read(V)]];case 11:return T=U("tensorArrayId",r,e,t),R=U("indices",r,e,t),N=U("dtype",r,e,t),[2,[t.getTensorArray(T).gather(R,N)]];case 12:return D=U("tensorArrayId",r,e,t),L=U("indices",r,e,t),P=U("tensor",r,e,t),t.getTensorArray(D).scatter(L,P),[2,[zt(1)]];case 13:return B=U("tensorArrayId",r,e,t),Z=t.getTensorArray(B),rt=U("dtype",r,e,t),[2,[Z.concat(rt)]];case 14:return q=U("tensorArrayId",r,e,t),K=U("tensor",r,e,t),Q=U("lengths",r,e,t),t.getTensorArray(q).split(Q,K),[2,[zt(1)]];case 15:return ut=U("tensorArrayId",r,e,t),W=t.getTensorArray(ut),[2,[zt(W.size(),"int32")]];case 16:return et=U("tensorArrayId",r,e,t),t.getTensorArray(et).clearAndClose(),[2,[]];case 17:throw TypeError("Node type "+r.op+" is not implemented")}})})}var HK=function(r,e,t){var n,i;switch(r.op){case"Conv1D":var a=U("stride",r,e,t),o=U("pad",r,e,t),u=U("dataFormat",r,e,t).toUpperCase(),l=U("dilation",r,e,t);return[jv(U("x",r,e,t),U("filter",r,e,t),a,o,u,l)];case"Conv2D":a=U("strides",r,e,t),o=U("pad",r,e,t),u=U("dataFormat",r,e,t).toUpperCase();var h=U("dilations",r,e,t);return[hl(U("x",r,e,t),U("filter",r,e,t),[a[1],a[2]],o,u,[h[1],h[2]])];case"_FusedConv2D":var f=(n=U("fusedOps",r,e,t))[0],p=n[1],m=f==="biasadd",v=p==="prelu",b=f==="fusedbatchnorm",C=U("numArgs",r,e,t);if(m){if(v&&C!==2)throw new Error("Fused Conv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!v&&C!==1)throw new Error("Fused Conv2d with BiasAdd must have one extra argument: bias.")}if(b)throw new Error("Fused Conv2d with FusedBatchNorm is not supported.");a=U("strides",r,e,t),o=U("pad",r,e,t),u=U("dataFormat",r,e,t).toUpperCase(),h=U("dilations",r,e,t);var w=(i=U("args",r,e,t))[0],E=i[1];return[zc.conv2d({x:U("x",r,e,t),filter:U("filter",r,e,t),strides:[a[1],a[2]],pad:o,dataFormat:u,dilations:[h[1],h[2]],bias:w,activation:p,preluActivationWeights:E})];case"Conv2DBackpropInput":case"Conv2dTranspose":var S=U("outputShape",r,e,t);return a=U("strides",r,e,t),o=U("pad",r,e,t),[Wv(U("x",r,e,t),U("filter",r,e,t),S,[a[1],a[2]],o)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return a=U("strides",r,e,t),o=U("pad",r,e,t),h=U("dilations",r,e,t),u=U("dataFormat",r,e,t).toUpperCase(),[sh(U("input",r,e,t),U("filter",r,e,t),[a[1],a[2]],o,u,[h[1],h[2]])];case"Conv3D":return a=U("strides",r,e,t),o=U("pad",r,e,t),u=U("dataFormat",r,e,t).toUpperCase(),h=U("dilations",r,e,t),[Uv(U("x",r,e,t),U("filter",r,e,t),[a[1],a[2],a[3]],o,u,[h[1],h[2],h[3]])];case"AvgPool":a=U("strides",r,e,t),o=U("pad",r,e,t);var A=U("kernelSize",r,e,t);return[Gv(U("x",r,e,t),[A[1],A[2]],[a[1],a[2]],o)];case"MaxPool":return a=U("strides",r,e,t),o=U("pad",r,e,t),A=U("kernelSize",r,e,t),[qv(U("x",r,e,t),[A[1],A[2]],[a[1],a[2]],o)];case"AvgPool3D":return a=U("strides",r,e,t),o=U("pad",r,e,t),A=U("kernelSize",r,e,t),[Kv(U("x",r,e,t),[A[1],A[2],A[3]],[a[1],a[2],a[3]],o)];case"MaxPool3D":return a=U("strides",r,e,t),o=U("pad",r,e,t),A=U("kernelSize",r,e,t),[$v(U("x",r,e,t),[A[1],A[2],A[3]],[a[1],a[2],a[3]],o)];default:throw TypeError("Node type "+r.op+" is not implemented")}},qK=function(r,e,t){switch(r.op){case"Fill":var n=U("shape",r,e,t),i=U("dtype",r,e,t),a=U("value",r,e,t);return[nh(n,a,i)];case"LinSpace":var o=U("start",r,e,t),u=U("stop",r,e,t),l=U("num",r,e,t);return[Rx(o,u,l)];case"Multinomial":var h=U("logits",r,e,t),f=U("numSamples",r,e,t),p=U("seed",r,e,t);return[Lx(h,f,p)];case"OneHot":var m=U("indices",r,e,t),v=U("depth",r,e,t),b=U("onValue",r,e,t),C=U("offValue",r,e,t);return[kc(m,v,b,C)];case"Ones":return[Wa(U("shape",r,e,t),U("dtype",r,e,t))];case"OnesLike":return[yi(U("x",r,e,t))];case"RandomUniform":return[sl(U("shape",r,e,t),U("minval",r,e,t),U("maxval",r,e,t),U("dtype",r,e,t))];case"Range":o=U("start",r,e,t);var w=U("stop",r,e,t),E=U("step",r,e,t);return[Cv(o,w,E,U("dtype",r,e,t))];case"TruncatedNormal":n=U("shape",r,e,t);var S=U("mean",r,e,t),A=U("stdDev",r,e,t);return p=U("seed",r,e,t),[Md(n,S,A,U("dtype",r,e,t),p)];case"Zeros":return[Ue(U("shape",r,e,t),U("dtype",r,e,t))];case"ZerosLike":return[Te(U("x",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}};function GK(r,e,t){return Ju(this,void 0,void 0,function(){var n,i,a,o,u;return tl(this,function(l){switch(l.label){case 0:switch(r.op){case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,3];case"ListDiff":return[3,5]}return[3,6];case 1:return n=U("boxes",r,e,t),i=U("scores",r,e,t),a=U("maxOutputSize",r,e,t),o=U("iouThreshold",r,e,t),u=U("scoreThreshold",r,e,t),[4,Wu.nonMaxSuppressionAsync(n,i,a,o,u)];case 2:return[2,[l.sent()]];case 3:return[4,Vv(U("condition",r,e,t).asType("bool"))];case 4:return[2,[l.sent()]];case 5:return[2,zx(U("x",r,e,t),U("y",r,e,t))];case 6:throw TypeError("Node type "+r.op+" is not implemented")}})})}var $K=function(r,e,t){switch(r.op){case"TopKV2":var n=U("x",r,e,t),i=U("k",r,e,t),a=U("sorted",r,e,t),o=Lw(n,i,a);return[o.values,o.indices];default:throw TypeError("Node type "+r.op+" is not implemented")}},KK=function(r,e,t){switch(r.op){case"Const":return e[r.name];case"PlaceholderWithDefault":var n=U("default",r,e,t);return[Fr(r.name,e,t)||n];case"Placeholder":return[Fr(r.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[U("x",r,e,t).clone()];case"IdentityN":return U("x",r,e,t).map(function(h){return h.clone()});case"Snapshot":return[U("x",r,e,t).clone()];case"Shape":return[Jr(U("x",r,e,t).shape,"int32")];case"ShapeN":return U("x",r,e,t).map(function(h){return Jr(h.shape)});case"Size":return[zt(U("x",r,e,t).size,"int32")];case"Rank":return[zt(U("x",r,e,t).rank,"int32")];case"NoOp":return[];case"Print":var i=U("x",r,e,t),a=U("data",r,e,t),o=U("message",r,e,t),u=U("summarize",r,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(var l=0;l<a.length;l++)console.log(Array.prototype.slice.call(a[l].dataSync()).slice(0,u));return[i];default:throw TypeError("Node type "+r.op+" is not implemented")}},XK=function(r,e,t){switch(r.op){case"ResizeBilinear":var n=U("images",r,e,t),i=U("size",r,e,t),a=U("alignCorners",r,e,t);return[Wu.resizeBilinear(n,[i[0],i[1]],a)];case"ResizeNearestNeighbor":return n=U("images",r,e,t),i=U("size",r,e,t),a=U("alignCorners",r,e,t),[Wu.resizeNearestNeighbor(n,[i[0],i[1]],a)];case"CropAndResize":var o=U("image",r,e,t),u=U("boxes",r,e,t),l=U("boxInd",r,e,t),h=U("cropSize",r,e,t),f=U("method",r,e,t),p=U("extrapolationValue",r,e,t);return[Wu.cropAndResize(o,u,l,h,f,p)];default:throw TypeError("Node type "+r.op+" is not implemented")}},YK=function(r,e,t){switch(r.op){case"Equal":return[cl(U("a",r,e,t),U("b",r,e,t))];case"NotEqual":return[Mc(U("a",r,e,t),U("b",r,e,t))];case"Greater":return[ah(U("a",r,e,t),U("b",r,e,t))];case"GreaterEqual":return[Fd(U("a",r,e,t),U("b",r,e,t))];case"Less":return[Tw(U("a",r,e,t),U("b",r,e,t))];case"LessEqual":return[Sw(U("a",r,e,t),U("b",r,e,t))];case"LogicalAnd":return[Vo(U("a",r,e,t),U("b",r,e,t))];case"LogicalNot":return[xw(U("a",r,e,t))];case"LogicalOr":return[zv(U("a",r,e,t),U("b",r,e,t))];case"Select":return[Mo(U("condition",r,e,t),U("a",r,e,t),U("b",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}},QK=function(r,e,t){switch(r.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Hv(U("a",r,e,t),U("b",r,e,t),U("transposeA",r,e,t),U("transposeB",r,e,t))];case"Transpose":return[fn(U("x",r,e,t),U("perm",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}},ZK=function(r,e,t){switch(r.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[gw(U("x",r,e,t),U("mean",r,e,t),U("variance",r,e,t),U("offset",r,e,t),U("scale",r,e,t),U("epsilon",r,e,t))];case"LRN":return[Dw(U("x",r,e,t),U("radius",r,e,t),U("bias",r,e,t),U("alpha",r,e,t),U("beta",r,e,t))];case"Softmax":return[ul(U("x",r,e,t))];case"LogSoftmax":return[Iv(U("x",r,e,t))];case"SparseToDense":return[ry(U("sparseIndices",r,e,t),U("outputShape",r,e,t),U("sparseValues",r,e,t),U("defaultValue",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}},JK=function(r,e,t){switch(r.op){case"Max":var n=U("axis",r,e,t),i=U("keepDims",r,e,t);return[js(U("x",r,e,t),n,i)];case"Mean":return n=U("axis",r,e,t),i=U("keepDims",r,e,t),[Nn(U("x",r,e,t),n,i)];case"Min":return n=U("axis",r,e,t),i=U("keepDims",r,e,t),[Qv(U("x",r,e,t),n,i)];case"Sum":return n=U("axis",r,e,t),i=U("keepDims",r,e,t),[ti(U("x",r,e,t),n,i)];case"All":return n=U("axis",r,e,t),i=U("keepDims",r,e,t),[Yv(U("x",r,e,t),n,i)];case"Any":return n=U("axis",r,e,t),i=U("keepDims",r,e,t),[pd(U("x",r,e,t),n,i)];case"ArgMax":return n=U("axis",r,e,t),[md(U("x",r,e,t),n)];case"ArgMin":return n=U("axis",r,e,t),[Iw(U("x",r,e,t),n)];case"Prod":return n=U("axis",r,e,t),i=U("keepDims",r,e,t),[Zv(U("x",r,e,t),n,i)];default:throw TypeError("Node type "+r.op+" is not implemented")}},tX=function(r,e,t){switch(r.op){case"ConcatV2":case"Concat":var n=U("axis",r,e,t),i=U("tensors",r,e,t);return[Ir(i,n)];case"GatherV2":case"Gather":n=U("axis",r,e,t);var a=U("x",r,e,t),o=U("indices",r,e,t);return[oh(a,o.asType("int32"),n)];case"ReverseV2":case"Reverse":return n=U("axis",r,e,t),a=U("x",r,e,t),[Fa(a,n)];case"Slice":var u=U("begin",r,e,t),l=U("size",r,e,t);return[bi(U("x",r,e,t),u,l)];case"StridedSlice":u=U("begin",r,e,t);var h=U("end",r,e,t),f=U("strides",r,e,t),p=U("beginMask",r,e,t),m=U("endMask",r,e,t),v=U("ellipsisMask",r,e,t),b=U("newAxisMask",r,e,t),C=U("shrinkAxisMask",r,e,t),w=U("x",r,e,t);if(u.length===1&&w.shape.length>1)for(var E=1;E<w.shape.length;E++)u.push(0),h.push(w.shape[E]),f.push(f[0]);return[Mw(w,u,h,f,p,m,v,b,C)];case"Pack":return ft(function(){var N=U("axis",r,e,t),D=U("tensors",r,e,t),L=D[0].shape,P=D[0].squeeze().shape,B=D.map(function(Z){var rt=Ht.arraysEqual(Z.shape,L);if(!rt&&!Ht.arraysEqual(Z.squeeze().shape,P))throw new Error("the input tensors shape does not match");return rt?Z:Z.reshape(L)});return[na(B,N)]});case"Unpack":return ft(function(){var N=U("axis",r,e,t),D=U("tensor",r,e,t);return Yu(D,N)});case"Tile":var S=U("reps",r,e,t);return[Ns(U("x",r,e,t),S)];case"Split":case"SplitV":n=U("axis",r,e,t);var A=U("numOrSizeSplits",r,e,t);return To(U("x",r,e,t),A,n);case"ScatterNd":o=U("indices",r,e,t);var k=U("values",r,e,t),O=U("shape",r,e,t);return[Pw(o,k,O)];case"GatherNd":var V=U("x",r,e,t);return o=U("indices",r,e,t),[zw(V,o)];case"SparseToDense":o=U("sparseIndices",r,e,t),O=U("outputShape",r,e,t);var T=U("sparseValues",r,e,t),R=U("defaultValue",r,e,t);return[ry(o,T,O,T.dtype===R.dtype?R:R.asType(T.dtype))];default:throw TypeError("Node type "+r.op+" is not implemented")}},eX=function(r,e,t){switch(r.op){case"FFT":return[Wd(U("x",r,e,t))];case"IFFT":return[Pc(U("x",r,e,t))];case"RFFT":return[Hd(U("x",r,e,t))];case"IRFFT":return[ny(U("x",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}},nX=function(r,e,t){switch(r.op){case"Cast":return[Tv(U("x",r,e,t),U("dtype",r,e,t))];case"ExpandDims":var n=U("axis",r,e,t);return[fi(U("x",r,e,t),n)];case"Squeeze":return n=U("axis",r,e,t),[Od(U("x",r,e,t),n)];case"Reshape":return[Dd(U("x",r,e,t),U("shape",r,e,t))];case"PadV2":case"Pad":return[$s(U("x",r,e,t),rb(U("padding",r,e,t),2),U("constantValue",r,e,t))];case"SpaceToBatchND":var i=U("blockShape",r,e,t),a=rb(U("paddings",r,e,t),2);return[Av(U("x",r,e,t),i,a)];case"BatchToSpaceND":i=U("blockShape",r,e,t);var o=rb(U("crops",r,e,t),2);return[_v(U("x",r,e,t),i,o)];case"DepthToSpace":var u=U("blockSize",r,e,t),l=U("dataFormat",r,e,t).toUpperCase();return[Mx(U("x",r,e,t),u,l)];default:throw TypeError("Node type "+r.op+" is not implemented")}};function S4(r,e,t){var n=function(i,a,o){switch(i.category){case"arithmetic":return BK(i,a,o);case"basic_math":return jK(i,a,o);case"control":return WK(i,a,o);case"convolution":return HK(i,a,o);case"creation":return qK(i,a,o);case"dynamic":return GK(i,a,o);case"evaluation":return $K(i,a,o);case"image":return XK(i,a,o);case"graph":return KK(i,a,o);case"logical":return YK(i,a,o);case"matrices":return QK(i,a,o);case"normalization":return ZK(i,a,o);case"reduction":return JK(i,a,o);case"slice_join":return tX(i,a,o);case"spectral":return eX(i,a,o);case"transformation":return nX(i,a,o);case"custom":var u=_6(i.op);if(u&&u.customExecutor)return u.customExecutor(new FK(i,a,o));throw TypeError("Custom op "+i.op+" is not registered.");default:throw TypeError("Unknown op '"+i.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(r,e,t);return n instanceof Promise?n.then(function(i){return[].concat(i)}):[].concat(n)}var A4=function(){function r(e,t){this.weightMap=e,this.tensorArrayMap=t,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return r.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(r.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),r.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},r.prototype.contextIdforContexts=function(e){return e?e.map(function(t){return t.id===0&&t.iterationId===0?"":t.frameName+"-"+t.iterationId}).join("/"):""},r.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},r.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},r.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},r.prototype.getWeight=function(e){return this.weightMap[e]},r.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},r.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},r}();function R4(r,e,t){for(var n=new Set,i=[],a=null,o=null,u=new Set,l=e.slice();l.length>0;){var h=l.pop();(R6(h)||oX(h))&&a==null&&(o=(a=h).children.map(function(f){return f.name}).filter(function(f){return n.has(f)})),n.add(h.name),t[h.name]==null&&r[h.name]==null&&(h.inputs.length!==0?h.inputs.forEach(function(f){u.has(f.name)||(u.add(f.name),l.push(f))}):i.push(h.name))}return{inputs:r,outputs:e,usedNodes:n,missingInputs:i,dynamicNode:a,syncInputs:o}}function rX(r,e,t){var n=t.usedNodes,i=t.inputs,a=[];Object.keys(i).map(function(h){return r.nodes[h]}).forEach(function(h){n.has(h.name)&&a.push(h)}),r.weights.forEach(function(h){n.has(h.name)&&a.push(h)});for(var o=new Set,u=[];a.length>0;){var l=a.pop();o.add(l.name),e[l.name]||u.push(l),l.children.forEach(function(h){!o.has(h.name)&&n.has(h.name)&&h.inputs.every(function(f){return o.has(f.name)})&&a.push(h)})}return u}var iX=["Switch","Merge","Enter","Exit","NextIteration"],aX=["NonMaxSuppressionV2","NonMaxSuppressionV3","Where"];function R6(r){return iX.indexOf(r.op)>=0}function oX(r){return aX.indexOf(r.op)>=0}var sX=function(){function r(e){this.graph=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this.placeholders=e.placeholders,this._outputs=e.outputs}return Object.defineProperty(r.prototype,"weightMap",{get:function(){return this._weightMap},set:function(e){var t=Object.keys(e).map(function(n){return e[n].map(function(i){return i.id})});this.weightIds=[].concat.apply([],t),this._weightMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this.placeholders.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this.placeholders.map(function(e){return e.name})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this.outputs.map(function(e){return e.name})},enumerable:!0,configurable:!0}),r.prototype.getCompilationKey=function(e,t){var n=e.map(function(a){return a.name}).sort(),i=t.map(function(a){return a.name}).sort();return n.join(this.SEPERATOR)+"--"+i.join(this.SEPERATOR)},r.prototype.compile=function(e,t){var n=R4(e,t,this.weightMap),i=n.missingInputs,a=n.dynamicNode,o=n.syncInputs;if(a!=null)throw new Error("This execution contains the node '"+a.name+"', which has the dynamic op '"+a.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+o+"]");if(i.length>0){var u=t.map(function(h){return h.name}),l=Object.keys(e);throw new Error("Cannot compute the outputs ["+u+"] from the provided inputs ["+l+"]. Missing the following inputs: ["+i+"]")}return rX(this.graph,this.weightMap,n)},r.prototype.execute=function(e,t){var n=this,i=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),this.checkOutputs(t);var a=i.map(function(f){return n.graph.nodes[f]}),o=t.map(function(f){return n.graph.nodes[qf(f)[0]]}),u=this.getCompilationKey(a,o),l=this.compiledMap.get(u);l==null&&(l=this.compile(e,o),this.compiledMap.set(u,l));var h={};return ft(function(){var f=new A4(n._weightMap,h),p=p2({},n.weightMap);Object.keys(e).forEach(function(E){p[E]=[e[E]]});for(var m=n.getFrozenTensorIds(p),v={},b=0;b<l.length;b++){var C=l[b];if(!p[C.name]){var w=S4(C,p,f);if(w instanceof Promise)throw new Error("The execution of the op '"+C.op+"' returned a promise. Please use model.executeAsync() instead.");p[C.name]=w,n.checkTensorForDisposal(C.name,C,p,f,m,t,v)}}return t.map(function(E){return Fr(E,p,f)})})},r.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(n){return e[n]}).map(function(n){return n.map(function(i){return i.id})}));return new Set(t)},r.prototype.checkTensorForDisposal=function(e,t,n,i,a,o,u){t.category!=="control"&&o.indexOf(e)===-1&&(n[e].forEach(function(l){l!=null&&(u[l.id]=(u[l.id]||0)+t.children.length)}),t.inputs.forEach(function(l){if(l.category!=="control"){var h=iK(l.name,n,i);h!=null&&h.forEach(function(f){if(f&&!a.has(f.id)){var p=u[f.id];p===1?(f.dispose(),delete u[f.id]):p!=null&&u[f.id]--}})}}))},r.prototype.executeAsync=function(e,t){return Ju(this,void 0,void 0,function(){var n,i,a,o,u,l,h=this;return tl(this,function(f){switch(f.label){case 0:return this.checkInputs(e),this.checkInputShapeAndType(e),this.checkOutputs(t),n={},i=new A4(this._weightMap,n),[4,this.executeWithControlFlow(e,i,t)];case 1:return a=f.sent(),o=t.map(function(p){return Fr(p,a,i)}),u=new Set(o.map(function(p){return p.id})),l=new Set(Object.keys(e).map(function(p){return e[p].id})),Object.keys(a).forEach(function(p){a[p].forEach(function(m){!m||m.isDisposed||u.has(m.id)||l.has(m.id)||h.weightIds.indexOf(m.id)!==-1||m.dispose()})}),[2,o]}})})},r.prototype.executeWithControlFlow=function(e,t,n){return Ju(this,void 0,void 0,function(){var i,a,o,u,l,h,f,p,m,v,b,C,w,E,S,A,k=this;return tl(this,function(O){switch(O.label){case 0:i=Object.keys(e),a=i.map(function(V){return k.graph.nodes[V]}),o=n.map(function(V){return k.graph.nodes[qf(V)[0]]}),u=R4(e,o,this.weightMap),l=u.usedNodes,h=u.missingInputs,f=u.dynamicNode,p=u.syncInputs,m=a.concat(this.graph.weights).map(function(V){return{node:V,contexts:t.currentContext}}),v=p2({},this.weightMap),Object.keys(e).forEach(function(V){v[V]=[e[V]]}),b={},C=this.getFrozenTensorIds(v),w={},O.label=1;case 1:return m.length>0?(E=this.processStack(a,m,t,v,w,C,n,b,l),[4,Promise.all(E)]):[3,3];case 2:return O.sent(),[3,1];case 3:if(f==null&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(S=o.filter(function(V){return!R6(V)&&!Fr(V.name,v,t)}).map(function(V){return V.name})).length>0)throw A="",f!=null&&(A="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+p+"]"),new Error("Cannot compute the outputs ["+S+"] from the provided inputs ["+i+"]. Consider providing the following inputs: ["+h+"]. "+A);return[2,v]}})})},r.prototype.processStack=function(e,t,n,i,a,o,u,l,h){for(var f=this,p=[],m=function(){var b=t.pop();n.currentContext=b.contexts;var C="";if(b.node.op==="Enter"&&U("isConstant",b.node,i,n)&&(C=ag(b.node.name,n)[0]),e.indexOf(b.node)===-1){var w=S4(b.node,i,n);C||(C=ag(b.node.name,n)[0]);var E=n.currentContext;w instanceof Promise?p.push(w.then(function(S){return i[C]=S,n.currentContext=E,f.checkTensorForDisposal(C,b.node,i,n,o,u,l),f.processChildNodes(b.node,t,n,i,a,h),S})):(i[C]=w,v.checkTensorForDisposal(C,b.node,i,n,o,u,l),v.processChildNodes(b.node,t,n,i,a,h))}else v.processChildNodes(b.node,t,n,i,a,h)},v=this;t.length>0;)m();return p},r.prototype.processChildNodes=function(e,t,n,i,a,o){e.children.forEach(function(u){var l=ag(u.name,n)[0];!a[l]&&o.has(u.name)&&(u.op==="Merge"?u.inputNames.some(function(h){return!!Fr(h,i,n)})&&(a[l]=!0,t.push({contexts:n.currentContext,node:u})):u.inputNames.every(function(h){return!!Fr(h,i,n)})&&(a[l]=!0,t.push({contexts:n.currentContext,node:u})))})},r.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(n){return n.dispose()})})},r.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(n){var i=e[n],a=t.graph.nodes[n];if(a.attrParams.shape&&a.attrParams.shape.value){var o=a.attrParams.shape.value,u=o.length===i.shape.length&&i.shape.every(function(l,h){return o[h]===-1||o[h]===l});Ht.assert(u,function(){return"The shape of dict['"+a.name+"'] provided in model.execute(dict) must be ["+o+"], but was ["+i.shape+"]"})}a.attrParams.dtype&&a.attrParams.dtype.value&&Ht.assert(i.dtype===a.attrParams.dtype.value,function(){return"The dtype of dict['"+a.name+"'] provided in model.execute(dict) must be "+a.attrParams.dtype.value+", but was "+i.dtype})})},r.prototype.checkInputs=function(e){var t=this,n=Object.keys(e).filter(function(i){return!t.graph.nodes[i]});if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+n+"] that are not part of graph")},r.prototype.checkOutputs=function(e){var t=this;e.forEach(function(n){var i=qf(n)[0];if(!t.graph.nodes[i])throw new Error("The output '"+n+"' is not found in the graph")})},r}(),uX="?tfjs-format=file",lX="model.json",N6=function(){function r(e,t){t===void 0&&(t={}),this.modelUrl=e,this.loadOptions=t,this.version="n/a",t==null&&(this.loadOptions={})}return Object.defineProperty(r.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),r.prototype.findIOHandler=function(){var e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=gi.browserHTTPRequest(e,this.loadOptions);else{var t=gi.getLoadHandlers(e,this.loadOptions.onProgress);if(t.length===0)t.push(gi.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one ("+t.length+") load handlers for URL '"+[e]+"'");this.handler=t[0]}},r.prototype.load=function(){return Ju(this,void 0,void 0,function(){var e,t,n;return tl(this,function(i){switch(i.label){case 0:if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,this.handler.load()];case 1:return e=i.sent(),t=e.modelTopology,this.version=t.versions.producer+"."+t.versions.minConsumer,n=gi.decodeWeights(e.weightData,e.weightSpecs),this.executor=new sX(zK.Instance.transformGraph(t)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),[2,!0]}})})},r.prototype.predict=function(e,t){return this.execute(e,this.outputNodes)},r.prototype.normalizeInputs=function(e){if(!(e instanceof Ge||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+e.length+" input tensors.");return this.inputNodes.reduce(function(t,n,i){return t[n]=e[i],t},{})},r.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},r.prototype.execute=function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]},r.prototype.executeAsync=function(e,t){return Ju(this,void 0,void 0,function(){var n;return tl(this,function(i){switch(i.label){case 0:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 1:return[2,(n=i.sent()).length>1?n:n[0]]}})})},r.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,n){return t[n]=[e[n]],t},{})},r.prototype.dispose=function(){this.executor.dispose()},r}();function cX(r,e){return e===void 0&&(e={}),Ju(this,void 0,void 0,function(){var t;return tl(this,function(n){switch(n.label){case 0:if(r==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return e==null&&(e={}),e.fromTFHub&&r.load==null&&(r.endsWith("/")||(r+="/"),r=""+r+lX+uX),[4,(t=new N6(r,e)).load()];case 1:return n.sent(),[2,t]}})})}var I6="1.3.1";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var k6=function(r,e){return(k6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(r,e)};function Be(r,e){function t(){this.constructor=r}k6(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function kt(r,e,t,n){return new(t||(t=Promise))(function(i,a){function o(h){try{l(n.next(h))}catch(f){a(f)}}function u(h){try{l(n.throw(h))}catch(f){a(f)}}function l(h){h.done?i(h.value):new t(function(f){f(h.value)}).then(o,u)}l((n=n.apply(r,[])).next())})}function Dt(r,e){var t,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(l){return function(h){return function(f){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(i=2&f[0]?n.return:f[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,f[1])).done)return i;switch(n=0,i&&(f=[2&f[0],i.value]),f[0]){case 0:case 1:i=f;break;case 4:return o.label++,{value:f[1],done:!1};case 5:o.label++,n=f[1],f=[0];continue;case 7:f=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(f[0]===6||f[0]===2)){o=0;continue}if(f[0]===3&&(!i||f[1]>i[0]&&f[1]<i[3])){o.label=f[1];break}if(f[0]===6&&o.label<i[1]){o.label=i[1],i=f;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(f);break}i[2]&&o.ops.pop(),o.trys.pop();continue}f=e.call(r,o)}catch(p){f=[6,p],n=0}finally{t=i=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([l,h])}}}function ml(r,e){return r(e={exports:{}},e.exports),e.exports}var hX=ml(function(r){(function(e,t,n){function i(o,u){return u.c=o.c,u.s0=o.s0,u.s1=o.s1,u.s2=o.s2,u}function a(o,u){var l=new function(p){var m,v=this,b=(m=4022871197,function(C){C=C.toString();for(var w=0;w<C.length;w++){var E=.02519603282416938*(m+=C.charCodeAt(w));E-=m=E>>>0,m=(E*=m)>>>0,m+=4294967296*(E-=m)}return 23283064365386963e-26*(m>>>0)});v.next=function(){var C=2091639*v.s0+23283064365386963e-26*v.c;return v.s0=v.s1,v.s1=v.s2,v.s2=C-(v.c=0|C)},v.c=1,v.s0=b(" "),v.s1=b(" "),v.s2=b(" "),v.s0-=b(p),v.s0<0&&(v.s0+=1),v.s1-=b(p),v.s1<0&&(v.s1+=1),v.s2-=b(p),v.s2<0&&(v.s2+=1),b=null}(o),h=u&&u.state,f=l.next;return f.int32=function(){return 4294967296*l.next()|0},f.double=function(){return f()+11102230246251565e-32*(2097152*f()|0)},f.quick=f,h&&(typeof h=="object"&&i(h,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=a:this.alea=a})(0,r)}),fX=ml(function(r){(function(e,t,n){function i(o,u){return u.x=o.x,u.y=o.y,u.z=o.z,u.w=o.w,u}function a(o,u){var l=new function(p){var m=this,v="";m.x=0,m.y=0,m.z=0,m.w=0,m.next=function(){var C=m.x^m.x<<11;return m.x=m.y,m.y=m.z,m.z=m.w,m.w^=m.w>>>19^C^C>>>8},p===(0|p)?m.x=p:v+=p;for(var b=0;b<v.length+64;b++)m.x^=0|v.charCodeAt(b),m.next()}(o),h=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},f.int32=l.next,f.quick=f,h&&(typeof h=="object"&&i(h,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=a:this.xor128=a})(0,r)}),dX=ml(function(r){(function(e,t,n){function i(o,u){return u.x=o.x,u.y=o.y,u.z=o.z,u.w=o.w,u.v=o.v,u.d=o.d,u}function a(o,u){var l=new function(p){var m=this,v="";m.next=function(){var C=m.x^m.x>>>2;return m.x=m.y,m.y=m.z,m.z=m.w,m.w=m.v,(m.d=m.d+362437|0)+(m.v=m.v^m.v<<4^C^C<<1)|0},m.x=0,m.y=0,m.z=0,m.w=0,m.v=0,p===(0|p)?m.x=p:v+=p;for(var b=0;b<v.length+64;b++)m.x^=0|v.charCodeAt(b),b==v.length&&(m.d=m.x<<10^m.x>>>4),m.next()}(o),h=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},f.int32=l.next,f.quick=f,h&&(typeof h=="object"&&i(h,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=a:this.xorwow=a})(0,r)}),pX=ml(function(r){(function(e,t,n){function i(o,u){return u.x=o.x.slice(),u.i=o.i,u}function a(o,u){o==null&&(o=+new Date);var l=new function(p){var m=this;m.next=function(){var v,b,C=m.x,w=m.i;return v=C[w],b=(v^=v>>>7)^v<<24,b^=(v=C[w+1&7])^v>>>10,b^=(v=C[w+3&7])^v>>>3,b^=(v=C[w+4&7])^v<<7,v=C[w+7&7],b^=(v^=v<<13)^v<<9,C[w]=b,m.i=w+1&7,b},function(v,b){var C,w=[];if(b===(0|b))w[0]=b;else for(b=""+b,C=0;C<b.length;++C)w[7&C]=w[7&C]<<15^b.charCodeAt(C)+w[C+1&7]<<13;for(;w.length<8;)w.push(0);for(C=0;C<8&&w[C]===0;++C);for(C==8?w[7]=-1:w[C],v.x=w,v.i=0,C=256;C>0;--C)v.next()}(m,p)}(o),h=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},f.int32=l.next,f.quick=f,h&&(h.x&&i(h,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=a:this.xorshift7=a})(0,r)}),mX=ml(function(r){(function(e,t,n){function i(o,u){return u.i=o.i,u.w=o.w,u.X=o.X.slice(),u}function a(o,u){o==null&&(o=+new Date);var l=new function(p){var m=this;m.next=function(){var v,b,C=m.w,w=m.X,E=m.i;return m.w=C=C+1640531527|0,b=w[E+34&127],v=w[E=E+1&127],b^=b<<13,v^=v<<17,b^=b>>>15,v^=v>>>12,b=w[E]=b^v,m.i=E,b+(C^C>>>16)|0},function(v,b){var C,w,E,S,A,k=[],O=128;for(b===(0|b)?(w=b,b=null):(b+="\0",w=0,O=Math.max(O,b.length)),E=0,S=-32;S<O;++S)b&&(w^=b.charCodeAt((S+32)%b.length)),S===0&&(A=w),w^=w<<10,w^=w>>>15,w^=w<<4,w^=w>>>13,S>=0&&(A=A+1640531527|0,E=(C=k[127&S]^=w+A)==0?E+1:0);for(E>=128&&(k[127&(b&&b.length||0)]=-1),E=127,S=512;S>0;--S)w=k[E+34&127],C=k[E=E+1&127],w^=w<<13,C^=C<<17,w^=w>>>15,C^=C>>>12,k[E]=w^C;v.w=A,v.X=k,v.i=E}(m,p)}(o),h=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},f.int32=l.next,f.quick=f,h&&(h.X&&i(h,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=a:this.xor4096=a})(0,r)}),gX=ml(function(r){(function(e,t,n){function i(o,u){return u.a=o.a,u.b=o.b,u.c=o.c,u.d=o.d,u}function a(o,u){var l=new function(p){var m=this,v="";m.next=function(){var C=m.b,w=m.c,E=m.d,S=m.a;return C=C<<25^C>>>7^w,w=w-E|0,E=E<<24^E>>>8^S,S=S-C|0,m.b=C=C<<20^C>>>12^w,m.c=w=w-E|0,m.d=E<<16^w>>>16^S,m.a=S-C|0},m.a=0,m.b=0,m.c=-1640531527,m.d=1367130551,p===Math.floor(p)?(m.a=p/4294967296|0,m.b=0|p):v+=p;for(var b=0;b<v.length+20;b++)m.b^=0|v.charCodeAt(b),m.next()}(o),h=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var p=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(p===0);return p},f.int32=l.next,f.quick=f,h&&(typeof h=="object"&&i(h,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=a:this.tychei=a})(0,r)}),Lu=ml(function(r){(function(e,t){var n,i=this,a=256,o=6,u="random",l=t.pow(a,o),h=t.pow(2,52),f=2*h,p=a-1;function m(w,E,S){var A=[],k=b(function T(R,N){var D,L=[],P=typeof R;if(N&&P=="object")for(D in R)try{L.push(T(R[D],N-1))}catch{}return L.length?L:P=="string"?R:R+"\0"}((E=E==1?{entropy:!0}:E||{}).entropy?[w,C(e)]:w??function(){try{var T;return n&&(T=n.randomBytes)?T=T(a):(T=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(T)),C(T)}catch{var R=i.navigator,N=R&&R.plugins;return[+new Date,i,N,i.screen,C(e)]}}(),3),A),O=new function(T){var R,N=T.length,D=this,L=0,P=D.i=D.j=0,B=D.S=[];for(N||(T=[N++]);L<a;)B[L]=L++;for(L=0;L<a;L++)B[L]=B[P=p&P+T[L%N]+(R=B[L])],B[P]=R;(D.g=function(Z){for(var rt,q=0,K=D.i,Q=D.j,ut=D.S;Z--;)rt=ut[K=p&K+1],q=q*a+ut[p&(ut[K]=ut[Q=p&Q+rt])+(ut[Q]=rt)];return D.i=K,D.j=Q,q})(a)}(A),V=function(){for(var T=O.g(o),R=l,N=0;T<h;)T=(T+N)*a,R*=a,N=O.g(1);for(;T>=f;)T/=2,R/=2,N>>>=1;return(T+N)/R};return V.int32=function(){return 0|O.g(4)},V.quick=function(){return O.g(4)/4294967296},V.double=V,b(C(O.S),e),(E.pass||S||function(T,R,N,D){return D&&(D.S&&v(D,O),T.state=function(){return v(O,{})}),N?(t[u]=T,R):T})(V,k,"global"in E?E.global:this==t,E.state)}function v(w,E){return E.i=w.i,E.j=w.j,E.S=w.S.slice(),E}function b(w,E){for(var S,A=w+"",k=0;k<A.length;)E[p&k]=p&(S^=19*E[p&k])+A.charCodeAt(k++);return C(E)}function C(w){return String.fromCharCode.apply(0,w)}if(t["seed"+u]=m,b(t.random(),e),r.exports){r.exports=m;try{n=require("crypto")}catch{}}})([],Math)});Lu.alea=hX,Lu.xor128=fX,Lu.xorwow=dX,Lu.xorshift7=pX,Lu.xor4096=mX,Lu.tychei=gX;var vX=Lu,D6=vX.alea;function yX(r,e){return Gg(r,e)}function Gg(r,e,t,n){if(t===void 0&&(t=new Map),n===void 0&&(n=new Set),r==null)return null;if(n.has(r))throw new Error("Circular references are not supported.");if(t.has(r))return t.get(r);var i=e(r);if(i.recurse&&i.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(Uc(r)){var a=Array.isArray(r)?[]:{};for(var o in n.add(r),r){var u=Gg(r[o],e,t,n);a[o]=u}return n.delete(r),a}throw new Error("Can't recurse into non-iterable type: "+r)}return t.set(r,i.value),i.value}function bX(r,e){return e===void 0&&(e=M6),O6(r,e)}function O6(r,e,t){t===void 0&&(t=new Set);var n=r[0];if(t.has(n))throw new Error("Circular references are not supported.");var i=e(r);if(i.recurse&&i.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(Uc(n)){var a=Array.isArray(n)?[]:{};t.add(n);var o=function(l){var h=O6(r.map(function(f){return f[l]}),e,t);a[l]=h};for(var u in n)o(u);return t.delete(n),a}throw new Error("Can't recurse into non-iterable type: "+n)}return i.value}function M6(r){return r===null?null:Uc(r[0])?{value:null,recurse:!0}:{value:r,recurse:!1}}function L6(r,e){return kt(this,void 0,void 0,function(){var t,n,i,a,o,u;return Dt(this,function(l){switch(l.label){case 0:t=new Map,Gg(r,e,t),n=0,i=Array.from(t.keys()),l.label=1;case 1:return n<i.length?(a=i[n],(o=t.get(a))instanceof Promise?[4,o]:[3,3]):[3,4];case 2:u=l.sent(),t.set(a,u),l.label=3;case 3:return n++,[3,1];case 4:return[2,Gg(r,e,t)]}})})}function Uc(r){return r!=null&&!ArrayBuffer.isView(r)&&(Array.isArray(r)||typeof r=="object"&&!(r instanceof Ge))}function xX(r){return r==null||wX(r)||Array.isArray(r)||typeof r=="object"&&r instanceof Ge||Ht.isTypedArray(r)}function wX(r){return r===null||typeof r!="object"&&typeof r!="function"}function CX(r){return yX(r,EX)}function EX(r){return r instanceof Ge?{value:r.clone(),recurse:!1}:Uc(r)?{value:null,recurse:!0}:{value:r,recurse:!1}}var P6=function(){function r(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return r.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},r.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},r.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},r.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},r.prototype.isFull=function(){return this.length()===this.capacity},r.prototype.isEmpty=function(){return this.length()===0},r.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},r.prototype.pushAll=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t];this.push(i)}},r.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},r.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},r.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},r.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n},r}(),_X=function(r){function e(){return r.call(this,e.INITIAL_CAPACITY)||this}return Be(e,r),e.prototype.isFull=function(){return!1},e.prototype.push=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.push.call(this,t)},e.prototype.unshift=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.unshift.call(this,t)},e.prototype.expand=function(){for(var t=2*this.capacity,n=new Array(t),i=this.length(),a=0;a<i;a++)n[a]=this.get(this.wrap(this.begin+a));this.data=n,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=i},e.INITIAL_CAPACITY=32,e}(P6);function z6(r){return new AX(r)}function AC(r){return new RX(r)}function TX(r,e){return new V6(r,e)}function SX(r,e){return e===void 0&&(e=Cs.FAIL),new zX(r,e)}var Cs,Qn=function(){function r(){}return r.prototype.toArray=function(){return kt(this,void 0,void 0,function(){var e,t;return Dt(this,function(n){switch(n.label){case 0:return e=[],[4,this.next()];case 1:t=n.sent(),n.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=n.sent(),[3,2];case 4:return[2,e]}})})},r.prototype.toArrayForTest=function(){return kt(this,void 0,void 0,function(){var e,t,n;return Dt(this,function(i){switch(i.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:n=i.sent(),i.label=2;case 2:return n.done?[3,4]:(t.push(n.value),[4,e.next()]);case 3:return n=i.sent(),[3,2];case 4:return[2,t]}})})},r.prototype.resolveFully=function(){return kt(this,void 0,void 0,function(){var e;return Dt(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}})})},r.prototype.resolveWhile=function(e){return kt(this,void 0,void 0,function(){var t,n;return Dt(this,function(i){switch(i.label){case 0:return[4,this.next()];case 1:t=i.sent(),n=e(t.value),i.label=2;case 2:return t.done||!n?[3,4]:[4,this.next()];case 3:return t=i.sent(),n=e(t.value),[3,2];case 4:return[2]}})})},r.prototype.handleErrors=function(e){return new LX(this,e)},r.prototype.filter=function(e){return new OX(this,e)},r.prototype.map=function(e){return new MX(this,e)},r.prototype.mapAsync=function(e){return new N4(this,e)},r.prototype.serialMapAsync=function(e){return new N4(this,e).serial()},r.prototype.flatmap=function(e){return new PX(this,e)},r.prototype.forEachAsync=function(e){return kt(this,void 0,void 0,function(){return Dt(this,function(t){return[2,this.map(e).resolveFully()]})})},r.prototype.serialForEach=function(e){return kt(this,void 0,void 0,function(){return Dt(this,function(t){return[2,this.serialMapAsync(e).resolveWhile(function(n){return n===!0})]})})},r.prototype.rowMajorBatch=function(e,t){return t===void 0&&(t=!0),new DX(this,e,t)},r.prototype.columnMajorBatch=function(e,t,n){return t===void 0&&(t=!0),n===void 0&&(n=M6),this.rowMajorBatch(e,t).map(function(i){return bX(i,n)})},r.prototype.concatenate=function(e,t){return new V6(z6([this,e]),t)},r.prototype.take=function(e){return e<0||e==null?this:new kX(this,e)},r.prototype.skip=function(e){return e<0||e==null?this:new IX(this,e)},r.prototype.prefetch=function(e){return new F6(this,e)},r.prototype.shuffle=function(e,t){return new VX(this,e,t)},r.prototype.serial=function(){return new NX(this)},r}(),AX=function(r){function e(t){var n=r.call(this)||this;return n.items=t,n.trav=0,n}return Be(e,r),e.prototype.summary=function(){return"Array of "+this.items.length+" items"},e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t;return Dt(this,function(n){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:CX(t),done:!1}])})})},e}(Qn),RX=function(r){function e(t){var n=r.call(this)||this;return n.nextFn=t,n}return Be(e,r),e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){try{return[2,this.nextFn()]}catch(n){throw n.message="Error thrown while iterating through a dataset: "+n.message,n}return[2]})})},e}(Qn),NX=function(r){function e(t){var n=r.call(this)||this;return n.upstream=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t=this;return Dt(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){return[2,this.upstream.next()]})})},e}(Qn),IX=function(r){function e(t,n){var i=r.call(this)||this;return i.upstream=t,i.maxCount=n,i.count=0,i.lastRead=Promise.resolve({value:null,done:!1}),i}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t=this;return Dt(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return kt(this,void 0,void 0,function(){var t;return Dt(this,function(n){switch(n.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(t=n.sent()).done?[2,t]:(de(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e}(Qn),kX=function(r){function e(t,n){var i=r.call(this)||this;return i.upstream=t,i.maxCount=n,i.count=0,i}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> Take"},e.prototype.next=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e}(Qn),DX=function(r){function e(t,n,i){i===void 0&&(i=!0);var a=r.call(this)||this;return a.upstream=t,a.batchSize=n,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t=this;return Dt(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return kt(this,void 0,void 0,function(){var t,n;return Dt(this,function(i){switch(i.label){case 0:t=[],i.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(n=i.sent()).done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(n.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e}(Qn),OX=function(r){function e(t,n){var i=r.call(this)||this;return i.upstream=t,i.predicate=n,i.lastRead=Promise.resolve({value:null,done:!1}),i}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t=this;return Dt(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return kt(this,void 0,void 0,function(){var t;return Dt(this,function(n){switch(n.label){case 0:return[4,this.upstream.next()];case 1:return(t=n.sent()).done||this.predicate(t.value)?[2,t]:(de(t.value),[3,0]);case 2:return[2]}})})},e}(Qn),MX=function(r){function e(t,n){var i=r.call(this)||this;return i.upstream=t,i.transform=n,i}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> Map"},e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t,n,i,a,o,u,l;return Dt(this,function(h){switch(h.label){case 0:return[4,this.upstream.next()];case 1:if((t=h.sent()).done)return[2,{value:null,done:!0}];for(n=Oa.getTensorsInContainer(t.value),i=this.transform(t.value),a=Oa.getTensorsInContainer(i),o=0,u=n;o<u.length;o++)l=u[o],Oa.isTensorInList(l,a)||l.dispose();return[2,{value:i,done:!1}]}})})},e}(Qn),LX=function(r){function e(t,n){var i=r.call(this)||this;return i.upstream=t,i.handler=n,i.count=0,i.lastRead=Promise.resolve({value:null,done:!1}),i}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t=this;return Dt(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return kt(this,void 0,void 0,function(){var t;return Dt(this,function(n){switch(n.label){case 0:n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,n.sent()];case 3:return t=n.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e}(Qn),N4=function(r){function e(t,n){var i=r.call(this)||this;return i.upstream=t,i.transform=n,i}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t,n,i,a,o,u,l;return Dt(this,function(h){switch(h.label){case 0:return[4,this.upstream.next()];case 1:return(t=h.sent()).done?[2,{value:null,done:!0}]:(n=Oa.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:for(i=h.sent(),a=Oa.getTensorsInContainer(i),o=0,u=n;o<u.length;o++)l=u[o],Oa.isTensorInList(l,a)||l.dispose();return[2,{value:i,done:!1}]}})})},e}(Qn),RC=function(r){function e(){var t=r.call(this)||this;return t.outputQueue=new _X,t.lastRead=Promise.resolve({value:null,done:!1}),t}return Be(e,r),e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t=this;return Dt(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){switch(t.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e}(Qn),PX=function(r){function e(t,n){var i=r.call(this)||this;return i.upstream=t,i.transform=n,i}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},e.prototype.pump=function(){return kt(this,void 0,void 0,function(){var t,n,i,a,o,u,l;return Dt(this,function(h){switch(h.label){case 0:return[4,this.upstream.next()];case 1:if((t=h.sent()).done)return[2,!1];for(n=Oa.getTensorsInContainer(t.value),i=this.transform(t.value),a=Oa.getTensorsInContainer(i),this.outputQueue.pushAll(i),o=0,u=n;o<u.length;o++)l=u[o],Oa.isTensorInList(l,a)||l.dispose();return[2,!0]}})})},e}(RC),V6=function(r){function e(t,n){var i=r.call(this)||this;return i.baseErrorHandler=n,i.lastRead=null,i.iterator=null,i.moreIterators=t,i}return Be(e,r),e.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},e.prototype.next=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return kt(this,void 0,void 0,function(){var n,i;return Dt(this,function(a){switch(a.label){case 0:return[4,t];case 1:return a.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if((n=a.sent()).done)return[2,{value:null,done:!0}];this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),a.label=3;case 3:return[4,this.iterator.next()];case 4:return(i=a.sent()).done?(this.iterator=null,[2,this.readFromChain(t)]):[2,i]}})})},e}(Qn);(function(r){r[r.FAIL=0]="FAIL",r[r.SHORTEST=1]="SHORTEST",r[r.LONGEST=2]="LONGEST"})(Cs||(Cs={}));var zX=function(r){function e(t,n){n===void 0&&(n=Cs.FAIL);var i=r.call(this)||this;return i.iterators=t,i.mismatchMode=n,i.count=0,i.currentPromise=null,i}return Be(e,r),e.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},e.prototype.nextState=function(t){return kt(this,void 0,void 0,function(){function n(u){return u instanceof Qn?{value:u.next().then(function(l){return i++,l.done&&a++,l.value}),recurse:!1}:{value:null,recurse:!0}}var i,a,o;return Dt(this,function(u){switch(u.label){case 0:return[4,t];case 1:return u.sent(),i=0,a=0,[4,L6(this.iterators,n)];case 2:if(o=u.sent(),i===a)return[2,{value:null,done:!0}];if(a>0)switch(this.mismatchMode){case Cs.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case Cs.SHORTEST:return[2,{value:null,done:!0}];case Cs.LONGEST:}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},e}(Qn),F6=function(r){function e(t,n){var i=r.call(this)||this;return i.upstream=t,i.bufferSize=n,i.buffer=new P6(n),i}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(Qn),VX=function(r){function e(t,n,i){var a=r.call(this,t,n)||this;return a.upstream=t,a.windowSize=n,a.upstreamExhausted=!1,a.random=D6(i||Ht.now().toString()),a.lastRead=Promise.resolve({value:null,done:!1}),a}return Be(e,r),e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t=this;return Dt(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return kt(this,void 0,void 0,function(){var t,n;return Dt(this,function(i){switch(i.label){case 0:this.upstreamExhausted||this.refill(),i.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:return(n=i.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,n]);case 3:return[2,{value:null,done:!0}]}})})},e}(F6),Jd=function(){function r(){this.size=null}return r.prototype.batch=function(e,t){var n=this;t===void 0&&(t=!0);var i=this;return Ht.assert(e>0,function(){return`batchSize needs to be positive, but it is
      `+e}),Kr(function(){return kt(n,void 0,void 0,function(){return Dt(this,function(a){switch(a.label){case 0:return[4,i.iterator()];case 1:return[2,a.sent().columnMajorBatch(e,t,jX)]}})})},this.size===1/0||this.size==null?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e))},r.prototype.concatenate=function(e){var t=this,n=this;return Kr(function(){return kt(t,void 0,void 0,function(){var i,a;return Dt(this,function(o){switch(o.label){case 0:return[4,n.iterator()];case 1:return a=(i=o.sent()).concatenate,[4,e.iterator()];case 2:return[2,a.apply(i,[o.sent()])]}})})},this.size===1/0||e.size===1/0?1/0:this.size!=null&&e.size!=null?this.size+e.size:null)},r.prototype.filter=function(e){var t=this,n=this;return Kr(function(){return kt(t,void 0,void 0,function(){return Dt(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().filter(function(a){return ft(function(){return e(a)})})]}})})},this.size===1/0?1/0:null)},r.prototype.forEachAsync=function(e){return kt(this,void 0,void 0,function(){return Dt(this,function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}})})},r.prototype.forEach=function(e){return kt(this,void 0,void 0,function(){return Dt(this,function(t){return xv("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(e)]})})},r.prototype.map=function(e){var t=this,n=this;return Kr(function(){return kt(t,void 0,void 0,function(){return Dt(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().map(function(a){return ft(function(){return e(a)})})]}})})},this.size)},r.prototype.mapAsync=function(e){var t=this,n=this;return Kr(function(){return kt(t,void 0,void 0,function(){return Dt(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().mapAsync(e)]}})})},this.size)},r.prototype.prefetch=function(e){var t=this;if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return Kr(function(){return kt(t,void 0,void 0,function(){return Dt(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().prefetch(e)]}})})},this.size)},r.prototype.repeat=function(e){var t=this,n=this;return Kr(function(){return kt(t,void 0,void 0,function(){var i=this;return Dt(this,function(a){return[2,TX(AC(function(){return kt(i,void 0,void 0,function(){var o;return Dt(this,function(u){switch(u.label){case 0:return o={},[4,n.iterator()];case 1:return[2,(o.value=u.sent(),o.done=!1,o)]}})})}).take(e))]})})},this.size!=null&&e>0?this.size*e:e===0?0:this.size!=null&&(e===void 0||e<0)?1/0:null)},r.prototype.skip=function(e){var t=this,n=this;return Kr(function(){return kt(t,void 0,void 0,function(){return Dt(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().skip(e)]}})})},this.size!=null&&e>=0&&this.size>=e?this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?0:null)},r.prototype.shuffle=function(e,t,n){var i=this;if(n===void 0&&(n=!0),e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var a=this,o=D6(t||Ht.now().toString());return Kr(function(){return kt(i,void 0,void 0,function(){var u;return Dt(this,function(l){switch(l.label){case 0:return u=o.int32(),n&&(u+=o.int32()),[4,a.iterator()];case 1:return[2,l.sent().shuffle(e,u.toString())]}})})},this.size)},r.prototype.take=function(e){var t=this,n=this;return Kr(function(){return kt(t,void 0,void 0,function(){return Dt(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().take(e)]}})})},this.size!=null&&this.size>e?e:this.size!=null&&this.size<=e?this.size:null)},r.prototype.toArray=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}})})},r.prototype.toArrayForTest=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}})})},r.MAX_BUFFER_SIZE=1e4,r}();function Kr(r,e){return e===void 0&&(e=null),new(function(t){function n(){var i=t!==null&&t.apply(this,arguments)||this;return i.size=e,i}return Be(n,t),n.prototype.iterator=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(i){return[2,r()]})})},n}(Jd))}function FX(r){var e=this;return Kr(function(){return kt(e,void 0,void 0,function(){return Dt(this,function(t){return[2,z6(r)]})})},r.length)}function BX(r){var e,t=this;if(!Uc(r))throw new Error("The argument to zip() must be an object or array.");if(Array.isArray(r))for(var n=0;n<r.length;n++)e=e==null?r[n].size:Math.min(e,r[n].size);else if(r instanceof Object)for(var i in r)e=e==null?r[i].size:Math.min(e,r[i].size);return Kr(function(){return kt(t,void 0,void 0,function(){return Dt(this,function(a){switch(a.label){case 0:return[4,L6(r,function(o){if(o instanceof Jd)return{value:o.iterator(),recurse:!1};if(Uc(o))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return[2,SX(a.sent(),Cs.SHORTEST)]}})})},e)}function jX(r){return r===null?null:xX(r[0])?{value:UX(r),recurse:!1}:{value:null,recurse:!0}}function UX(r){if(r.length===0)throw new Error("Can't make a batch of zero elements.");return r[0]instanceof Ge?na(r):Rn(r)}var B6=function(r){function e(t){var n=r.call(this)||this;return n.input=t,n}return Be(e,r),e.prototype.iterator=function(){return kt(this,void 0,void 0,function(){var t,n;return Dt(this,function(i){switch(i.label){case 0:return[4,this.input.iterator()];case 1:return t=i.sent(),n=t.decodeUTF8(),[2,n.split(`
`).map(function(a){return a.endsWith("\r")&&(a=a.slice(0,-1)),a})]}})})},e}(Jd),jm='"',Sf=Symbol("out"),I4=Symbol("field"),Um=Symbol("quote"),ib=Symbol("quoteafterquote"),k4=Symbol("quoteinquote"),j6=function(r){function e(t,n){var i=r.call(this)||this;return i.input=t,i.hasHeader=!0,i.fullColumnNames=null,i.columnNamesValidated=!1,i.columnConfigs=null,i.configuredColumnsOnly=!1,i.delimiter=",",i.delimWhitespace=!1,i.base=new B6(t),n||(n={}),i.hasHeader=n.hasHeader!==!1,i.fullColumnNames=n.columnNames,i.columnConfigs=n.columnConfigs,i.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(Ht.assert(n.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),i.delimWhitespace=!0,i.delimiter=" "):i.delimiter=n.delimiter?n.delimiter:",",i}return Be(e,r),e.prototype.columnNames=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return kt(this,void 0,void 0,function(){var t,n,i,a,o,u,l=this;return Dt(this,function(h){switch(h.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=h.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&Ht.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+l.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce(function(f,p){return f[p]=f[p]+1||1,f},{}),i=Object.keys(n).filter(function(f){return n[f]>1}),Ht.assert(i.length===0,function(){return"Duplicate column names found: "+i.toString()}),this.columnConfigs){for(a=0,o=Object.keys(this.columnConfigs);a<o.length;a++)if(u=o[a],this.fullColumnNames.indexOf(u)===-1)throw new Error('The key "'+u+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return kt(this,void 0,void 0,function(){var t,n;return Dt(this,function(i){switch(i.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,i.sent().next()];case 2:if((t=i.sent()).done)throw new Error("No data was found for CSV parsing.");return n=t.value,[2,this.parseRow(n,!1)];case 3:return[2,null]}})})},e.prototype.iterator=function(){return kt(this,void 0,void 0,function(){var t,n=this;return Dt(this,function(i){switch(i.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:i.sent(),i.label=2;case 2:return[4,this.base.iterator()];case 3:return t=i.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(a){return n.makeDataElement(a)})]}})})},e.prototype.makeDataElement=function(t){for(var n=this.parseRow(t),i={},a={},o=0;o<this.fullColumnNames.length;o++){var u=this.fullColumnNames[o],l=this.columnConfigs?this.columnConfigs[u]:null;if(!this.configuredColumnsOnly||l){var h=n[o],f=null;if(h==="")if(l&&l.default!==void 0)f=l.default;else{if(l&&(l.required||l.isLabel))throw new Error("Required column "+u+" is empty in this line: "+t);f=void 0}else{var p=Number(h);if(isNaN(p))f=l&&l.dtype==="bool"?this.getBoolean(h):h;else if(l&&l.dtype)switch(l.dtype){case"float32":f=p;break;case"int32":f=Math.floor(p);break;case"bool":f=this.getBoolean(h);break;default:f=p}else f=p}l&&l.isLabel?a[u]=f:i[u]=f}}return Object.keys(a).length===0?i:{xs:i,ys:a}},e.prototype.getBoolean=function(t){return t==="1"||t.toLowerCase()==="true"?1:0},e.prototype.parseRow=function(t,n){n===void 0&&(n=!0);for(var i=[],a=0,o=t.length,u=Sf,l=0;l<o;l++)switch(u){case Sf:switch(t.charAt(l)){case jm:a=l+1,u=Um;break;case this.delimiter:if(a=l+1,this.delimiter===" "&&this.delimWhitespace)break;i.push(""),u=Sf;break;default:u=I4,a=l}break;case I4:switch(t.charAt(l)){case this.delimiter:i.push(t.substring(a,l)),u=Sf,a=l+1}break;case Um:switch(t.charAt(l)){case jm:u=ib}break;case ib:switch(t.charAt(l)){case this.delimiter:i.push(t.substring(a,l-1)),u=Sf,a=l+1;break;case jm:u=Um;break;default:u=k4}break;case k4:switch(t.charAt(l)){case jm:u=Um}}if(u===ib?i.push(t.substring(a,o-1)):i.push(t.substring(a)),n&&i.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+i);return i},e}(Jd),WX=function(r){function e(t){var n=r.call(this)||this;n.microphoneConfig=t,n.isClosed=!1,n.fftSize=t.fftSize||1024;var i=Math.log2(n.fftSize);if(n.fftSize<0||i<4||i>14||!Number.isInteger(i))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+n.fftSize);if(n.numFrames=t.numFramesPerSpectrogram||43,n.sampleRateHz=t.sampleRateHz,n.columnTruncateLength=t.columnTruncateLength||n.fftSize,n.audioTrackConstraints=t.audioTrackConstraints,n.smoothingTimeConstant=t.smoothingTimeConstant||0,n.includeSpectrogram=t.includeSpectrogram!==!1,n.includeWaveform=t.includeWaveform===!0,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}return Be(e,r),e.prototype.summary=function(){return"microphone"},e.create=function(t){return t===void 0&&(t={}),kt(this,void 0,void 0,function(){var n;return Dt(this,function(i){switch(i.label){case 0:if(gt().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(n=new e(t)).start()];case 1:return i.sent(),[2,n]}})})},e.prototype.start=function(){return kt(this,void 0,void 0,function(){var t,n,i,a;return Dt(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null||this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw n=o.sent(),new Error("Error thrown while initializing video stream: "+n.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(i=window.AudioContext||window.webkitAudioContext,this.audioContext=new i,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return a=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,a.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t,n,i,a,o;return Dt(this,function(u){switch(u.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return i=u.sent(),this.includeSpectrogram&&(a=this.flattenQueue(i.freqDataQueue),t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(i.timeDataQueue),n=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:n},done:!1}]}})})},e.prototype.capture=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return kt(this,void 0,void 0,function(){var t,n,i,a=this;return Dt(this,function(o){return t=[],n=[],i=0,[2,new Promise(function(u){var l=setInterval(function(){a.includeSpectrogram&&(a.analyser.getFloatFrequencyData(a.freqData),a.freqData[0]===-1/0&&u({freqDataQueue:t,timeDataQueue:n}),t.push(a.freqData.slice(0,a.columnTruncateLength))),a.includeWaveform&&(a.analyser.getFloatTimeDomainData(a.timeData),n.push(a.timeData.slice())),++i===a.numFrames&&(clearInterval(l),u({freqDataQueue:t,timeDataQueue:n}))},a.fftSize/a.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var n=t[0].length,i=new Float32Array(t.length*n);return t.forEach(function(a,o){return i.set(a,o*n)}),i},e.prototype.getTensorFromAudioDataArray=function(t,n){var i=new Float32Array(Ht.sizeFromShape(n));return i.set(t,i.length-t.length),Rn(i,n)},e}(Qn),HX=function(r){function e(t,n){var i=r.call(this)||this;if(i.webcamVideoElement=t,i.webcamConfig=n,i.isClosed=!0,i.resize=!1,i.needToResize())if(i.resize=!0,i.cropSize=[i.webcamConfig.resizeHeight,i.webcamConfig.resizeWidth],i.cropBoxInd=Jr([0],"int32"),i.webcamConfig.centerCrop){var a=1*i.webcamConfig.resizeWidth/i.webcamVideoElement.width,o=1*i.webcamConfig.resizeHeight/i.webcamVideoElement.height,u=(1-a)/2,l=(1-o)/2,h=u+a,f=o+l;i.cropBox=_o([l,u,f,h],[1,4])}else i.cropBox=_o([0,0,1,1],[1,4]);return i}return Be(e,r),e.prototype.summary=function(){return"webcam"},e.create=function(t,n){return n===void 0&&(n={}),kt(this,void 0,void 0,function(){var i;return Dt(this,function(a){switch(a.label){case 0:if(gt().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}return[4,(i=new e(t,n)).start()];case 1:return a.sent(),[2,i]}})})},e.prototype.start=function(){return kt(this,void 0,void 0,function(){var t,n,i=this;return Dt(this,function(a){switch(a.label){case 0:this.webcamConfig.facingMode&&Ht.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: "+i.webcamConfig.facingMode+". Please provide 'user' or 'environment'"}),a.label=1;case 1:return a.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=a.sent(),[3,4];case 3:throw(n=a.sent()).message="Error thrown while initializing video stream: "+n.message,n;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(o){console.log(o),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(o){i.webcamVideoElement.onloadedmetadata=function(){o()}})]}})})},e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t;return Dt(this,function(n){if(this.isClosed)return[2,{value:null,done:!0}];try{t=p5.fromPixels(this.webcamVideoElement)}catch(i){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(i))}if(!this.resize)return[2,{value:t,done:!1}];try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(i){throw new Error("Error thrown cropping the video: "+i.message)}finally{t.dispose()}return[2]})})},e.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},e.prototype.cropAndResizeFrame=function(t){var n=this;return ft(function(){var i,a=t.toFloat().expandDims(0),o=(i=Wu.cropAndResize(a,n.cropBox,n.cropBoxInd,n.cropSize,"bilinear")).shape;return i.reshape(o.slice(1))})},e.prototype.capture=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){this.stream.getTracks().forEach(function(t){return t.stop()});try{this.webcamVideoElement.srcObject=null}catch(t){console.log(t),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},e}(Qn),U6=function(){return function(){}}(),W6=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return Be(e,r),e.prototype.split=function(t){return new qX(this,t)},e}(Qn),qX=function(r){function e(t,n){var i=r.call(this)||this;return i.upstream=t,i.impl=new GX(t,n),i}return Be(e,r),e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){return[2,this.impl.next()]})})},e}(W6),GX=function(r){function e(t,n){var i=r.call(this)||this;return i.upstream=t,i.separator=n,i.carryover="",i}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},e.prototype.pump=function(){return kt(this,void 0,void 0,function(){var t,n,i,a,o;return Dt(this,function(u){switch(u.label){case 0:return[4,this.upstream.next()];case 1:if((t=u.sent()).done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((n=t.value.split(this.separator))[0]=this.carryover+n[0],i=0,a=n.slice(0,-1);i<a.length;i++)o=a[i],this.outputQueue.push(o);return this.carryover=n[n.length-1],[2,!0]}})})},e}(RC),$X=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return Be(e,r),e.prototype.decodeUTF8=function(){return new KX(this)},e}(Qn),KX=function(r){function e(t){var n=r.call(this)||this;return n.upstream=t,n.impl=new XX(t),n}return Be(e,r),e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){return[2,this.impl.next()]})})},e}(W6),XX=function(r){function e(t){var n=r.call(this)||this;if(n.upstream=t,gt().get("IS_BROWSER"))n.decoder=new TextDecoder("utf-8");else{var i=require("string_decoder").StringDecoder;n.decoder=new i("utf8")}return n}return Be(e,r),e.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},e.prototype.pump=function(){return kt(this,void 0,void 0,function(){var t,n,i;return Dt(this,function(a){switch(a.label){case 0:return[4,this.upstream.next()];case 1:return(t=a.sent()).done?[2,!1]:(n=t.value,i=gt().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(i),[2,!0])}})})},e}(RC),H6=function(r){function e(t,n){n===void 0&&(n={});var i=r.call(this)||this;return i.file=t,i.options=n,Ht.assert(t instanceof Uint8Array||!!gt().get("IS_BROWSER")&&(t instanceof File||t instanceof Blob),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),i.offset=n.offset||0,i.chunkSize=n.chunkSize||1048576,i}return Be(e,r),e.prototype.summary=function(){return"FileChunks "+this.file},e.prototype.next=function(){return kt(this,void 0,void 0,function(){var t,n,i=this;return Dt(this,function(a){switch(a.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(o,u){var l=i.offset+i.chunkSize;if(i.file instanceof Uint8Array)o(new Uint8Array(i.file.slice(i.offset,l)));else{var h=new FileReader;h.onload=function(p){var m=h.result;if(m instanceof ArrayBuffer&&(m=new Uint8Array(m)),!(m instanceof Uint8Array))return u(new TypeError("FileReader returned unknown type."));o(m)},h.onabort=function(p){return u(new Error("Aborted"))},h.onerror=function(p){return u(new Error(p.type))};var f=i.file.slice(i.offset,l);h.readAsArrayBuffer(f)}i.offset=l}),n={},[4,t]);case 1:return[2,(n.value=a.sent(),n.done=!1,n)]}})})},e}($X);function YX(r,e){return e===void 0&&(e={}),kt(this,void 0,void 0,function(){var t,n,i,a,o;return Dt(this,function(u){switch(u.label){case 0:return typeof r=="string"?t=r:(t=r.url,n=QX(r)),[4,Ht.fetch(t,n)];case 1:return(i=u.sent()).ok?(o=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return a=new(o.apply(Uint8Array,[void 0,u.sent()])),[2,new H6(a,e)];case 3:throw new Error(i.statusText)}})})}var QX=function(r){return{method:r.method,headers:r.headers,body:r.body,mode:r.mode,credentials:r.credentials,cache:r.cache,redirect:r.redirect,referrer:r.referrer,integrity:r.integrity}};function q6(r){return typeof r=="string"&&r.substr(0,7)==="file://"}var G6=function(r){function e(t,n){n===void 0&&(n={});var i=r.call(this)||this;return i.input=t,i.options=n,i}return Be(e,r),e.prototype.iterator=function(){return kt(this,void 0,void 0,function(){var t;return Dt(this,function(n){return q6(this.input)&&gt().get("IS_NODE")&&(t=require("fs"),this.input=t.readFileSync(this.input.substr(7))),[2,new H6(this.input,this.options)]})})},e}(U6),$6=function(r){function e(t,n){n===void 0&&(n={});var i=r.call(this)||this;return i.url=t,i.fileOptions=n,i}return Be(e,r),e.prototype.iterator=function(){return kt(this,void 0,void 0,function(){return Dt(this,function(t){return q6(this.url)?[2,new G6(this.url,this.fileOptions).iterator()]:[2,YX(this.url,this.fileOptions)]})})},e}(U6);function ZX(r,e){return e===void 0&&(e={}),new j6(new $6(r),e)}function JX(r){var e=this,t=AC(r);return Kr(function(){return kt(e,void 0,void 0,function(){return Dt(this,function(n){return[2,t]})})})}function tY(r){var e=this;return Kr(function(){return kt(e,void 0,void 0,function(){var t;return Dt(this,function(n){switch(n.label){case 0:return[4,r()];case 1:return t=n.sent(),[2,AC(function(){return t.next()})]}})})})}function eY(r,e){return kt(this,void 0,void 0,function(){return Dt(this,function(t){return[2,HX.create(r,e)]})})}function nY(r){return kt(this,void 0,void 0,function(){return Dt(this,function(e){return[2,WX.create(r)]})})}var K6="1.3.1";const rY=Object.freeze(Object.defineProperty({__proto__:null,CSVDataset:j6,Dataset:Jd,FileDataSource:G6,TextLineDataset:B6,URLDataSource:$6,array:FX,csv:ZX,func:JX,generator:tY,microphone:nY,version_data:K6,webcam:eY,zip:BX},Symbol.toStringTag,{value:"Module"}));var iY="1.3.1",aY={"tfjs-core":y5,"tfjs-data":K6,"tfjs-layers":fy,"tfjs-converter":I6,tfjs:iY};const oY=Object.freeze(Object.defineProperty({__proto__:null,AdadeltaOptimizer:$w,AdagradOptimizer:Kw,AdamOptimizer:Xw,AdamaxOptimizer:Yw,Callback:C6,CallbackList:G5,CustomCallback:K5,DataStorage:Bx,get ENV(){return gx},EarlyStopping:E6,Environment:bN,GraphModel:N6,History:$5,InputSpec:ar,KernelBackend:jx,LayerVariable:U5,LayersModel:Gu,MomentumOptimizer:Qw,Optimizer:Bo,RMSPropOptimizer:Zw,RNN:pl,get Rank(){return Fb},get Reduction(){return xr},SGDOptimizer:oy,Sequential:mC,SymbolicTensor:Ji,Tensor:Ge,TensorBuffer:Ic,Variable:sd,abs:Bs,acos:Qx,acosh:Zx,add:xe,addN:ww,addStrict:xk,all:Yv,any:pd,argMax:md,argMin:Iw,asin:Jx,asinh:tw,atan:ew,atan2:Cw,atanh:nw,avgPool:Gv,avgPool3d:Kv,backend:sI,backend_util:Mj,basicLSTMCell:Zk,batchNorm:gw,batchNorm2d:vw,batchNorm3d:yw,batchNorm4d:bw,batchNormalization:yk,batchNormalization2d:mk,batchNormalization3d:gk,batchNormalization4d:vk,batchToSpaceND:_v,booleanMaskAsync:Mk,browser:p5,buffer:ie,callbacks:eK,cast:Tv,ceil:rw,clipByValue:Ur,clone:dI,complex:Kn,concat:Ir,concat1d:Nx,concat2d:Ix,concat3d:kx,concat4d:Dx,constraints:pH,conv1d:jv,conv2d:hl,conv2dTranspose:Wv,conv3d:Uv,conv3dTranspose:Bk,cos:iw,cosh:aw,cumsum:pI,customGrad:rh,data:rY,deprecationWarn:xv,depthToSpace:Mx,depthwiseConv2d:sh,deregisterOp:rK,diag:n5,disableDeprecationWarnings:sj,dispose:de,disposeVariables:uj,div:kr,divStrict:wk,dot:jk,dropout:Vw,elu:uh,enableDebugMode:oj,enableProdMode:aj,engine:lj,env:gt,equal:cl,equalStrict:Rk,erf:ow,exp:sw,expandDims:fi,expm1:uw,eye:Sv,fft:Wd,fill:nh,findBackend:gj,findBackendFactory:vj,floor:Dv,floorDiv:Fv,frame:ay,fused:zc,gather:oh,gatherND:zw,getBackend:pj,getKernel:xN,getKernelsForBackend:Lb,grad:Ij,grads:kj,greater:ah,greaterEqual:Fd,greaterEqualStrict:Nk,greaterStrict:Ik,hammingWindow:Fw,hannWindow:iy,ifft:Pc,imag:zi,image:Wu,inTopKAsync:a5,initializers:KH,input:uD,io:gi,irfft:ny,isFinite:ck,isInf:lk,isNaN:uk,keep:za,layers:D$,leakyRelu:Jv,less:Tw,lessEqual:Sw,lessEqualStrict:kk,lessStrict:Dk,linalg:jw,linspace:Rx,loadGraphModel:cX,loadLayersModel:tG,localResponseNormalization:Dw,log:Oo,log1p:lw,logSigmoid:sk,logSoftmax:Iv,logSumExp:Qk,logicalAnd:Vo,logicalNot:xw,logicalOr:zv,logicalXor:bk,losses:o5,matMul:Hv,math:tH,max:js,maxPool:qv,maxPool3d:$v,maximum:Ha,maximumStrict:Ck,mean:Nn,memory:Kb,metrics:K$,min:Qv,minimum:ih,minimumStrict:Ek,mod:Ew,modStrict:_k,model:Zq,models:X$,moments:Ud,movingAverage:t5,mul:ne,mulStrict:Bv,multiRNNCell:Jk,multinomial:Lx,neg:ll,nextFrame:ig,norm:Ow,notEqual:Mc,notEqualStrict:Ok,oneHot:kc,ones:Wa,onesLike:yi,op:tt,outerProduct:Uk,pad:$s,pad1d:mI,pad2d:gI,pad3d:vI,pad4d:yI,pool:Xk,pow:Oc,powStrict:Tk,prelu:ty,print:fI,prod:Zv,profile:cj,rand:bI,randomGamma:xI,randomNormal:Px,randomUniform:sl,range:Cv,ready:dj,real:Qr,reciprocal:cw,registerBackend:yj,registerCallbackConstructor:eG,registerKernel:Pb,registerOp:nK,regularizers:J$,relu:Xs,relu6:kw,removeBackend:mj,reshape:Dd,reverse:Fa,reverse1d:Wk,reverse2d:Hk,reverse3d:qk,reverse4d:Gk,rfft:Hd,round:hw,rsqrt:Ov,scalar:zt,scatterND:Pw,selu:ey,separableConv2d:Nw,sequential:Jq,serialization:At,setBackend:fj,setPlatform:bj,setdiff1dAsync:zx,sigmoid:Mv,sign:fw,signal:i5,sin:dw,sinh:pw,slice:bi,slice1d:Bd,slice2d:Xv,slice3d:jd,slice4d:Lc,slice_util:Nj,softmax:ul,softplus:Pd,spaceToBatchND:Av,sparseToDense:ry,spectral:e5,split:To,sqrt:zd,square:Yx,squaredDifference:_w,squaredDifferenceStrict:Sk,squeeze:Od,stack:na,step:hk,stft:Bw,stridedSlice:Mw,sub:sr,subStrict:Ak,sum:ti,tan:mw,tanh:Lv,tensor:Rn,tensor1d:Jr,tensor2d:_o,tensor3d:Sx,tensor4d:vs,tensor5d:cI,tensor6d:hI,tensor_util:Oa,test_util:rH,tidy:ft,tile:Ns,time:hj,topk:Lw,train:Ou,transpose:fn,truncatedNormal:Md,unregisterKernel:XB,unsortedSegmentSum:Aw,unstack:Yu,util:Ht,valueAndGrad:Dj,valueAndGrads:Oj,variable:Ax,variableGrads:RI,version:aY,version_converter:I6,version_core:y5,version_layers:fy,webgl:iH,where:Mo,whereAsync:Vv,zeros:Ue,zerosLike:Te},Symbol.toStringTag,{value:"Module"})),bd=T2(oY);var Nu={},D4;function X6(){if(D4)return Nu;D4=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Nu,"__esModule",{value:!0}),Nu.cropTensor=Nu.capture=void 0;var r=bd;function e(n,i){return r.tidy(function(){var a=r.browser.fromPixels(n),o=t(a,i),u=o.expandDims(0);return u.toFloat().div(r.scalar(127)).sub(r.scalar(1))})}Nu.capture=e;function t(n,i,a){var o=Math.min(n.shape[0],n.shape[1]),u=n.shape[0]/2,l=u-o/2,h=n.shape[1]/2,f=h-o/2;if(i&&!a){var p=n.slice([l,f,0],[o,o,3]);p=p.reshape([o*o,1,3]);var m=[.2989,.587,.114];return p=r.mul(p,m),p=p.reshape([o,o,3]),p=r.sum(p,-1),p=r.expandDims(p,-1),p}return n.slice([l,f,0],[o,o,3])}return Nu.cropTensor=t,Nu}var Ki={},O4;function Y6(){if(O4)return Ki;O4=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.cropTo=Ki.resizeMinTo=Ki.resizeMaxTo=Ki.resize=void 0;var r=function(){return document.createElement("canvas")};function e(a,o,u){u===void 0&&(u=r()),u.width=a.width*o,u.height=a.height*o;var l=u.getContext("2d");return l.drawImage(a,0,0,u.width,u.height),u}Ki.resize=e;function t(a,o,u){u===void 0&&(u=r());var l=Math.max(a.width,a.height);return e(a,o/l,u)}Ki.resizeMaxTo=t;function n(a,o,u){u===void 0&&(u=r());var l=Math.min(a.width,a.height);return e(a,o/l,u)}Ki.resizeMinTo=n;function i(a,o,u,l){u===void 0&&(u=!1),l===void 0&&(l=r());var h=a.width,f=a.height;a instanceof HTMLVideoElement&&(h=a.videoWidth,f=a.videoHeight);var p=Math.min(h,f),m=o/p,v=Math.ceil(h*m),b=Math.ceil(f*m),C=v-o,w=b-o;l.width=l.height=o;var E=l.getContext("2d");return E.drawImage(a,~~(C/2)*-1,~~(w/2)*-1,v,b),u&&(E.scale(-1,1),E.drawImage(l,o*-1,0)),l}return Ki.cropTo=i,Ki}var Af={},M4;function Q6(){if(M4)return Af;M4=1;/** @license See the LICENSE file. */Object.defineProperty(Af,"__esModule",{value:!0}),Af.version=void 0;var r="0.8.4-alpha2";return Af.version=r,Af}var L4;function Z6(){return L4||(L4=1,function(r){/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var e=Su&&Su.__awaiter||function(T,R,N,D){function L(P){return P instanceof N?P:new N(function(B){B(P)})}return new(N||(N=Promise))(function(P,B){function Z(K){try{q(D.next(K))}catch(Q){B(Q)}}function rt(K){try{q(D.throw(K))}catch(Q){B(Q)}}function q(K){K.done?P(K.value):L(K.value).then(Z,rt)}q((D=D.apply(T,R||[])).next())})},t=Su&&Su.__generator||function(T,R){var N={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},D,L,P,B;return B={next:Z(0),throw:Z(1),return:Z(2)},typeof Symbol=="function"&&(B[Symbol.iterator]=function(){return this}),B;function Z(q){return function(K){return rt([q,K])}}function rt(q){if(D)throw new TypeError("Generator is already executing.");for(;N;)try{if(D=1,L&&(P=q[0]&2?L.return:q[0]?L.throw||((P=L.return)&&P.call(L),0):L.next)&&!(P=P.call(L,q[1])).done)return P;switch(L=0,P&&(q=[q[0]&2,P.value]),q[0]){case 0:case 1:P=q;break;case 4:return N.label++,{value:q[1],done:!1};case 5:N.label++,L=q[1],q=[0];continue;case 7:q=N.ops.pop(),N.trys.pop();continue;default:if(P=N.trys,!(P=P.length>0&&P[P.length-1])&&(q[0]===6||q[0]===2)){N=0;continue}if(q[0]===3&&(!P||q[1]>P[0]&&q[1]<P[3])){N.label=q[1];break}if(q[0]===6&&N.label<P[1]){N.label=P[1],P=q;break}if(P&&N.label<P[2]){N.label=P[2],N.ops.push(q);break}P[2]&&N.ops.pop(),N.trys.pop();continue}q=R.call(T,N)}catch(K){q=[6,K],L=0}finally{D=P=0}if(q[0]&5)throw q[1];return{value:q[0]?q[1]:void 0,done:!0}}};Object.defineProperty(r,"__esModule",{value:!0}),r.loadFromFiles=r.load=r.loadTruncatedMobileNet=r.CustomMobileNet=r.getTopKClasses=r.IMAGE_SIZE=void 0;var n=bd,i=bd,a=X6(),o=Y6(),u=Q6(),l=1,h="conv_pw_13_relu",f="out_relu",p=.25,m=.35;r.IMAGE_SIZE=224;var v=function(T){return T.packageVersion=T.packageVersion||u.version,T.packageName=T.packageName||"@teachablemachine/image",T.timeStamp=T.timeStamp||new Date().toISOString(),T.userMetadata=T.userMetadata||{},T.modelName=T.modelName||"untitled",T.labels=T.labels||[],T.imageSize=T.imageSize||r.IMAGE_SIZE,T},b=function(T){return!!T&&Array.isArray(T.labels)},C=function(T,R){if(T===1){if(R!==.25&&R!==.5&&R!==.75&&R!==1)return console.warn("Invalid alpha. Options are: 0.25, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",p.toFixed(2)),p}else if(R!==.35&&R!==.5&&R!==.75&&R!==1)return console.warn("Invalid alpha. Options are: 0.35, 0.50, 0.75 or 1.00."),console.log("Loading model with alpha: ",m.toFixed(2)),m;return R},w=function(T){if(T=T||{},T.checkpointUrl&&T.trainingLayer)return(T.alpha||T.version)&&console.warn("Checkpoint URL passed to modelOptions, alpha options are ignored"),[T.checkpointUrl,T.trainingLayer];if(T.version=T.version||l,T.version===1){T.alpha=T.alpha||p,T.alpha=C(T.version,T.alpha),console.log("Loading mobilenet "+T.version+" and alpha "+T.alpha);var R=T.alpha.toFixed(2);return R==="1.00"&&(R="1.0"),["https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_"+R+"_"+r.IMAGE_SIZE+"/model.json",h]}else{if(T.version===2)return T.alpha=T.alpha||m,T.alpha=C(T.version,T.alpha),console.log("Loading mobilenet "+T.version+" and alpha "+T.alpha),["https://storage.googleapis.com/teachable-machine-models/mobilenet_v2_weights_tf_dim_ordering_tf_kernels_"+T.alpha.toFixed(2)+"_"+r.IMAGE_SIZE+"_no_top/model.json",f];throw new Error("MobileNet V"+T.version+" doesn't exist")}},E=function(T){return e(void 0,void 0,void 0,function(){var R,N;return t(this,function(D){switch(D.label){case 0:return typeof T!="string"?[3,3]:[4,fetch(T)];case 1:return N=D.sent(),[4,N.json()];case 2:return R=D.sent(),[3,4];case 3:if(b(T))R=T;else throw new Error("Invalid Metadata provided");D.label=4;case 4:return[2,v(R)]}})})};function S(T,R,N){return N===void 0&&(N=3),e(this,void 0,void 0,function(){var D;return t(this,function(L){switch(L.label){case 0:return[4,R.data()];case 1:return D=L.sent(),[2,n.tidy(function(){N=Math.min(N,D.length);for(var P=[],B=0;B<D.length;B++)P.push({value:D[B],index:B});P.sort(function(K,Q){return Q.value-K.value});for(var Z=new Float32Array(N),rt=new Int32Array(N),B=0;B<N;B++)Z[B]=P[B].value,rt[B]=P[B].index;for(var q=[],B=0;B<rt.length;B++)q.push({className:T[rt[B]],probability:Z[B]});return q})]}})})}r.getTopKClasses=S;var A=function(){function T(R,N){this.model=R,this._metadata=v(N)}return Object.defineProperty(T,"EXPECTED_IMAGE_SIZE",{get:function(){return r.IMAGE_SIZE},enumerable:!1,configurable:!0}),T.prototype.getMetadata=function(){return this._metadata},T.prototype.getTotalClasses=function(){var R=this.model.output,N=R.shape[1];return N},T.prototype.getClassLabels=function(){return this._metadata.labels},T.prototype.predictTopK=function(R,N,D){return N===void 0&&(N=10),D===void 0&&(D=!1),e(this,void 0,void 0,function(){var L,P,B,Z=this;return t(this,function(rt){switch(rt.label){case 0:return L=o.cropTo(R,this._metadata.imageSize,D),P=n.tidy(function(){var q=a.capture(L,Z._metadata.grayscale);return Z.model.predict(q)}),[4,S(this._metadata.labels,P,N)];case 1:return B=rt.sent(),i.dispose(P),[2,B]}})})},T.prototype.predict=function(R,N){return N===void 0&&(N=!1),e(this,void 0,void 0,function(){var D,L,P,B,Z,rt=this;return t(this,function(q){switch(q.label){case 0:return D=o.cropTo(R,this._metadata.imageSize,N),L=n.tidy(function(){var K=a.capture(D,rt._metadata.grayscale);return rt.model.predict(K)}),[4,L.data()];case 1:for(P=q.sent(),B=[],Z=0;Z<P.length;Z++)B.push({className:this._metadata.labels[Z],probability:P[Z]});return i.dispose(L),[2,B]}})})},T.prototype.dispose=function(){this.truncatedModel.dispose()},T}();r.CustomMobileNet=A;function k(T){return e(this,void 0,void 0,function(){var R,N,D,L,P,B,Z,P,B,Z;return t(this,function(rt){switch(rt.label){case 0:return R=w(T),N=R[0],D=R[1],[4,n.loadLayersModel(N)];case 1:return L=rt.sent(),T&&T.version===1?(P=L.getLayer(D),B=n.model({inputs:L.inputs,outputs:P.output}),Z=n.sequential(),Z.add(B),Z.add(n.layers.flatten()),[2,Z]):(P=L.getLayer(D),B=n.model({inputs:L.inputs,outputs:P.output}),Z=n.sequential(),Z.add(B),Z.add(n.layers.globalAveragePooling2d({})),[2,Z])}})})}r.loadTruncatedMobileNet=k;function O(T,R){return e(this,void 0,void 0,function(){var N,D,L;return t(this,function(P){switch(P.label){case 0:return[4,n.loadLayersModel(T)];case 1:return N=P.sent(),R?[4,E(R)]:[3,3];case 2:return L=P.sent(),[3,4];case 3:L=null,P.label=4;case 4:return D=L,[2,new A(N,D)]}})})}r.load=O;function V(T,R,N){return e(this,void 0,void 0,function(){var D,L,P,B;return t(this,function(Z){switch(Z.label){case 0:return[4,n.loadLayersModel(n.io.browserFiles([T,R]))];case 1:return D=Z.sent(),[4,new Response(N).json()];case 2:return L=Z.sent(),N?[4,E(L)]:[3,4];case 3:return B=Z.sent(),[3,5];case 4:B=null,Z.label=5;case 5:return P=B,[2,new A(D,P)]}})})}r.loadFromFiles=V}(Su)),Su}var ci={},og={exports:{}},sY=og.exports,P4;function uY(){return P4||(P4=1,function(r){(function(e,t,n){function i(l){var h=this,f=u();h.next=function(){var p=2091639*h.s0+h.c*23283064365386963e-26;return h.s0=h.s1,h.s1=h.s2,h.s2=p-(h.c=p|0)},h.c=1,h.s0=f(" "),h.s1=f(" "),h.s2=f(" "),h.s0-=f(l),h.s0<0&&(h.s0+=1),h.s1-=f(l),h.s1<0&&(h.s1+=1),h.s2-=f(l),h.s2<0&&(h.s2+=1),f=null}function a(l,h){return h.c=l.c,h.s0=l.s0,h.s1=l.s1,h.s2=l.s2,h}function o(l,h){var f=new i(l),p=h&&h.state,m=f.next;return m.int32=function(){return f.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,p&&(typeof p=="object"&&a(p,f),m.state=function(){return a(f,{})}),m}function u(){var l=4022871197,h=function(f){f=f.toString();for(var p=0;p<f.length;p++){l+=f.charCodeAt(p);var m=.02519603282416938*l;l=m>>>0,m-=l,m*=l,l=m>>>0,m-=l,l+=m*4294967296}return(l>>>0)*23283064365386963e-26};return h}t&&t.exports?t.exports=o:this.alea=o})(sY,r)}(og)),og.exports}var sg={exports:{}},lY=sg.exports,z4;function cY(){return z4||(z4=1,function(r){(function(e,t,n){function i(u){var l=this,h="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var p=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^p^p>>>8},u===(u|0)?l.x=u:h+=u;for(var f=0;f<h.length+64;f++)l.x^=h.charCodeAt(f)|0,l.next()}function a(u,l){return l.x=u.x,l.y=u.y,l.z=u.z,l.w=u.w,l}function o(u,l){var h=new i(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=h.next()>>>11,v=(h.next()>>>0)/4294967296,b=(m+v)/(1<<21);while(b===0);return b},p.int32=h.next,p.quick=p,f&&(typeof f=="object"&&a(f,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xor128=o})(lY,r)}(sg)),sg.exports}var ug={exports:{}},hY=ug.exports,V4;function fY(){return V4||(V4=1,function(r){(function(e,t,n){function i(u){var l=this,h="";l.next=function(){var p=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(p^p<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,u===(u|0)?l.x=u:h+=u;for(var f=0;f<h.length+64;f++)l.x^=h.charCodeAt(f)|0,f==h.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function a(u,l){return l.x=u.x,l.y=u.y,l.z=u.z,l.w=u.w,l.v=u.v,l.d=u.d,l}function o(u,l){var h=new i(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=h.next()>>>11,v=(h.next()>>>0)/4294967296,b=(m+v)/(1<<21);while(b===0);return b},p.int32=h.next,p.quick=p,f&&(typeof f=="object"&&a(f,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xorwow=o})(hY,r)}(ug)),ug.exports}var lg={exports:{}},dY=lg.exports,F4;function pY(){return F4||(F4=1,function(r){(function(e,t,n){function i(u){var l=this;l.next=function(){var f=l.x,p=l.i,m,v;return m=f[p],m^=m>>>7,v=m^m<<24,m=f[p+1&7],v^=m^m>>>10,m=f[p+3&7],v^=m^m>>>3,m=f[p+4&7],v^=m^m<<7,m=f[p+7&7],m=m^m<<13,v^=m^m<<9,f[p]=v,l.i=p+1&7,v};function h(f,p){var m,v=[];if(p===(p|0))v[0]=p;else for(p=""+p,m=0;m<p.length;++m)v[m&7]=v[m&7]<<15^p.charCodeAt(m)+v[m+1&7]<<13;for(;v.length<8;)v.push(0);for(m=0;m<8&&v[m]===0;++m);for(m==8?v[7]=-1:v[m],f.x=v,f.i=0,m=256;m>0;--m)f.next()}h(l,u)}function a(u,l){return l.x=u.x.slice(),l.i=u.i,l}function o(u,l){u==null&&(u=+new Date);var h=new i(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=h.next()>>>11,v=(h.next()>>>0)/4294967296,b=(m+v)/(1<<21);while(b===0);return b},p.int32=h.next,p.quick=p,f&&(f.x&&a(f,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xorshift7=o})(dY,r)}(lg)),lg.exports}var cg={exports:{}},mY=cg.exports,B4;function gY(){return B4||(B4=1,function(r){(function(e,t,n){function i(u){var l=this;l.next=function(){var f=l.w,p=l.X,m=l.i,v,b;return l.w=f=f+1640531527|0,b=p[m+34&127],v=p[m=m+1&127],b^=b<<13,v^=v<<17,b^=b>>>15,v^=v>>>12,b=p[m]=b^v,l.i=m,b+(f^f>>>16)|0};function h(f,p){var m,v,b,C,w,E=[],S=128;for(p===(p|0)?(v=p,p=null):(p=p+"\0",v=0,S=Math.max(S,p.length)),b=0,C=-32;C<S;++C)p&&(v^=p.charCodeAt((C+32)%p.length)),C===0&&(w=v),v^=v<<10,v^=v>>>15,v^=v<<4,v^=v>>>13,C>=0&&(w=w+1640531527|0,m=E[C&127]^=v+w,b=m==0?b+1:0);for(b>=128&&(E[(p&&p.length||0)&127]=-1),b=127,C=4*128;C>0;--C)v=E[b+34&127],m=E[b=b+1&127],v^=v<<13,m^=m<<17,v^=v>>>15,m^=m>>>12,E[b]=v^m;f.w=w,f.X=E,f.i=b}h(l,u)}function a(u,l){return l.i=u.i,l.w=u.w,l.X=u.X.slice(),l}function o(u,l){u==null&&(u=+new Date);var h=new i(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=h.next()>>>11,v=(h.next()>>>0)/4294967296,b=(m+v)/(1<<21);while(b===0);return b},p.int32=h.next,p.quick=p,f&&(f.X&&a(f,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.xor4096=o})(mY,r)}(cg)),cg.exports}var hg={exports:{}},vY=hg.exports,j4;function yY(){return j4||(j4=1,function(r){(function(e,t,n){function i(u){var l=this,h="";l.next=function(){var p=l.b,m=l.c,v=l.d,b=l.a;return p=p<<25^p>>>7^m,m=m-v|0,v=v<<24^v>>>8^b,b=b-p|0,l.b=p=p<<20^p>>>12^m,l.c=m=m-v|0,l.d=v<<16^m>>>16^b,l.a=b-p|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,u===Math.floor(u)?(l.a=u/4294967296|0,l.b=u|0):h+=u;for(var f=0;f<h.length+20;f++)l.b^=h.charCodeAt(f)|0,l.next()}function a(u,l){return l.a=u.a,l.b=u.b,l.c=u.c,l.d=u.d,l}function o(u,l){var h=new i(u),f=l&&l.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=h.next()>>>11,v=(h.next()>>>0)/4294967296,b=(m+v)/(1<<21);while(b===0);return b},p.int32=h.next,p.quick=p,f&&(typeof f=="object"&&a(f,h),p.state=function(){return a(h,{})}),p}t&&t.exports?t.exports=o:this.tychei=o})(vY,r)}(hg)),hg.exports}var ab={exports:{}};const bY={},xY=Object.freeze(Object.defineProperty({__proto__:null,default:bY},Symbol.toStringTag,{value:"Module"})),wY=T2(xY);var U4;function CY(){return U4||(U4=1,function(r){(function(e,t){var n=(0,eval)("this"),i=256,a=6,o=52,u="random",l=t.pow(i,a),h=t.pow(2,o),f=h*2,p=i-1,m;function v(k,O,V){var T=[];O=O==!0?{entropy:!0}:O||{};var R=E(w(O.entropy?[k,A(e)]:k??S(),3),T),N=new b(T),D=function(){for(var L=N.g(a),P=l,B=0;L<h;)L=(L+B)*i,P*=i,B=N.g(1);for(;L>=f;)L/=2,P/=2,B>>>=1;return(L+B)/P};return D.int32=function(){return N.g(4)|0},D.quick=function(){return N.g(4)/4294967296},D.double=D,E(A(N.S),e),(O.pass||V||function(L,P,B,Z){return Z&&(Z.S&&C(Z,N),L.state=function(){return C(N,{})}),B?(t[u]=L,P):L})(D,R,"global"in O?O.global:this==t,O.state)}t["seed"+u]=v;function b(k){var O,V=k.length,T=this,R=0,N=T.i=T.j=0,D=T.S=[];for(V||(k=[V++]);R<i;)D[R]=R++;for(R=0;R<i;R++)D[R]=D[N=p&N+k[R%V]+(O=D[R])],D[N]=O;(T.g=function(L){for(var P,B=0,Z=T.i,rt=T.j,q=T.S;L--;)P=q[Z=p&Z+1],B=B*i+q[p&(q[Z]=q[rt=p&rt+P])+(q[rt]=P)];return T.i=Z,T.j=rt,B})(i)}function C(k,O){return O.i=k.i,O.j=k.j,O.S=k.S.slice(),O}function w(k,O){var V=[],T=typeof k,R;if(O&&T=="object")for(R in k)try{V.push(w(k[R],O-1))}catch{}return V.length?V:T=="string"?k:k+"\0"}function E(k,O){for(var V=k+"",T,R=0;R<V.length;)O[p&R]=p&(T^=O[p&R]*19)+V.charCodeAt(R++);return A(O)}function S(){try{var k;return m&&(k=m.randomBytes)?k=k(i):(k=new Uint8Array(i),(n.crypto||n.msCrypto).getRandomValues(k)),A(k)}catch{var O=n.navigator,V=O&&O.plugins;return[+new Date,n,V,n.screen,A(e)]}}function A(k){return String.fromCharCode.apply(0,k)}if(E(t.random(),e),r.exports){r.exports=v;try{m=wY}catch{}}})([],Math)}(ab)),ab.exports}var ob,W4;function EY(){if(W4)return ob;W4=1;var r=uY(),e=cY(),t=fY(),n=pY(),i=gY(),a=yY(),o=CY();return o.alea=r,o.xor128=e,o.xorwow=t,o.xorshift7=n,o.xor4096=i,o.tychei=a,ob=o,ob}var H4;function _Y(){if(H4)return ci;H4=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var r=ci&&ci.__extends||function(){var b=function(C,w){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,S){E.__proto__=S}||function(E,S){for(var A in S)S.hasOwnProperty(A)&&(E[A]=S[A])},b(C,w)};return function(C,w){b(C,w);function E(){this.constructor=C}C.prototype=w===null?Object.create(w):(E.prototype=w.prototype,new E)}}(),e=ci&&ci.__awaiter||function(b,C,w,E){function S(A){return A instanceof w?A:new w(function(k){k(A)})}return new(w||(w=Promise))(function(A,k){function O(R){try{T(E.next(R))}catch(N){k(N)}}function V(R){try{T(E.throw(R))}catch(N){k(N)}}function T(R){R.done?A(R.value):S(R.value).then(O,V)}T((E=E.apply(b,C||[])).next())})},t=ci&&ci.__generator||function(b,C){var w={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},E,S,A,k;return k={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function O(T){return function(R){return V([T,R])}}function V(T){if(E)throw new TypeError("Generator is already executing.");for(;w;)try{if(E=1,S&&(A=T[0]&2?S.return:T[0]?S.throw||((A=S.return)&&A.call(S),0):S.next)&&!(A=A.call(S,T[1])).done)return A;switch(S=0,A&&(T=[T[0]&2,A.value]),T[0]){case 0:case 1:A=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,S=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(A=w.trys,!(A=A.length>0&&A[A.length-1])&&(T[0]===6||T[0]===2)){w=0;continue}if(T[0]===3&&(!A||T[1]>A[0]&&T[1]<A[3])){w.label=T[1];break}if(T[0]===6&&w.label<A[1]){w.label=A[1],A=T;break}if(A&&w.label<A[2]){w.label=A[2],w.ops.push(T);break}A[2]&&w.ops.pop(),w.trys.pop();continue}T=C.call(b,w)}catch(R){T=[6,R],S=0}finally{E=A=0}if(T[0]&5)throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}};Object.defineProperty(ci,"__esModule",{value:!0}),ci.createTeachable=ci.TeachableMobileNet=void 0;var n=bd,i=bd,a=X6(),o=Z6(),u=EY(),l=.15,h=function(b){return typeof b.dataId=="object"&&typeof b.shape=="object"};function f(b,C){var w=new Array(C).fill(0);return w[b]=1,w}function p(b,C){for(var w,E=b.length,S=b.slice(),A=E-1;A>0;A-=1){var k=void 0;C?k=Math.floor(C()*(A+1)):k=Math.floor(Math.random()*(A+1)),w=[S[k],S[A]],S[A]=w[0],S[k]=w[1]}return S}var m=function(b){r(C,b);function C(w,E){var S=b.call(this,n.sequential(),E)||this;return S.totalSamples=0,S.examples=[],S.truncatedModel=w,S}return Object.defineProperty(C.prototype,"asSequentialModel",{get:function(){return this.model},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isTrained",{get:function(){return!!this.model&&this.model.layers&&this.model.layers.length>2},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isPrepared",{get:function(){return!!this.trainDataset},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"numClasses",{get:function(){return this._metadata.labels.length},enumerable:!1,configurable:!0}),C.prototype.addExample=function(w,E){return e(this,void 0,void 0,function(){var S,A,k;return t(this,function(O){return S=h(E)?E:a.capture(E,this._metadata.grayscale),A=this.truncatedModel.predict(S),k=A.dataSync(),S.dispose(),A.dispose(),this.examples[w].push(k),this.totalSamples++,[2]})})},C.prototype.predict=function(w,E){return E===void 0&&(E=!1),e(this,void 0,void 0,function(){return t(this,function(S){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,b.prototype.predict.call(this,w,E)]})})},C.prototype.predictTopK=function(w,E,S){return E===void 0&&(E=10),S===void 0&&(S=!1),e(this,void 0,void 0,function(){return t(this,function(A){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,b.prototype.predictTopK.call(this,w,E,S)]})})},C.prototype.prepare=function(){for(var w in this.examples)if(w.length===0)throw new Error("Add some examples before training");var E=this.convertToTfDataset();this.trainDataset=E.trainDataset,this.validationDataset=E.validationDataset},C.prototype.convertToTfDataset=function(){for(var w=0;w<this.examples.length;w++)this.examples[w]=p(this.examples[w],this.seed);for(var E=[],S=[],A=function(N){var D=f(N,k.numClasses),L=k.examples[N].length,P=Math.ceil(l*L),B=L-P,Z=k.examples[N].slice(0,B).map(function(q){return{data:q,label:D}}),rt=k.examples[N].slice(B).map(function(q){return{data:q,label:D}});E=E.concat(Z),S=S.concat(rt)},k=this,w=0;w<this.examples.length;w++)A(w);E=p(E,this.seed),S=p(S,this.seed);var O=n.data.array(E.map(function(N){return N.data})),V=n.data.array(S.map(function(N){return N.data})),T=n.data.array(E.map(function(N){return N.label})),R=n.data.array(S.map(function(N){return N.label}));return{trainDataset:n.data.zip({xs:O,ys:T}),validationDataset:n.data.zip({xs:V,ys:R})}},C.prototype.save=function(w,E){return e(this,void 0,void 0,function(){return t(this,function(S){return[2,this.model.save(w,E)]})})},C.prototype.train=function(w,E){return E===void 0&&(E={}),e(this,void 0,void 0,function(){var S,A,k,O,V,T,R,N,D,L=this;return t(this,function(P){switch(P.label){case 0:if(S=E.onTrainEnd||function(){},E.onTrainEnd=function(B){L.__stopTrainingResolve&&(L.__stopTrainingResolve(),L.__stopTrainingResolve=null),S(B)},this.isPrepared||this.prepare(),A=this.getLabels().length,i.util.assert(A===this.numClasses,function(){return"Can not train, has "+A+" labels and "+L.numClasses+" classes"}),k=this.truncatedModel.outputs[0].shape.slice(1),O=n.util.sizeFromShape(k),this.seed?V=n.initializers.varianceScaling({seed:3.14}):V=n.initializers.varianceScaling({}),this.trainingModel=n.sequential({layers:[n.layers.dense({inputShape:[O],units:w.denseUnits,activation:"relu",kernelInitializer:V,useBias:!0}),n.layers.dense({kernelInitializer:V,useBias:!1,activation:"softmax",units:this.numClasses})]}),T=n.train.adam(w.learningRate),this.trainingModel.compile({optimizer:T,loss:"categoricalCrossentropy",metrics:["accuracy"]}),!(w.batchSize>0))throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction");return R=this.trainDataset.batch(w.batchSize),N=this.validationDataset.batch(w.batchSize),[4,this.trainingModel.fitDataset(R,{epochs:w.epochs,validationData:N,callbacks:E})];case 1:return P.sent(),D=n.sequential(),D.add(this.truncatedModel),D.add(this.trainingModel),this.model=D,T.dispose(),[2,this.model]}})})},C.prototype.prepareDataset=function(){for(var w=0;w<this.numClasses;w++)this.examples[w]=[]},C.prototype.setLabel=function(w,E){this._metadata.labels[w]=E},C.prototype.setLabels=function(w){this._metadata.labels=w,this.prepareDataset()},C.prototype.getLabel=function(w){return this._metadata.labels[w]},C.prototype.getLabels=function(){return this._metadata.labels},C.prototype.setName=function(w){this._metadata.modelName=w},C.prototype.getName=function(){return this._metadata.modelName},C.prototype.stopTraining=function(){var w=this,E=new Promise(function(S,A){w.trainingModel.stopTraining=!0,w.__stopTrainingResolve=S});return E},C.prototype.dispose=function(){this.trainingModel.dispose(),b.prototype.dispose.call(this)},C.prototype.calculateAccuracyPerClass=function(){return e(this,void 0,void 0,function(){var w,E,S,A,k,O,V,T,R,N,K,D,L,P,B,Z,rt,q,K,Q=this;return t(this,function(ut){switch(ut.label){case 0:return w=this.validationDataset.mapAsync(function(W){return e(Q,void 0,void 0,function(){return t(this,function(et){return[2,W.xs]})})}),E=this.validationDataset.mapAsync(function(W){return e(Q,void 0,void 0,function(){return t(this,function(et){return[2,W.ys]})})}),S=Math.min(E.size,32),A=Math.ceil(E.size/S),k=w.batch(S),O=E.batch(S),[4,k.iterator()];case 1:return V=ut.sent(),[4,O.iterator()];case 2:T=ut.sent(),R=[],N=[],K=0,ut.label=3;case 3:return K<A?[4,V.next()]:[3,7];case 4:return D=ut.sent(),L=this.trainingModel.predict(D.value),P=L.argMax(1),R.push(P),[4,T.next()];case 5:B=ut.sent(),Z=B.value.argMax(1),N.push(Z),D.value.dispose(),L.dispose(),B.value.dispose(),ut.label=6;case 6:return K++,[3,3];case 7:if(rt=n.concat(N),q=n.concat(R),A!==1)for(K=0;K<R.length;K++)R[K].dispose(),N[K].dispose();return[2,{reference:rt,predictions:q}]}})})},C.prototype.setSeed=function(w){this.seed=u(w)},C}(o.CustomMobileNet);ci.TeachableMobileNet=m;function v(b,C){return e(this,void 0,void 0,function(){var w;return t(this,function(E){switch(E.label){case 0:return[4,o.loadTruncatedMobileNet(C)];case 1:return w=E.sent(),[2,new m(w,b)]}})})}return ci.createTeachable=v,ci}var Xi={};function fg(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?fg=function(t){return typeof t}:fg=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fg(r)}function NC(r,e,t){var n=t.value;if(typeof n!="function")throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(fg(n)));var i=!1;return{configurable:!0,get:function(){if(i||this===r.prototype||this.hasOwnProperty(e)||typeof n!="function")return n;var o=n.bind(this);return i=!0,Object.defineProperty(this,e,{configurable:!0,get:function(){return o},set:function(l){n=l,delete this[e]}}),i=!1,o},set:function(o){n=o}}}function J6(r){var e;return typeof Reflect<"u"&&typeof Reflect.ownKeys=="function"?e=Reflect.ownKeys(r.prototype):(e=Object.getOwnPropertyNames(r.prototype),typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(r.prototype)))),e.forEach(function(t){if(t!=="constructor"){var n=Object.getOwnPropertyDescriptor(r.prototype,t);typeof n.value=="function"&&Object.defineProperty(r.prototype,t,NC(r,t,n))}}),r}function TY(){return arguments.length===1?J6.apply(void 0,arguments):NC.apply(void 0,arguments)}const SY=Object.freeze(Object.defineProperty({__proto__:null,boundClass:J6,boundMethod:NC,default:TY},Symbol.toStringTag,{value:"Module"})),AY=T2(SY);var q4;function RY(){if(q4)return Xi;q4=1;/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var r=Xi&&Xi.__decorate||function(l,h,f,p){var m=arguments.length,v=m<3?h:p===null?p=Object.getOwnPropertyDescriptor(h,f):p,b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(l,h,f,p);else for(var C=l.length-1;C>=0;C--)(b=l[C])&&(v=(m<3?b(v):m>3?b(h,f,v):b(h,f))||v);return m>3&&v&&Object.defineProperty(h,f,v),v},e=Xi&&Xi.__awaiter||function(l,h,f,p){function m(v){return v instanceof f?v:new f(function(b){b(v)})}return new(f||(f=Promise))(function(v,b){function C(S){try{E(p.next(S))}catch(A){b(A)}}function w(S){try{E(p.throw(S))}catch(A){b(A)}}function E(S){S.done?v(S.value):m(S.value).then(C,w)}E((p=p.apply(l,h||[])).next())})},t=Xi&&Xi.__generator||function(l,h){var f={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},p,m,v,b;return b={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(b[Symbol.iterator]=function(){return this}),b;function C(E){return function(S){return w([E,S])}}function w(E){if(p)throw new TypeError("Generator is already executing.");for(;f;)try{if(p=1,m&&(v=E[0]&2?m.return:E[0]?m.throw||((v=m.return)&&v.call(m),0):m.next)&&!(v=v.call(m,E[1])).done)return v;switch(m=0,v&&(E=[E[0]&2,v.value]),E[0]){case 0:case 1:v=E;break;case 4:return f.label++,{value:E[1],done:!1};case 5:f.label++,m=E[1],E=[0];continue;case 7:E=f.ops.pop(),f.trys.pop();continue;default:if(v=f.trys,!(v=v.length>0&&v[v.length-1])&&(E[0]===6||E[0]===2)){f=0;continue}if(E[0]===3&&(!v||E[1]>v[0]&&E[1]<v[3])){f.label=E[1];break}if(E[0]===6&&f.label<v[1]){f.label=v[1],v=E;break}if(v&&f.label<v[2]){f.label=v[2],f.ops.push(E);break}v[2]&&f.ops.pop(),f.trys.pop();continue}E=h.call(l,f)}catch(S){E=[6,S],m=0}finally{p=v=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}};Object.defineProperty(Xi,"__esModule",{value:!0}),Xi.Webcam=void 0;var n=AY,i=Y6(),a={facingMode:"user",frameRate:24},o=function(l){return l.facingMode=l.facingMode||a.facingMode,l.frameRate=l.frameRate||a.frameRate,l.aspectRatio=l.aspectRatio||a.aspectRatio,l},u=function(){function l(h,f,p){h===void 0&&(h=400),f===void 0&&(f=400),p===void 0&&(p=!1),this.width=h,this.height=f,this.flip=p}return l.prototype.getWebcam=function(h){if(h===void 0&&(h={}),!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia)return Promise.reject("Your browser does not support WebRTC. Please try another one.");h.width=640;var f=o(h),p=document.createElement("video");return window.navigator.mediaDevices.getUserMedia({video:f}).then(function(m){return p.srcObject=m,p.addEventListener("loadedmetadata",function(v){var b=p.videoWidth,C=p.videoHeight;p.width=b,p.height=C}),p},function(){return Promise.reject("Could not open your camera. You may have denied access.")})},l.prototype.setup=function(h){return h===void 0&&(h={}),e(this,void 0,void 0,function(){var f;return t(this,function(p){switch(p.label){case 0:return this.webcam?[3,2]:(f=this,[4,this.getWebcam(h)]);case 1:f.webcam=p.sent(),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height),p.label=2;case 2:return[2]}})})},l.prototype.play=function(){var h=this.webcam.play();return h},l.prototype.pause=function(){this.webcam.pause()},l.prototype.stop=function(){this.stopStreamedVideo(this.webcam)},l.prototype.update=function(){this.renderCameraToCanvas()},l.prototype.stopStreamedVideo=function(h){var f=h.srcObject,p=f.getTracks();p.forEach(function(m){m.stop()}),h.srcObject=null},l.prototype.renderCameraToCanvas=function(){if(this.canvas&&this.webcam){var h=this.canvas.getContext("2d");if(this.webcam.videoWidth!==0){var f=i.cropTo(this.webcam,this.width,this.flip);h.drawImage(f,0,0)}}},r([n.default],l.prototype,"getWebcam",null),r([n.default],l.prototype,"setup",null),r([n.default],l.prototype,"play",null),r([n.default],l.prototype,"pause",null),r([n.default],l.prototype,"stop",null),r([n.default],l.prototype,"update",null),r([n.default],l.prototype,"stopStreamedVideo",null),r([n.default],l.prototype,"renderCameraToCanvas",null),l}();return Xi.Webcam=u,Xi}var G4;function NY(){return G4||(G4=1,function(r){/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(r,"__esModule",{value:!0});var e=Z6();Object.defineProperty(r,"IMAGE_SIZE",{enumerable:!0,get:function(){return e.IMAGE_SIZE}}),Object.defineProperty(r,"CustomMobileNet",{enumerable:!0,get:function(){return e.CustomMobileNet}}),Object.defineProperty(r,"load",{enumerable:!0,get:function(){return e.load}}),Object.defineProperty(r,"loadFromFiles",{enumerable:!0,get:function(){return e.loadFromFiles}}),Object.defineProperty(r,"loadTruncatedMobileNet",{enumerable:!0,get:function(){return e.loadTruncatedMobileNet}});var t=_Y();Object.defineProperty(r,"TeachableMobileNet",{enumerable:!0,get:function(){return t.TeachableMobileNet}}),Object.defineProperty(r,"createTeachable",{enumerable:!0,get:function(){return t.createTeachable}});var n=RY();Object.defineProperty(r,"Webcam",{enumerable:!0,get:function(){return n.Webcam}});var i=Q6();Object.defineProperty(r,"version",{enumerable:!0,get:function(){return i.version}})}(k1)),k1}var IY=NY();const kY=({to:r,onClick:e,text:t="Retake"})=>{const n=wi(),i=()=>{e?e():r&&n(r)};return M.jsxs("button",{className:"continue-button",onClick:i,children:[M.jsx("h3",{children:t}),M.jsx(CB,{className:"arrow"})]})},DY=({onClick:r,text:e})=>M.jsxs("button",{className:"continue-button",onClick:r,children:[M.jsx("h3",{children:e}),M.jsx(Rd,{className:"arrow"})]}),$4="https://teachablemachine.withgoogle.com/models/rM4lfitvI/",OY=()=>{uN();const r=Lo(),{image:e,sceneId:t}=r.state||{},[n,i]=X.useState(null),[a,o]=X.useState(!1),[u,l]=X.useState(!1),h=vN.find(p=>p.id===t);if(X.useEffect(()=>{let p=!1;return e&&(async()=>{try{i(null);const v=$4+"model.json",b=$4+"metadata.json",C=await IY.load(v,b),w=new Image;w.src=e,w.onload=async()=>{if(p)return;const S=(await C.predict(w)).find(A=>A.className==="Lion Exhibit");i(S!==void 0&&S.probability>.85)}}catch(v){console.error("Error loading model or predicting",v),p||i(!1)}})(),()=>{p=!0}},[e]),!e||!h)return M.jsx("div",{children:"Something went wrong. Try again."});const f=()=>{o(!0),setTimeout(()=>{l(!0)},100)};return M.jsxs("div",{className:"ar-result-page",children:[M.jsx("div",{className:"content-notif",children:M.jsx(vv,{icon:null,heading:n===null?"Analyzing...":n?h.successText:h.failText,description:n===null?"Checking your image...":n?"These pictures sure awaken some memories.":"Try capturing the lion exhibit again."})}),!a&&M.jsx("img",{src:e,alt:"Captured",className:"captured-image"}),a&&M.jsxs("video",{className:"lion-video",autoPlay:!0,muted:!0,playsInline:!0,loop:!0,children:[M.jsx("source",{src:h.videoUrl,type:"video/mp4"}),"Your browser does not support the video tag."]}),n!==null&&M.jsx("div",{className:"ar-result-controls",children:n?a?u?M.jsx(Zc,{to:h.nextPage,text:"Continue"}):null:M.jsx(DY,{onClick:f,text:"Remember"}):M.jsx(kY,{to:`/safariPages/ar/${h.id}`,text:"Try Again"})})]})};function MY(){const{shouldHideNavbar:r}=gv();return M.jsxs(M.Fragment,{children:[!r&&M.jsx(YV,{}),M.jsxs(SM,{children:[M.jsx(mn,{path:"/",element:M.jsx(EV,{})}),M.jsx(mn,{path:"/exhibitions",element:M.jsx(AV,{})}),M.jsx(mn,{path:"/exhibitions/:id",element:M.jsx(BV,{})}),M.jsx(mn,{path:"/map",element:M.jsx(jV,{})}),M.jsx(mn,{path:"/schedule",element:M.jsx(qV,{})}),M.jsx(mn,{path:"/schedule/event/:id",element:M.jsx(KB,{})}),M.jsx(mn,{path:"/infoPages/ticket-prices",element:M.jsx(eF,{})}),M.jsx(mn,{path:"/infoPages/opening-hours",element:M.jsx(rF,{})}),M.jsx(mn,{path:"/infoPages/route-parking",element:M.jsx(sF,{})}),M.jsx(mn,{path:"/infoPages/social-media",element:M.jsx(bF,{})}),M.jsx(mn,{path:"/infoPages/contact-info",element:M.jsx(wF,{})}),M.jsx(mn,{path:"/safariPages/slider",element:M.jsx(_F,{})}),M.jsx(mn,{path:"/safariPages/checkbox",element:M.jsx(kF,{})}),M.jsx(mn,{path:"/safariPages/poll",element:M.jsx(DF,{})}),M.jsx(mn,{path:"/safariPages/poll-results",element:M.jsx(MF,{})}),M.jsx(mn,{path:"/safariPages/scene/:id",element:M.jsx(NB,{})}),M.jsx(mn,{path:"/safariPages/notification/:id",element:M.jsx(PB,{})}),M.jsx(mn,{path:"/safariPages/sliderEnd",element:M.jsx(zB,{})}),M.jsx(mn,{path:"/safariPages/choose",element:M.jsx(FB,{})}),M.jsx(mn,{path:"/safariPages/dialog",element:M.jsx(HB,{})}),M.jsx(mn,{path:"/safariPages/ar/:id",element:M.jsx(GB,{})}),M.jsx(mn,{path:"/safariPages/ar-result",element:M.jsx(OY,{})})]})]})}L9.createRoot(document.getElementById("root")).render(M.jsx(X.StrictMode,{children:M.jsx(YM,{basename:"/nhm-app/",children:M.jsx(FV,{children:M.jsx(MY,{})})})}));
